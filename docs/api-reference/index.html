
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Automated and authored documentation for the Ragora project.">
      
      
      
        <link rel="canonical" href="https://vahidlari.github.io/aiApps/api-reference/">
      
      
        <link rel="prev" href="../contributing/">
      
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.23">
    
    
      
        <title>API Reference - Ragora Documentation</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.84d31ad4.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../stylesheets/overrides.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#api-reference" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Ragora Documentation" class="md-header__button md-logo" aria-label="Ragora Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Ragora Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              API Reference
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="Share" aria-label="Share" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/vahidlari/aiApps" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    vahidlari/aiApps
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Ragora Documentation" class="md-nav__button md-logo" aria-label="Ragora Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Ragora Documentation
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/vahidlari/aiApps" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    vahidlari/aiApps
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../getting_started/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Getting Started
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Guides
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Guides
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../development/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Development Workflow
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../release/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Release Process
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../devcontainer/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    DevContainer Setup
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../onboarding/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Onboarding Guide
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../deployment/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Deployment
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../testing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Testing
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../design_decisions/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Design Decisions
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../contributing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Contributing
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Reference
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    API Reference
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    API Reference
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#cli" class="md-nav__link">
    <span class="md-ellipsis">
      CLI
    </span>
  </a>
  
    <nav class="md-nav" aria-label="CLI">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ragora.cli.main" class="md-nav__link">
    <span class="md-ellipsis">
      main
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.cli.main.create_parser" class="md-nav__link">
    <span class="md-ellipsis">
      create_parser
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.cli.main.main" class="md-nav__link">
    <span class="md-ellipsis">
      main
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.cli.main.process_document_command" class="md-nav__link">
    <span class="md-ellipsis">
      process_document_command
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.cli.main.query_command" class="md-nav__link">
    <span class="md-ellipsis">
      query_command
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.cli.main.setup_logging" class="md-nav__link">
    <span class="md-ellipsis">
      setup_logging
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.cli.main.status_command" class="md-nav__link">
    <span class="md-ellipsis">
      status_command
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#core" class="md-nav__link">
    <span class="md-ellipsis">
      Core
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Core">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#knowledge-base-manager" class="md-nav__link">
    <span class="md-ellipsis">
      Knowledge Base Manager
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Knowledge Base Manager">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ragora.core.knowledge_base_manager" class="md-nav__link">
    <span class="md-ellipsis">
      knowledge_base_manager
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.knowledge_base_manager.KnowledgeBaseManager" class="md-nav__link">
    <span class="md-ellipsis">
      KnowledgeBaseManager
    </span>
  </a>
  
    <nav class="md-nav" aria-label="KnowledgeBaseManager">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ragora.core.knowledge_base_manager.KnowledgeBaseManager._ensure_email_connection" class="md-nav__link">
    <span class="md-ellipsis">
      _ensure_email_connection
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.knowledge_base_manager.KnowledgeBaseManager.check_new_emails" class="md-nav__link">
    <span class="md-ellipsis">
      check_new_emails
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.knowledge_base_manager.KnowledgeBaseManager.clear_collection" class="md-nav__link">
    <span class="md-ellipsis">
      clear_collection
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.knowledge_base_manager.KnowledgeBaseManager.close" class="md-nav__link">
    <span class="md-ellipsis">
      close
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.knowledge_base_manager.KnowledgeBaseManager.create_collection" class="md-nav__link">
    <span class="md-ellipsis">
      create_collection
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.knowledge_base_manager.KnowledgeBaseManager.delete_chunk" class="md-nav__link">
    <span class="md-ellipsis">
      delete_chunk
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.knowledge_base_manager.KnowledgeBaseManager.delete_collection" class="md-nav__link">
    <span class="md-ellipsis">
      delete_collection
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.knowledge_base_manager.KnowledgeBaseManager.get_chunk" class="md-nav__link">
    <span class="md-ellipsis">
      get_chunk
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.knowledge_base_manager.KnowledgeBaseManager.get_collection_stats" class="md-nav__link">
    <span class="md-ellipsis">
      get_collection_stats
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.knowledge_base_manager.KnowledgeBaseManager.list_collections" class="md-nav__link">
    <span class="md-ellipsis">
      list_collections
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.knowledge_base_manager.KnowledgeBaseManager.process_document" class="md-nav__link">
    <span class="md-ellipsis">
      process_document
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.knowledge_base_manager.KnowledgeBaseManager.process_documents" class="md-nav__link">
    <span class="md-ellipsis">
      process_documents
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.knowledge_base_manager.KnowledgeBaseManager.process_email_account" class="md-nav__link">
    <span class="md-ellipsis">
      process_email_account
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.knowledge_base_manager.KnowledgeBaseManager.process_emails" class="md-nav__link">
    <span class="md-ellipsis">
      process_emails
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.knowledge_base_manager.KnowledgeBaseManager.process_new_emails" class="md-nav__link">
    <span class="md-ellipsis">
      process_new_emails
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.knowledge_base_manager.KnowledgeBaseManager.search" class="md-nav__link">
    <span class="md-ellipsis">
      search
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.knowledge_base_manager.SearchResult" class="md-nav__link">
    <span class="md-ellipsis">
      SearchResult
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.knowledge_base_manager.SearchStrategy" class="md-nav__link">
    <span class="md-ellipsis">
      SearchStrategy
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#models" class="md-nav__link">
    <span class="md-ellipsis">
      Models
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Models">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ragora.core.models" class="md-nav__link">
    <span class="md-ellipsis">
      models
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.models.EmailAddressModel" class="md-nav__link">
    <span class="md-ellipsis">
      EmailAddressModel
    </span>
  </a>
  
    <nav class="md-nav" aria-label="EmailAddressModel">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ragora.core.models.EmailAddressModel.from_email_address" class="md-nav__link">
    <span class="md-ellipsis">
      from_email_address
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.models.EmailAddressModel.to_email_address" class="md-nav__link">
    <span class="md-ellipsis">
      to_email_address
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.models.EmailListResult" class="md-nav__link">
    <span class="md-ellipsis">
      EmailListResult
    </span>
  </a>
  
    <nav class="md-nav" aria-label="EmailListResult">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ragora.core.models.EmailListResult.email_messages" class="md-nav__link">
    <span class="md-ellipsis">
      email_messages
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.models.EmailListResult.validate_count_matches_emails" class="md-nav__link">
    <span class="md-ellipsis">
      validate_count_matches_emails
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.models.EmailMessageModel" class="md-nav__link">
    <span class="md-ellipsis">
      EmailMessageModel
    </span>
  </a>
  
    <nav class="md-nav" aria-label="EmailMessageModel">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ragora.core.models.EmailMessageModel.from_email_message" class="md-nav__link">
    <span class="md-ellipsis">
      from_email_message
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.models.EmailMessageModel.get_all_recipients" class="md-nav__link">
    <span class="md-ellipsis">
      get_all_recipients
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.models.EmailMessageModel.get_body" class="md-nav__link">
    <span class="md-ellipsis">
      get_body
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.models.EmailMessageModel.to_email_message" class="md-nav__link">
    <span class="md-ellipsis">
      to_email_message
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.models.RetrievalMetadata" class="md-nav__link">
    <span class="md-ellipsis">
      RetrievalMetadata
    </span>
  </a>
  
    <nav class="md-nav" aria-label="RetrievalMetadata">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ragora.core.models.RetrievalMetadata.from_properties" class="md-nav__link">
    <span class="md-ellipsis">
      from_properties
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.models.RetrievalResultItem" class="md-nav__link">
    <span class="md-ellipsis">
      RetrievalResultItem
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.models.SearchResultItem" class="md-nav__link">
    <span class="md-ellipsis">
      SearchResultItem
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SearchResultItem">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ragora.core.models.SearchResultItem.sender" class="md-nav__link">
    <span class="md-ellipsis">
      sender
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.models.SearchResultItem.subject" class="md-nav__link">
    <span class="md-ellipsis">
      subject
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.models.SearchResultItem.parse_timestamp" class="md-nav__link">
    <span class="md-ellipsis">
      parse_timestamp
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#retriever" class="md-nav__link">
    <span class="md-ellipsis">
      Retriever
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Retriever">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ragora.core.retriever" class="md-nav__link">
    <span class="md-ellipsis">
      retriever
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.retriever.Retriever" class="md-nav__link">
    <span class="md-ellipsis">
      Retriever
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Retriever">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ragora.core.retriever.Retriever._get_current_timestamp" class="md-nav__link">
    <span class="md-ellipsis">
      _get_current_timestamp
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.retriever.Retriever._preprocess_query" class="md-nav__link">
    <span class="md-ellipsis">
      _preprocess_query
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.retriever.Retriever._process_hybrid_results" class="md-nav__link">
    <span class="md-ellipsis">
      _process_hybrid_results
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.retriever.Retriever._process_keyword_results" class="md-nav__link">
    <span class="md-ellipsis">
      _process_keyword_results
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.retriever.Retriever._process_vector_results" class="md-nav__link">
    <span class="md-ellipsis">
      _process_vector_results
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.retriever.Retriever.get_retrieval_stats" class="md-nav__link">
    <span class="md-ellipsis">
      get_retrieval_stats
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.retriever.Retriever.search_hybrid" class="md-nav__link">
    <span class="md-ellipsis">
      search_hybrid
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.retriever.Retriever.search_keyword" class="md-nav__link">
    <span class="md-ellipsis">
      search_keyword
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.retriever.Retriever.search_similar" class="md-nav__link">
    <span class="md-ellipsis">
      search_similar
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vector-store" class="md-nav__link">
    <span class="md-ellipsis">
      Vector Store
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Vector Store">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ragora.core.vector_store" class="md-nav__link">
    <span class="md-ellipsis">
      vector_store
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.vector_store.VectorStore" class="md-nav__link">
    <span class="md-ellipsis">
      VectorStore
    </span>
  </a>
  
    <nav class="md-nav" aria-label="VectorStore">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ragora.core.vector_store.VectorStore.chunk_exists" class="md-nav__link">
    <span class="md-ellipsis">
      chunk_exists
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.vector_store.VectorStore.clear_all" class="md-nav__link">
    <span class="md-ellipsis">
      clear_all
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.vector_store.VectorStore.close" class="md-nav__link">
    <span class="md-ellipsis">
      close
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.vector_store.VectorStore.create_schema" class="md-nav__link">
    <span class="md-ellipsis">
      create_schema
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.vector_store.VectorStore.delete_chunk" class="md-nav__link">
    <span class="md-ellipsis">
      delete_chunk
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.vector_store.VectorStore.get_chunk_by_id" class="md-nav__link">
    <span class="md-ellipsis">
      get_chunk_by_id
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.vector_store.VectorStore.get_stats" class="md-nav__link">
    <span class="md-ellipsis">
      get_stats
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.vector_store.VectorStore.is_connected" class="md-nav__link">
    <span class="md-ellipsis">
      is_connected
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.vector_store.VectorStore.prepare_data_object" class="md-nav__link">
    <span class="md-ellipsis">
      prepare_data_object
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.vector_store.VectorStore.store_chunk" class="md-nav__link">
    <span class="md-ellipsis">
      store_chunk
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.vector_store.VectorStore.store_chunks" class="md-nav__link">
    <span class="md-ellipsis">
      store_chunks
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.vector_store.VectorStore.update_chunk" class="md-nav__link">
    <span class="md-ellipsis">
      update_chunk
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#database-manager" class="md-nav__link">
    <span class="md-ellipsis">
      Database Manager
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Database Manager">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ragora.core.database_manager" class="md-nav__link">
    <span class="md-ellipsis">
      database_manager
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.database_manager.DatabaseManager" class="md-nav__link">
    <span class="md-ellipsis">
      DatabaseManager
    </span>
  </a>
  
    <nav class="md-nav" aria-label="DatabaseManager">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ragora.core.database_manager.DatabaseManager._normalize_collection_name" class="md-nav__link">
    <span class="md-ellipsis">
      _normalize_collection_name
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.database_manager.DatabaseManager._test_connection" class="md-nav__link">
    <span class="md-ellipsis">
      _test_connection
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.database_manager.DatabaseManager.close" class="md-nav__link">
    <span class="md-ellipsis">
      close
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.database_manager.DatabaseManager.collection_exists" class="md-nav__link">
    <span class="md-ellipsis">
      collection_exists
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.database_manager.DatabaseManager.create_collection" class="md-nav__link">
    <span class="md-ellipsis">
      create_collection
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.database_manager.DatabaseManager.delete_collection" class="md-nav__link">
    <span class="md-ellipsis">
      delete_collection
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.database_manager.DatabaseManager.get_client" class="md-nav__link">
    <span class="md-ellipsis">
      get_client
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.database_manager.DatabaseManager.get_collection" class="md-nav__link">
    <span class="md-ellipsis">
      get_collection
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.database_manager.DatabaseManager.is_ready" class="md-nav__link">
    <span class="md-ellipsis">
      is_ready
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.database_manager.DatabaseManager.list_collections" class="md-nav__link">
    <span class="md-ellipsis">
      list_collections
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chunking" class="md-nav__link">
    <span class="md-ellipsis">
      Chunking
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Chunking">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ragora.core.chunking" class="md-nav__link">
    <span class="md-ellipsis">
      chunking
    </span>
  </a>
  
    <nav class="md-nav" aria-label="chunking">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ragora.core.chunking--architecture-overview" class="md-nav__link">
    <span class="md-ellipsis">
      Architecture Overview
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.chunking--quick-start" class="md-nav__link">
    <span class="md-ellipsis">
      Quick Start
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.chunking--detailed-usage-guide" class="md-nav__link">
    <span class="md-ellipsis">
      Detailed Usage Guide
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Detailed Usage Guide">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ragora.core.chunking--1-basic-text-chunking" class="md-nav__link">
    <span class="md-ellipsis">
      1. Basic Text Chunking
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.chunking--2-document-chunking" class="md-nav__link">
    <span class="md-ellipsis">
      2. Document Chunking
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.chunking--3-email-chunking" class="md-nav__link">
    <span class="md-ellipsis">
      3. Email Chunking
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.chunking--4-custom-chunking-strategies" class="md-nav__link">
    <span class="md-ellipsis">
      4. Custom Chunking Strategies
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.chunking--5-stateless-chunk-id-management" class="md-nav__link">
    <span class="md-ellipsis">
      5. Stateless Chunk ID Management
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.chunking--6-batch-processing-multiple-documents" class="md-nav__link">
    <span class="md-ellipsis">
      6. Batch Processing Multiple Documents
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.chunking--strategy-types-and-defaults" class="md-nav__link">
    <span class="md-ellipsis">
      Strategy Types and Defaults
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.chunking--advanced-features" class="md-nav__link">
    <span class="md-ellipsis">
      Advanced Features
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Advanced Features">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ragora.core.chunking--custom-metadata" class="md-nav__link">
    <span class="md-ellipsis">
      Custom Metadata
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.chunking--strategy-selection" class="md-nav__link">
    <span class="md-ellipsis">
      Strategy Selection
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.chunking--performance-considerations" class="md-nav__link">
    <span class="md-ellipsis">
      Performance Considerations
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.chunking--error-handling" class="md-nav__link">
    <span class="md-ellipsis">
      Error Handling
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.chunking.ChunkIdGenerator" class="md-nav__link">
    <span class="md-ellipsis">
      ChunkIdGenerator
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ChunkIdGenerator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ragora.core.chunking.ChunkIdGenerator._normalize_content_type" class="md-nav__link">
    <span class="md-ellipsis">
      _normalize_content_type
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.chunking.ChunkIdGenerator._normalize_location_id" class="md-nav__link">
    <span class="md-ellipsis">
      _normalize_location_id
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.chunking.ChunkIdGenerator._normalize_source_id" class="md-nav__link">
    <span class="md-ellipsis">
      _normalize_source_id
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.chunking.ChunkIdGenerator.generate_chunk_id" class="md-nav__link">
    <span class="md-ellipsis">
      generate_chunk_id
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.chunking.ChunkIdGenerator.get_source_hash" class="md-nav__link">
    <span class="md-ellipsis">
      get_source_hash
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.chunking.ChunkIdGenerator.parse_chunk_id" class="md-nav__link">
    <span class="md-ellipsis">
      parse_chunk_id
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.chunking.ChunkMetadata" class="md-nav__link">
    <span class="md-ellipsis">
      ChunkMetadata
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.chunking.ChunkingContext" class="md-nav__link">
    <span class="md-ellipsis">
      ChunkingContext
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.chunking.ChunkingContextBuilder" class="md-nav__link">
    <span class="md-ellipsis">
      ChunkingContextBuilder
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ChunkingContextBuilder">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ragora.core.chunking.ChunkingContextBuilder.build" class="md-nav__link">
    <span class="md-ellipsis">
      build
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.chunking.ChunkingContextBuilder.for_document" class="md-nav__link">
    <span class="md-ellipsis">
      for_document
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.chunking.ChunkingContextBuilder.for_document_with_page" class="md-nav__link">
    <span class="md-ellipsis">
      for_document_with_page
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.chunking.ChunkingContextBuilder.for_email" class="md-nav__link">
    <span class="md-ellipsis">
      for_email
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.chunking.ChunkingContextBuilder.for_email_with_id" class="md-nav__link">
    <span class="md-ellipsis">
      for_email_with_id
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.chunking.ChunkingContextBuilder.for_text" class="md-nav__link">
    <span class="md-ellipsis">
      for_text
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.chunking.ChunkingContextBuilder.for_text_with_source" class="md-nav__link">
    <span class="md-ellipsis">
      for_text_with_source
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.chunking.ChunkingContextBuilder.with_created_at" class="md-nav__link">
    <span class="md-ellipsis">
      with_created_at
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.chunking.ChunkingContextBuilder.with_custom_metadata" class="md-nav__link">
    <span class="md-ellipsis">
      with_custom_metadata
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.chunking.ChunkingContextBuilder.with_email_info" class="md-nav__link">
    <span class="md-ellipsis">
      with_email_info
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.chunking.ChunkingContextBuilder.with_location_id" class="md-nav__link">
    <span class="md-ellipsis">
      with_location_id
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.chunking.ChunkingContextBuilder.with_page" class="md-nav__link">
    <span class="md-ellipsis">
      with_page
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.chunking.ChunkingContextBuilder.with_section" class="md-nav__link">
    <span class="md-ellipsis">
      with_section
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.chunking.ChunkingContextBuilder.with_source" class="md-nav__link">
    <span class="md-ellipsis">
      with_source
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.chunking.ChunkingContextBuilder.with_source_id" class="md-nav__link">
    <span class="md-ellipsis">
      with_source_id
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.chunking.ChunkingContextBuilder.with_start_sequence_idx" class="md-nav__link">
    <span class="md-ellipsis">
      with_start_sequence_idx
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.chunking.ChunkingStrategy" class="md-nav__link">
    <span class="md-ellipsis">
      ChunkingStrategy
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ChunkingStrategy">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ragora.core.chunking.ChunkingStrategy._create_chunk_with_id" class="md-nav__link">
    <span class="md-ellipsis">
      _create_chunk_with_id
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.chunking.ChunkingStrategy._get_location_id" class="md-nav__link">
    <span class="md-ellipsis">
      _get_location_id
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.chunking.ChunkingStrategy._get_source_id" class="md-nav__link">
    <span class="md-ellipsis">
      _get_source_id
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.chunking.ChunkingStrategy.chunk" class="md-nav__link">
    <span class="md-ellipsis">
      chunk
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.chunking.DataChunk" class="md-nav__link">
    <span class="md-ellipsis">
      DataChunk
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.chunking.DataChunker" class="md-nav__link">
    <span class="md-ellipsis">
      DataChunker
    </span>
  </a>
  
    <nav class="md-nav" aria-label="DataChunker">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ragora.core.chunking.DataChunker.chunk" class="md-nav__link">
    <span class="md-ellipsis">
      chunk
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.chunking.DataChunker.register_strategy" class="md-nav__link">
    <span class="md-ellipsis">
      register_strategy
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.chunking.DocumentChunkingStrategy" class="md-nav__link">
    <span class="md-ellipsis">
      DocumentChunkingStrategy
    </span>
  </a>
  
    <nav class="md-nav" aria-label="DocumentChunkingStrategy">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ragora.core.chunking.DocumentChunkingStrategy._chunk_text" class="md-nav__link">
    <span class="md-ellipsis">
      _chunk_text
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.chunking.DocumentChunkingStrategy._create_chunk_with_id" class="md-nav__link">
    <span class="md-ellipsis">
      _create_chunk_with_id
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.chunking.DocumentChunkingStrategy._get_location_id" class="md-nav__link">
    <span class="md-ellipsis">
      _get_location_id
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.chunking.DocumentChunkingStrategy._get_source_id" class="md-nav__link">
    <span class="md-ellipsis">
      _get_source_id
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.chunking.DocumentChunkingStrategy.chunk" class="md-nav__link">
    <span class="md-ellipsis">
      chunk
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.chunking.EmailChunkingStrategy" class="md-nav__link">
    <span class="md-ellipsis">
      EmailChunkingStrategy
    </span>
  </a>
  
    <nav class="md-nav" aria-label="EmailChunkingStrategy">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ragora.core.chunking.EmailChunkingStrategy._chunk_text" class="md-nav__link">
    <span class="md-ellipsis">
      _chunk_text
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.chunking.EmailChunkingStrategy._create_chunk_with_id" class="md-nav__link">
    <span class="md-ellipsis">
      _create_chunk_with_id
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.chunking.EmailChunkingStrategy._get_location_id" class="md-nav__link">
    <span class="md-ellipsis">
      _get_location_id
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.chunking.EmailChunkingStrategy._get_source_id" class="md-nav__link">
    <span class="md-ellipsis">
      _get_source_id
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.chunking.EmailChunkingStrategy.chunk" class="md-nav__link">
    <span class="md-ellipsis">
      chunk
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.chunking.TextChunkingStrategy" class="md-nav__link">
    <span class="md-ellipsis">
      TextChunkingStrategy
    </span>
  </a>
  
    <nav class="md-nav" aria-label="TextChunkingStrategy">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ragora.core.chunking.TextChunkingStrategy._chunk_text" class="md-nav__link">
    <span class="md-ellipsis">
      _chunk_text
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.chunking.TextChunkingStrategy._create_chunk_with_id" class="md-nav__link">
    <span class="md-ellipsis">
      _create_chunk_with_id
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.chunking.TextChunkingStrategy._get_location_id" class="md-nav__link">
    <span class="md-ellipsis">
      _get_location_id
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.chunking.TextChunkingStrategy._get_source_id" class="md-nav__link">
    <span class="md-ellipsis">
      _get_source_id
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.chunking.TextChunkingStrategy.chunk" class="md-nav__link">
    <span class="md-ellipsis">
      chunk
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#document-preprocessor" class="md-nav__link">
    <span class="md-ellipsis">
      Document Preprocessor
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Document Preprocessor">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ragora.core.document_preprocessor" class="md-nav__link">
    <span class="md-ellipsis">
      document_preprocessor
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.document_preprocessor.DocumentPreprocessor" class="md-nav__link">
    <span class="md-ellipsis">
      DocumentPreprocessor
    </span>
  </a>
  
    <nav class="md-nav" aria-label="DocumentPreprocessor">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ragora.core.document_preprocessor.DocumentPreprocessor._chunk_document" class="md-nav__link">
    <span class="md-ellipsis">
      _chunk_document
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.document_preprocessor.DocumentPreprocessor._chunk_documents" class="md-nav__link">
    <span class="md-ellipsis">
      _chunk_documents
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.document_preprocessor.DocumentPreprocessor._chunk_markdown_document" class="md-nav__link">
    <span class="md-ellipsis">
      _chunk_markdown_document
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.document_preprocessor.DocumentPreprocessor._chunk_markdown_documents" class="md-nav__link">
    <span class="md-ellipsis">
      _chunk_markdown_documents
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.document_preprocessor.DocumentPreprocessor._extract_document_text" class="md-nav__link">
    <span class="md-ellipsis">
      _extract_document_text
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.document_preprocessor.DocumentPreprocessor.preprocess_document" class="md-nav__link">
    <span class="md-ellipsis">
      preprocess_document
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.document_preprocessor.DocumentPreprocessor.preprocess_document_folder" class="md-nav__link">
    <span class="md-ellipsis">
      preprocess_document_folder
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.document_preprocessor.DocumentPreprocessor.preprocess_documents" class="md-nav__link">
    <span class="md-ellipsis">
      preprocess_documents
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#email-preprocessor" class="md-nav__link">
    <span class="md-ellipsis">
      Email Preprocessor
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Email Preprocessor">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ragora.core.email_preprocessor" class="md-nav__link">
    <span class="md-ellipsis">
      email_preprocessor
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.email_preprocessor.EmailPreprocessor" class="md-nav__link">
    <span class="md-ellipsis">
      EmailPreprocessor
    </span>
  </a>
  
    <nav class="md-nav" aria-label="EmailPreprocessor">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ragora.core.email_preprocessor.EmailPreprocessor._email_to_chunks" class="md-nav__link">
    <span class="md-ellipsis">
      _email_to_chunks
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.email_preprocessor.EmailPreprocessor._html_to_text" class="md-nav__link">
    <span class="md-ellipsis">
      _html_to_text
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.email_preprocessor.EmailPreprocessor._html_to_text_beautifulsoup" class="md-nav__link">
    <span class="md-ellipsis">
      _html_to_text_beautifulsoup
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.email_preprocessor.EmailPreprocessor._html_to_text_html2text" class="md-nav__link">
    <span class="md-ellipsis">
      _html_to_text_html2text
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.email_preprocessor.EmailPreprocessor._html_to_text_regex" class="md-nav__link">
    <span class="md-ellipsis">
      _html_to_text_regex
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.email_preprocessor.EmailPreprocessor._normalize_whitespace" class="md-nav__link">
    <span class="md-ellipsis">
      _normalize_whitespace
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.email_preprocessor.EmailPreprocessor._strip_quoted_replies" class="md-nav__link">
    <span class="md-ellipsis">
      _strip_quoted_replies
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.email_preprocessor.EmailPreprocessor._strip_quoted_replies_library" class="md-nav__link">
    <span class="md-ellipsis">
      _strip_quoted_replies_library
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.email_preprocessor.EmailPreprocessor._strip_quoted_replies_regex" class="md-nav__link">
    <span class="md-ellipsis">
      _strip_quoted_replies_regex
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.email_preprocessor.EmailPreprocessor._strip_signatures" class="md-nav__link">
    <span class="md-ellipsis">
      _strip_signatures
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.email_preprocessor.EmailPreprocessor.clean_email_body" class="md-nav__link">
    <span class="md-ellipsis">
      clean_email_body
    </span>
  </a>
  
    <nav class="md-nav" aria-label="clean_email_body">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ragora.core.email_preprocessor.EmailPreprocessor.clean_email_body--works-with-emailmessage" class="md-nav__link">
    <span class="md-ellipsis">
      Works with EmailMessage
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.email_preprocessor.EmailPreprocessor.clean_email_body--also-works-with-emailmessagemodel" class="md-nav__link">
    <span class="md-ellipsis">
      Also works with EmailMessageModel
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.email_preprocessor.EmailPreprocessor.clean_email_body--use-clean_text-with-llm-or-other-processing" class="md-nav__link">
    <span class="md-ellipsis">
      Use clean_text with LLM or other processing
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.email_preprocessor.EmailPreprocessor.preprocess_email" class="md-nav__link">
    <span class="md-ellipsis">
      preprocess_email
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.email_preprocessor.EmailPreprocessor.preprocess_emails" class="md-nav__link">
    <span class="md-ellipsis">
      preprocess_emails
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#embedding-engine" class="md-nav__link">
    <span class="md-ellipsis">
      Embedding Engine
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Embedding Engine">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ragora.core.embedding_engine" class="md-nav__link">
    <span class="md-ellipsis">
      embedding_engine
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.embedding_engine.EmbeddingEngine" class="md-nav__link">
    <span class="md-ellipsis">
      EmbeddingEngine
    </span>
  </a>
  
    <nav class="md-nav" aria-label="EmbeddingEngine">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ragora.core.embedding_engine.EmbeddingEngine._cosine_similarity" class="md-nav__link">
    <span class="md-ellipsis">
      _cosine_similarity
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.embedding_engine.EmbeddingEngine._euclidean_distance" class="md-nav__link">
    <span class="md-ellipsis">
      _euclidean_distance
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.embedding_engine.EmbeddingEngine.embed_chunk" class="md-nav__link">
    <span class="md-ellipsis">
      embed_chunk
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.embedding_engine.EmbeddingEngine.embed_chunks" class="md-nav__link">
    <span class="md-ellipsis">
      embed_chunks
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.embedding_engine.EmbeddingEngine.embed_text" class="md-nav__link">
    <span class="md-ellipsis">
      embed_text
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.embedding_engine.EmbeddingEngine.embed_texts" class="md-nav__link">
    <span class="md-ellipsis">
      embed_texts
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.embedding_engine.EmbeddingEngine.get_embedding_dimension" class="md-nav__link">
    <span class="md-ellipsis">
      get_embedding_dimension
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.embedding_engine.EmbeddingEngine.get_model_info" class="md-nav__link">
    <span class="md-ellipsis">
      get_model_info
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.embedding_engine.EmbeddingEngine.similarity" class="md-nav__link">
    <span class="md-ellipsis">
      similarity
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#filters" class="md-nav__link">
    <span class="md-ellipsis">
      Filters
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Filters">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ragora.core.filters" class="md-nav__link">
    <span class="md-ellipsis">
      filters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.filters.FilterBuilder" class="md-nav__link">
    <span class="md-ellipsis">
      FilterBuilder
    </span>
  </a>
  
    <nav class="md-nav" aria-label="FilterBuilder">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ragora.core.filters.FilterBuilder.by_chunk_idx" class="md-nav__link">
    <span class="md-ellipsis">
      by_chunk_idx
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.filters.FilterBuilder.by_chunk_type" class="md-nav__link">
    <span class="md-ellipsis">
      by_chunk_type
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.filters.FilterBuilder.by_date_range" class="md-nav__link">
    <span class="md-ellipsis">
      by_date_range
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.filters.FilterBuilder.by_email_date_range" class="md-nav__link">
    <span class="md-ellipsis">
      by_email_date_range
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.filters.FilterBuilder.by_email_folder" class="md-nav__link">
    <span class="md-ellipsis">
      by_email_folder
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.filters.FilterBuilder.by_email_recipient" class="md-nav__link">
    <span class="md-ellipsis">
      by_email_recipient
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.filters.FilterBuilder.by_email_sender" class="md-nav__link">
    <span class="md-ellipsis">
      by_email_sender
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.filters.FilterBuilder.by_email_subject" class="md-nav__link">
    <span class="md-ellipsis">
      by_email_subject
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.filters.FilterBuilder.by_page_number" class="md-nav__link">
    <span class="md-ellipsis">
      by_page_number
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.filters.FilterBuilder.by_section_title" class="md-nav__link">
    <span class="md-ellipsis">
      by_section_title
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.filters.FilterBuilder.by_source_document" class="md-nav__link">
    <span class="md-ellipsis">
      by_source_document
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.filters.FilterBuilder.combine_and" class="md-nav__link">
    <span class="md-ellipsis">
      combine_and
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.filters.FilterBuilder.combine_or" class="md-nav__link">
    <span class="md-ellipsis">
      combine_or
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#exceptions" class="md-nav__link">
    <span class="md-ellipsis">
      Exceptions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Exceptions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ragora.exceptions" class="md-nav__link">
    <span class="md-ellipsis">
      exceptions
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.exceptions.ConfigurationError" class="md-nav__link">
    <span class="md-ellipsis">
      ConfigurationError
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.exceptions.DocumentProcessingError" class="md-nav__link">
    <span class="md-ellipsis">
      DocumentProcessingError
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.exceptions.EmbeddingError" class="md-nav__link">
    <span class="md-ellipsis">
      EmbeddingError
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.exceptions.KnowledgeBaseManagerError" class="md-nav__link">
    <span class="md-ellipsis">
      KnowledgeBaseManagerError
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.exceptions.RetrievalError" class="md-nav__link">
    <span class="md-ellipsis">
      RetrievalError
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.exceptions.VectorStoreError" class="md-nav__link">
    <span class="md-ellipsis">
      VectorStoreError
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#utilities" class="md-nav__link">
    <span class="md-ellipsis">
      Utilities
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Utilities">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#device-utilities" class="md-nav__link">
    <span class="md-ellipsis">
      Device Utilities
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Device Utilities">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ragora.utils.device_utils" class="md-nav__link">
    <span class="md-ellipsis">
      device_utils
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.device_utils.DeviceManager" class="md-nav__link">
    <span class="md-ellipsis">
      DeviceManager
    </span>
  </a>
  
    <nav class="md-nav" aria-label="DeviceManager">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ragora.utils.device_utils.DeviceManager._check_cuda_via_nvidia_smi" class="md-nav__link">
    <span class="md-ellipsis">
      _check_cuda_via_nvidia_smi
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.device_utils.DeviceManager._detect_gpu_capabilities" class="md-nav__link">
    <span class="md-ellipsis">
      _detect_gpu_capabilities
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.device_utils.DeviceManager._detect_platform" class="md-nav__link">
    <span class="md-ellipsis">
      _detect_platform
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.device_utils.DeviceManager._select_optimal_device" class="md-nav__link">
    <span class="md-ellipsis">
      _select_optimal_device
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.device_utils.DeviceManager.configure_pytorch_device" class="md-nav__link">
    <span class="md-ellipsis">
      configure_pytorch_device
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.device_utils.DeviceManager.get_device_info" class="md-nav__link">
    <span class="md-ellipsis">
      get_device_info
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.device_utils.DeviceManager.get_recommended_device" class="md-nav__link">
    <span class="md-ellipsis">
      get_recommended_device
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.device_utils.configure_pytorch_for_platform" class="md-nav__link">
    <span class="md-ellipsis">
      configure_pytorch_for_platform
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.device_utils.get_device_info" class="md-nav__link">
    <span class="md-ellipsis">
      get_device_info
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.device_utils.get_device_manager" class="md-nav__link">
    <span class="md-ellipsis">
      get_device_manager
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.device_utils.get_recommended_device" class="md-nav__link">
    <span class="md-ellipsis">
      get_recommended_device
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.device_utils.get_sentence_transformer_device" class="md-nav__link">
    <span class="md-ellipsis">
      get_sentence_transformer_device
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.device_utils.is_cuda_available" class="md-nav__link">
    <span class="md-ellipsis">
      is_cuda_available
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.device_utils.is_gpu_available" class="md-nav__link">
    <span class="md-ellipsis">
      is_gpu_available
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.device_utils.is_linux" class="md-nav__link">
    <span class="md-ellipsis">
      is_linux
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.device_utils.is_macos" class="md-nav__link">
    <span class="md-ellipsis">
      is_macos
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.device_utils.is_windows" class="md-nav__link">
    <span class="md-ellipsis">
      is_windows
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.device_utils.mock_platform_info" class="md-nav__link">
    <span class="md-ellipsis">
      mock_platform_info
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.device_utils.reset_device_manager" class="md-nav__link">
    <span class="md-ellipsis">
      reset_device_manager
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#email-provider-factory" class="md-nav__link">
    <span class="md-ellipsis">
      Email Provider Factory
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Email Provider Factory">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ragora.utils.email_provider_factory" class="md-nav__link">
    <span class="md-ellipsis">
      email_provider_factory
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.email_provider_factory.EmailProviderFactory" class="md-nav__link">
    <span class="md-ellipsis">
      EmailProviderFactory
    </span>
  </a>
  
    <nav class="md-nav" aria-label="EmailProviderFactory">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ragora.utils.email_provider_factory.EmailProviderFactory.create_graph_provider" class="md-nav__link">
    <span class="md-ellipsis">
      create_graph_provider
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.email_provider_factory.EmailProviderFactory.create_imap_provider" class="md-nav__link">
    <span class="md-ellipsis">
      create_imap_provider
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.email_provider_factory.EmailProviderFactory.create_provider" class="md-nav__link">
    <span class="md-ellipsis">
      create_provider
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.email_provider_factory.EmailProviderFactory.get_supported_providers" class="md-nav__link">
    <span class="md-ellipsis">
      get_supported_providers
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.email_provider_factory.ProviderType" class="md-nav__link">
    <span class="md-ellipsis">
      ProviderType
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#email-utils" class="md-nav__link">
    <span class="md-ellipsis">
      Email Utils
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Email Utils">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ragora.utils.email_utils.base" class="md-nav__link">
    <span class="md-ellipsis">
      base
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.email_utils.base.EmailProvider" class="md-nav__link">
    <span class="md-ellipsis">
      EmailProvider
    </span>
  </a>
  
    <nav class="md-nav" aria-label="EmailProvider">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ragora.utils.email_utils.base.EmailProvider.is_connected" class="md-nav__link">
    <span class="md-ellipsis">
      is_connected
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.email_utils.base.EmailProvider.connect" class="md-nav__link">
    <span class="md-ellipsis">
      connect
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.email_utils.base.EmailProvider.create_draft" class="md-nav__link">
    <span class="md-ellipsis">
      create_draft
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.email_utils.base.EmailProvider.disconnect" class="md-nav__link">
    <span class="md-ellipsis">
      disconnect
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.email_utils.base.EmailProvider.fetch_message_by_id" class="md-nav__link">
    <span class="md-ellipsis">
      fetch_message_by_id
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.email_utils.base.EmailProvider.fetch_messages" class="md-nav__link">
    <span class="md-ellipsis">
      fetch_messages
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.email_utils.base.EmailProvider.get_folders" class="md-nav__link">
    <span class="md-ellipsis">
      get_folders
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.email_utils.base.EmailProvider.mark_as_read" class="md-nav__link">
    <span class="md-ellipsis">
      mark_as_read
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.email_utils.base.EmailProvider.send_message" class="md-nav__link">
    <span class="md-ellipsis">
      send_message
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.email_utils.base.EmailProvider.send_message_direct" class="md-nav__link">
    <span class="md-ellipsis">
      send_message_direct
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.email_utils.graph_provider" class="md-nav__link">
    <span class="md-ellipsis">
      graph_provider
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.email_utils.graph_provider.AuthenticationError" class="md-nav__link">
    <span class="md-ellipsis">
      AuthenticationError
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.email_utils.graph_provider.GraphProvider" class="md-nav__link">
    <span class="md-ellipsis">
      GraphProvider
    </span>
  </a>
  
    <nav class="md-nav" aria-label="GraphProvider">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ragora.utils.email_utils.graph_provider.GraphProvider.is_connected" class="md-nav__link">
    <span class="md-ellipsis">
      is_connected
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.email_utils.graph_provider.GraphProvider._get_access_token" class="md-nav__link">
    <span class="md-ellipsis">
      _get_access_token
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.email_utils.graph_provider.GraphProvider._make_request" class="md-nav__link">
    <span class="md-ellipsis">
      _make_request
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.email_utils.graph_provider.GraphProvider._parse_graph_attachments" class="md-nav__link">
    <span class="md-ellipsis">
      _parse_graph_attachments
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.email_utils.graph_provider.GraphProvider._parse_graph_date" class="md-nav__link">
    <span class="md-ellipsis">
      _parse_graph_date
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.email_utils.graph_provider.GraphProvider._parse_graph_message" class="md-nav__link">
    <span class="md-ellipsis">
      _parse_graph_message
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.email_utils.graph_provider.GraphProvider._verify_token" class="md-nav__link">
    <span class="md-ellipsis">
      _verify_token
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.email_utils.graph_provider.GraphProvider.connect" class="md-nav__link">
    <span class="md-ellipsis">
      connect
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.email_utils.graph_provider.GraphProvider.create_draft" class="md-nav__link">
    <span class="md-ellipsis">
      create_draft
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.email_utils.graph_provider.GraphProvider.disconnect" class="md-nav__link">
    <span class="md-ellipsis">
      disconnect
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.email_utils.graph_provider.GraphProvider.fetch_message_by_id" class="md-nav__link">
    <span class="md-ellipsis">
      fetch_message_by_id
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.email_utils.graph_provider.GraphProvider.fetch_messages" class="md-nav__link">
    <span class="md-ellipsis">
      fetch_messages
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.email_utils.graph_provider.GraphProvider.get_folders" class="md-nav__link">
    <span class="md-ellipsis">
      get_folders
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.email_utils.graph_provider.GraphProvider.mark_as_read" class="md-nav__link">
    <span class="md-ellipsis">
      mark_as_read
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.email_utils.graph_provider.GraphProvider.send_message" class="md-nav__link">
    <span class="md-ellipsis">
      send_message
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.email_utils.graph_provider.GraphProvider.send_message_direct" class="md-nav__link">
    <span class="md-ellipsis">
      send_message_direct
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.email_utils.imap_provider" class="md-nav__link">
    <span class="md-ellipsis">
      imap_provider
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.email_utils.imap_provider.IMAPProvider" class="md-nav__link">
    <span class="md-ellipsis">
      IMAPProvider
    </span>
  </a>
  
    <nav class="md-nav" aria-label="IMAPProvider">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ragora.utils.email_utils.imap_provider.IMAPProvider.is_connected" class="md-nav__link">
    <span class="md-ellipsis">
      is_connected
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.email_utils.imap_provider.IMAPProvider._create_draft_message" class="md-nav__link">
    <span class="md-ellipsis">
      _create_draft_message
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.email_utils.imap_provider.IMAPProvider._create_local_draft" class="md-nav__link">
    <span class="md-ellipsis">
      _create_local_draft
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.email_utils.imap_provider.IMAPProvider._decode_header" class="md-nav__link">
    <span class="md-ellipsis">
      _decode_header
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.email_utils.imap_provider.IMAPProvider._extract_attachments" class="md-nav__link">
    <span class="md-ellipsis">
      _extract_attachments
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.email_utils.imap_provider.IMAPProvider._extract_body" class="md-nav__link">
    <span class="md-ellipsis">
      _extract_body
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.email_utils.imap_provider.IMAPProvider._fetch_single_message" class="md-nav__link">
    <span class="md-ellipsis">
      _fetch_single_message
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.email_utils.imap_provider.IMAPProvider._parse_address" class="md-nav__link">
    <span class="md-ellipsis">
      _parse_address
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.email_utils.imap_provider.IMAPProvider._parse_address_list" class="md-nav__link">
    <span class="md-ellipsis">
      _parse_address_list
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.email_utils.imap_provider.IMAPProvider._parse_date" class="md-nav__link">
    <span class="md-ellipsis">
      _parse_date
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.email_utils.imap_provider.IMAPProvider._parse_email_message" class="md-nav__link">
    <span class="md-ellipsis">
      _parse_email_message
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.email_utils.imap_provider.IMAPProvider.connect" class="md-nav__link">
    <span class="md-ellipsis">
      connect
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.email_utils.imap_provider.IMAPProvider.create_draft" class="md-nav__link">
    <span class="md-ellipsis">
      create_draft
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.email_utils.imap_provider.IMAPProvider.disconnect" class="md-nav__link">
    <span class="md-ellipsis">
      disconnect
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.email_utils.imap_provider.IMAPProvider.fetch_message_by_id" class="md-nav__link">
    <span class="md-ellipsis">
      fetch_message_by_id
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.email_utils.imap_provider.IMAPProvider.fetch_messages" class="md-nav__link">
    <span class="md-ellipsis">
      fetch_messages
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.email_utils.imap_provider.IMAPProvider.get_folders" class="md-nav__link">
    <span class="md-ellipsis">
      get_folders
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.email_utils.imap_provider.IMAPProvider.mark_as_read" class="md-nav__link">
    <span class="md-ellipsis">
      mark_as_read
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.email_utils.imap_provider.IMAPProvider.send_message" class="md-nav__link">
    <span class="md-ellipsis">
      send_message
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.email_utils.imap_provider.IMAPProvider.send_message_direct" class="md-nav__link">
    <span class="md-ellipsis">
      send_message_direct
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.email_utils.models" class="md-nav__link">
    <span class="md-ellipsis">
      models
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.email_utils.models.EmailAddress" class="md-nav__link">
    <span class="md-ellipsis">
      EmailAddress
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.email_utils.models.EmailAttachment" class="md-nav__link">
    <span class="md-ellipsis">
      EmailAttachment
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.email_utils.models.EmailCredentials" class="md-nav__link">
    <span class="md-ellipsis">
      EmailCredentials
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.email_utils.models.EmailDraft" class="md-nav__link">
    <span class="md-ellipsis">
      EmailDraft
    </span>
  </a>
  
    <nav class="md-nav" aria-label="EmailDraft">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ragora.utils.email_utils.models.EmailDraft.get_all_recipients" class="md-nav__link">
    <span class="md-ellipsis">
      get_all_recipients
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.email_utils.models.EmailDraft.get_body" class="md-nav__link">
    <span class="md-ellipsis">
      get_body
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.email_utils.models.EmailMessage" class="md-nav__link">
    <span class="md-ellipsis">
      EmailMessage
    </span>
  </a>
  
    <nav class="md-nav" aria-label="EmailMessage">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ragora.utils.email_utils.models.EmailMessage.get_all_recipients" class="md-nav__link">
    <span class="md-ellipsis">
      get_all_recipients
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.email_utils.models.EmailMessage.get_body" class="md-nav__link">
    <span class="md-ellipsis">
      get_body
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.email_utils.models.GraphCredentials" class="md-nav__link">
    <span class="md-ellipsis">
      GraphCredentials
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.email_utils.models.IMAPCredentials" class="md-nav__link">
    <span class="md-ellipsis">
      IMAPCredentials
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.email_utils.models.MessageStatus" class="md-nav__link">
    <span class="md-ellipsis">
      MessageStatus
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#latex-parser" class="md-nav__link">
    <span class="md-ellipsis">
      LaTeX Parser
    </span>
  </a>
  
    <nav class="md-nav" aria-label="LaTeX Parser">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ragora.utils.latex_parser" class="md-nav__link">
    <span class="md-ellipsis">
      latex_parser
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.latex_parser.Citation" class="md-nav__link">
    <span class="md-ellipsis">
      Citation
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Citation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ragora.utils.latex_parser.Citation.to_text" class="md-nav__link">
    <span class="md-ellipsis">
      to_text
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.latex_parser.LatexChapter" class="md-nav__link">
    <span class="md-ellipsis">
      LatexChapter
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.latex_parser.LatexDocument" class="md-nav__link">
    <span class="md-ellipsis">
      LatexDocument
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.latex_parser.LatexFigure" class="md-nav__link">
    <span class="md-ellipsis">
      LatexFigure
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.latex_parser.LatexParagraph" class="md-nav__link">
    <span class="md-ellipsis">
      LatexParagraph
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.latex_parser.LatexParser" class="md-nav__link">
    <span class="md-ellipsis">
      LatexParser
    </span>
  </a>
  
    <nav class="md-nav" aria-label="LatexParser">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ragora.utils.latex_parser.LatexParser._extract_author" class="md-nav__link">
    <span class="md-ellipsis">
      _extract_author
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.latex_parser.LatexParser._extract_bib_field" class="md-nav__link">
    <span class="md-ellipsis">
      _extract_bib_field
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.latex_parser.LatexParser._extract_doi" class="md-nav__link">
    <span class="md-ellipsis">
      _extract_doi
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.latex_parser.LatexParser._extract_label" class="md-nav__link">
    <span class="md-ellipsis">
      _extract_label
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.latex_parser.LatexParser._extract_title" class="md-nav__link">
    <span class="md-ellipsis">
      _extract_title
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.latex_parser.LatexParser._extract_year" class="md-nav__link">
    <span class="md-ellipsis">
      _extract_year
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.latex_parser.LatexParser._get_or_create_citation" class="md-nav__link">
    <span class="md-ellipsis">
      _get_or_create_citation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.latex_parser.LatexParser._load_bibliography" class="md-nav__link">
    <span class="md-ellipsis">
      _load_bibliography
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.latex_parser.LatexParser._parse_bibtex" class="md-nav__link">
    <span class="md-ellipsis">
      _parse_bibtex
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.latex_parser.LatexParser._parse_chapters" class="md-nav__link">
    <span class="md-ellipsis">
      _parse_chapters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.latex_parser.LatexParser._parse_figures" class="md-nav__link">
    <span class="md-ellipsis">
      _parse_figures
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.latex_parser.LatexParser._parse_paragraphs" class="md-nav__link">
    <span class="md-ellipsis">
      _parse_paragraphs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.latex_parser.LatexParser._parse_sections" class="md-nav__link">
    <span class="md-ellipsis">
      _parse_sections
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.latex_parser.LatexParser._parse_single_chapter" class="md-nav__link">
    <span class="md-ellipsis">
      _parse_single_chapter
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.latex_parser.LatexParser._parse_single_figure" class="md-nav__link">
    <span class="md-ellipsis">
      _parse_single_figure
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.latex_parser.LatexParser._parse_single_section" class="md-nav__link">
    <span class="md-ellipsis">
      _parse_single_section
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.latex_parser.LatexParser._parse_single_table" class="md-nav__link">
    <span class="md-ellipsis">
      _parse_single_table
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.latex_parser.LatexParser._parse_tables" class="md-nav__link">
    <span class="md-ellipsis">
      _parse_tables
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.latex_parser.LatexParser._parse_tabular_content" class="md-nav__link">
    <span class="md-ellipsis">
      _parse_tabular_content
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.latex_parser.LatexParser._process_citations_in_text" class="md-nav__link">
    <span class="md-ellipsis">
      _process_citations_in_text
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.latex_parser.LatexParser._remove_document_preamble" class="md-nav__link">
    <span class="md-ellipsis">
      _remove_document_preamble
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.latex_parser.LatexParser._split_into_chapters" class="md-nav__link">
    <span class="md-ellipsis">
      _split_into_chapters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.latex_parser.LatexParser._split_into_sections" class="md-nav__link">
    <span class="md-ellipsis">
      _split_into_sections
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.latex_parser.LatexParser.get_bibliography_entries" class="md-nav__link">
    <span class="md-ellipsis">
      get_bibliography_entries
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.latex_parser.LatexParser.parse_bibliography" class="md-nav__link">
    <span class="md-ellipsis">
      parse_bibliography
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.latex_parser.LatexParser.parse_document" class="md-nav__link">
    <span class="md-ellipsis">
      parse_document
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.latex_parser.LatexParser.parse_document_text" class="md-nav__link">
    <span class="md-ellipsis">
      parse_document_text
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.latex_parser.LatexSection" class="md-nav__link">
    <span class="md-ellipsis">
      LatexSection
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.latex_parser.LatexSubsection" class="md-nav__link">
    <span class="md-ellipsis">
      LatexSubsection
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.latex_parser.LatexSubsubsection" class="md-nav__link">
    <span class="md-ellipsis">
      LatexSubsubsection
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.latex_parser.LatexTable" class="md-nav__link">
    <span class="md-ellipsis">
      LatexTable
    </span>
  </a>
  
    <nav class="md-nav" aria-label="LatexTable">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ragora.utils.latex_parser.LatexTable.to_markdown" class="md-nav__link">
    <span class="md-ellipsis">
      to_markdown
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.latex_parser.LatexTable.to_plain_text" class="md-nav__link">
    <span class="md-ellipsis">
      to_plain_text
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#markdown-parser" class="md-nav__link">
    <span class="md-ellipsis">
      Markdown Parser
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Markdown Parser">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ragora.utils.markdown_parser" class="md-nav__link">
    <span class="md-ellipsis">
      markdown_parser
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.markdown_parser.MarkdownChapter" class="md-nav__link">
    <span class="md-ellipsis">
      MarkdownChapter
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.markdown_parser.MarkdownDocument" class="md-nav__link">
    <span class="md-ellipsis">
      MarkdownDocument
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.markdown_parser.MarkdownParagraph" class="md-nav__link">
    <span class="md-ellipsis">
      MarkdownParagraph
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.markdown_parser.MarkdownParser" class="md-nav__link">
    <span class="md-ellipsis">
      MarkdownParser
    </span>
  </a>
  
    <nav class="md-nav" aria-label="MarkdownParser">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ragora.utils.markdown_parser.MarkdownParser.parse_document" class="md-nav__link">
    <span class="md-ellipsis">
      parse_document
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.markdown_parser.MarkdownParser.parse_text" class="md-nav__link">
    <span class="md-ellipsis">
      parse_text
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.markdown_parser.MarkdownSection" class="md-nav__link">
    <span class="md-ellipsis">
      MarkdownSection
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Configuration
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Configuration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ragora.config.settings" class="md-nav__link">
    <span class="md-ellipsis">
      settings
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.config.settings.ChunkConfig" class="md-nav__link">
    <span class="md-ellipsis">
      ChunkConfig
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.config.settings.DatabaseManagerConfig" class="md-nav__link">
    <span class="md-ellipsis">
      DatabaseManagerConfig
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.config.settings.EmbeddingConfig" class="md-nav__link">
    <span class="md-ellipsis">
      EmbeddingConfig
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.config.settings.KnowledgeBaseManagerConfig" class="md-nav__link">
    <span class="md-ellipsis">
      KnowledgeBaseManagerConfig
    </span>
  </a>
  
    <nav class="md-nav" aria-label="KnowledgeBaseManagerConfig">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ragora.config.settings.KnowledgeBaseManagerConfig.default" class="md-nav__link">
    <span class="md-ellipsis">
      default
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.config.settings.KnowledgeBaseManagerConfig.from_dict" class="md-nav__link">
    <span class="md-ellipsis">
      from_dict
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#cli" class="md-nav__link">
    <span class="md-ellipsis">
      CLI
    </span>
  </a>
  
    <nav class="md-nav" aria-label="CLI">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ragora.cli.main" class="md-nav__link">
    <span class="md-ellipsis">
      main
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.cli.main.create_parser" class="md-nav__link">
    <span class="md-ellipsis">
      create_parser
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.cli.main.main" class="md-nav__link">
    <span class="md-ellipsis">
      main
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.cli.main.process_document_command" class="md-nav__link">
    <span class="md-ellipsis">
      process_document_command
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.cli.main.query_command" class="md-nav__link">
    <span class="md-ellipsis">
      query_command
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.cli.main.setup_logging" class="md-nav__link">
    <span class="md-ellipsis">
      setup_logging
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.cli.main.status_command" class="md-nav__link">
    <span class="md-ellipsis">
      status_command
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#core" class="md-nav__link">
    <span class="md-ellipsis">
      Core
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Core">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#knowledge-base-manager" class="md-nav__link">
    <span class="md-ellipsis">
      Knowledge Base Manager
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Knowledge Base Manager">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ragora.core.knowledge_base_manager" class="md-nav__link">
    <span class="md-ellipsis">
      knowledge_base_manager
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.knowledge_base_manager.KnowledgeBaseManager" class="md-nav__link">
    <span class="md-ellipsis">
      KnowledgeBaseManager
    </span>
  </a>
  
    <nav class="md-nav" aria-label="KnowledgeBaseManager">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ragora.core.knowledge_base_manager.KnowledgeBaseManager._ensure_email_connection" class="md-nav__link">
    <span class="md-ellipsis">
      _ensure_email_connection
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.knowledge_base_manager.KnowledgeBaseManager.check_new_emails" class="md-nav__link">
    <span class="md-ellipsis">
      check_new_emails
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.knowledge_base_manager.KnowledgeBaseManager.clear_collection" class="md-nav__link">
    <span class="md-ellipsis">
      clear_collection
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.knowledge_base_manager.KnowledgeBaseManager.close" class="md-nav__link">
    <span class="md-ellipsis">
      close
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.knowledge_base_manager.KnowledgeBaseManager.create_collection" class="md-nav__link">
    <span class="md-ellipsis">
      create_collection
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.knowledge_base_manager.KnowledgeBaseManager.delete_chunk" class="md-nav__link">
    <span class="md-ellipsis">
      delete_chunk
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.knowledge_base_manager.KnowledgeBaseManager.delete_collection" class="md-nav__link">
    <span class="md-ellipsis">
      delete_collection
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.knowledge_base_manager.KnowledgeBaseManager.get_chunk" class="md-nav__link">
    <span class="md-ellipsis">
      get_chunk
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.knowledge_base_manager.KnowledgeBaseManager.get_collection_stats" class="md-nav__link">
    <span class="md-ellipsis">
      get_collection_stats
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.knowledge_base_manager.KnowledgeBaseManager.list_collections" class="md-nav__link">
    <span class="md-ellipsis">
      list_collections
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.knowledge_base_manager.KnowledgeBaseManager.process_document" class="md-nav__link">
    <span class="md-ellipsis">
      process_document
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.knowledge_base_manager.KnowledgeBaseManager.process_documents" class="md-nav__link">
    <span class="md-ellipsis">
      process_documents
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.knowledge_base_manager.KnowledgeBaseManager.process_email_account" class="md-nav__link">
    <span class="md-ellipsis">
      process_email_account
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.knowledge_base_manager.KnowledgeBaseManager.process_emails" class="md-nav__link">
    <span class="md-ellipsis">
      process_emails
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.knowledge_base_manager.KnowledgeBaseManager.process_new_emails" class="md-nav__link">
    <span class="md-ellipsis">
      process_new_emails
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.knowledge_base_manager.KnowledgeBaseManager.search" class="md-nav__link">
    <span class="md-ellipsis">
      search
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.knowledge_base_manager.SearchResult" class="md-nav__link">
    <span class="md-ellipsis">
      SearchResult
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.knowledge_base_manager.SearchStrategy" class="md-nav__link">
    <span class="md-ellipsis">
      SearchStrategy
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#models" class="md-nav__link">
    <span class="md-ellipsis">
      Models
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Models">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ragora.core.models" class="md-nav__link">
    <span class="md-ellipsis">
      models
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.models.EmailAddressModel" class="md-nav__link">
    <span class="md-ellipsis">
      EmailAddressModel
    </span>
  </a>
  
    <nav class="md-nav" aria-label="EmailAddressModel">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ragora.core.models.EmailAddressModel.from_email_address" class="md-nav__link">
    <span class="md-ellipsis">
      from_email_address
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.models.EmailAddressModel.to_email_address" class="md-nav__link">
    <span class="md-ellipsis">
      to_email_address
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.models.EmailListResult" class="md-nav__link">
    <span class="md-ellipsis">
      EmailListResult
    </span>
  </a>
  
    <nav class="md-nav" aria-label="EmailListResult">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ragora.core.models.EmailListResult.email_messages" class="md-nav__link">
    <span class="md-ellipsis">
      email_messages
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.models.EmailListResult.validate_count_matches_emails" class="md-nav__link">
    <span class="md-ellipsis">
      validate_count_matches_emails
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.models.EmailMessageModel" class="md-nav__link">
    <span class="md-ellipsis">
      EmailMessageModel
    </span>
  </a>
  
    <nav class="md-nav" aria-label="EmailMessageModel">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ragora.core.models.EmailMessageModel.from_email_message" class="md-nav__link">
    <span class="md-ellipsis">
      from_email_message
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.models.EmailMessageModel.get_all_recipients" class="md-nav__link">
    <span class="md-ellipsis">
      get_all_recipients
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.models.EmailMessageModel.get_body" class="md-nav__link">
    <span class="md-ellipsis">
      get_body
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.models.EmailMessageModel.to_email_message" class="md-nav__link">
    <span class="md-ellipsis">
      to_email_message
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.models.RetrievalMetadata" class="md-nav__link">
    <span class="md-ellipsis">
      RetrievalMetadata
    </span>
  </a>
  
    <nav class="md-nav" aria-label="RetrievalMetadata">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ragora.core.models.RetrievalMetadata.from_properties" class="md-nav__link">
    <span class="md-ellipsis">
      from_properties
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.models.RetrievalResultItem" class="md-nav__link">
    <span class="md-ellipsis">
      RetrievalResultItem
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.models.SearchResultItem" class="md-nav__link">
    <span class="md-ellipsis">
      SearchResultItem
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SearchResultItem">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ragora.core.models.SearchResultItem.sender" class="md-nav__link">
    <span class="md-ellipsis">
      sender
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.models.SearchResultItem.subject" class="md-nav__link">
    <span class="md-ellipsis">
      subject
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.models.SearchResultItem.parse_timestamp" class="md-nav__link">
    <span class="md-ellipsis">
      parse_timestamp
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#retriever" class="md-nav__link">
    <span class="md-ellipsis">
      Retriever
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Retriever">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ragora.core.retriever" class="md-nav__link">
    <span class="md-ellipsis">
      retriever
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.retriever.Retriever" class="md-nav__link">
    <span class="md-ellipsis">
      Retriever
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Retriever">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ragora.core.retriever.Retriever._get_current_timestamp" class="md-nav__link">
    <span class="md-ellipsis">
      _get_current_timestamp
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.retriever.Retriever._preprocess_query" class="md-nav__link">
    <span class="md-ellipsis">
      _preprocess_query
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.retriever.Retriever._process_hybrid_results" class="md-nav__link">
    <span class="md-ellipsis">
      _process_hybrid_results
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.retriever.Retriever._process_keyword_results" class="md-nav__link">
    <span class="md-ellipsis">
      _process_keyword_results
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.retriever.Retriever._process_vector_results" class="md-nav__link">
    <span class="md-ellipsis">
      _process_vector_results
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.retriever.Retriever.get_retrieval_stats" class="md-nav__link">
    <span class="md-ellipsis">
      get_retrieval_stats
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.retriever.Retriever.search_hybrid" class="md-nav__link">
    <span class="md-ellipsis">
      search_hybrid
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.retriever.Retriever.search_keyword" class="md-nav__link">
    <span class="md-ellipsis">
      search_keyword
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.retriever.Retriever.search_similar" class="md-nav__link">
    <span class="md-ellipsis">
      search_similar
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vector-store" class="md-nav__link">
    <span class="md-ellipsis">
      Vector Store
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Vector Store">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ragora.core.vector_store" class="md-nav__link">
    <span class="md-ellipsis">
      vector_store
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.vector_store.VectorStore" class="md-nav__link">
    <span class="md-ellipsis">
      VectorStore
    </span>
  </a>
  
    <nav class="md-nav" aria-label="VectorStore">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ragora.core.vector_store.VectorStore.chunk_exists" class="md-nav__link">
    <span class="md-ellipsis">
      chunk_exists
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.vector_store.VectorStore.clear_all" class="md-nav__link">
    <span class="md-ellipsis">
      clear_all
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.vector_store.VectorStore.close" class="md-nav__link">
    <span class="md-ellipsis">
      close
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.vector_store.VectorStore.create_schema" class="md-nav__link">
    <span class="md-ellipsis">
      create_schema
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.vector_store.VectorStore.delete_chunk" class="md-nav__link">
    <span class="md-ellipsis">
      delete_chunk
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.vector_store.VectorStore.get_chunk_by_id" class="md-nav__link">
    <span class="md-ellipsis">
      get_chunk_by_id
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.vector_store.VectorStore.get_stats" class="md-nav__link">
    <span class="md-ellipsis">
      get_stats
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.vector_store.VectorStore.is_connected" class="md-nav__link">
    <span class="md-ellipsis">
      is_connected
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.vector_store.VectorStore.prepare_data_object" class="md-nav__link">
    <span class="md-ellipsis">
      prepare_data_object
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.vector_store.VectorStore.store_chunk" class="md-nav__link">
    <span class="md-ellipsis">
      store_chunk
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.vector_store.VectorStore.store_chunks" class="md-nav__link">
    <span class="md-ellipsis">
      store_chunks
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.vector_store.VectorStore.update_chunk" class="md-nav__link">
    <span class="md-ellipsis">
      update_chunk
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#database-manager" class="md-nav__link">
    <span class="md-ellipsis">
      Database Manager
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Database Manager">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ragora.core.database_manager" class="md-nav__link">
    <span class="md-ellipsis">
      database_manager
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.database_manager.DatabaseManager" class="md-nav__link">
    <span class="md-ellipsis">
      DatabaseManager
    </span>
  </a>
  
    <nav class="md-nav" aria-label="DatabaseManager">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ragora.core.database_manager.DatabaseManager._normalize_collection_name" class="md-nav__link">
    <span class="md-ellipsis">
      _normalize_collection_name
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.database_manager.DatabaseManager._test_connection" class="md-nav__link">
    <span class="md-ellipsis">
      _test_connection
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.database_manager.DatabaseManager.close" class="md-nav__link">
    <span class="md-ellipsis">
      close
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.database_manager.DatabaseManager.collection_exists" class="md-nav__link">
    <span class="md-ellipsis">
      collection_exists
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.database_manager.DatabaseManager.create_collection" class="md-nav__link">
    <span class="md-ellipsis">
      create_collection
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.database_manager.DatabaseManager.delete_collection" class="md-nav__link">
    <span class="md-ellipsis">
      delete_collection
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.database_manager.DatabaseManager.get_client" class="md-nav__link">
    <span class="md-ellipsis">
      get_client
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.database_manager.DatabaseManager.get_collection" class="md-nav__link">
    <span class="md-ellipsis">
      get_collection
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.database_manager.DatabaseManager.is_ready" class="md-nav__link">
    <span class="md-ellipsis">
      is_ready
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.database_manager.DatabaseManager.list_collections" class="md-nav__link">
    <span class="md-ellipsis">
      list_collections
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chunking" class="md-nav__link">
    <span class="md-ellipsis">
      Chunking
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Chunking">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ragora.core.chunking" class="md-nav__link">
    <span class="md-ellipsis">
      chunking
    </span>
  </a>
  
    <nav class="md-nav" aria-label="chunking">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ragora.core.chunking--architecture-overview" class="md-nav__link">
    <span class="md-ellipsis">
      Architecture Overview
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.chunking--quick-start" class="md-nav__link">
    <span class="md-ellipsis">
      Quick Start
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.chunking--detailed-usage-guide" class="md-nav__link">
    <span class="md-ellipsis">
      Detailed Usage Guide
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Detailed Usage Guide">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ragora.core.chunking--1-basic-text-chunking" class="md-nav__link">
    <span class="md-ellipsis">
      1. Basic Text Chunking
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.chunking--2-document-chunking" class="md-nav__link">
    <span class="md-ellipsis">
      2. Document Chunking
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.chunking--3-email-chunking" class="md-nav__link">
    <span class="md-ellipsis">
      3. Email Chunking
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.chunking--4-custom-chunking-strategies" class="md-nav__link">
    <span class="md-ellipsis">
      4. Custom Chunking Strategies
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.chunking--5-stateless-chunk-id-management" class="md-nav__link">
    <span class="md-ellipsis">
      5. Stateless Chunk ID Management
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.chunking--6-batch-processing-multiple-documents" class="md-nav__link">
    <span class="md-ellipsis">
      6. Batch Processing Multiple Documents
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.chunking--strategy-types-and-defaults" class="md-nav__link">
    <span class="md-ellipsis">
      Strategy Types and Defaults
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.chunking--advanced-features" class="md-nav__link">
    <span class="md-ellipsis">
      Advanced Features
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Advanced Features">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ragora.core.chunking--custom-metadata" class="md-nav__link">
    <span class="md-ellipsis">
      Custom Metadata
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.chunking--strategy-selection" class="md-nav__link">
    <span class="md-ellipsis">
      Strategy Selection
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.chunking--performance-considerations" class="md-nav__link">
    <span class="md-ellipsis">
      Performance Considerations
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.chunking--error-handling" class="md-nav__link">
    <span class="md-ellipsis">
      Error Handling
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.chunking.ChunkIdGenerator" class="md-nav__link">
    <span class="md-ellipsis">
      ChunkIdGenerator
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ChunkIdGenerator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ragora.core.chunking.ChunkIdGenerator._normalize_content_type" class="md-nav__link">
    <span class="md-ellipsis">
      _normalize_content_type
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.chunking.ChunkIdGenerator._normalize_location_id" class="md-nav__link">
    <span class="md-ellipsis">
      _normalize_location_id
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.chunking.ChunkIdGenerator._normalize_source_id" class="md-nav__link">
    <span class="md-ellipsis">
      _normalize_source_id
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.chunking.ChunkIdGenerator.generate_chunk_id" class="md-nav__link">
    <span class="md-ellipsis">
      generate_chunk_id
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.chunking.ChunkIdGenerator.get_source_hash" class="md-nav__link">
    <span class="md-ellipsis">
      get_source_hash
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.chunking.ChunkIdGenerator.parse_chunk_id" class="md-nav__link">
    <span class="md-ellipsis">
      parse_chunk_id
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.chunking.ChunkMetadata" class="md-nav__link">
    <span class="md-ellipsis">
      ChunkMetadata
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.chunking.ChunkingContext" class="md-nav__link">
    <span class="md-ellipsis">
      ChunkingContext
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.chunking.ChunkingContextBuilder" class="md-nav__link">
    <span class="md-ellipsis">
      ChunkingContextBuilder
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ChunkingContextBuilder">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ragora.core.chunking.ChunkingContextBuilder.build" class="md-nav__link">
    <span class="md-ellipsis">
      build
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.chunking.ChunkingContextBuilder.for_document" class="md-nav__link">
    <span class="md-ellipsis">
      for_document
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.chunking.ChunkingContextBuilder.for_document_with_page" class="md-nav__link">
    <span class="md-ellipsis">
      for_document_with_page
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.chunking.ChunkingContextBuilder.for_email" class="md-nav__link">
    <span class="md-ellipsis">
      for_email
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.chunking.ChunkingContextBuilder.for_email_with_id" class="md-nav__link">
    <span class="md-ellipsis">
      for_email_with_id
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.chunking.ChunkingContextBuilder.for_text" class="md-nav__link">
    <span class="md-ellipsis">
      for_text
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.chunking.ChunkingContextBuilder.for_text_with_source" class="md-nav__link">
    <span class="md-ellipsis">
      for_text_with_source
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.chunking.ChunkingContextBuilder.with_created_at" class="md-nav__link">
    <span class="md-ellipsis">
      with_created_at
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.chunking.ChunkingContextBuilder.with_custom_metadata" class="md-nav__link">
    <span class="md-ellipsis">
      with_custom_metadata
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.chunking.ChunkingContextBuilder.with_email_info" class="md-nav__link">
    <span class="md-ellipsis">
      with_email_info
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.chunking.ChunkingContextBuilder.with_location_id" class="md-nav__link">
    <span class="md-ellipsis">
      with_location_id
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.chunking.ChunkingContextBuilder.with_page" class="md-nav__link">
    <span class="md-ellipsis">
      with_page
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.chunking.ChunkingContextBuilder.with_section" class="md-nav__link">
    <span class="md-ellipsis">
      with_section
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.chunking.ChunkingContextBuilder.with_source" class="md-nav__link">
    <span class="md-ellipsis">
      with_source
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.chunking.ChunkingContextBuilder.with_source_id" class="md-nav__link">
    <span class="md-ellipsis">
      with_source_id
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.chunking.ChunkingContextBuilder.with_start_sequence_idx" class="md-nav__link">
    <span class="md-ellipsis">
      with_start_sequence_idx
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.chunking.ChunkingStrategy" class="md-nav__link">
    <span class="md-ellipsis">
      ChunkingStrategy
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ChunkingStrategy">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ragora.core.chunking.ChunkingStrategy._create_chunk_with_id" class="md-nav__link">
    <span class="md-ellipsis">
      _create_chunk_with_id
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.chunking.ChunkingStrategy._get_location_id" class="md-nav__link">
    <span class="md-ellipsis">
      _get_location_id
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.chunking.ChunkingStrategy._get_source_id" class="md-nav__link">
    <span class="md-ellipsis">
      _get_source_id
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.chunking.ChunkingStrategy.chunk" class="md-nav__link">
    <span class="md-ellipsis">
      chunk
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.chunking.DataChunk" class="md-nav__link">
    <span class="md-ellipsis">
      DataChunk
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.chunking.DataChunker" class="md-nav__link">
    <span class="md-ellipsis">
      DataChunker
    </span>
  </a>
  
    <nav class="md-nav" aria-label="DataChunker">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ragora.core.chunking.DataChunker.chunk" class="md-nav__link">
    <span class="md-ellipsis">
      chunk
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.chunking.DataChunker.register_strategy" class="md-nav__link">
    <span class="md-ellipsis">
      register_strategy
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.chunking.DocumentChunkingStrategy" class="md-nav__link">
    <span class="md-ellipsis">
      DocumentChunkingStrategy
    </span>
  </a>
  
    <nav class="md-nav" aria-label="DocumentChunkingStrategy">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ragora.core.chunking.DocumentChunkingStrategy._chunk_text" class="md-nav__link">
    <span class="md-ellipsis">
      _chunk_text
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.chunking.DocumentChunkingStrategy._create_chunk_with_id" class="md-nav__link">
    <span class="md-ellipsis">
      _create_chunk_with_id
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.chunking.DocumentChunkingStrategy._get_location_id" class="md-nav__link">
    <span class="md-ellipsis">
      _get_location_id
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.chunking.DocumentChunkingStrategy._get_source_id" class="md-nav__link">
    <span class="md-ellipsis">
      _get_source_id
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.chunking.DocumentChunkingStrategy.chunk" class="md-nav__link">
    <span class="md-ellipsis">
      chunk
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.chunking.EmailChunkingStrategy" class="md-nav__link">
    <span class="md-ellipsis">
      EmailChunkingStrategy
    </span>
  </a>
  
    <nav class="md-nav" aria-label="EmailChunkingStrategy">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ragora.core.chunking.EmailChunkingStrategy._chunk_text" class="md-nav__link">
    <span class="md-ellipsis">
      _chunk_text
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.chunking.EmailChunkingStrategy._create_chunk_with_id" class="md-nav__link">
    <span class="md-ellipsis">
      _create_chunk_with_id
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.chunking.EmailChunkingStrategy._get_location_id" class="md-nav__link">
    <span class="md-ellipsis">
      _get_location_id
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.chunking.EmailChunkingStrategy._get_source_id" class="md-nav__link">
    <span class="md-ellipsis">
      _get_source_id
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.chunking.EmailChunkingStrategy.chunk" class="md-nav__link">
    <span class="md-ellipsis">
      chunk
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.chunking.TextChunkingStrategy" class="md-nav__link">
    <span class="md-ellipsis">
      TextChunkingStrategy
    </span>
  </a>
  
    <nav class="md-nav" aria-label="TextChunkingStrategy">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ragora.core.chunking.TextChunkingStrategy._chunk_text" class="md-nav__link">
    <span class="md-ellipsis">
      _chunk_text
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.chunking.TextChunkingStrategy._create_chunk_with_id" class="md-nav__link">
    <span class="md-ellipsis">
      _create_chunk_with_id
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.chunking.TextChunkingStrategy._get_location_id" class="md-nav__link">
    <span class="md-ellipsis">
      _get_location_id
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.chunking.TextChunkingStrategy._get_source_id" class="md-nav__link">
    <span class="md-ellipsis">
      _get_source_id
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.chunking.TextChunkingStrategy.chunk" class="md-nav__link">
    <span class="md-ellipsis">
      chunk
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#document-preprocessor" class="md-nav__link">
    <span class="md-ellipsis">
      Document Preprocessor
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Document Preprocessor">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ragora.core.document_preprocessor" class="md-nav__link">
    <span class="md-ellipsis">
      document_preprocessor
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.document_preprocessor.DocumentPreprocessor" class="md-nav__link">
    <span class="md-ellipsis">
      DocumentPreprocessor
    </span>
  </a>
  
    <nav class="md-nav" aria-label="DocumentPreprocessor">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ragora.core.document_preprocessor.DocumentPreprocessor._chunk_document" class="md-nav__link">
    <span class="md-ellipsis">
      _chunk_document
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.document_preprocessor.DocumentPreprocessor._chunk_documents" class="md-nav__link">
    <span class="md-ellipsis">
      _chunk_documents
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.document_preprocessor.DocumentPreprocessor._chunk_markdown_document" class="md-nav__link">
    <span class="md-ellipsis">
      _chunk_markdown_document
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.document_preprocessor.DocumentPreprocessor._chunk_markdown_documents" class="md-nav__link">
    <span class="md-ellipsis">
      _chunk_markdown_documents
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.document_preprocessor.DocumentPreprocessor._extract_document_text" class="md-nav__link">
    <span class="md-ellipsis">
      _extract_document_text
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.document_preprocessor.DocumentPreprocessor.preprocess_document" class="md-nav__link">
    <span class="md-ellipsis">
      preprocess_document
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.document_preprocessor.DocumentPreprocessor.preprocess_document_folder" class="md-nav__link">
    <span class="md-ellipsis">
      preprocess_document_folder
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.document_preprocessor.DocumentPreprocessor.preprocess_documents" class="md-nav__link">
    <span class="md-ellipsis">
      preprocess_documents
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#email-preprocessor" class="md-nav__link">
    <span class="md-ellipsis">
      Email Preprocessor
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Email Preprocessor">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ragora.core.email_preprocessor" class="md-nav__link">
    <span class="md-ellipsis">
      email_preprocessor
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.email_preprocessor.EmailPreprocessor" class="md-nav__link">
    <span class="md-ellipsis">
      EmailPreprocessor
    </span>
  </a>
  
    <nav class="md-nav" aria-label="EmailPreprocessor">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ragora.core.email_preprocessor.EmailPreprocessor._email_to_chunks" class="md-nav__link">
    <span class="md-ellipsis">
      _email_to_chunks
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.email_preprocessor.EmailPreprocessor._html_to_text" class="md-nav__link">
    <span class="md-ellipsis">
      _html_to_text
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.email_preprocessor.EmailPreprocessor._html_to_text_beautifulsoup" class="md-nav__link">
    <span class="md-ellipsis">
      _html_to_text_beautifulsoup
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.email_preprocessor.EmailPreprocessor._html_to_text_html2text" class="md-nav__link">
    <span class="md-ellipsis">
      _html_to_text_html2text
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.email_preprocessor.EmailPreprocessor._html_to_text_regex" class="md-nav__link">
    <span class="md-ellipsis">
      _html_to_text_regex
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.email_preprocessor.EmailPreprocessor._normalize_whitespace" class="md-nav__link">
    <span class="md-ellipsis">
      _normalize_whitespace
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.email_preprocessor.EmailPreprocessor._strip_quoted_replies" class="md-nav__link">
    <span class="md-ellipsis">
      _strip_quoted_replies
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.email_preprocessor.EmailPreprocessor._strip_quoted_replies_library" class="md-nav__link">
    <span class="md-ellipsis">
      _strip_quoted_replies_library
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.email_preprocessor.EmailPreprocessor._strip_quoted_replies_regex" class="md-nav__link">
    <span class="md-ellipsis">
      _strip_quoted_replies_regex
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.email_preprocessor.EmailPreprocessor._strip_signatures" class="md-nav__link">
    <span class="md-ellipsis">
      _strip_signatures
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.email_preprocessor.EmailPreprocessor.clean_email_body" class="md-nav__link">
    <span class="md-ellipsis">
      clean_email_body
    </span>
  </a>
  
    <nav class="md-nav" aria-label="clean_email_body">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ragora.core.email_preprocessor.EmailPreprocessor.clean_email_body--works-with-emailmessage" class="md-nav__link">
    <span class="md-ellipsis">
      Works with EmailMessage
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.email_preprocessor.EmailPreprocessor.clean_email_body--also-works-with-emailmessagemodel" class="md-nav__link">
    <span class="md-ellipsis">
      Also works with EmailMessageModel
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.email_preprocessor.EmailPreprocessor.clean_email_body--use-clean_text-with-llm-or-other-processing" class="md-nav__link">
    <span class="md-ellipsis">
      Use clean_text with LLM or other processing
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.email_preprocessor.EmailPreprocessor.preprocess_email" class="md-nav__link">
    <span class="md-ellipsis">
      preprocess_email
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.email_preprocessor.EmailPreprocessor.preprocess_emails" class="md-nav__link">
    <span class="md-ellipsis">
      preprocess_emails
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#embedding-engine" class="md-nav__link">
    <span class="md-ellipsis">
      Embedding Engine
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Embedding Engine">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ragora.core.embedding_engine" class="md-nav__link">
    <span class="md-ellipsis">
      embedding_engine
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.embedding_engine.EmbeddingEngine" class="md-nav__link">
    <span class="md-ellipsis">
      EmbeddingEngine
    </span>
  </a>
  
    <nav class="md-nav" aria-label="EmbeddingEngine">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ragora.core.embedding_engine.EmbeddingEngine._cosine_similarity" class="md-nav__link">
    <span class="md-ellipsis">
      _cosine_similarity
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.embedding_engine.EmbeddingEngine._euclidean_distance" class="md-nav__link">
    <span class="md-ellipsis">
      _euclidean_distance
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.embedding_engine.EmbeddingEngine.embed_chunk" class="md-nav__link">
    <span class="md-ellipsis">
      embed_chunk
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.embedding_engine.EmbeddingEngine.embed_chunks" class="md-nav__link">
    <span class="md-ellipsis">
      embed_chunks
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.embedding_engine.EmbeddingEngine.embed_text" class="md-nav__link">
    <span class="md-ellipsis">
      embed_text
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.embedding_engine.EmbeddingEngine.embed_texts" class="md-nav__link">
    <span class="md-ellipsis">
      embed_texts
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.embedding_engine.EmbeddingEngine.get_embedding_dimension" class="md-nav__link">
    <span class="md-ellipsis">
      get_embedding_dimension
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.embedding_engine.EmbeddingEngine.get_model_info" class="md-nav__link">
    <span class="md-ellipsis">
      get_model_info
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.embedding_engine.EmbeddingEngine.similarity" class="md-nav__link">
    <span class="md-ellipsis">
      similarity
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#filters" class="md-nav__link">
    <span class="md-ellipsis">
      Filters
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Filters">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ragora.core.filters" class="md-nav__link">
    <span class="md-ellipsis">
      filters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.filters.FilterBuilder" class="md-nav__link">
    <span class="md-ellipsis">
      FilterBuilder
    </span>
  </a>
  
    <nav class="md-nav" aria-label="FilterBuilder">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ragora.core.filters.FilterBuilder.by_chunk_idx" class="md-nav__link">
    <span class="md-ellipsis">
      by_chunk_idx
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.filters.FilterBuilder.by_chunk_type" class="md-nav__link">
    <span class="md-ellipsis">
      by_chunk_type
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.filters.FilterBuilder.by_date_range" class="md-nav__link">
    <span class="md-ellipsis">
      by_date_range
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.filters.FilterBuilder.by_email_date_range" class="md-nav__link">
    <span class="md-ellipsis">
      by_email_date_range
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.filters.FilterBuilder.by_email_folder" class="md-nav__link">
    <span class="md-ellipsis">
      by_email_folder
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.filters.FilterBuilder.by_email_recipient" class="md-nav__link">
    <span class="md-ellipsis">
      by_email_recipient
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.filters.FilterBuilder.by_email_sender" class="md-nav__link">
    <span class="md-ellipsis">
      by_email_sender
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.filters.FilterBuilder.by_email_subject" class="md-nav__link">
    <span class="md-ellipsis">
      by_email_subject
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.filters.FilterBuilder.by_page_number" class="md-nav__link">
    <span class="md-ellipsis">
      by_page_number
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.filters.FilterBuilder.by_section_title" class="md-nav__link">
    <span class="md-ellipsis">
      by_section_title
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.filters.FilterBuilder.by_source_document" class="md-nav__link">
    <span class="md-ellipsis">
      by_source_document
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.filters.FilterBuilder.combine_and" class="md-nav__link">
    <span class="md-ellipsis">
      combine_and
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.core.filters.FilterBuilder.combine_or" class="md-nav__link">
    <span class="md-ellipsis">
      combine_or
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#exceptions" class="md-nav__link">
    <span class="md-ellipsis">
      Exceptions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Exceptions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ragora.exceptions" class="md-nav__link">
    <span class="md-ellipsis">
      exceptions
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.exceptions.ConfigurationError" class="md-nav__link">
    <span class="md-ellipsis">
      ConfigurationError
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.exceptions.DocumentProcessingError" class="md-nav__link">
    <span class="md-ellipsis">
      DocumentProcessingError
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.exceptions.EmbeddingError" class="md-nav__link">
    <span class="md-ellipsis">
      EmbeddingError
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.exceptions.KnowledgeBaseManagerError" class="md-nav__link">
    <span class="md-ellipsis">
      KnowledgeBaseManagerError
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.exceptions.RetrievalError" class="md-nav__link">
    <span class="md-ellipsis">
      RetrievalError
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.exceptions.VectorStoreError" class="md-nav__link">
    <span class="md-ellipsis">
      VectorStoreError
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#utilities" class="md-nav__link">
    <span class="md-ellipsis">
      Utilities
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Utilities">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#device-utilities" class="md-nav__link">
    <span class="md-ellipsis">
      Device Utilities
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Device Utilities">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ragora.utils.device_utils" class="md-nav__link">
    <span class="md-ellipsis">
      device_utils
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.device_utils.DeviceManager" class="md-nav__link">
    <span class="md-ellipsis">
      DeviceManager
    </span>
  </a>
  
    <nav class="md-nav" aria-label="DeviceManager">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ragora.utils.device_utils.DeviceManager._check_cuda_via_nvidia_smi" class="md-nav__link">
    <span class="md-ellipsis">
      _check_cuda_via_nvidia_smi
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.device_utils.DeviceManager._detect_gpu_capabilities" class="md-nav__link">
    <span class="md-ellipsis">
      _detect_gpu_capabilities
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.device_utils.DeviceManager._detect_platform" class="md-nav__link">
    <span class="md-ellipsis">
      _detect_platform
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.device_utils.DeviceManager._select_optimal_device" class="md-nav__link">
    <span class="md-ellipsis">
      _select_optimal_device
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.device_utils.DeviceManager.configure_pytorch_device" class="md-nav__link">
    <span class="md-ellipsis">
      configure_pytorch_device
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.device_utils.DeviceManager.get_device_info" class="md-nav__link">
    <span class="md-ellipsis">
      get_device_info
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.device_utils.DeviceManager.get_recommended_device" class="md-nav__link">
    <span class="md-ellipsis">
      get_recommended_device
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.device_utils.configure_pytorch_for_platform" class="md-nav__link">
    <span class="md-ellipsis">
      configure_pytorch_for_platform
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.device_utils.get_device_info" class="md-nav__link">
    <span class="md-ellipsis">
      get_device_info
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.device_utils.get_device_manager" class="md-nav__link">
    <span class="md-ellipsis">
      get_device_manager
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.device_utils.get_recommended_device" class="md-nav__link">
    <span class="md-ellipsis">
      get_recommended_device
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.device_utils.get_sentence_transformer_device" class="md-nav__link">
    <span class="md-ellipsis">
      get_sentence_transformer_device
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.device_utils.is_cuda_available" class="md-nav__link">
    <span class="md-ellipsis">
      is_cuda_available
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.device_utils.is_gpu_available" class="md-nav__link">
    <span class="md-ellipsis">
      is_gpu_available
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.device_utils.is_linux" class="md-nav__link">
    <span class="md-ellipsis">
      is_linux
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.device_utils.is_macos" class="md-nav__link">
    <span class="md-ellipsis">
      is_macos
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.device_utils.is_windows" class="md-nav__link">
    <span class="md-ellipsis">
      is_windows
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.device_utils.mock_platform_info" class="md-nav__link">
    <span class="md-ellipsis">
      mock_platform_info
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.device_utils.reset_device_manager" class="md-nav__link">
    <span class="md-ellipsis">
      reset_device_manager
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#email-provider-factory" class="md-nav__link">
    <span class="md-ellipsis">
      Email Provider Factory
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Email Provider Factory">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ragora.utils.email_provider_factory" class="md-nav__link">
    <span class="md-ellipsis">
      email_provider_factory
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.email_provider_factory.EmailProviderFactory" class="md-nav__link">
    <span class="md-ellipsis">
      EmailProviderFactory
    </span>
  </a>
  
    <nav class="md-nav" aria-label="EmailProviderFactory">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ragora.utils.email_provider_factory.EmailProviderFactory.create_graph_provider" class="md-nav__link">
    <span class="md-ellipsis">
      create_graph_provider
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.email_provider_factory.EmailProviderFactory.create_imap_provider" class="md-nav__link">
    <span class="md-ellipsis">
      create_imap_provider
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.email_provider_factory.EmailProviderFactory.create_provider" class="md-nav__link">
    <span class="md-ellipsis">
      create_provider
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.email_provider_factory.EmailProviderFactory.get_supported_providers" class="md-nav__link">
    <span class="md-ellipsis">
      get_supported_providers
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.email_provider_factory.ProviderType" class="md-nav__link">
    <span class="md-ellipsis">
      ProviderType
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#email-utils" class="md-nav__link">
    <span class="md-ellipsis">
      Email Utils
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Email Utils">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ragora.utils.email_utils.base" class="md-nav__link">
    <span class="md-ellipsis">
      base
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.email_utils.base.EmailProvider" class="md-nav__link">
    <span class="md-ellipsis">
      EmailProvider
    </span>
  </a>
  
    <nav class="md-nav" aria-label="EmailProvider">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ragora.utils.email_utils.base.EmailProvider.is_connected" class="md-nav__link">
    <span class="md-ellipsis">
      is_connected
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.email_utils.base.EmailProvider.connect" class="md-nav__link">
    <span class="md-ellipsis">
      connect
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.email_utils.base.EmailProvider.create_draft" class="md-nav__link">
    <span class="md-ellipsis">
      create_draft
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.email_utils.base.EmailProvider.disconnect" class="md-nav__link">
    <span class="md-ellipsis">
      disconnect
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.email_utils.base.EmailProvider.fetch_message_by_id" class="md-nav__link">
    <span class="md-ellipsis">
      fetch_message_by_id
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.email_utils.base.EmailProvider.fetch_messages" class="md-nav__link">
    <span class="md-ellipsis">
      fetch_messages
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.email_utils.base.EmailProvider.get_folders" class="md-nav__link">
    <span class="md-ellipsis">
      get_folders
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.email_utils.base.EmailProvider.mark_as_read" class="md-nav__link">
    <span class="md-ellipsis">
      mark_as_read
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.email_utils.base.EmailProvider.send_message" class="md-nav__link">
    <span class="md-ellipsis">
      send_message
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.email_utils.base.EmailProvider.send_message_direct" class="md-nav__link">
    <span class="md-ellipsis">
      send_message_direct
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.email_utils.graph_provider" class="md-nav__link">
    <span class="md-ellipsis">
      graph_provider
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.email_utils.graph_provider.AuthenticationError" class="md-nav__link">
    <span class="md-ellipsis">
      AuthenticationError
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.email_utils.graph_provider.GraphProvider" class="md-nav__link">
    <span class="md-ellipsis">
      GraphProvider
    </span>
  </a>
  
    <nav class="md-nav" aria-label="GraphProvider">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ragora.utils.email_utils.graph_provider.GraphProvider.is_connected" class="md-nav__link">
    <span class="md-ellipsis">
      is_connected
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.email_utils.graph_provider.GraphProvider._get_access_token" class="md-nav__link">
    <span class="md-ellipsis">
      _get_access_token
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.email_utils.graph_provider.GraphProvider._make_request" class="md-nav__link">
    <span class="md-ellipsis">
      _make_request
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.email_utils.graph_provider.GraphProvider._parse_graph_attachments" class="md-nav__link">
    <span class="md-ellipsis">
      _parse_graph_attachments
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.email_utils.graph_provider.GraphProvider._parse_graph_date" class="md-nav__link">
    <span class="md-ellipsis">
      _parse_graph_date
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.email_utils.graph_provider.GraphProvider._parse_graph_message" class="md-nav__link">
    <span class="md-ellipsis">
      _parse_graph_message
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.email_utils.graph_provider.GraphProvider._verify_token" class="md-nav__link">
    <span class="md-ellipsis">
      _verify_token
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.email_utils.graph_provider.GraphProvider.connect" class="md-nav__link">
    <span class="md-ellipsis">
      connect
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.email_utils.graph_provider.GraphProvider.create_draft" class="md-nav__link">
    <span class="md-ellipsis">
      create_draft
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.email_utils.graph_provider.GraphProvider.disconnect" class="md-nav__link">
    <span class="md-ellipsis">
      disconnect
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.email_utils.graph_provider.GraphProvider.fetch_message_by_id" class="md-nav__link">
    <span class="md-ellipsis">
      fetch_message_by_id
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.email_utils.graph_provider.GraphProvider.fetch_messages" class="md-nav__link">
    <span class="md-ellipsis">
      fetch_messages
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.email_utils.graph_provider.GraphProvider.get_folders" class="md-nav__link">
    <span class="md-ellipsis">
      get_folders
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.email_utils.graph_provider.GraphProvider.mark_as_read" class="md-nav__link">
    <span class="md-ellipsis">
      mark_as_read
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.email_utils.graph_provider.GraphProvider.send_message" class="md-nav__link">
    <span class="md-ellipsis">
      send_message
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.email_utils.graph_provider.GraphProvider.send_message_direct" class="md-nav__link">
    <span class="md-ellipsis">
      send_message_direct
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.email_utils.imap_provider" class="md-nav__link">
    <span class="md-ellipsis">
      imap_provider
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.email_utils.imap_provider.IMAPProvider" class="md-nav__link">
    <span class="md-ellipsis">
      IMAPProvider
    </span>
  </a>
  
    <nav class="md-nav" aria-label="IMAPProvider">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ragora.utils.email_utils.imap_provider.IMAPProvider.is_connected" class="md-nav__link">
    <span class="md-ellipsis">
      is_connected
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.email_utils.imap_provider.IMAPProvider._create_draft_message" class="md-nav__link">
    <span class="md-ellipsis">
      _create_draft_message
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.email_utils.imap_provider.IMAPProvider._create_local_draft" class="md-nav__link">
    <span class="md-ellipsis">
      _create_local_draft
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.email_utils.imap_provider.IMAPProvider._decode_header" class="md-nav__link">
    <span class="md-ellipsis">
      _decode_header
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.email_utils.imap_provider.IMAPProvider._extract_attachments" class="md-nav__link">
    <span class="md-ellipsis">
      _extract_attachments
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.email_utils.imap_provider.IMAPProvider._extract_body" class="md-nav__link">
    <span class="md-ellipsis">
      _extract_body
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.email_utils.imap_provider.IMAPProvider._fetch_single_message" class="md-nav__link">
    <span class="md-ellipsis">
      _fetch_single_message
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.email_utils.imap_provider.IMAPProvider._parse_address" class="md-nav__link">
    <span class="md-ellipsis">
      _parse_address
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.email_utils.imap_provider.IMAPProvider._parse_address_list" class="md-nav__link">
    <span class="md-ellipsis">
      _parse_address_list
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.email_utils.imap_provider.IMAPProvider._parse_date" class="md-nav__link">
    <span class="md-ellipsis">
      _parse_date
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.email_utils.imap_provider.IMAPProvider._parse_email_message" class="md-nav__link">
    <span class="md-ellipsis">
      _parse_email_message
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.email_utils.imap_provider.IMAPProvider.connect" class="md-nav__link">
    <span class="md-ellipsis">
      connect
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.email_utils.imap_provider.IMAPProvider.create_draft" class="md-nav__link">
    <span class="md-ellipsis">
      create_draft
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.email_utils.imap_provider.IMAPProvider.disconnect" class="md-nav__link">
    <span class="md-ellipsis">
      disconnect
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.email_utils.imap_provider.IMAPProvider.fetch_message_by_id" class="md-nav__link">
    <span class="md-ellipsis">
      fetch_message_by_id
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.email_utils.imap_provider.IMAPProvider.fetch_messages" class="md-nav__link">
    <span class="md-ellipsis">
      fetch_messages
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.email_utils.imap_provider.IMAPProvider.get_folders" class="md-nav__link">
    <span class="md-ellipsis">
      get_folders
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.email_utils.imap_provider.IMAPProvider.mark_as_read" class="md-nav__link">
    <span class="md-ellipsis">
      mark_as_read
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.email_utils.imap_provider.IMAPProvider.send_message" class="md-nav__link">
    <span class="md-ellipsis">
      send_message
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.email_utils.imap_provider.IMAPProvider.send_message_direct" class="md-nav__link">
    <span class="md-ellipsis">
      send_message_direct
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.email_utils.models" class="md-nav__link">
    <span class="md-ellipsis">
      models
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.email_utils.models.EmailAddress" class="md-nav__link">
    <span class="md-ellipsis">
      EmailAddress
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.email_utils.models.EmailAttachment" class="md-nav__link">
    <span class="md-ellipsis">
      EmailAttachment
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.email_utils.models.EmailCredentials" class="md-nav__link">
    <span class="md-ellipsis">
      EmailCredentials
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.email_utils.models.EmailDraft" class="md-nav__link">
    <span class="md-ellipsis">
      EmailDraft
    </span>
  </a>
  
    <nav class="md-nav" aria-label="EmailDraft">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ragora.utils.email_utils.models.EmailDraft.get_all_recipients" class="md-nav__link">
    <span class="md-ellipsis">
      get_all_recipients
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.email_utils.models.EmailDraft.get_body" class="md-nav__link">
    <span class="md-ellipsis">
      get_body
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.email_utils.models.EmailMessage" class="md-nav__link">
    <span class="md-ellipsis">
      EmailMessage
    </span>
  </a>
  
    <nav class="md-nav" aria-label="EmailMessage">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ragora.utils.email_utils.models.EmailMessage.get_all_recipients" class="md-nav__link">
    <span class="md-ellipsis">
      get_all_recipients
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.email_utils.models.EmailMessage.get_body" class="md-nav__link">
    <span class="md-ellipsis">
      get_body
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.email_utils.models.GraphCredentials" class="md-nav__link">
    <span class="md-ellipsis">
      GraphCredentials
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.email_utils.models.IMAPCredentials" class="md-nav__link">
    <span class="md-ellipsis">
      IMAPCredentials
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.email_utils.models.MessageStatus" class="md-nav__link">
    <span class="md-ellipsis">
      MessageStatus
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#latex-parser" class="md-nav__link">
    <span class="md-ellipsis">
      LaTeX Parser
    </span>
  </a>
  
    <nav class="md-nav" aria-label="LaTeX Parser">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ragora.utils.latex_parser" class="md-nav__link">
    <span class="md-ellipsis">
      latex_parser
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.latex_parser.Citation" class="md-nav__link">
    <span class="md-ellipsis">
      Citation
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Citation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ragora.utils.latex_parser.Citation.to_text" class="md-nav__link">
    <span class="md-ellipsis">
      to_text
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.latex_parser.LatexChapter" class="md-nav__link">
    <span class="md-ellipsis">
      LatexChapter
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.latex_parser.LatexDocument" class="md-nav__link">
    <span class="md-ellipsis">
      LatexDocument
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.latex_parser.LatexFigure" class="md-nav__link">
    <span class="md-ellipsis">
      LatexFigure
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.latex_parser.LatexParagraph" class="md-nav__link">
    <span class="md-ellipsis">
      LatexParagraph
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.latex_parser.LatexParser" class="md-nav__link">
    <span class="md-ellipsis">
      LatexParser
    </span>
  </a>
  
    <nav class="md-nav" aria-label="LatexParser">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ragora.utils.latex_parser.LatexParser._extract_author" class="md-nav__link">
    <span class="md-ellipsis">
      _extract_author
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.latex_parser.LatexParser._extract_bib_field" class="md-nav__link">
    <span class="md-ellipsis">
      _extract_bib_field
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.latex_parser.LatexParser._extract_doi" class="md-nav__link">
    <span class="md-ellipsis">
      _extract_doi
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.latex_parser.LatexParser._extract_label" class="md-nav__link">
    <span class="md-ellipsis">
      _extract_label
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.latex_parser.LatexParser._extract_title" class="md-nav__link">
    <span class="md-ellipsis">
      _extract_title
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.latex_parser.LatexParser._extract_year" class="md-nav__link">
    <span class="md-ellipsis">
      _extract_year
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.latex_parser.LatexParser._get_or_create_citation" class="md-nav__link">
    <span class="md-ellipsis">
      _get_or_create_citation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.latex_parser.LatexParser._load_bibliography" class="md-nav__link">
    <span class="md-ellipsis">
      _load_bibliography
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.latex_parser.LatexParser._parse_bibtex" class="md-nav__link">
    <span class="md-ellipsis">
      _parse_bibtex
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.latex_parser.LatexParser._parse_chapters" class="md-nav__link">
    <span class="md-ellipsis">
      _parse_chapters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.latex_parser.LatexParser._parse_figures" class="md-nav__link">
    <span class="md-ellipsis">
      _parse_figures
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.latex_parser.LatexParser._parse_paragraphs" class="md-nav__link">
    <span class="md-ellipsis">
      _parse_paragraphs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.latex_parser.LatexParser._parse_sections" class="md-nav__link">
    <span class="md-ellipsis">
      _parse_sections
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.latex_parser.LatexParser._parse_single_chapter" class="md-nav__link">
    <span class="md-ellipsis">
      _parse_single_chapter
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.latex_parser.LatexParser._parse_single_figure" class="md-nav__link">
    <span class="md-ellipsis">
      _parse_single_figure
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.latex_parser.LatexParser._parse_single_section" class="md-nav__link">
    <span class="md-ellipsis">
      _parse_single_section
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.latex_parser.LatexParser._parse_single_table" class="md-nav__link">
    <span class="md-ellipsis">
      _parse_single_table
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.latex_parser.LatexParser._parse_tables" class="md-nav__link">
    <span class="md-ellipsis">
      _parse_tables
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.latex_parser.LatexParser._parse_tabular_content" class="md-nav__link">
    <span class="md-ellipsis">
      _parse_tabular_content
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.latex_parser.LatexParser._process_citations_in_text" class="md-nav__link">
    <span class="md-ellipsis">
      _process_citations_in_text
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.latex_parser.LatexParser._remove_document_preamble" class="md-nav__link">
    <span class="md-ellipsis">
      _remove_document_preamble
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.latex_parser.LatexParser._split_into_chapters" class="md-nav__link">
    <span class="md-ellipsis">
      _split_into_chapters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.latex_parser.LatexParser._split_into_sections" class="md-nav__link">
    <span class="md-ellipsis">
      _split_into_sections
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.latex_parser.LatexParser.get_bibliography_entries" class="md-nav__link">
    <span class="md-ellipsis">
      get_bibliography_entries
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.latex_parser.LatexParser.parse_bibliography" class="md-nav__link">
    <span class="md-ellipsis">
      parse_bibliography
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.latex_parser.LatexParser.parse_document" class="md-nav__link">
    <span class="md-ellipsis">
      parse_document
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.latex_parser.LatexParser.parse_document_text" class="md-nav__link">
    <span class="md-ellipsis">
      parse_document_text
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.latex_parser.LatexSection" class="md-nav__link">
    <span class="md-ellipsis">
      LatexSection
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.latex_parser.LatexSubsection" class="md-nav__link">
    <span class="md-ellipsis">
      LatexSubsection
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.latex_parser.LatexSubsubsection" class="md-nav__link">
    <span class="md-ellipsis">
      LatexSubsubsection
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.latex_parser.LatexTable" class="md-nav__link">
    <span class="md-ellipsis">
      LatexTable
    </span>
  </a>
  
    <nav class="md-nav" aria-label="LatexTable">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ragora.utils.latex_parser.LatexTable.to_markdown" class="md-nav__link">
    <span class="md-ellipsis">
      to_markdown
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.latex_parser.LatexTable.to_plain_text" class="md-nav__link">
    <span class="md-ellipsis">
      to_plain_text
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#markdown-parser" class="md-nav__link">
    <span class="md-ellipsis">
      Markdown Parser
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Markdown Parser">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ragora.utils.markdown_parser" class="md-nav__link">
    <span class="md-ellipsis">
      markdown_parser
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.markdown_parser.MarkdownChapter" class="md-nav__link">
    <span class="md-ellipsis">
      MarkdownChapter
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.markdown_parser.MarkdownDocument" class="md-nav__link">
    <span class="md-ellipsis">
      MarkdownDocument
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.markdown_parser.MarkdownParagraph" class="md-nav__link">
    <span class="md-ellipsis">
      MarkdownParagraph
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.markdown_parser.MarkdownParser" class="md-nav__link">
    <span class="md-ellipsis">
      MarkdownParser
    </span>
  </a>
  
    <nav class="md-nav" aria-label="MarkdownParser">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ragora.utils.markdown_parser.MarkdownParser.parse_document" class="md-nav__link">
    <span class="md-ellipsis">
      parse_document
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.markdown_parser.MarkdownParser.parse_text" class="md-nav__link">
    <span class="md-ellipsis">
      parse_text
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.utils.markdown_parser.MarkdownSection" class="md-nav__link">
    <span class="md-ellipsis">
      MarkdownSection
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Configuration
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Configuration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ragora.config.settings" class="md-nav__link">
    <span class="md-ellipsis">
      settings
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.config.settings.ChunkConfig" class="md-nav__link">
    <span class="md-ellipsis">
      ChunkConfig
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.config.settings.DatabaseManagerConfig" class="md-nav__link">
    <span class="md-ellipsis">
      DatabaseManagerConfig
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.config.settings.EmbeddingConfig" class="md-nav__link">
    <span class="md-ellipsis">
      EmbeddingConfig
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.config.settings.KnowledgeBaseManagerConfig" class="md-nav__link">
    <span class="md-ellipsis">
      KnowledgeBaseManagerConfig
    </span>
  </a>
  
    <nav class="md-nav" aria-label="KnowledgeBaseManagerConfig">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ragora.config.settings.KnowledgeBaseManagerConfig.default" class="md-nav__link">
    <span class="md-ellipsis">
      default
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragora.config.settings.KnowledgeBaseManagerConfig.from_dict" class="md-nav__link">
    <span class="md-ellipsis">
      from_dict
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="api-reference">API Reference<a class="headerlink" href="#api-reference" title="Permanent link">&para;</a></h1>
<p>This reference is generated automatically from the Ragora docstrings during the
release workflow. Each section below maps to a core module in the project. If
you add or update public APIs, make sure the corresponding docstrings stay in
sync so the published documentation reflects the latest release.</p>
<h2 id="cli">CLI<a class="headerlink" href="#cli" title="Permanent link">&para;</a></h2>


<div class="doc doc-object doc-module">



<a id="ragora.cli.main"></a>
    <div class="doc doc-contents first">

        <p>Entry points for the <code>kbm</code> command-line interface.</p>










  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="ragora.cli.main.create_parser" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">create_parser</span><span class="p">()</span></code>

<a href="#ragora.cli.main.create_parser" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Create the top-level CLI parser.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="argparse.ArgumentParser">ArgumentParser</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>argparse.ArgumentParser: Configured parser instance.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><span class="n">parser</span> <span class="o">=</span> <span class="n">create_parser</span><span class="p">()</span>
<span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">([</span><span class="s2">&quot;process&quot;</span><span class="p">,</span> <span class="s2">&quot;docs/paper.tex&quot;</span><span class="p">])</span>
</code></pre></div>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/cli/main.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">create_parser</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create the top-level CLI parser.</span>

<span class="sd">    Returns:</span>
<span class="sd">        argparse.ArgumentParser: Configured parser instance.</span>

<span class="sd">    Examples:</span>
<span class="sd">        ```python</span>
<span class="sd">        parser = create_parser()</span>
<span class="sd">        parser.parse_args([&quot;process&quot;, &quot;docs/paper.tex&quot;])</span>
<span class="sd">        ```</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">(</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Knowledge Base Manager CLI - LaTeX Document Knowledge Base Manager&quot;</span><span class="p">,</span>
        <span class="n">formatter_class</span><span class="o">=</span><span class="n">argparse</span><span class="o">.</span><span class="n">RawDescriptionHelpFormatter</span><span class="p">,</span>
        <span class="n">epilog</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">Examples:</span>
<span class="s2">  # Process a LaTeX document</span>
<span class="s2">  kbm process document.tex</span>

<span class="s2">  # Query the knowledge base</span>
<span class="s2">  kbm query &quot;What is the main equation in chapter 2?&quot;</span>

<span class="s2">  # Check system status</span>
<span class="s2">  kbm status</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># Global options</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--weaviate-url&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="s2">&quot;http://localhost:8080&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Weaviate server URL (default: http://localhost:8080)&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--class-name&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="s2">&quot;Document&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Weaviate class name (default: Document)&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--embedding-model&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="s2">&quot;all-mpnet-base-v2&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Embedding model name (default: all-mpnet-base-v2)&quot;</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">subparsers</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">add_subparsers</span><span class="p">(</span><span class="n">dest</span><span class="o">=</span><span class="s2">&quot;command&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Available commands&quot;</span><span class="p">)</span>

    <span class="c1"># Process document command</span>
    <span class="n">process_parser</span> <span class="o">=</span> <span class="n">subparsers</span><span class="o">.</span><span class="n">add_parser</span><span class="p">(</span><span class="s2">&quot;process&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Process a LaTeX document&quot;</span><span class="p">)</span>
    <span class="n">process_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;document&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Path to LaTeX document&quot;</span><span class="p">)</span>
    <span class="n">process_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--chunk-size&quot;</span><span class="p">,</span>
        <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="mi">768</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Chunk size in tokens (default: 768)&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">process_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--overlap&quot;</span><span class="p">,</span>
        <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Chunk overlap in tokens (default: 100)&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">process_parser</span><span class="o">.</span><span class="n">set_defaults</span><span class="p">(</span><span class="n">func</span><span class="o">=</span><span class="n">process_document_command</span><span class="p">)</span>

    <span class="c1"># Query command</span>
    <span class="n">query_parser</span> <span class="o">=</span> <span class="n">subparsers</span><span class="o">.</span><span class="n">add_parser</span><span class="p">(</span><span class="s2">&quot;query&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Query the knowledge base&quot;</span><span class="p">)</span>
    <span class="n">query_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;question&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Question to ask&quot;</span><span class="p">)</span>
    <span class="n">query_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--search-type&quot;</span><span class="p">,</span>
        <span class="n">choices</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;similar&quot;</span><span class="p">,</span> <span class="s2">&quot;hybrid&quot;</span><span class="p">],</span>
        <span class="n">default</span><span class="o">=</span><span class="s2">&quot;hybrid&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Type of search to perform (default: hybrid)&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">query_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--top-k&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Number of results to return (default: 5)&quot;</span>
    <span class="p">)</span>
    <span class="n">query_parser</span><span class="o">.</span><span class="n">set_defaults</span><span class="p">(</span><span class="n">func</span><span class="o">=</span><span class="n">query_command</span><span class="p">)</span>

    <span class="c1"># Status command</span>
    <span class="n">status_parser</span> <span class="o">=</span> <span class="n">subparsers</span><span class="o">.</span><span class="n">add_parser</span><span class="p">(</span><span class="s2">&quot;status&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Check system status&quot;</span><span class="p">)</span>
    <span class="n">status_parser</span><span class="o">.</span><span class="n">set_defaults</span><span class="p">(</span><span class="n">func</span><span class="o">=</span><span class="n">status_command</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">parser</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="ragora.cli.main.main" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">main</span><span class="p">()</span></code>

<a href="#ragora.cli.main.main" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Main CLI entry point.</p>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/cli/main.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Main CLI entry point.&quot;&quot;&quot;</span>
    <span class="n">parser</span> <span class="o">=</span> <span class="n">create_parser</span><span class="p">()</span>
    <span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>

    <span class="n">setup_logging</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">verbose</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="s2">&quot;verbose&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="kc">False</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="s2">&quot;func&quot;</span><span class="p">):</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">print_help</span><span class="p">()</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">args</span><span class="o">.</span><span class="n">func</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">KnowledgeBaseManagerError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; Knowledge Base Manager Error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">KeyboardInterrupt</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">  Operation cancelled by user&quot;</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; Unexpected error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="ragora.cli.main.process_document_command" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">process_document_command</span><span class="p">(</span><span class="n">args</span><span class="p">)</span></code>

<a href="#ragora.cli.main.process_document_command" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Process a document specified via CLI arguments.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>args</code>
            </td>
            <td>
                  <code><span title="argparse.Namespace">Namespace</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Parsed CLI namespace with <code>document</code>, <code>chunk_size</code>, <code>overlap</code>,
<code>embedding_model</code>, and <code>weaviate_url</code>.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="SystemExit">SystemExit</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>When processing fails (exit code 1).</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code>kbm<span class="w"> </span>process<span class="w"> </span>docs/sample.tex<span class="w"> </span>--chunk-size<span class="w"> </span><span class="m">600</span><span class="w"> </span>--overlap<span class="w"> </span><span class="m">80</span>
</code></pre></div>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/cli/main.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">process_document_command</span><span class="p">(</span><span class="n">args</span><span class="p">:</span> <span class="n">Namespace</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Process a document specified via CLI arguments.</span>

<span class="sd">    Args:</span>
<span class="sd">        args: Parsed CLI namespace with `document`, `chunk_size`, `overlap`,</span>
<span class="sd">            `embedding_model`, and `weaviate_url`.</span>

<span class="sd">    Raises:</span>
<span class="sd">        SystemExit: When processing fails (exit code 1).</span>

<span class="sd">    Examples:</span>
<span class="sd">        ```bash</span>
<span class="sd">        kbm process docs/sample.tex --chunk-size 600 --overlap 80</span>
<span class="sd">        ```</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">KnowledgeBaseManagerConfig</span><span class="p">(</span>
            <span class="n">chunk_config</span><span class="o">=</span><span class="n">ChunkConfig</span><span class="p">(</span>
                <span class="n">chunk_size</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">chunk_size</span><span class="p">,</span> <span class="n">overlap_size</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">overlap</span>
            <span class="p">),</span>
            <span class="n">embedding_config</span><span class="o">=</span><span class="n">EmbeddingConfig</span><span class="p">(</span><span class="n">model_name</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">embedding_model</span><span class="p">),</span>
            <span class="n">database_manager_config</span><span class="o">=</span><span class="n">DatabaseManagerConfig</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">weaviate_url</span><span class="p">),</span>
        <span class="p">)</span>

        <span class="n">kbm</span> <span class="o">=</span> <span class="n">KnowledgeBaseManager</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="n">config</span><span class="p">)</span>
        <span class="n">chunk_ids</span> <span class="o">=</span> <span class="n">kbm</span><span class="o">.</span><span class="n">process_document</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">document</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; Processed document: </span><span class="si">{</span><span class="n">args</span><span class="o">.</span><span class="n">document</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; Stored </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">chunk_ids</span><span class="p">)</span><span class="si">}</span><span class="s2"> chunks&quot;</span><span class="p">)</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; Error processing document: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="ragora.cli.main.query_command" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">query_command</span><span class="p">(</span><span class="n">args</span><span class="p">)</span></code>

<a href="#ragora.cli.main.query_command" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Execute a semantic or hybrid search.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>args</code>
            </td>
            <td>
                  <code><span title="argparse.Namespace">Namespace</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Parsed CLI namespace containing the query options.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="SystemExit">SystemExit</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>When querying fails (exit code 1).</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code>kbm<span class="w"> </span>query<span class="w"> </span><span class="s2">&quot;Explain theorem 3&quot;</span><span class="w"> </span>--search-type<span class="w"> </span>similar<span class="w"> </span>--top-k<span class="w"> </span><span class="m">3</span>
</code></pre></div>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/cli/main.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">query_command</span><span class="p">(</span><span class="n">args</span><span class="p">:</span> <span class="n">Namespace</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Execute a semantic or hybrid search.</span>

<span class="sd">    Args:</span>
<span class="sd">        args: Parsed CLI namespace containing the query options.</span>

<span class="sd">    Raises:</span>
<span class="sd">        SystemExit: When querying fails (exit code 1).</span>

<span class="sd">    Examples:</span>
<span class="sd">        ```bash</span>
<span class="sd">        kbm query &quot;Explain theorem 3&quot; --search-type similar --top-k 3</span>
<span class="sd">        ```</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">KnowledgeBaseManagerConfig</span><span class="p">(</span>
            <span class="n">chunk_config</span><span class="o">=</span><span class="n">ChunkConfig</span><span class="p">(),</span>
            <span class="n">embedding_config</span><span class="o">=</span><span class="n">EmbeddingConfig</span><span class="p">(</span><span class="n">model_name</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">embedding_model</span><span class="p">),</span>
            <span class="n">database_manager_config</span><span class="o">=</span><span class="n">DatabaseManagerConfig</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">weaviate_url</span><span class="p">),</span>
        <span class="p">)</span>

        <span class="n">kbm</span> <span class="o">=</span> <span class="n">KnowledgeBaseManager</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="n">config</span><span class="p">)</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">kbm</span><span class="o">.</span><span class="n">query</span><span class="p">(</span>
            <span class="n">args</span><span class="o">.</span><span class="n">question</span><span class="p">,</span> <span class="n">search_type</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">search_type</span><span class="p">,</span> <span class="n">top_k</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">top_k</span>
        <span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; Question: </span><span class="si">{</span><span class="n">response</span><span class="p">[</span><span class="s1">&#39;question&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; Search type: </span><span class="si">{</span><span class="n">response</span><span class="p">[</span><span class="s1">&#39;search_type&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; Retrieved </span><span class="si">{</span><span class="n">response</span><span class="p">[</span><span class="s1">&#39;num_chunks&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> chunks:&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">response</span><span class="p">[</span><span class="s2">&quot;retrieved_chunks&quot;</span><span class="p">],</span> <span class="mi">1</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">.  </span><span class="si">{</span><span class="n">chunk</span><span class="p">[</span><span class="s1">&#39;content&#39;</span><span class="p">][:</span><span class="mi">100</span><span class="p">]</span><span class="si">}</span><span class="s2">...&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="s2">&quot;similarity_score&quot;</span> <span class="ow">in</span> <span class="n">chunk</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    Similarity: </span><span class="si">{</span><span class="n">chunk</span><span class="p">[</span><span class="s1">&#39;similarity_score&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">()</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; Error querying system: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="ragora.cli.main.setup_logging" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">setup_logging</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#ragora.cli.main.setup_logging" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Configure application logging.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>verbose</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>When <code>True</code> raises the log level to <code>DEBUG</code>.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/cli/main.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">setup_logging</span><span class="p">(</span><span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Configure application logging.</span>

<span class="sd">    Args:</span>
<span class="sd">        verbose: When ``True`` raises the log level to ``DEBUG``.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">level</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span> <span class="k">if</span> <span class="n">verbose</span> <span class="k">else</span> <span class="n">logging</span><span class="o">.</span><span class="n">INFO</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span>
        <span class="n">level</span><span class="o">=</span><span class="n">level</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%(asctime)s</span><span class="s2"> - </span><span class="si">%(name)s</span><span class="s2"> - </span><span class="si">%(levelname)s</span><span class="s2"> - </span><span class="si">%(message)s</span><span class="s2">&quot;</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="ragora.cli.main.status_command" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">status_command</span><span class="p">(</span><span class="n">args</span><span class="p">)</span></code>

<a href="#ragora.cli.main.status_command" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Display status information for the knowledge base manager.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>args</code>
            </td>
            <td>
                  <code><span title="argparse.Namespace">Namespace</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Parsed CLI namespace (unused).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="SystemExit">SystemExit</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If the status request fails.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/cli/main.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">status_command</span><span class="p">(</span><span class="n">args</span><span class="p">:</span> <span class="n">Namespace</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Display status information for the knowledge base manager.</span>

<span class="sd">    Args:</span>
<span class="sd">        args: Parsed CLI namespace (unused).</span>

<span class="sd">    Raises:</span>
<span class="sd">        SystemExit: If the status request fails.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">KnowledgeBaseManagerConfig</span><span class="o">.</span><span class="n">default</span><span class="p">()</span>
        <span class="n">kbm</span> <span class="o">=</span> <span class="n">KnowledgeBaseManager</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="n">config</span><span class="p">)</span>
        <span class="n">stats</span> <span class="o">=</span> <span class="n">kbm</span><span class="o">.</span><span class="n">get_system_stats</span><span class="p">()</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; Knowledge Base Manager Status:&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; Initialized: </span><span class="si">{</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;system_initialized&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; Total objects: </span><span class="si">{</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;vector_store&#39;</span><span class="p">][</span><span class="s1">&#39;total_objects&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; Embedding model: </span><span class="si">{</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;embedding_engine&#39;</span><span class="p">][</span><span class="s1">&#39;model_name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; Chunk size: </span><span class="si">{</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;data_chunker&#39;</span><span class="p">][</span><span class="s1">&#39;chunk_size&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; Error checking status: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div><h2 id="core">Core<a class="headerlink" href="#core" title="Permanent link">&para;</a></h2>
<h3 id="knowledge-base-manager">Knowledge Base Manager<a class="headerlink" href="#knowledge-base-manager" title="Permanent link">&para;</a></h3>


<div class="doc doc-object doc-module">



<a id="ragora.core.knowledge_base_manager"></a>
    <div class="doc doc-contents first">

        <p>High-level orchestration entry point for the Ragora knowledge base.</p>
<p>The module exposes the <code>KnowledgeBaseManager</code> which connects the ingestion,
chunking, vector store, and retrieval layers into a single cohesive API. It is
typically the only component application code needs to instantiate when working
with Ragora programmatically.</p>










  <div class="doc doc-children">









<div class="doc doc-object doc-class">



<h4 id="ragora.core.knowledge_base_manager.KnowledgeBaseManager" class="doc doc-heading">
            <code>KnowledgeBaseManager</code>


<a href="#ragora.core.knowledge_base_manager.KnowledgeBaseManager" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">


        <p>High-level faade for document ingestion and retrieval.</p>
<p>The manager wires together the lower-level components (preprocessors,
chunkers, embedding engine, vector store, retriever) and exposes a compact
API for turning raw files and emails into searchable chunks.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="ragora.core.knowledge_base_manager.KnowledgeBaseManager.db_manager">db_manager</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Component that maintains the connection to Weaviate.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="ragora.core.knowledge_base_manager.KnowledgeBaseManager.vector_store">vector_store</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Storage layer responsible for persisting chunks.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="ragora.core.knowledge_base_manager.KnowledgeBaseManager.retriever">retriever</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Retrieval layer used to execute search strategies.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="ragora.core.knowledge_base_manager.KnowledgeBaseManager.embedding_engine">embedding_engine</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional embedding engine used for semantic search.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="ragora.core.knowledge_base_manager.KnowledgeBaseManager.document_preprocessor">document_preprocessor</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Parser that converts documents into chunks.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="ragora.core.knowledge_base_manager.KnowledgeBaseManager.data_chunker">data_chunker</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Chunking configuration used by preprocessors.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="ragora.core.knowledge_base_manager.KnowledgeBaseManager.logger">logger</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Module logger for diagnostics.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="ragora.core.knowledge_base_manager.KnowledgeBaseManager.is_initialized">is_initialized</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether the manager completed initialization.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <p>Create a manager with default settings and ingest a LaTeX document:</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">ragora.core.knowledge_base_manager</span><span class="w"> </span><span class="kn">import</span> <span class="n">KnowledgeBaseManager</span>

<span class="n">kb</span> <span class="o">=</span> <span class="n">KnowledgeBaseManager</span><span class="p">()</span>
<span class="n">chunk_ids</span> <span class="o">=</span> <span class="n">kb</span><span class="o">.</span><span class="n">process_document</span><span class="p">(</span><span class="s2">&quot;docs/paper.tex&quot;</span><span class="p">,</span> <span class="n">document_type</span><span class="o">=</span><span class="s2">&quot;latex&quot;</span><span class="p">)</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">kb</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">&quot;neural networks&quot;</span><span class="p">,</span> <span class="n">collection</span><span class="o">=</span><span class="s2">&quot;Document&quot;</span><span class="p">)</span>
</code></pre></div>








              <details class="quote">
                <summary>Source code in <code>ragora/ragora/core/knowledge_base_manager.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span>
<span class="normal">760</span>
<span class="normal">761</span>
<span class="normal">762</span>
<span class="normal">763</span>
<span class="normal">764</span>
<span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span>
<span class="normal">768</span>
<span class="normal">769</span>
<span class="normal">770</span>
<span class="normal">771</span>
<span class="normal">772</span>
<span class="normal">773</span>
<span class="normal">774</span>
<span class="normal">775</span>
<span class="normal">776</span>
<span class="normal">777</span>
<span class="normal">778</span>
<span class="normal">779</span>
<span class="normal">780</span>
<span class="normal">781</span>
<span class="normal">782</span>
<span class="normal">783</span>
<span class="normal">784</span>
<span class="normal">785</span>
<span class="normal">786</span>
<span class="normal">787</span>
<span class="normal">788</span>
<span class="normal">789</span>
<span class="normal">790</span>
<span class="normal">791</span>
<span class="normal">792</span>
<span class="normal">793</span>
<span class="normal">794</span>
<span class="normal">795</span>
<span class="normal">796</span>
<span class="normal">797</span>
<span class="normal">798</span>
<span class="normal">799</span>
<span class="normal">800</span>
<span class="normal">801</span>
<span class="normal">802</span>
<span class="normal">803</span>
<span class="normal">804</span>
<span class="normal">805</span>
<span class="normal">806</span>
<span class="normal">807</span>
<span class="normal">808</span>
<span class="normal">809</span>
<span class="normal">810</span>
<span class="normal">811</span>
<span class="normal">812</span>
<span class="normal">813</span>
<span class="normal">814</span>
<span class="normal">815</span>
<span class="normal">816</span>
<span class="normal">817</span>
<span class="normal">818</span>
<span class="normal">819</span>
<span class="normal">820</span>
<span class="normal">821</span>
<span class="normal">822</span>
<span class="normal">823</span>
<span class="normal">824</span>
<span class="normal">825</span>
<span class="normal">826</span>
<span class="normal">827</span>
<span class="normal">828</span>
<span class="normal">829</span>
<span class="normal">830</span>
<span class="normal">831</span>
<span class="normal">832</span>
<span class="normal">833</span>
<span class="normal">834</span>
<span class="normal">835</span>
<span class="normal">836</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">KnowledgeBaseManager</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;High-level faade for document ingestion and retrieval.</span>

<span class="sd">    The manager wires together the lower-level components (preprocessors,</span>
<span class="sd">    chunkers, embedding engine, vector store, retriever) and exposes a compact</span>
<span class="sd">    API for turning raw files and emails into searchable chunks.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        db_manager: Component that maintains the connection to Weaviate.</span>
<span class="sd">        vector_store: Storage layer responsible for persisting chunks.</span>
<span class="sd">        retriever: Retrieval layer used to execute search strategies.</span>
<span class="sd">        embedding_engine: Optional embedding engine used for semantic search.</span>
<span class="sd">        document_preprocessor: Parser that converts documents into chunks.</span>
<span class="sd">        data_chunker: Chunking configuration used by preprocessors.</span>
<span class="sd">        logger: Module logger for diagnostics.</span>
<span class="sd">        is_initialized: Whether the manager completed initialization.</span>

<span class="sd">    Examples:</span>
<span class="sd">        Create a manager with default settings and ingest a LaTeX document:</span>

<span class="sd">        ```python</span>
<span class="sd">        from ragora.core.knowledge_base_manager import KnowledgeBaseManager</span>

<span class="sd">        kb = KnowledgeBaseManager()</span>
<span class="sd">        chunk_ids = kb.process_document(&quot;docs/paper.tex&quot;, document_type=&quot;latex&quot;)</span>
<span class="sd">        results = kb.search(&quot;neural networks&quot;, collection=&quot;Document&quot;)</span>
<span class="sd">        ```</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">config</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">KnowledgeBaseManagerConfig</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">weaviate_url</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;http://localhost:8080&quot;</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the knowledge base manager.</span>

<span class="sd">        Args:</span>
<span class="sd">            config: RagoraConfig object with system configuration (optional)</span>
<span class="sd">            weaviate_url: Weaviate server URL (used if config not provided)</span>

<span class="sd">        Raises:</span>
<span class="sd">            ConnectionError: If unable to connect to Weaviate</span>
<span class="sd">            ValueError: If invalid parameters are provided</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_initialized</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">embedding_engine</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data_chunker</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">db_manager</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vector_store</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">retriever</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">document_preprocessor</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">email_preprocessor</span> <span class="o">=</span> <span class="kc">None</span>

            <span class="c1"># Handle configuration - use provided config or create from individual parameters</span>
            <span class="k">if</span> <span class="n">config</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">config</span><span class="o">.</span><span class="n">embedding_config</span><span class="p">:</span>
                    <span class="c1"># Initialize embedding engine</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">embedding_engine</span> <span class="o">=</span> <span class="n">EmbeddingEngine</span><span class="p">(</span>
                        <span class="n">model_name</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">embedding_config</span><span class="o">.</span><span class="n">model_name</span><span class="p">,</span>
                        <span class="n">device</span><span class="o">=</span><span class="p">(</span>
                            <span class="n">config</span><span class="o">.</span><span class="n">embedding_config</span><span class="o">.</span><span class="n">device</span>
                            <span class="k">if</span> <span class="n">config</span><span class="o">.</span><span class="n">embedding_config</span><span class="o">.</span><span class="n">device</span>
                            <span class="k">else</span> <span class="kc">None</span>
                        <span class="p">),</span>
                    <span class="p">)</span>
                <span class="k">if</span> <span class="n">config</span><span class="o">.</span><span class="n">database_manager_config</span><span class="p">:</span>
                    <span class="n">weaviate_url</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">database_manager_config</span><span class="o">.</span><span class="n">url</span>
                <span class="k">if</span> <span class="n">config</span><span class="o">.</span><span class="n">chunk_config</span><span class="p">:</span>
                    <span class="kn">from</span><span class="w"> </span><span class="nn">.chunking</span><span class="w"> </span><span class="kn">import</span> <span class="n">DocumentChunkingStrategy</span>

                    <span class="n">custom_strategy</span> <span class="o">=</span> <span class="n">DocumentChunkingStrategy</span><span class="p">(</span>
                        <span class="n">chunk_size</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">chunk_config</span><span class="o">.</span><span class="n">chunk_size</span><span class="p">,</span>
                        <span class="n">overlap_size</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">chunk_config</span><span class="o">.</span><span class="n">overlap_size</span><span class="p">,</span>
                    <span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">data_chunker</span> <span class="o">=</span> <span class="n">DataChunker</span><span class="p">(</span><span class="n">default_strategy</span><span class="o">=</span><span class="n">custom_strategy</span><span class="p">)</span>

            <span class="c1"># Initialize database manager (infrastructure layer)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Initializing database manager at </span><span class="si">{</span><span class="n">weaviate_url</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">db_manager</span> <span class="o">=</span> <span class="n">DatabaseManager</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">weaviate_url</span><span class="p">)</span>

            <span class="c1"># Initialize vector store (storage layer)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Initializing vector store&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vector_store</span> <span class="o">=</span> <span class="n">VectorStore</span><span class="p">(</span>
                <span class="n">db_manager</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">db_manager</span><span class="p">,</span>
                <span class="n">embedding_engine</span><span class="o">=</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">embedding_engine</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">embedding_engine</span> <span class="k">else</span> <span class="kc">None</span>
                <span class="p">),</span>
            <span class="p">)</span>

            <span class="c1"># Initialize retriever (search layer)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Initializing retriever&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">retriever</span> <span class="o">=</span> <span class="n">Retriever</span><span class="p">(</span>
                <span class="n">db_manager</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">db_manager</span><span class="p">,</span>
                <span class="n">embedding_engine</span><span class="o">=</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">embedding_engine</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">embedding_engine</span> <span class="k">else</span> <span class="kc">None</span>
                <span class="p">),</span>
            <span class="p">)</span>

            <span class="c1"># Initialize document preprocessor with chunking parameters</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Initializing document preprocessor&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">document_preprocessor</span> <span class="o">=</span> <span class="n">DocumentPreprocessor</span><span class="p">(</span>
                <span class="n">chunker</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_chunker</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_chunker</span> <span class="k">else</span> <span class="kc">None</span><span class="p">)</span>
            <span class="p">)</span>

            <span class="c1"># Initialize email preprocessor with chunking parameters</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Initializing email preprocessor&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">email_preprocessor</span> <span class="o">=</span> <span class="n">EmailPreprocessor</span><span class="p">(</span>
                <span class="n">chunker</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_chunker</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_chunker</span> <span class="k">else</span> <span class="kc">None</span><span class="p">)</span>
            <span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">is_initialized</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Knowledge base manager initialized successfully&quot;</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to initialize knowledge base manager: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">raise</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">process_documents</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">document_paths</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
        <span class="n">document_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;latex&quot;</span><span class="p">,</span>
        <span class="n">collection</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;Document&quot;</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Process a list of documents and store them in the vector database.</span>

<span class="sd">        Args:</span>
<span class="sd">            document_paths: List of paths to the documents to ingest</span>
<span class="sd">            document_type: Type of document to process (&quot;latex&quot;, &quot;markdown&quot;, &quot;text&quot;)</span>
<span class="sd">            collection: Collection name to store the documents</span>
<span class="sd">        Returns:</span>
<span class="sd">            List[str]: List of chunk IDs that were stored</span>

<span class="sd">        Raises:</span>
<span class="sd">            RuntimeError: If the manager is not initialized</span>
<span class="sd">            Exception: If the documents cannot be processed</span>

<span class="sd">        Examples:</span>
<span class="sd">            ```python</span>
<span class="sd">            kb = KnowledgeBaseManager()</span>
<span class="sd">            kb.process_documents([&quot;notes.md&quot;, &quot;report.tex&quot;], document_type=&quot;markdown&quot;)</span>
<span class="sd">            ```</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_initialized</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Knowledge base manager not initialized&quot;</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Processing </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">document_paths</span><span class="p">)</span><span class="si">}</span><span class="s2"> documents&quot;</span><span class="p">)</span>
            <span class="n">chunks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">document_preprocessor</span><span class="o">.</span><span class="n">preprocess_documents</span><span class="p">(</span>
                <span class="n">document_paths</span><span class="p">,</span> <span class="n">document_type</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Storing </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">chunks</span><span class="p">)</span><span class="si">}</span><span class="s2"> chunks in vector database&quot;</span><span class="p">)</span>
            <span class="n">stored_uuids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vector_store</span><span class="o">.</span><span class="n">store_chunks</span><span class="p">(</span><span class="n">chunks</span><span class="p">,</span> <span class="n">collection</span><span class="o">=</span><span class="n">collection</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Successfully processed </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">document_paths</span><span class="p">)</span><span class="si">}</span><span class="s2"> documents&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Stored </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">stored_uuids</span><span class="p">)</span><span class="si">}</span><span class="s2"> chunks&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">stored_uuids</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to process documents: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">raise</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">process_document</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">document_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">document_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;latex&quot;</span><span class="p">,</span>
        <span class="n">collection</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;Document&quot;</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Process a single document and store it in the vector database.</span>

<span class="sd">        Args:</span>
<span class="sd">            document_path: Path to the document file</span>
<span class="sd">            document_type: Type of document to process (&quot;latex&quot;, &quot;markdown&quot;, &quot;text&quot;)</span>
<span class="sd">            collection: Collection name to store the document</span>
<span class="sd">        Returns:</span>
<span class="sd">            List[str]: List of chunk IDs that were stored</span>

<span class="sd">        Raises:</span>
<span class="sd">            FileNotFoundError: If document file doesn&#39;t exist</span>
<span class="sd">            ValueError: If document processing fails</span>
<span class="sd">        Examples:</span>
<span class="sd">            ```python</span>
<span class="sd">            kb = KnowledgeBaseManager()</span>
<span class="sd">            kb.process_document(&quot;docs/tutorial.md&quot;, document_type=&quot;markdown&quot;)</span>
<span class="sd">            ```</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_initialized</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Knowledge base manager not initialized&quot;</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Processing document: </span><span class="si">{</span><span class="n">document_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="c1"># Step 1: Preprocess the LaTeX document</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Step 1: Preprocessing </span><span class="si">{</span><span class="n">document_type</span><span class="si">}</span><span class="s2"> document&quot;</span><span class="p">)</span>
            <span class="n">chunks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">document_preprocessor</span><span class="o">.</span><span class="n">preprocess_document</span><span class="p">(</span>
                <span class="n">document_path</span><span class="p">,</span> <span class="n">document_type</span>
            <span class="p">)</span>

            <span class="c1"># Step 2: Store chunks in vector database</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Step 2: Storing </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">chunks</span><span class="p">)</span><span class="si">}</span><span class="s2"> chunks in vector database&quot;</span>
            <span class="p">)</span>
            <span class="n">stored_uuids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vector_store</span><span class="o">.</span><span class="n">store_chunks</span><span class="p">(</span><span class="n">chunks</span><span class="p">,</span> <span class="n">collection</span><span class="o">=</span><span class="n">collection</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Successfully processed document: </span><span class="si">{</span><span class="n">document_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Stored </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">stored_uuids</span><span class="p">)</span><span class="si">}</span><span class="s2"> chunks&quot;</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">stored_uuids</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to process document </span><span class="si">{</span><span class="n">document_path</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">raise</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">search</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">query</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">collection</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;Document&quot;</span><span class="p">,</span>
        <span class="n">strategy</span><span class="p">:</span> <span class="n">SearchStrategy</span> <span class="o">=</span> <span class="n">SearchStrategy</span><span class="o">.</span><span class="n">HYBRID</span><span class="p">,</span>
        <span class="n">top_k</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
        <span class="nb">filter</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Filter</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">strategy_kwargs</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SearchResult</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Unified search interface for all data types and strategies.</span>

<span class="sd">        Args:</span>
<span class="sd">            query: Search query text</span>
<span class="sd">            collection: Collection name to search in</span>
<span class="sd">            strategy: Search strategy to use</span>
<span class="sd">            top_k: Number of results to return</span>
<span class="sd">            filter: Optional Weaviate Filter to filter results by properties</span>
<span class="sd">            **strategy_kwargs: Strategy-specific parameters</span>
<span class="sd">                (alpha, score_threshold, etc.)</span>

<span class="sd">        Returns:</span>
<span class="sd">            SearchResult: Structured search results with metadata</span>

<span class="sd">        Raises:</span>
<span class="sd">            RuntimeError: If system not initialized</span>
<span class="sd">            ValueError: If invalid strategy or empty query</span>

<span class="sd">        Examples:</span>
<span class="sd">            ```python</span>
<span class="sd">            kb = KnowledgeBaseManager()</span>
<span class="sd">            kb.process_document(&quot;docs/tutorial.md&quot;, document_type=&quot;markdown&quot;)</span>
<span class="sd">            result = kb.search(&quot;introduction&quot;, strategy=SearchStrategy.HYBRID, top_k=3)</span>
<span class="sd">            for hit in result.results:</span>
<span class="sd">                print(hit.metadata.title, hit.similarity_score)</span>
<span class="sd">            ```</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_initialized</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Knowledge base manager not initialized&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">query</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">query</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Query cannot be empty&quot;</span><span class="p">)</span>

        <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Processing search: &#39;</span><span class="si">{</span><span class="n">query</span><span class="si">}</span><span class="s2">&#39; &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;(strategy: </span><span class="si">{</span><span class="n">strategy</span><span class="o">.</span><span class="n">value</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nb">hasattr</span><span class="p">(</span><span class="n">strategy</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;value&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="n">strategy</span><span class="si">}</span><span class="s2">, collection: </span><span class="si">{</span><span class="n">collection</span><span class="si">}</span><span class="s2">)&quot;</span>
            <span class="p">)</span>

            <span class="c1"># Execute search based on strategy</span>
            <span class="k">if</span> <span class="n">strategy</span> <span class="o">==</span> <span class="n">SearchStrategy</span><span class="o">.</span><span class="n">SIMILAR</span><span class="p">:</span>
                <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">retriever</span><span class="o">.</span><span class="n">search_similar</span><span class="p">(</span>
                    <span class="n">query</span><span class="p">,</span>
                    <span class="n">collection</span><span class="o">=</span><span class="n">collection</span><span class="p">,</span>
                    <span class="n">top_k</span><span class="o">=</span><span class="n">top_k</span><span class="p">,</span>
                    <span class="nb">filter</span><span class="o">=</span><span class="nb">filter</span><span class="p">,</span>
                    <span class="o">**</span><span class="n">strategy_kwargs</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="k">elif</span> <span class="n">strategy</span> <span class="o">==</span> <span class="n">SearchStrategy</span><span class="o">.</span><span class="n">KEYWORD</span><span class="p">:</span>
                <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">retriever</span><span class="o">.</span><span class="n">search_keyword</span><span class="p">(</span>
                    <span class="n">query</span><span class="p">,</span>
                    <span class="n">collection</span><span class="o">=</span><span class="n">collection</span><span class="p">,</span>
                    <span class="n">top_k</span><span class="o">=</span><span class="n">top_k</span><span class="p">,</span>
                    <span class="nb">filter</span><span class="o">=</span><span class="nb">filter</span><span class="p">,</span>
                    <span class="o">**</span><span class="n">strategy_kwargs</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="k">elif</span> <span class="n">strategy</span> <span class="o">==</span> <span class="n">SearchStrategy</span><span class="o">.</span><span class="n">HYBRID</span><span class="p">:</span>
                <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">retriever</span><span class="o">.</span><span class="n">search_hybrid</span><span class="p">(</span>
                    <span class="n">query</span><span class="p">,</span>
                    <span class="n">collection</span><span class="o">=</span><span class="n">collection</span><span class="p">,</span>
                    <span class="n">top_k</span><span class="o">=</span><span class="n">top_k</span><span class="p">,</span>
                    <span class="nb">filter</span><span class="o">=</span><span class="nb">filter</span><span class="p">,</span>
                    <span class="o">**</span><span class="n">strategy_kwargs</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="k">elif</span> <span class="n">strategy</span> <span class="o">==</span> <span class="n">SearchStrategy</span><span class="o">.</span><span class="n">AUTO</span><span class="p">:</span>
                <span class="c1"># For now, default to hybrid.</span>
                <span class="c1"># Could be enhanced with automatic strategy selection</span>
                <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">retriever</span><span class="o">.</span><span class="n">search_hybrid</span><span class="p">(</span>
                    <span class="n">query</span><span class="p">,</span>
                    <span class="n">collection</span><span class="o">=</span><span class="n">collection</span><span class="p">,</span>
                    <span class="n">top_k</span><span class="o">=</span><span class="n">top_k</span><span class="p">,</span>
                    <span class="nb">filter</span><span class="o">=</span><span class="nb">filter</span><span class="p">,</span>
                    <span class="o">**</span><span class="n">strategy_kwargs</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid search strategy: </span><span class="si">{</span><span class="n">strategy</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="n">execution_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>

            <span class="c1"># Prepare metadata</span>
            <span class="n">metadata</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;chunk_sources&quot;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span>
                    <span class="nb">set</span><span class="p">(</span>
                        <span class="n">result</span><span class="o">.</span><span class="n">properties</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;source_document&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
                        <span class="ow">or</span> <span class="n">result</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">source_document</span>
                        <span class="ow">or</span> <span class="s2">&quot;&quot;</span>
                        <span class="k">for</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">results</span>
                    <span class="p">)</span>
                <span class="p">),</span>
                <span class="s2">&quot;chunk_types&quot;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span>
                    <span class="nb">set</span><span class="p">(</span>
                        <span class="n">result</span><span class="o">.</span><span class="n">properties</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;chunk_type&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
                        <span class="ow">or</span> <span class="n">result</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">chunk_type</span>
                        <span class="ow">or</span> <span class="s2">&quot;&quot;</span>
                        <span class="k">for</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">results</span>
                    <span class="p">)</span>
                <span class="p">),</span>
            <span class="p">}</span>

            <span class="c1"># Add similarity scores if available</span>
            <span class="n">similarity_scores</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">result</span><span class="o">.</span><span class="n">similarity_score</span>
                <span class="k">for</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">results</span>
                <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">similarity_score</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
            <span class="p">]</span>

            <span class="k">if</span> <span class="n">similarity_scores</span><span class="p">:</span>
                <span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;avg_similarity&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">similarity_scores</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span>
                    <span class="n">similarity_scores</span>
                <span class="p">)</span>
                <span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;max_similarity&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">similarity_scores</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Search completed: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">results</span><span class="p">)</span><span class="si">}</span><span class="s2"> results in </span><span class="si">{</span><span class="n">execution_time</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">s&quot;</span>
            <span class="p">)</span>

            <span class="c1"># Convert strategy enum to string for SearchResult</span>
            <span class="n">strategy_str</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">strategy</span><span class="o">.</span><span class="n">value</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">strategy</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="nb">str</span><span class="p">(</span><span class="n">strategy</span><span class="p">)</span>
            <span class="p">)</span>

            <span class="n">results_dicts</span> <span class="o">=</span> <span class="p">[</span><span class="n">item</span><span class="o">.</span><span class="n">model_dump</span><span class="p">()</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">results</span><span class="p">]</span>

            <span class="c1"># Use model_validate for proper nested model validation in Pydantic 2.x</span>
            <span class="k">return</span> <span class="n">SearchResult</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span>
                <span class="p">{</span>
                    <span class="s2">&quot;query&quot;</span><span class="p">:</span> <span class="n">query</span><span class="p">,</span>
                    <span class="s2">&quot;strategy&quot;</span><span class="p">:</span> <span class="n">strategy_str</span><span class="p">,</span>
                    <span class="s2">&quot;collection&quot;</span><span class="p">:</span> <span class="n">collection</span><span class="p">,</span>
                    <span class="s2">&quot;results&quot;</span><span class="p">:</span> <span class="n">results_dicts</span><span class="p">,</span>
                    <span class="s2">&quot;total_found&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">results</span><span class="p">),</span>
                    <span class="s2">&quot;execution_time&quot;</span><span class="p">:</span> <span class="n">execution_time</span><span class="p">,</span>
                    <span class="s2">&quot;metadata&quot;</span><span class="p">:</span> <span class="n">metadata</span><span class="p">,</span>
                <span class="p">}</span>
            <span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Search failed: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">raise</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_chunk</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">chunk_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">collection</span><span class="p">:</span> <span class="nb">str</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">RetrievalResultItem</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Retrieve a specific chunk by its ID.</span>

<span class="sd">        Args:</span>
<span class="sd">            chunk_id: Unique identifier of the chunk</span>
<span class="sd">            collection: Collection name</span>
<span class="sd">        Returns:</span>
<span class="sd">            Optional[RetrievalResultItem]: Chunk data if found, None otherwise</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">vector_store</span><span class="o">.</span><span class="n">get_chunk_by_id</span><span class="p">(</span><span class="n">chunk_id</span><span class="p">,</span> <span class="n">collection</span><span class="o">=</span><span class="n">collection</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">delete_chunk</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">chunk_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">collection</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Delete a chunk by its ID.</span>

<span class="sd">        Args:</span>
<span class="sd">            chunk_id: Unique identifier of the chunk to delete</span>
<span class="sd">            collection: Collection name</span>
<span class="sd">        Returns:</span>
<span class="sd">            bool: True if deletion was successful, False otherwise</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">vector_store</span><span class="o">.</span><span class="n">delete_chunk</span><span class="p">(</span><span class="n">chunk_id</span><span class="p">,</span> <span class="n">collection</span><span class="o">=</span><span class="n">collection</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">list_collections</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;List all available collections.</span>

<span class="sd">        Returns:</span>
<span class="sd">            List[str]: List of collection names</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">db_manager</span><span class="o">.</span><span class="n">list_collections</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">create_collection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">force_recreate</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a new collection.</span>

<span class="sd">        Args:</span>
<span class="sd">            name: Collection name</span>
<span class="sd">            force_recreate: Whether to recreate if collection exists</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool: True if creation was successful, False otherwise</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vector_store</span><span class="o">.</span><span class="n">create_schema</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">force_recreate</span><span class="o">=</span><span class="n">force_recreate</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to create collection </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">delete_collection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Delete a collection and all its data.</span>

<span class="sd">        Args:</span>
<span class="sd">            name: Collection name</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool: True if deletion was successful, False otherwise</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vector_store</span><span class="o">.</span><span class="n">clear_all</span><span class="p">(</span><span class="n">collection</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
            <span class="c1"># Note: Weaviate doesn&#39;t have direct collection deletion</span>
            <span class="c1"># This clears all data, effectively &quot;deleting&quot; the collection</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to delete collection </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">clear_collection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">collection</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Clear all data from a collection.</span>

<span class="sd">        Args:</span>
<span class="sd">            collection: Collection name</span>

<span class="sd">        Raises:</span>
<span class="sd">            RuntimeError: If system not initialized</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_initialized</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Knowledge base manager not initialized&quot;</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Clearing all data from collection: </span><span class="si">{</span><span class="n">collection</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vector_store</span><span class="o">.</span><span class="n">clear_all</span><span class="p">(</span><span class="n">collection</span><span class="o">=</span><span class="n">collection</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Collection </span><span class="si">{</span><span class="n">collection</span><span class="si">}</span><span class="s2"> cleared successfully&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to clear collection </span><span class="si">{</span><span class="n">collection</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">raise</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_collection_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">collection</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get statistics for a specific collection.</span>

<span class="sd">        Args:</span>
<span class="sd">            collection: Collection name</span>

<span class="sd">        Returns:</span>
<span class="sd">            Dict[str, Any]: Collection statistics</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Get vector store stats</span>
            <span class="n">vector_stats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vector_store</span><span class="o">.</span><span class="n">get_stats</span><span class="p">(</span><span class="n">collection</span><span class="o">=</span><span class="n">collection</span><span class="p">)</span>

            <span class="c1"># Get retrieval stats</span>
            <span class="n">retrieval_stats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">retriever</span><span class="o">.</span><span class="n">get_retrieval_stats</span><span class="p">(</span><span class="n">collection</span><span class="o">=</span><span class="n">collection</span><span class="p">)</span>

            <span class="c1"># Get embedding engine info</span>
            <span class="n">embedding_info</span> <span class="o">=</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">embedding_engine</span><span class="o">.</span><span class="n">get_model_info</span><span class="p">()</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">embedding_engine</span>
                <span class="k">else</span> <span class="p">{</span><span class="s2">&quot;model_name&quot;</span><span class="p">:</span> <span class="s2">&quot;Not initialized&quot;</span><span class="p">,</span> <span class="s2">&quot;dimension&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">}</span>
            <span class="p">)</span>

            <span class="c1"># Get chunker configuration</span>
            <span class="n">chunker_config</span> <span class="o">=</span> <span class="p">(</span>
                <span class="p">{</span>
                    <span class="s2">&quot;chunk_size&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_chunker</span><span class="o">.</span><span class="n">default_strategy</span><span class="o">.</span><span class="n">chunk_size</span><span class="p">,</span>
                    <span class="s2">&quot;overlap_size&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_chunker</span><span class="o">.</span><span class="n">default_strategy</span><span class="o">.</span><span class="n">overlap_size</span><span class="p">,</span>
                    <span class="s2">&quot;chunk_type&quot;</span><span class="p">:</span> <span class="s2">&quot;custom&quot;</span><span class="p">,</span>
                <span class="p">}</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_chunker</span>
                <span class="k">else</span> <span class="p">{</span>
                    <span class="s2">&quot;chunk_size&quot;</span><span class="p">:</span> <span class="s2">&quot;Not initialized&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;overlap_size&quot;</span><span class="p">:</span> <span class="s2">&quot;Not initialized&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;chunk_type&quot;</span><span class="p">:</span> <span class="s2">&quot;Not initialized&quot;</span><span class="p">,</span>
                <span class="p">}</span>
            <span class="p">)</span>

            <span class="k">return</span> <span class="p">{</span>
                <span class="s2">&quot;collection&quot;</span><span class="p">:</span> <span class="n">collection</span><span class="p">,</span>
                <span class="s2">&quot;system_initialized&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_initialized</span><span class="p">,</span>
                <span class="s2">&quot;database_manager&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">db_manager</span><span class="o">.</span><span class="n">url</span><span class="p">,</span>
                    <span class="s2">&quot;is_connected&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">db_manager</span><span class="o">.</span><span class="n">is_connected</span><span class="p">,</span>
                    <span class="s2">&quot;collections&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">db_manager</span><span class="o">.</span><span class="n">list_collections</span><span class="p">(),</span>
                <span class="p">},</span>
                <span class="s2">&quot;vector_store&quot;</span><span class="p">:</span> <span class="n">vector_stats</span><span class="p">,</span>
                <span class="s2">&quot;retrieval&quot;</span><span class="p">:</span> <span class="n">retrieval_stats</span><span class="p">,</span>
                <span class="s2">&quot;embedding_engine&quot;</span><span class="p">:</span> <span class="n">embedding_info</span><span class="p">,</span>
                <span class="s2">&quot;data_chunker&quot;</span><span class="p">:</span> <span class="n">chunker_config</span><span class="p">,</span>
                <span class="s2">&quot;components&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s2">&quot;database_manager&quot;</span><span class="p">:</span> <span class="s2">&quot;Weaviate Infrastructure&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;vector_store&quot;</span><span class="p">:</span> <span class="s2">&quot;Weaviate Storage&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;retriever&quot;</span><span class="p">:</span> <span class="s2">&quot;Weaviate Search APIs&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;embedding_engine&quot;</span><span class="p">:</span> <span class="n">embedding_info</span><span class="p">[</span><span class="s2">&quot;model_name&quot;</span><span class="p">],</span>
                    <span class="s2">&quot;document_preprocessor&quot;</span><span class="p">:</span> <span class="s2">&quot;LaTeX Parser&quot;</span><span class="p">,</span>
                <span class="p">},</span>
                <span class="s2">&quot;architecture&quot;</span><span class="p">:</span> <span class="s2">&quot;Three-Layer (DatabaseManager -&gt; VectorStore -&gt; Retriever)&quot;</span><span class="p">,</span>
            <span class="p">}</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to get collection stats: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">raise</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Close all system connections and cleanup resources.&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;vector_store&quot;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">vector_store</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">is_initialized</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Knowledge base manager closed successfully&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error closing knowledge base manager: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Email processing methods</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_ensure_email_connection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">email_provider</span><span class="p">:</span> <span class="n">EmailProvider</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Ensure email provider is connected.</span>

<span class="sd">        Returns True if we connected it, False if already connected.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">email_provider</span><span class="o">.</span><span class="n">is_connected</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Email provider not connected, connecting...&quot;</span><span class="p">)</span>
            <span class="n">email_provider</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">check_new_emails</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">email_provider</span><span class="p">:</span> <span class="n">EmailProvider</span><span class="p">,</span>
        <span class="n">folder</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">include_body</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">EmailListResult</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check for new unread emails without storing them.</span>

<span class="sd">        Args:</span>
<span class="sd">            email_provider: Email provider instance</span>
<span class="sd">            folder: Optional folder to check (None = all folders)</span>
<span class="sd">            include_body: Include email body content (default: True)</span>
<span class="sd">            limit: Maximum number of emails to return</span>

<span class="sd">        Returns:</span>
<span class="sd">            EmailListResult: Structured result with email items and metadata</span>

<span class="sd">        Raises:</span>
<span class="sd">            RuntimeError: If system not initialized</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_initialized</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Knowledge base manager not initialized&quot;</span><span class="p">)</span>

        <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Auto-connect if needed</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_ensure_email_connection</span><span class="p">(</span><span class="n">email_provider</span><span class="p">)</span>

            <span class="c1"># Fetch unread messages</span>
            <span class="n">new_emails</span> <span class="o">=</span> <span class="n">email_provider</span><span class="o">.</span><span class="n">fetch_messages</span><span class="p">(</span>
                <span class="n">limit</span><span class="o">=</span><span class="n">limit</span><span class="p">,</span> <span class="n">folder</span><span class="o">=</span><span class="n">folder</span><span class="p">,</span> <span class="n">unread_only</span><span class="o">=</span><span class="kc">True</span>
            <span class="p">)</span>

            <span class="c1"># Convert EmailMessage objects to EmailMessageModel</span>
            <span class="n">email_items</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">EmailMessageModel</span><span class="o">.</span><span class="n">from_email_message</span><span class="p">(</span><span class="n">email</span><span class="p">)</span> <span class="k">for</span> <span class="n">email</span> <span class="ow">in</span> <span class="n">new_emails</span>
            <span class="p">]</span>

            <span class="c1"># Clear body fields if include_body is False</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">include_body</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">email_item</span> <span class="ow">in</span> <span class="n">email_items</span><span class="p">:</span>
                    <span class="n">email_item</span><span class="o">.</span><span class="n">body_text</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="n">email_item</span><span class="o">.</span><span class="n">body_html</span> <span class="o">=</span> <span class="kc">None</span>

            <span class="n">execution_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>

            <span class="c1"># Build metadata</span>
            <span class="n">metadata</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;include_body&quot;</span><span class="p">:</span> <span class="n">include_body</span><span class="p">,</span>
                <span class="s2">&quot;limit&quot;</span><span class="p">:</span> <span class="n">limit</span><span class="p">,</span>
                <span class="s2">&quot;unread_only&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="p">}</span>

            <span class="n">result</span> <span class="o">=</span> <span class="n">EmailListResult</span><span class="p">(</span>
                <span class="n">emails</span><span class="o">=</span><span class="n">email_items</span><span class="p">,</span>
                <span class="n">count</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">new_emails</span><span class="p">),</span>
                <span class="n">folder</span><span class="o">=</span><span class="n">folder</span><span class="p">,</span>
                <span class="n">execution_time</span><span class="o">=</span><span class="n">execution_time</span><span class="p">,</span>
                <span class="n">metadata</span><span class="o">=</span><span class="n">metadata</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Found </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">new_emails</span><span class="p">)</span><span class="si">}</span><span class="s2"> new emails&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">result</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to check new emails: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">raise</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">process_new_emails</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">email_provider</span><span class="p">:</span> <span class="n">EmailProvider</span><span class="p">,</span>
        <span class="n">email_ids</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
        <span class="n">collection</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;Email&quot;</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Process and store specific emails by their IDs.</span>

<span class="sd">        This method processes emails that have been identified by the user</span>
<span class="sd">        through check_new_emails() and filtered as needed.</span>

<span class="sd">        Args:</span>
<span class="sd">            email_provider: Email provider instance</span>
<span class="sd">            email_ids: List of email IDs to process (required)</span>
<span class="sd">            collection: Collection name to store the emails</span>

<span class="sd">        Returns:</span>
<span class="sd">            List of stored chunk IDs</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_initialized</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Knowledge base manager not initialized&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">email_ids</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;No email IDs provided&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">[]</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Auto-connect if needed</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_ensure_email_connection</span><span class="p">(</span><span class="n">email_provider</span><span class="p">)</span>

            <span class="c1"># Fetch specific emails by ID</span>
            <span class="n">emails</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">email_id</span> <span class="ow">in</span> <span class="n">email_ids</span><span class="p">:</span>
                <span class="n">email</span> <span class="o">=</span> <span class="n">email_provider</span><span class="o">.</span><span class="n">fetch_message_by_id</span><span class="p">(</span><span class="n">email_id</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">email</span><span class="p">:</span>
                    <span class="n">emails</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">email</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Email </span><span class="si">{</span><span class="n">email_id</span><span class="si">}</span><span class="s2"> not found&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">emails</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;No emails found to process&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="p">[]</span>

            <span class="c1"># Preprocess emails</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Preprocessing </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">emails</span><span class="p">)</span><span class="si">}</span><span class="s2"> emails&quot;</span><span class="p">)</span>
            <span class="n">chunks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">email_preprocessor</span><span class="o">.</span><span class="n">preprocess_emails</span><span class="p">(</span><span class="n">emails</span><span class="p">)</span>

            <span class="c1"># Store chunks</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Storing </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">chunks</span><span class="p">)</span><span class="si">}</span><span class="s2"> chunks&quot;</span><span class="p">)</span>
            <span class="n">stored_uuids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vector_store</span><span class="o">.</span><span class="n">store_chunks</span><span class="p">(</span><span class="n">chunks</span><span class="p">,</span> <span class="n">collection</span><span class="o">=</span><span class="n">collection</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Successfully processed </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">emails</span><span class="p">)</span><span class="si">}</span><span class="s2"> emails&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">stored_uuids</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to process new emails: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">raise</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">process_email_account</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">email_provider</span><span class="p">:</span> <span class="n">EmailProvider</span><span class="p">,</span>
        <span class="n">folder</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">unread_only</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">collection</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;Email&quot;</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Process emails from an email account.</span>

<span class="sd">        Args:</span>
<span class="sd">            email_provider: Email provider instance</span>
<span class="sd">            folder: Optional folder to process (None = all folders)</span>
<span class="sd">            unread_only: If True, only process unread emails</span>
<span class="sd">            collection: Collection name to store the emails</span>

<span class="sd">        Returns:</span>
<span class="sd">            List of stored chunk IDs</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_initialized</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Knowledge base manager not initialized&quot;</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Auto-connect if needed</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_ensure_email_connection</span><span class="p">(</span><span class="n">email_provider</span><span class="p">)</span>

            <span class="c1"># Fetch emails</span>
            <span class="n">emails</span> <span class="o">=</span> <span class="n">email_provider</span><span class="o">.</span><span class="n">fetch_messages</span><span class="p">(</span>
                <span class="n">limit</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">folder</span><span class="o">=</span><span class="n">folder</span><span class="p">,</span> <span class="n">unread_only</span><span class="o">=</span><span class="n">unread_only</span>
            <span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">emails</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;No emails to process&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="p">[]</span>

            <span class="c1"># Preprocess emails</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Preprocessing </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">emails</span><span class="p">)</span><span class="si">}</span><span class="s2"> emails&quot;</span><span class="p">)</span>
            <span class="n">chunks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">email_preprocessor</span><span class="o">.</span><span class="n">preprocess_emails</span><span class="p">(</span><span class="n">emails</span><span class="p">)</span>

            <span class="c1"># Store chunks</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Storing </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">chunks</span><span class="p">)</span><span class="si">}</span><span class="s2"> chunks&quot;</span><span class="p">)</span>
            <span class="n">stored_uuids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vector_store</span><span class="o">.</span><span class="n">store_chunks</span><span class="p">(</span><span class="n">chunks</span><span class="p">,</span> <span class="n">collection</span><span class="o">=</span><span class="n">collection</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Successfully processed </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">emails</span><span class="p">)</span><span class="si">}</span><span class="s2"> emails&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">stored_uuids</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to process email account: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">raise</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">process_emails</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">email_provider</span><span class="p">:</span> <span class="n">EmailProvider</span><span class="p">,</span>
        <span class="n">email_ids</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
        <span class="n">collection</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;Email&quot;</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Process specific emails by their IDs.</span>

<span class="sd">        Args:</span>
<span class="sd">            email_provider: Email provider instance</span>
<span class="sd">            email_ids: List of email IDs to process</span>
<span class="sd">            collection: Collection name to store the emails</span>

<span class="sd">        Returns:</span>
<span class="sd">            List of stored chunk IDs</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_initialized</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Knowledge base manager not initialized&quot;</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Auto-connect if needed</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_ensure_email_connection</span><span class="p">(</span><span class="n">email_provider</span><span class="p">)</span>

            <span class="c1"># Fetch emails</span>
            <span class="n">emails</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">email_id</span> <span class="ow">in</span> <span class="n">email_ids</span><span class="p">:</span>
                <span class="n">email</span> <span class="o">=</span> <span class="n">email_provider</span><span class="o">.</span><span class="n">fetch_message_by_id</span><span class="p">(</span><span class="n">email_id</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">email</span><span class="p">:</span>
                    <span class="n">emails</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">email</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">emails</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;No emails found to process&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="p">[]</span>

            <span class="c1"># Preprocess emails</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Preprocessing </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">emails</span><span class="p">)</span><span class="si">}</span><span class="s2"> emails&quot;</span><span class="p">)</span>
            <span class="n">chunks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">email_preprocessor</span><span class="o">.</span><span class="n">preprocess_emails</span><span class="p">(</span><span class="n">emails</span><span class="p">)</span>

            <span class="c1"># Store chunks</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Storing </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">chunks</span><span class="p">)</span><span class="si">}</span><span class="s2"> chunks&quot;</span><span class="p">)</span>
            <span class="n">stored_uuids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vector_store</span><span class="o">.</span><span class="n">store_chunks</span><span class="p">(</span><span class="n">chunks</span><span class="p">,</span> <span class="n">collection</span><span class="o">=</span><span class="n">collection</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Successfully processed </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">emails</span><span class="p">)</span><span class="si">}</span><span class="s2"> emails&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">stored_uuids</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to process emails: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">raise</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Context manager entry.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exc_type</span><span class="p">,</span> <span class="n">exc_val</span><span class="p">,</span> <span class="n">exc_tb</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Context manager exit.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h5 id="ragora.core.knowledge_base_manager.KnowledgeBaseManager._ensure_email_connection" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">_ensure_email_connection</span><span class="p">(</span><span class="n">email_provider</span><span class="p">)</span></code>

<a href="#ragora.core.knowledge_base_manager.KnowledgeBaseManager._ensure_email_connection" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Ensure email provider is connected.</p>
<p>Returns True if we connected it, False if already connected.</p>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/core/knowledge_base_manager.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">_ensure_email_connection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">email_provider</span><span class="p">:</span> <span class="n">EmailProvider</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Ensure email provider is connected.</span>

<span class="sd">    Returns True if we connected it, False if already connected.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">email_provider</span><span class="o">.</span><span class="n">is_connected</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Email provider not connected, connecting...&quot;</span><span class="p">)</span>
        <span class="n">email_provider</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">return</span> <span class="kc">False</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="ragora.core.knowledge_base_manager.KnowledgeBaseManager.check_new_emails" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">check_new_emails</span><span class="p">(</span><span class="n">email_provider</span><span class="p">,</span> <span class="n">folder</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">include_body</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span></code>

<a href="#ragora.core.knowledge_base_manager.KnowledgeBaseManager.check_new_emails" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Check for new unread emails without storing them.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>email_provider</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="EmailProvider (ragora.utils.email_utils.base.EmailProvider)" href="#ragora.utils.email_utils.base.EmailProvider">EmailProvider</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Email provider instance</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>folder</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional folder to check (None = all folders)</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>include_body</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Include email body content (default: True)</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>limit</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Maximum number of emails to return</p>
              </div>
            </td>
            <td>
                  <code>50</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>EmailListResult</code></td>            <td>
                  <code><a class="autorefs autorefs-internal" title="EmailListResult (ragora.core.models.EmailListResult)" href="#ragora.core.models.EmailListResult">EmailListResult</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Structured result with email items and metadata</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="RuntimeError">RuntimeError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If system not initialized</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/core/knowledge_base_manager.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">check_new_emails</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">email_provider</span><span class="p">:</span> <span class="n">EmailProvider</span><span class="p">,</span>
    <span class="n">folder</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">include_body</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">EmailListResult</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Check for new unread emails without storing them.</span>

<span class="sd">    Args:</span>
<span class="sd">        email_provider: Email provider instance</span>
<span class="sd">        folder: Optional folder to check (None = all folders)</span>
<span class="sd">        include_body: Include email body content (default: True)</span>
<span class="sd">        limit: Maximum number of emails to return</span>

<span class="sd">    Returns:</span>
<span class="sd">        EmailListResult: Structured result with email items and metadata</span>

<span class="sd">    Raises:</span>
<span class="sd">        RuntimeError: If system not initialized</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_initialized</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Knowledge base manager not initialized&quot;</span><span class="p">)</span>

    <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Auto-connect if needed</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ensure_email_connection</span><span class="p">(</span><span class="n">email_provider</span><span class="p">)</span>

        <span class="c1"># Fetch unread messages</span>
        <span class="n">new_emails</span> <span class="o">=</span> <span class="n">email_provider</span><span class="o">.</span><span class="n">fetch_messages</span><span class="p">(</span>
            <span class="n">limit</span><span class="o">=</span><span class="n">limit</span><span class="p">,</span> <span class="n">folder</span><span class="o">=</span><span class="n">folder</span><span class="p">,</span> <span class="n">unread_only</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>

        <span class="c1"># Convert EmailMessage objects to EmailMessageModel</span>
        <span class="n">email_items</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">EmailMessageModel</span><span class="o">.</span><span class="n">from_email_message</span><span class="p">(</span><span class="n">email</span><span class="p">)</span> <span class="k">for</span> <span class="n">email</span> <span class="ow">in</span> <span class="n">new_emails</span>
        <span class="p">]</span>

        <span class="c1"># Clear body fields if include_body is False</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">include_body</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">email_item</span> <span class="ow">in</span> <span class="n">email_items</span><span class="p">:</span>
                <span class="n">email_item</span><span class="o">.</span><span class="n">body_text</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">email_item</span><span class="o">.</span><span class="n">body_html</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="n">execution_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>

        <span class="c1"># Build metadata</span>
        <span class="n">metadata</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;include_body&quot;</span><span class="p">:</span> <span class="n">include_body</span><span class="p">,</span>
            <span class="s2">&quot;limit&quot;</span><span class="p">:</span> <span class="n">limit</span><span class="p">,</span>
            <span class="s2">&quot;unread_only&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="n">result</span> <span class="o">=</span> <span class="n">EmailListResult</span><span class="p">(</span>
            <span class="n">emails</span><span class="o">=</span><span class="n">email_items</span><span class="p">,</span>
            <span class="n">count</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">new_emails</span><span class="p">),</span>
            <span class="n">folder</span><span class="o">=</span><span class="n">folder</span><span class="p">,</span>
            <span class="n">execution_time</span><span class="o">=</span><span class="n">execution_time</span><span class="p">,</span>
            <span class="n">metadata</span><span class="o">=</span><span class="n">metadata</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Found </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">new_emails</span><span class="p">)</span><span class="si">}</span><span class="s2"> new emails&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to check new emails: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">raise</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="ragora.core.knowledge_base_manager.KnowledgeBaseManager.clear_collection" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">clear_collection</span><span class="p">(</span><span class="n">collection</span><span class="p">)</span></code>

<a href="#ragora.core.knowledge_base_manager.KnowledgeBaseManager.clear_collection" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Clear all data from a collection.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>collection</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Collection name</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="RuntimeError">RuntimeError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If system not initialized</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/core/knowledge_base_manager.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">clear_collection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">collection</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Clear all data from a collection.</span>

<span class="sd">    Args:</span>
<span class="sd">        collection: Collection name</span>

<span class="sd">    Raises:</span>
<span class="sd">        RuntimeError: If system not initialized</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_initialized</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Knowledge base manager not initialized&quot;</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Clearing all data from collection: </span><span class="si">{</span><span class="n">collection</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vector_store</span><span class="o">.</span><span class="n">clear_all</span><span class="p">(</span><span class="n">collection</span><span class="o">=</span><span class="n">collection</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Collection </span><span class="si">{</span><span class="n">collection</span><span class="si">}</span><span class="s2"> cleared successfully&quot;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to clear collection </span><span class="si">{</span><span class="n">collection</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">raise</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="ragora.core.knowledge_base_manager.KnowledgeBaseManager.close" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">close</span><span class="p">()</span></code>

<a href="#ragora.core.knowledge_base_manager.KnowledgeBaseManager.close" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Close all system connections and cleanup resources.</p>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/core/knowledge_base_manager.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Close all system connections and cleanup resources.&quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;vector_store&quot;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vector_store</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_initialized</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Knowledge base manager closed successfully&quot;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error closing knowledge base manager: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="ragora.core.knowledge_base_manager.KnowledgeBaseManager.create_collection" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">create_collection</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">force_recreate</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#ragora.core.knowledge_base_manager.KnowledgeBaseManager.create_collection" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Create a new collection.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Collection name</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>force_recreate</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to recreate if collection exists</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>bool</code></td>            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>True if creation was successful, False otherwise</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/core/knowledge_base_manager.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">create_collection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">force_recreate</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create a new collection.</span>

<span class="sd">    Args:</span>
<span class="sd">        name: Collection name</span>
<span class="sd">        force_recreate: Whether to recreate if collection exists</span>

<span class="sd">    Returns:</span>
<span class="sd">        bool: True if creation was successful, False otherwise</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vector_store</span><span class="o">.</span><span class="n">create_schema</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">force_recreate</span><span class="o">=</span><span class="n">force_recreate</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to create collection </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="ragora.core.knowledge_base_manager.KnowledgeBaseManager.delete_chunk" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">delete_chunk</span><span class="p">(</span><span class="n">chunk_id</span><span class="p">,</span> <span class="n">collection</span><span class="p">)</span></code>

<a href="#ragora.core.knowledge_base_manager.KnowledgeBaseManager.delete_chunk" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Delete a chunk by its ID.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>chunk_id</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Unique identifier of the chunk to delete</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>collection</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Collection name</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>
        <p>Returns:
    bool: True if deletion was successful, False otherwise</p>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/core/knowledge_base_manager.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">delete_chunk</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">chunk_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">collection</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Delete a chunk by its ID.</span>

<span class="sd">    Args:</span>
<span class="sd">        chunk_id: Unique identifier of the chunk to delete</span>
<span class="sd">        collection: Collection name</span>
<span class="sd">    Returns:</span>
<span class="sd">        bool: True if deletion was successful, False otherwise</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">vector_store</span><span class="o">.</span><span class="n">delete_chunk</span><span class="p">(</span><span class="n">chunk_id</span><span class="p">,</span> <span class="n">collection</span><span class="o">=</span><span class="n">collection</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="ragora.core.knowledge_base_manager.KnowledgeBaseManager.delete_collection" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">delete_collection</span><span class="p">(</span><span class="n">name</span><span class="p">)</span></code>

<a href="#ragora.core.knowledge_base_manager.KnowledgeBaseManager.delete_collection" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Delete a collection and all its data.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Collection name</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>bool</code></td>            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>True if deletion was successful, False otherwise</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/core/knowledge_base_manager.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">delete_collection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Delete a collection and all its data.</span>

<span class="sd">    Args:</span>
<span class="sd">        name: Collection name</span>

<span class="sd">    Returns:</span>
<span class="sd">        bool: True if deletion was successful, False otherwise</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vector_store</span><span class="o">.</span><span class="n">clear_all</span><span class="p">(</span><span class="n">collection</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
        <span class="c1"># Note: Weaviate doesn&#39;t have direct collection deletion</span>
        <span class="c1"># This clears all data, effectively &quot;deleting&quot; the collection</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to delete collection </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="ragora.core.knowledge_base_manager.KnowledgeBaseManager.get_chunk" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_chunk</span><span class="p">(</span><span class="n">chunk_id</span><span class="p">,</span> <span class="n">collection</span><span class="p">)</span></code>

<a href="#ragora.core.knowledge_base_manager.KnowledgeBaseManager.get_chunk" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Retrieve a specific chunk by its ID.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>chunk_id</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Unique identifier of the chunk</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>collection</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Collection name</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>
        <p>Returns:
    Optional[RetrievalResultItem]: Chunk data if found, None otherwise</p>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/core/knowledge_base_manager.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_chunk</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">chunk_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">collection</span><span class="p">:</span> <span class="nb">str</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">RetrievalResultItem</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Retrieve a specific chunk by its ID.</span>

<span class="sd">    Args:</span>
<span class="sd">        chunk_id: Unique identifier of the chunk</span>
<span class="sd">        collection: Collection name</span>
<span class="sd">    Returns:</span>
<span class="sd">        Optional[RetrievalResultItem]: Chunk data if found, None otherwise</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">vector_store</span><span class="o">.</span><span class="n">get_chunk_by_id</span><span class="p">(</span><span class="n">chunk_id</span><span class="p">,</span> <span class="n">collection</span><span class="o">=</span><span class="n">collection</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="ragora.core.knowledge_base_manager.KnowledgeBaseManager.get_collection_stats" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_collection_stats</span><span class="p">(</span><span class="n">collection</span><span class="p">)</span></code>

<a href="#ragora.core.knowledge_base_manager.KnowledgeBaseManager.get_collection_stats" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Get statistics for a specific collection.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>collection</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Collection name</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dict[str, Any]: Collection statistics</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/core/knowledge_base_manager.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_collection_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">collection</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get statistics for a specific collection.</span>

<span class="sd">    Args:</span>
<span class="sd">        collection: Collection name</span>

<span class="sd">    Returns:</span>
<span class="sd">        Dict[str, Any]: Collection statistics</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Get vector store stats</span>
        <span class="n">vector_stats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vector_store</span><span class="o">.</span><span class="n">get_stats</span><span class="p">(</span><span class="n">collection</span><span class="o">=</span><span class="n">collection</span><span class="p">)</span>

        <span class="c1"># Get retrieval stats</span>
        <span class="n">retrieval_stats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">retriever</span><span class="o">.</span><span class="n">get_retrieval_stats</span><span class="p">(</span><span class="n">collection</span><span class="o">=</span><span class="n">collection</span><span class="p">)</span>

        <span class="c1"># Get embedding engine info</span>
        <span class="n">embedding_info</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">embedding_engine</span><span class="o">.</span><span class="n">get_model_info</span><span class="p">()</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">embedding_engine</span>
            <span class="k">else</span> <span class="p">{</span><span class="s2">&quot;model_name&quot;</span><span class="p">:</span> <span class="s2">&quot;Not initialized&quot;</span><span class="p">,</span> <span class="s2">&quot;dimension&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">}</span>
        <span class="p">)</span>

        <span class="c1"># Get chunker configuration</span>
        <span class="n">chunker_config</span> <span class="o">=</span> <span class="p">(</span>
            <span class="p">{</span>
                <span class="s2">&quot;chunk_size&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_chunker</span><span class="o">.</span><span class="n">default_strategy</span><span class="o">.</span><span class="n">chunk_size</span><span class="p">,</span>
                <span class="s2">&quot;overlap_size&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_chunker</span><span class="o">.</span><span class="n">default_strategy</span><span class="o">.</span><span class="n">overlap_size</span><span class="p">,</span>
                <span class="s2">&quot;chunk_type&quot;</span><span class="p">:</span> <span class="s2">&quot;custom&quot;</span><span class="p">,</span>
            <span class="p">}</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_chunker</span>
            <span class="k">else</span> <span class="p">{</span>
                <span class="s2">&quot;chunk_size&quot;</span><span class="p">:</span> <span class="s2">&quot;Not initialized&quot;</span><span class="p">,</span>
                <span class="s2">&quot;overlap_size&quot;</span><span class="p">:</span> <span class="s2">&quot;Not initialized&quot;</span><span class="p">,</span>
                <span class="s2">&quot;chunk_type&quot;</span><span class="p">:</span> <span class="s2">&quot;Not initialized&quot;</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;collection&quot;</span><span class="p">:</span> <span class="n">collection</span><span class="p">,</span>
            <span class="s2">&quot;system_initialized&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_initialized</span><span class="p">,</span>
            <span class="s2">&quot;database_manager&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">db_manager</span><span class="o">.</span><span class="n">url</span><span class="p">,</span>
                <span class="s2">&quot;is_connected&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">db_manager</span><span class="o">.</span><span class="n">is_connected</span><span class="p">,</span>
                <span class="s2">&quot;collections&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">db_manager</span><span class="o">.</span><span class="n">list_collections</span><span class="p">(),</span>
            <span class="p">},</span>
            <span class="s2">&quot;vector_store&quot;</span><span class="p">:</span> <span class="n">vector_stats</span><span class="p">,</span>
            <span class="s2">&quot;retrieval&quot;</span><span class="p">:</span> <span class="n">retrieval_stats</span><span class="p">,</span>
            <span class="s2">&quot;embedding_engine&quot;</span><span class="p">:</span> <span class="n">embedding_info</span><span class="p">,</span>
            <span class="s2">&quot;data_chunker&quot;</span><span class="p">:</span> <span class="n">chunker_config</span><span class="p">,</span>
            <span class="s2">&quot;components&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;database_manager&quot;</span><span class="p">:</span> <span class="s2">&quot;Weaviate Infrastructure&quot;</span><span class="p">,</span>
                <span class="s2">&quot;vector_store&quot;</span><span class="p">:</span> <span class="s2">&quot;Weaviate Storage&quot;</span><span class="p">,</span>
                <span class="s2">&quot;retriever&quot;</span><span class="p">:</span> <span class="s2">&quot;Weaviate Search APIs&quot;</span><span class="p">,</span>
                <span class="s2">&quot;embedding_engine&quot;</span><span class="p">:</span> <span class="n">embedding_info</span><span class="p">[</span><span class="s2">&quot;model_name&quot;</span><span class="p">],</span>
                <span class="s2">&quot;document_preprocessor&quot;</span><span class="p">:</span> <span class="s2">&quot;LaTeX Parser&quot;</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="s2">&quot;architecture&quot;</span><span class="p">:</span> <span class="s2">&quot;Three-Layer (DatabaseManager -&gt; VectorStore -&gt; Retriever)&quot;</span><span class="p">,</span>
        <span class="p">}</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to get collection stats: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">raise</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="ragora.core.knowledge_base_manager.KnowledgeBaseManager.list_collections" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">list_collections</span><span class="p">()</span></code>

<a href="#ragora.core.knowledge_base_manager.KnowledgeBaseManager.list_collections" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>List all available collections.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.List">List</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List[str]: List of collection names</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/core/knowledge_base_manager.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">list_collections</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;List all available collections.</span>

<span class="sd">    Returns:</span>
<span class="sd">        List[str]: List of collection names</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">db_manager</span><span class="o">.</span><span class="n">list_collections</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="ragora.core.knowledge_base_manager.KnowledgeBaseManager.process_document" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">process_document</span><span class="p">(</span><span class="n">document_path</span><span class="p">,</span> <span class="n">document_type</span><span class="o">=</span><span class="s1">&#39;latex&#39;</span><span class="p">,</span> <span class="n">collection</span><span class="o">=</span><span class="s1">&#39;Document&#39;</span><span class="p">)</span></code>

<a href="#ragora.core.knowledge_base_manager.KnowledgeBaseManager.process_document" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Process a single document and store it in the vector database.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>document_path</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to the document file</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>document_type</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Type of document to process ("latex", "markdown", "text")</p>
              </div>
            </td>
            <td>
                  <code>&#39;latex&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>collection</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Collection name to store the document</p>
              </div>
            </td>
            <td>
                  <code>&#39;Document&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>
        <p>Returns:
    List[str]: List of chunk IDs that were stored</p>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="FileNotFoundError">FileNotFoundError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If document file doesn't exist</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If document processing fails</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>
        <p>Examples:
    <div class="highlight"><pre><span></span><code><span class="n">kb</span> <span class="o">=</span> <span class="n">KnowledgeBaseManager</span><span class="p">()</span>
<span class="n">kb</span><span class="o">.</span><span class="n">process_document</span><span class="p">(</span><span class="s2">&quot;docs/tutorial.md&quot;</span><span class="p">,</span> <span class="n">document_type</span><span class="o">=</span><span class="s2">&quot;markdown&quot;</span><span class="p">)</span>
</code></pre></div></p>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/core/knowledge_base_manager.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">process_document</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">document_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">document_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;latex&quot;</span><span class="p">,</span>
    <span class="n">collection</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;Document&quot;</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Process a single document and store it in the vector database.</span>

<span class="sd">    Args:</span>
<span class="sd">        document_path: Path to the document file</span>
<span class="sd">        document_type: Type of document to process (&quot;latex&quot;, &quot;markdown&quot;, &quot;text&quot;)</span>
<span class="sd">        collection: Collection name to store the document</span>
<span class="sd">    Returns:</span>
<span class="sd">        List[str]: List of chunk IDs that were stored</span>

<span class="sd">    Raises:</span>
<span class="sd">        FileNotFoundError: If document file doesn&#39;t exist</span>
<span class="sd">        ValueError: If document processing fails</span>
<span class="sd">    Examples:</span>
<span class="sd">        ```python</span>
<span class="sd">        kb = KnowledgeBaseManager()</span>
<span class="sd">        kb.process_document(&quot;docs/tutorial.md&quot;, document_type=&quot;markdown&quot;)</span>
<span class="sd">        ```</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_initialized</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Knowledge base manager not initialized&quot;</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Processing document: </span><span class="si">{</span><span class="n">document_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Step 1: Preprocess the LaTeX document</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Step 1: Preprocessing </span><span class="si">{</span><span class="n">document_type</span><span class="si">}</span><span class="s2"> document&quot;</span><span class="p">)</span>
        <span class="n">chunks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">document_preprocessor</span><span class="o">.</span><span class="n">preprocess_document</span><span class="p">(</span>
            <span class="n">document_path</span><span class="p">,</span> <span class="n">document_type</span>
        <span class="p">)</span>

        <span class="c1"># Step 2: Store chunks in vector database</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Step 2: Storing </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">chunks</span><span class="p">)</span><span class="si">}</span><span class="s2"> chunks in vector database&quot;</span>
        <span class="p">)</span>
        <span class="n">stored_uuids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vector_store</span><span class="o">.</span><span class="n">store_chunks</span><span class="p">(</span><span class="n">chunks</span><span class="p">,</span> <span class="n">collection</span><span class="o">=</span><span class="n">collection</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Successfully processed document: </span><span class="si">{</span><span class="n">document_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Stored </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">stored_uuids</span><span class="p">)</span><span class="si">}</span><span class="s2"> chunks&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">stored_uuids</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to process document </span><span class="si">{</span><span class="n">document_path</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">raise</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="ragora.core.knowledge_base_manager.KnowledgeBaseManager.process_documents" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">process_documents</span><span class="p">(</span><span class="n">document_paths</span><span class="p">,</span> <span class="n">document_type</span><span class="o">=</span><span class="s1">&#39;latex&#39;</span><span class="p">,</span> <span class="n">collection</span><span class="o">=</span><span class="s1">&#39;Document&#39;</span><span class="p">)</span></code>

<a href="#ragora.core.knowledge_base_manager.KnowledgeBaseManager.process_documents" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Process a list of documents and store them in the vector database.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>document_paths</code>
            </td>
            <td>
                  <code><span title="typing.List">List</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of paths to the documents to ingest</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>document_type</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Type of document to process ("latex", "markdown", "text")</p>
              </div>
            </td>
            <td>
                  <code>&#39;latex&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>collection</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Collection name to store the documents</p>
              </div>
            </td>
            <td>
                  <code>&#39;Document&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>
        <p>Returns:
    List[str]: List of chunk IDs that were stored</p>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="RuntimeError">RuntimeError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If the manager is not initialized</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="Exception">Exception</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If the documents cannot be processed</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><span class="n">kb</span> <span class="o">=</span> <span class="n">KnowledgeBaseManager</span><span class="p">()</span>
<span class="n">kb</span><span class="o">.</span><span class="n">process_documents</span><span class="p">([</span><span class="s2">&quot;notes.md&quot;</span><span class="p">,</span> <span class="s2">&quot;report.tex&quot;</span><span class="p">],</span> <span class="n">document_type</span><span class="o">=</span><span class="s2">&quot;markdown&quot;</span><span class="p">)</span>
</code></pre></div>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/core/knowledge_base_manager.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">process_documents</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">document_paths</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
    <span class="n">document_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;latex&quot;</span><span class="p">,</span>
    <span class="n">collection</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;Document&quot;</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Process a list of documents and store them in the vector database.</span>

<span class="sd">    Args:</span>
<span class="sd">        document_paths: List of paths to the documents to ingest</span>
<span class="sd">        document_type: Type of document to process (&quot;latex&quot;, &quot;markdown&quot;, &quot;text&quot;)</span>
<span class="sd">        collection: Collection name to store the documents</span>
<span class="sd">    Returns:</span>
<span class="sd">        List[str]: List of chunk IDs that were stored</span>

<span class="sd">    Raises:</span>
<span class="sd">        RuntimeError: If the manager is not initialized</span>
<span class="sd">        Exception: If the documents cannot be processed</span>

<span class="sd">    Examples:</span>
<span class="sd">        ```python</span>
<span class="sd">        kb = KnowledgeBaseManager()</span>
<span class="sd">        kb.process_documents([&quot;notes.md&quot;, &quot;report.tex&quot;], document_type=&quot;markdown&quot;)</span>
<span class="sd">        ```</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_initialized</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Knowledge base manager not initialized&quot;</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Processing </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">document_paths</span><span class="p">)</span><span class="si">}</span><span class="s2"> documents&quot;</span><span class="p">)</span>
        <span class="n">chunks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">document_preprocessor</span><span class="o">.</span><span class="n">preprocess_documents</span><span class="p">(</span>
            <span class="n">document_paths</span><span class="p">,</span> <span class="n">document_type</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Storing </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">chunks</span><span class="p">)</span><span class="si">}</span><span class="s2"> chunks in vector database&quot;</span><span class="p">)</span>
        <span class="n">stored_uuids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vector_store</span><span class="o">.</span><span class="n">store_chunks</span><span class="p">(</span><span class="n">chunks</span><span class="p">,</span> <span class="n">collection</span><span class="o">=</span><span class="n">collection</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Successfully processed </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">document_paths</span><span class="p">)</span><span class="si">}</span><span class="s2"> documents&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Stored </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">stored_uuids</span><span class="p">)</span><span class="si">}</span><span class="s2"> chunks&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">stored_uuids</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to process documents: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">raise</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="ragora.core.knowledge_base_manager.KnowledgeBaseManager.process_email_account" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">process_email_account</span><span class="p">(</span><span class="n">email_provider</span><span class="p">,</span> <span class="n">folder</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">unread_only</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">collection</span><span class="o">=</span><span class="s1">&#39;Email&#39;</span><span class="p">)</span></code>

<a href="#ragora.core.knowledge_base_manager.KnowledgeBaseManager.process_email_account" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Process emails from an email account.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>email_provider</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="EmailProvider (ragora.utils.email_utils.base.EmailProvider)" href="#ragora.utils.email_utils.base.EmailProvider">EmailProvider</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Email provider instance</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>folder</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional folder to process (None = all folders)</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>unread_only</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, only process unread emails</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>collection</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Collection name to store the emails</p>
              </div>
            </td>
            <td>
                  <code>&#39;Email&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.List">List</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of stored chunk IDs</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/core/knowledge_base_manager.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span>
<span class="normal">760</span>
<span class="normal">761</span>
<span class="normal">762</span>
<span class="normal">763</span>
<span class="normal">764</span>
<span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span>
<span class="normal">768</span>
<span class="normal">769</span>
<span class="normal">770</span>
<span class="normal">771</span>
<span class="normal">772</span>
<span class="normal">773</span>
<span class="normal">774</span>
<span class="normal">775</span>
<span class="normal">776</span>
<span class="normal">777</span>
<span class="normal">778</span>
<span class="normal">779</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">process_email_account</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">email_provider</span><span class="p">:</span> <span class="n">EmailProvider</span><span class="p">,</span>
    <span class="n">folder</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">unread_only</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">collection</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;Email&quot;</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Process emails from an email account.</span>

<span class="sd">    Args:</span>
<span class="sd">        email_provider: Email provider instance</span>
<span class="sd">        folder: Optional folder to process (None = all folders)</span>
<span class="sd">        unread_only: If True, only process unread emails</span>
<span class="sd">        collection: Collection name to store the emails</span>

<span class="sd">    Returns:</span>
<span class="sd">        List of stored chunk IDs</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_initialized</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Knowledge base manager not initialized&quot;</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Auto-connect if needed</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ensure_email_connection</span><span class="p">(</span><span class="n">email_provider</span><span class="p">)</span>

        <span class="c1"># Fetch emails</span>
        <span class="n">emails</span> <span class="o">=</span> <span class="n">email_provider</span><span class="o">.</span><span class="n">fetch_messages</span><span class="p">(</span>
            <span class="n">limit</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">folder</span><span class="o">=</span><span class="n">folder</span><span class="p">,</span> <span class="n">unread_only</span><span class="o">=</span><span class="n">unread_only</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">emails</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;No emails to process&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">[]</span>

        <span class="c1"># Preprocess emails</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Preprocessing </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">emails</span><span class="p">)</span><span class="si">}</span><span class="s2"> emails&quot;</span><span class="p">)</span>
        <span class="n">chunks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">email_preprocessor</span><span class="o">.</span><span class="n">preprocess_emails</span><span class="p">(</span><span class="n">emails</span><span class="p">)</span>

        <span class="c1"># Store chunks</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Storing </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">chunks</span><span class="p">)</span><span class="si">}</span><span class="s2"> chunks&quot;</span><span class="p">)</span>
        <span class="n">stored_uuids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vector_store</span><span class="o">.</span><span class="n">store_chunks</span><span class="p">(</span><span class="n">chunks</span><span class="p">,</span> <span class="n">collection</span><span class="o">=</span><span class="n">collection</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Successfully processed </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">emails</span><span class="p">)</span><span class="si">}</span><span class="s2"> emails&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">stored_uuids</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to process email account: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">raise</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="ragora.core.knowledge_base_manager.KnowledgeBaseManager.process_emails" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">process_emails</span><span class="p">(</span><span class="n">email_provider</span><span class="p">,</span> <span class="n">email_ids</span><span class="p">,</span> <span class="n">collection</span><span class="o">=</span><span class="s1">&#39;Email&#39;</span><span class="p">)</span></code>

<a href="#ragora.core.knowledge_base_manager.KnowledgeBaseManager.process_emails" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Process specific emails by their IDs.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>email_provider</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="EmailProvider (ragora.utils.email_utils.base.EmailProvider)" href="#ragora.utils.email_utils.base.EmailProvider">EmailProvider</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Email provider instance</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>email_ids</code>
            </td>
            <td>
                  <code><span title="typing.List">List</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of email IDs to process</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>collection</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Collection name to store the emails</p>
              </div>
            </td>
            <td>
                  <code>&#39;Email&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.List">List</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of stored chunk IDs</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/core/knowledge_base_manager.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">781</span>
<span class="normal">782</span>
<span class="normal">783</span>
<span class="normal">784</span>
<span class="normal">785</span>
<span class="normal">786</span>
<span class="normal">787</span>
<span class="normal">788</span>
<span class="normal">789</span>
<span class="normal">790</span>
<span class="normal">791</span>
<span class="normal">792</span>
<span class="normal">793</span>
<span class="normal">794</span>
<span class="normal">795</span>
<span class="normal">796</span>
<span class="normal">797</span>
<span class="normal">798</span>
<span class="normal">799</span>
<span class="normal">800</span>
<span class="normal">801</span>
<span class="normal">802</span>
<span class="normal">803</span>
<span class="normal">804</span>
<span class="normal">805</span>
<span class="normal">806</span>
<span class="normal">807</span>
<span class="normal">808</span>
<span class="normal">809</span>
<span class="normal">810</span>
<span class="normal">811</span>
<span class="normal">812</span>
<span class="normal">813</span>
<span class="normal">814</span>
<span class="normal">815</span>
<span class="normal">816</span>
<span class="normal">817</span>
<span class="normal">818</span>
<span class="normal">819</span>
<span class="normal">820</span>
<span class="normal">821</span>
<span class="normal">822</span>
<span class="normal">823</span>
<span class="normal">824</span>
<span class="normal">825</span>
<span class="normal">826</span>
<span class="normal">827</span>
<span class="normal">828</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">process_emails</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">email_provider</span><span class="p">:</span> <span class="n">EmailProvider</span><span class="p">,</span>
    <span class="n">email_ids</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
    <span class="n">collection</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;Email&quot;</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Process specific emails by their IDs.</span>

<span class="sd">    Args:</span>
<span class="sd">        email_provider: Email provider instance</span>
<span class="sd">        email_ids: List of email IDs to process</span>
<span class="sd">        collection: Collection name to store the emails</span>

<span class="sd">    Returns:</span>
<span class="sd">        List of stored chunk IDs</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_initialized</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Knowledge base manager not initialized&quot;</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Auto-connect if needed</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ensure_email_connection</span><span class="p">(</span><span class="n">email_provider</span><span class="p">)</span>

        <span class="c1"># Fetch emails</span>
        <span class="n">emails</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">email_id</span> <span class="ow">in</span> <span class="n">email_ids</span><span class="p">:</span>
            <span class="n">email</span> <span class="o">=</span> <span class="n">email_provider</span><span class="o">.</span><span class="n">fetch_message_by_id</span><span class="p">(</span><span class="n">email_id</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">email</span><span class="p">:</span>
                <span class="n">emails</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">email</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">emails</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;No emails found to process&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">[]</span>

        <span class="c1"># Preprocess emails</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Preprocessing </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">emails</span><span class="p">)</span><span class="si">}</span><span class="s2"> emails&quot;</span><span class="p">)</span>
        <span class="n">chunks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">email_preprocessor</span><span class="o">.</span><span class="n">preprocess_emails</span><span class="p">(</span><span class="n">emails</span><span class="p">)</span>

        <span class="c1"># Store chunks</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Storing </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">chunks</span><span class="p">)</span><span class="si">}</span><span class="s2"> chunks&quot;</span><span class="p">)</span>
        <span class="n">stored_uuids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vector_store</span><span class="o">.</span><span class="n">store_chunks</span><span class="p">(</span><span class="n">chunks</span><span class="p">,</span> <span class="n">collection</span><span class="o">=</span><span class="n">collection</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Successfully processed </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">emails</span><span class="p">)</span><span class="si">}</span><span class="s2"> emails&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">stored_uuids</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to process emails: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">raise</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="ragora.core.knowledge_base_manager.KnowledgeBaseManager.process_new_emails" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">process_new_emails</span><span class="p">(</span><span class="n">email_provider</span><span class="p">,</span> <span class="n">email_ids</span><span class="p">,</span> <span class="n">collection</span><span class="o">=</span><span class="s1">&#39;Email&#39;</span><span class="p">)</span></code>

<a href="#ragora.core.knowledge_base_manager.KnowledgeBaseManager.process_new_emails" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Process and store specific emails by their IDs.</p>
<p>This method processes emails that have been identified by the user
through check_new_emails() and filtered as needed.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>email_provider</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="EmailProvider (ragora.utils.email_utils.base.EmailProvider)" href="#ragora.utils.email_utils.base.EmailProvider">EmailProvider</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Email provider instance</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>email_ids</code>
            </td>
            <td>
                  <code><span title="typing.List">List</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of email IDs to process (required)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>collection</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Collection name to store the emails</p>
              </div>
            </td>
            <td>
                  <code>&#39;Email&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.List">List</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of stored chunk IDs</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/core/knowledge_base_manager.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">process_new_emails</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">email_provider</span><span class="p">:</span> <span class="n">EmailProvider</span><span class="p">,</span>
    <span class="n">email_ids</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
    <span class="n">collection</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;Email&quot;</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Process and store specific emails by their IDs.</span>

<span class="sd">    This method processes emails that have been identified by the user</span>
<span class="sd">    through check_new_emails() and filtered as needed.</span>

<span class="sd">    Args:</span>
<span class="sd">        email_provider: Email provider instance</span>
<span class="sd">        email_ids: List of email IDs to process (required)</span>
<span class="sd">        collection: Collection name to store the emails</span>

<span class="sd">    Returns:</span>
<span class="sd">        List of stored chunk IDs</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_initialized</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Knowledge base manager not initialized&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">email_ids</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;No email IDs provided&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[]</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Auto-connect if needed</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ensure_email_connection</span><span class="p">(</span><span class="n">email_provider</span><span class="p">)</span>

        <span class="c1"># Fetch specific emails by ID</span>
        <span class="n">emails</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">email_id</span> <span class="ow">in</span> <span class="n">email_ids</span><span class="p">:</span>
            <span class="n">email</span> <span class="o">=</span> <span class="n">email_provider</span><span class="o">.</span><span class="n">fetch_message_by_id</span><span class="p">(</span><span class="n">email_id</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">email</span><span class="p">:</span>
                <span class="n">emails</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">email</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Email </span><span class="si">{</span><span class="n">email_id</span><span class="si">}</span><span class="s2"> not found&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">emails</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;No emails found to process&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">[]</span>

        <span class="c1"># Preprocess emails</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Preprocessing </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">emails</span><span class="p">)</span><span class="si">}</span><span class="s2"> emails&quot;</span><span class="p">)</span>
        <span class="n">chunks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">email_preprocessor</span><span class="o">.</span><span class="n">preprocess_emails</span><span class="p">(</span><span class="n">emails</span><span class="p">)</span>

        <span class="c1"># Store chunks</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Storing </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">chunks</span><span class="p">)</span><span class="si">}</span><span class="s2"> chunks&quot;</span><span class="p">)</span>
        <span class="n">stored_uuids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vector_store</span><span class="o">.</span><span class="n">store_chunks</span><span class="p">(</span><span class="n">chunks</span><span class="p">,</span> <span class="n">collection</span><span class="o">=</span><span class="n">collection</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Successfully processed </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">emails</span><span class="p">)</span><span class="si">}</span><span class="s2"> emails&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">stored_uuids</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to process new emails: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">raise</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="ragora.core.knowledge_base_manager.KnowledgeBaseManager.search" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">search</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">collection</span><span class="o">=</span><span class="s1">&#39;Document&#39;</span><span class="p">,</span> <span class="n">strategy</span><span class="o">=</span><span class="n">SearchStrategy</span><span class="o">.</span><span class="n">HYBRID</span><span class="p">,</span> <span class="n">top_k</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="nb">filter</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">strategy_kwargs</span><span class="p">)</span></code>

<a href="#ragora.core.knowledge_base_manager.KnowledgeBaseManager.search" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Unified search interface for all data types and strategies.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>query</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Search query text</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>collection</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Collection name to search in</p>
              </div>
            </td>
            <td>
                  <code>&#39;Document&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>strategy</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="SearchStrategy (ragora.core.knowledge_base_manager.SearchStrategy)" href="#ragora.core.knowledge_base_manager.SearchStrategy">SearchStrategy</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Search strategy to use</p>
              </div>
            </td>
            <td>
                  <code><span title="ragora.core.knowledge_base_manager.SearchStrategy.HYBRID">HYBRID</span></code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>top_k</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of results to return</p>
              </div>
            </td>
            <td>
                  <code>5</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>filter</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="weaviate.classes.query.Filter">Filter</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional Weaviate Filter to filter results by properties</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>**strategy_kwargs</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Strategy-specific parameters
(alpha, score_threshold, etc.)</p>
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>SearchResult</code></td>            <td>
                  <code><a class="autorefs autorefs-internal" title="SearchResult (ragora.core.knowledge_base_manager.SearchResult)" href="#ragora.core.knowledge_base_manager.SearchResult">SearchResult</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Structured search results with metadata</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="RuntimeError">RuntimeError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If system not initialized</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If invalid strategy or empty query</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><span class="n">kb</span> <span class="o">=</span> <span class="n">KnowledgeBaseManager</span><span class="p">()</span>
<span class="n">kb</span><span class="o">.</span><span class="n">process_document</span><span class="p">(</span><span class="s2">&quot;docs/tutorial.md&quot;</span><span class="p">,</span> <span class="n">document_type</span><span class="o">=</span><span class="s2">&quot;markdown&quot;</span><span class="p">)</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">kb</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">&quot;introduction&quot;</span><span class="p">,</span> <span class="n">strategy</span><span class="o">=</span><span class="n">SearchStrategy</span><span class="o">.</span><span class="n">HYBRID</span><span class="p">,</span> <span class="n">top_k</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="k">for</span> <span class="n">hit</span> <span class="ow">in</span> <span class="n">result</span><span class="o">.</span><span class="n">results</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">hit</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">title</span><span class="p">,</span> <span class="n">hit</span><span class="o">.</span><span class="n">similarity_score</span><span class="p">)</span>
</code></pre></div>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/core/knowledge_base_manager.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">search</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">query</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">collection</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;Document&quot;</span><span class="p">,</span>
    <span class="n">strategy</span><span class="p">:</span> <span class="n">SearchStrategy</span> <span class="o">=</span> <span class="n">SearchStrategy</span><span class="o">.</span><span class="n">HYBRID</span><span class="p">,</span>
    <span class="n">top_k</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
    <span class="nb">filter</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Filter</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="o">**</span><span class="n">strategy_kwargs</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SearchResult</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Unified search interface for all data types and strategies.</span>

<span class="sd">    Args:</span>
<span class="sd">        query: Search query text</span>
<span class="sd">        collection: Collection name to search in</span>
<span class="sd">        strategy: Search strategy to use</span>
<span class="sd">        top_k: Number of results to return</span>
<span class="sd">        filter: Optional Weaviate Filter to filter results by properties</span>
<span class="sd">        **strategy_kwargs: Strategy-specific parameters</span>
<span class="sd">            (alpha, score_threshold, etc.)</span>

<span class="sd">    Returns:</span>
<span class="sd">        SearchResult: Structured search results with metadata</span>

<span class="sd">    Raises:</span>
<span class="sd">        RuntimeError: If system not initialized</span>
<span class="sd">        ValueError: If invalid strategy or empty query</span>

<span class="sd">    Examples:</span>
<span class="sd">        ```python</span>
<span class="sd">        kb = KnowledgeBaseManager()</span>
<span class="sd">        kb.process_document(&quot;docs/tutorial.md&quot;, document_type=&quot;markdown&quot;)</span>
<span class="sd">        result = kb.search(&quot;introduction&quot;, strategy=SearchStrategy.HYBRID, top_k=3)</span>
<span class="sd">        for hit in result.results:</span>
<span class="sd">            print(hit.metadata.title, hit.similarity_score)</span>
<span class="sd">        ```</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_initialized</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Knowledge base manager not initialized&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">query</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">query</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Query cannot be empty&quot;</span><span class="p">)</span>

    <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Processing search: &#39;</span><span class="si">{</span><span class="n">query</span><span class="si">}</span><span class="s2">&#39; &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;(strategy: </span><span class="si">{</span><span class="n">strategy</span><span class="o">.</span><span class="n">value</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nb">hasattr</span><span class="p">(</span><span class="n">strategy</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;value&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="n">strategy</span><span class="si">}</span><span class="s2">, collection: </span><span class="si">{</span><span class="n">collection</span><span class="si">}</span><span class="s2">)&quot;</span>
        <span class="p">)</span>

        <span class="c1"># Execute search based on strategy</span>
        <span class="k">if</span> <span class="n">strategy</span> <span class="o">==</span> <span class="n">SearchStrategy</span><span class="o">.</span><span class="n">SIMILAR</span><span class="p">:</span>
            <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">retriever</span><span class="o">.</span><span class="n">search_similar</span><span class="p">(</span>
                <span class="n">query</span><span class="p">,</span>
                <span class="n">collection</span><span class="o">=</span><span class="n">collection</span><span class="p">,</span>
                <span class="n">top_k</span><span class="o">=</span><span class="n">top_k</span><span class="p">,</span>
                <span class="nb">filter</span><span class="o">=</span><span class="nb">filter</span><span class="p">,</span>
                <span class="o">**</span><span class="n">strategy_kwargs</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="n">strategy</span> <span class="o">==</span> <span class="n">SearchStrategy</span><span class="o">.</span><span class="n">KEYWORD</span><span class="p">:</span>
            <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">retriever</span><span class="o">.</span><span class="n">search_keyword</span><span class="p">(</span>
                <span class="n">query</span><span class="p">,</span>
                <span class="n">collection</span><span class="o">=</span><span class="n">collection</span><span class="p">,</span>
                <span class="n">top_k</span><span class="o">=</span><span class="n">top_k</span><span class="p">,</span>
                <span class="nb">filter</span><span class="o">=</span><span class="nb">filter</span><span class="p">,</span>
                <span class="o">**</span><span class="n">strategy_kwargs</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="n">strategy</span> <span class="o">==</span> <span class="n">SearchStrategy</span><span class="o">.</span><span class="n">HYBRID</span><span class="p">:</span>
            <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">retriever</span><span class="o">.</span><span class="n">search_hybrid</span><span class="p">(</span>
                <span class="n">query</span><span class="p">,</span>
                <span class="n">collection</span><span class="o">=</span><span class="n">collection</span><span class="p">,</span>
                <span class="n">top_k</span><span class="o">=</span><span class="n">top_k</span><span class="p">,</span>
                <span class="nb">filter</span><span class="o">=</span><span class="nb">filter</span><span class="p">,</span>
                <span class="o">**</span><span class="n">strategy_kwargs</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="n">strategy</span> <span class="o">==</span> <span class="n">SearchStrategy</span><span class="o">.</span><span class="n">AUTO</span><span class="p">:</span>
            <span class="c1"># For now, default to hybrid.</span>
            <span class="c1"># Could be enhanced with automatic strategy selection</span>
            <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">retriever</span><span class="o">.</span><span class="n">search_hybrid</span><span class="p">(</span>
                <span class="n">query</span><span class="p">,</span>
                <span class="n">collection</span><span class="o">=</span><span class="n">collection</span><span class="p">,</span>
                <span class="n">top_k</span><span class="o">=</span><span class="n">top_k</span><span class="p">,</span>
                <span class="nb">filter</span><span class="o">=</span><span class="nb">filter</span><span class="p">,</span>
                <span class="o">**</span><span class="n">strategy_kwargs</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid search strategy: </span><span class="si">{</span><span class="n">strategy</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">execution_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>

        <span class="c1"># Prepare metadata</span>
        <span class="n">metadata</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;chunk_sources&quot;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span>
                <span class="nb">set</span><span class="p">(</span>
                    <span class="n">result</span><span class="o">.</span><span class="n">properties</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;source_document&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
                    <span class="ow">or</span> <span class="n">result</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">source_document</span>
                    <span class="ow">or</span> <span class="s2">&quot;&quot;</span>
                    <span class="k">for</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">results</span>
                <span class="p">)</span>
            <span class="p">),</span>
            <span class="s2">&quot;chunk_types&quot;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span>
                <span class="nb">set</span><span class="p">(</span>
                    <span class="n">result</span><span class="o">.</span><span class="n">properties</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;chunk_type&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
                    <span class="ow">or</span> <span class="n">result</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">chunk_type</span>
                    <span class="ow">or</span> <span class="s2">&quot;&quot;</span>
                    <span class="k">for</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">results</span>
                <span class="p">)</span>
            <span class="p">),</span>
        <span class="p">}</span>

        <span class="c1"># Add similarity scores if available</span>
        <span class="n">similarity_scores</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">result</span><span class="o">.</span><span class="n">similarity_score</span>
            <span class="k">for</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">results</span>
            <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">similarity_score</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="p">]</span>

        <span class="k">if</span> <span class="n">similarity_scores</span><span class="p">:</span>
            <span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;avg_similarity&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">similarity_scores</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span>
                <span class="n">similarity_scores</span>
            <span class="p">)</span>
            <span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;max_similarity&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">similarity_scores</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Search completed: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">results</span><span class="p">)</span><span class="si">}</span><span class="s2"> results in </span><span class="si">{</span><span class="n">execution_time</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">s&quot;</span>
        <span class="p">)</span>

        <span class="c1"># Convert strategy enum to string for SearchResult</span>
        <span class="n">strategy_str</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">strategy</span><span class="o">.</span><span class="n">value</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">strategy</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="nb">str</span><span class="p">(</span><span class="n">strategy</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="n">results_dicts</span> <span class="o">=</span> <span class="p">[</span><span class="n">item</span><span class="o">.</span><span class="n">model_dump</span><span class="p">()</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">results</span><span class="p">]</span>

        <span class="c1"># Use model_validate for proper nested model validation in Pydantic 2.x</span>
        <span class="k">return</span> <span class="n">SearchResult</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="s2">&quot;query&quot;</span><span class="p">:</span> <span class="n">query</span><span class="p">,</span>
                <span class="s2">&quot;strategy&quot;</span><span class="p">:</span> <span class="n">strategy_str</span><span class="p">,</span>
                <span class="s2">&quot;collection&quot;</span><span class="p">:</span> <span class="n">collection</span><span class="p">,</span>
                <span class="s2">&quot;results&quot;</span><span class="p">:</span> <span class="n">results_dicts</span><span class="p">,</span>
                <span class="s2">&quot;total_found&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">results</span><span class="p">),</span>
                <span class="s2">&quot;execution_time&quot;</span><span class="p">:</span> <span class="n">execution_time</span><span class="p">,</span>
                <span class="s2">&quot;metadata&quot;</span><span class="p">:</span> <span class="n">metadata</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="p">)</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Search failed: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">raise</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="ragora.core.knowledge_base_manager.SearchResult" class="doc doc-heading">
            <code>SearchResult</code>


<a href="#ragora.core.knowledge_base_manager.SearchResult" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="pydantic.BaseModel">BaseModel</span></code></p>


        <p>Container for search results with query metadata.</p>
<p>Provides a structured container for search results including
the query, strategy, results list, and execution metadata.</p>








              <details class="quote">
                <summary>Source code in <code>ragora/ragora/core/knowledge_base_manager.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">SearchResult</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Container for search results with query metadata.</span>

<span class="sd">    Provides a structured container for search results including</span>
<span class="sd">    the query, strategy, results list, and execution metadata.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">query</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Search query text&quot;</span><span class="p">)</span>
    <span class="n">strategy</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Search strategy used&quot;</span><span class="p">)</span>
    <span class="n">collection</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Collection searched&quot;</span><span class="p">)</span>
    <span class="n">results</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">SearchResultItem</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="n">default_factory</span><span class="o">=</span><span class="nb">list</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;List of search result items&quot;</span>
    <span class="p">)</span>
    <span class="n">total_found</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">ge</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Total number of results found&quot;</span><span class="p">)</span>
    <span class="n">execution_time</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">ge</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Execution time in seconds&quot;</span><span class="p">)</span>
    <span class="n">metadata</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="n">default_factory</span><span class="o">=</span><span class="nb">dict</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Additional metadata about the search&quot;</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="ragora.core.knowledge_base_manager.SearchStrategy" class="doc doc-heading">
            <code>SearchStrategy</code>


<a href="#ragora.core.knowledge_base_manager.SearchStrategy" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="enum.Enum">Enum</span></code></p>


        <p>Search strategy enumeration.</p>








              <details class="quote">
                <summary>Source code in <code>ragora/ragora/core/knowledge_base_manager.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">SearchStrategy</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Search strategy enumeration.&quot;&quot;&quot;</span>

    <span class="n">SIMILAR</span> <span class="o">=</span> <span class="s2">&quot;similar&quot;</span>  <span class="c1"># Vector similarity only</span>
    <span class="n">KEYWORD</span> <span class="o">=</span> <span class="s2">&quot;keyword&quot;</span>  <span class="c1"># BM25 keyword search only</span>
    <span class="n">HYBRID</span> <span class="o">=</span> <span class="s2">&quot;hybrid&quot;</span>  <span class="c1"># Combined vector + keyword</span>
    <span class="n">AUTO</span> <span class="o">=</span> <span class="s2">&quot;auto&quot;</span>  <span class="c1"># Automatically choose best strategy</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">












  </div>

    </div>

</div>




  </div>

    </div>

</div><h3 id="models">Models<a class="headerlink" href="#models" title="Permanent link">&para;</a></h3>


<div class="doc doc-object doc-module">



<a id="ragora.core.models"></a>
    <div class="doc doc-contents first">

        <p>Domain models for retrieval results.</p>
<p>This module contains the core data models used for retrieval operations in the
RAG system. These models represent the structured data returned from search
and retrieval operations, providing type-safe access to chunk content,
metadata, and search scores.</p>
<p>Key Models:
- RetrievalMetadata: Structured metadata extracted from stored properties
- RetrievalResultItem: Base class for all chunk retrieval results
- SearchResultItem: Search results with scores (extends RetrievalResultItem)
- EmailMessageModel: Pydantic model for email messages (compatible with EmailMessage)
- EmailListResult: Container for email list results with metadata</p>










  <div class="doc doc-children">









<div class="doc doc-object doc-class">



<h4 id="ragora.core.models.EmailAddressModel" class="doc doc-heading">
            <code>EmailAddressModel</code>


<a href="#ragora.core.models.EmailAddressModel" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="pydantic.BaseModel">BaseModel</span></code></p>


        <p>Pydantic model for email address representation.</p>
<p>This model ensures 'email' is always required and non-null,
while 'name' remains optional. Provides validation and a rich
data model interface similar to EmailAddress dataclass.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="ragora.core.models.EmailAddressModel.email">email</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Required, non-null email address</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="ragora.core.models.EmailAddressModel.name">name</span></code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional display name</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>








              <details class="quote">
                <summary>Source code in <code>ragora/ragora/core/models.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">EmailAddressModel</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Pydantic model for email address representation.</span>

<span class="sd">    This model ensures &#39;email&#39; is always required and non-null,</span>
<span class="sd">    while &#39;name&#39; remains optional. Provides validation and a rich</span>
<span class="sd">    data model interface similar to EmailAddress dataclass.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        email: Required, non-null email address</span>
<span class="sd">        name: Optional display name</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">email</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Email address (required)&quot;</span><span class="p">)</span>
    <span class="n">name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Display name (optional)&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;String representation matching EmailAddress format.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> &lt;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">email</span><span class="si">}</span><span class="s2">&gt;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">email</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">to_email_address</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;EmailAddress&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Convert to EmailAddress dataclass.</span>

<span class="sd">        Returns:</span>
<span class="sd">            EmailAddress: EmailAddress dataclass instance</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">EmailAddress</span><span class="p">(</span><span class="n">email</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">email</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_email_address</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">address</span><span class="p">:</span> <span class="s2">&quot;EmailAddress&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;EmailAddressModel&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create EmailAddressModel from EmailAddress dataclass.</span>

<span class="sd">        Args:</span>
<span class="sd">            address: EmailAddress dataclass instance</span>

<span class="sd">        Returns:</span>
<span class="sd">            EmailAddressModel: EmailAddressModel instance</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">email</span><span class="o">=</span><span class="n">address</span><span class="o">.</span><span class="n">email</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">address</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h5 id="ragora.core.models.EmailAddressModel.from_email_address" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">from_email_address</span><span class="p">(</span><span class="n">address</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

<a href="#ragora.core.models.EmailAddressModel.from_email_address" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Create EmailAddressModel from EmailAddress dataclass.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>address</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="EmailAddress


  
      dataclass
   (ragora.utils.email_utils.models.EmailAddress)" href="#ragora.utils.email_utils.models.EmailAddress">EmailAddress</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>EmailAddress dataclass instance</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>EmailAddressModel</code></td>            <td>
                  <code><a class="autorefs autorefs-internal" title="EmailAddressModel (ragora.core.models.EmailAddressModel)" href="#ragora.core.models.EmailAddressModel">EmailAddressModel</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>EmailAddressModel instance</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/core/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">from_email_address</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">address</span><span class="p">:</span> <span class="s2">&quot;EmailAddress&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;EmailAddressModel&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create EmailAddressModel from EmailAddress dataclass.</span>

<span class="sd">    Args:</span>
<span class="sd">        address: EmailAddress dataclass instance</span>

<span class="sd">    Returns:</span>
<span class="sd">        EmailAddressModel: EmailAddressModel instance</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">email</span><span class="o">=</span><span class="n">address</span><span class="o">.</span><span class="n">email</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">address</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="ragora.core.models.EmailAddressModel.to_email_address" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">to_email_address</span><span class="p">()</span></code>

<a href="#ragora.core.models.EmailAddressModel.to_email_address" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Convert to EmailAddress dataclass.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>EmailAddress</code></td>            <td>
                  <code><a class="autorefs autorefs-internal" title="EmailAddress


  
      dataclass
   (ragora.utils.email_utils.models.EmailAddress)" href="#ragora.utils.email_utils.models.EmailAddress">EmailAddress</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>EmailAddress dataclass instance</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/core/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">to_email_address</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;EmailAddress&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Convert to EmailAddress dataclass.</span>

<span class="sd">    Returns:</span>
<span class="sd">        EmailAddress: EmailAddress dataclass instance</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">EmailAddress</span><span class="p">(</span><span class="n">email</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">email</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="ragora.core.models.EmailListResult" class="doc doc-heading">
            <code>EmailListResult</code>


<a href="#ragora.core.models.EmailListResult" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="pydantic.BaseModel">BaseModel</span></code></p>


        <p>Container for email list results with metadata.</p>
<p>Provides a structured container for email list results including
the list of emails, count, folder searched, and execution metadata.
Similar pattern to SearchResult for consistency.</p>








              <details class="quote">
                <summary>Source code in <code>ragora/ragora/core/models.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">EmailListResult</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Container for email list results with metadata.</span>

<span class="sd">    Provides a structured container for email list results including</span>
<span class="sd">    the list of emails, count, folder searched, and execution metadata.</span>
<span class="sd">    Similar pattern to SearchResult for consistency.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">emails</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">EmailMessageModel</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="n">default_factory</span><span class="o">=</span><span class="nb">list</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;List of email items&quot;</span>
    <span class="p">)</span>
    <span class="n">count</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">ge</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Total number of emails found&quot;</span><span class="p">)</span>
    <span class="n">folder</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Folder that was searched (None = all folders)&quot;</span>
    <span class="p">)</span>
    <span class="n">execution_time</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">ge</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Execution time in seconds&quot;</span><span class="p">)</span>
    <span class="n">metadata</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="n">default_factory</span><span class="o">=</span><span class="nb">dict</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Additional metadata about the email fetch operation&quot;</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="nd">@model_validator</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s2">&quot;after&quot;</span><span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">validate_count_matches_emails</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;EmailListResult&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Validate that count matches the actual number of emails.</span>

<span class="sd">        This ensures data consistency and prevents mismatched counts.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">count</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">emails</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Count (</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">count</span><span class="si">}</span><span class="s2">) does not match the number of emails &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">emails</span><span class="p">)</span><span class="si">}</span><span class="s2">)&quot;</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">email_messages</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="s2">&quot;EmailMessage&quot;</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Convert EmailMessageModel list to EmailMessage list for compatibility.</span>

<span class="sd">        Returns:</span>
<span class="sd">            List[EmailMessage]: List of EmailMessage dataclass instances</span>

<span class="sd">        Raises:</span>
<span class="sd">            ImportError: If email_utils.models cannot be imported</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">email_item</span><span class="o">.</span><span class="n">to_email_message</span><span class="p">()</span> <span class="k">for</span> <span class="n">email_item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">emails</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h5 id="ragora.core.models.EmailListResult.email_messages" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">email_messages</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#ragora.core.models.EmailListResult.email_messages" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Convert EmailMessageModel list to EmailMessage list for compatibility.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.List">List</span>[<a class="autorefs autorefs-internal" title="EmailMessage


  
      dataclass
   (ragora.utils.email_utils.models.EmailMessage)" href="#ragora.utils.email_utils.models.EmailMessage">EmailMessage</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List[EmailMessage]: List of EmailMessage dataclass instances</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ImportError">ImportError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If email_utils.models cannot be imported</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

    </div>

</div>




<div class="doc doc-object doc-function">


<h5 id="ragora.core.models.EmailListResult.validate_count_matches_emails" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">validate_count_matches_emails</span><span class="p">()</span></code>

<a href="#ragora.core.models.EmailListResult.validate_count_matches_emails" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Validate that count matches the actual number of emails.</p>
<p>This ensures data consistency and prevents mismatched counts.</p>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/core/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@model_validator</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s2">&quot;after&quot;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">validate_count_matches_emails</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;EmailListResult&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Validate that count matches the actual number of emails.</span>

<span class="sd">    This ensures data consistency and prevents mismatched counts.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">count</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">emails</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Count (</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">count</span><span class="si">}</span><span class="s2">) does not match the number of emails &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">emails</span><span class="p">)</span><span class="si">}</span><span class="s2">)&quot;</span>
        <span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="ragora.core.models.EmailMessageModel" class="doc doc-heading">
            <code>EmailMessageModel</code>


<a href="#ragora.core.models.EmailMessageModel" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="pydantic.BaseModel">BaseModel</span></code></p>


        <p>Pydantic model for email messages, compatible with EmailMessage dataclass.</p>
<p>This model provides the same interface as EmailMessage but as a Pydantic
model for better serialization, validation, and integration with other
Pydantic-based APIs in the system.</p>
<p>The model can be converted to/from EmailMessage dataclass for compatibility
with EmailPreprocessor and other components that expect EmailMessage.</p>








              <details class="quote">
                <summary>Source code in <code>ragora/ragora/core/models.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">EmailMessageModel</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Pydantic model for email messages, compatible with EmailMessage dataclass.</span>

<span class="sd">    This model provides the same interface as EmailMessage but as a Pydantic</span>
<span class="sd">    model for better serialization, validation, and integration with other</span>
<span class="sd">    Pydantic-based APIs in the system.</span>

<span class="sd">    The model can be converted to/from EmailMessage dataclass for compatibility</span>
<span class="sd">    with EmailPreprocessor and other components that expect EmailMessage.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">message_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Unique email message identifier&quot;</span><span class="p">)</span>
    <span class="n">subject</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Email subject line&quot;</span><span class="p">)</span>
    <span class="n">sender</span><span class="p">:</span> <span class="n">EmailAddressModel</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="o">...</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Email sender with required &#39;email&#39; and optional &#39;name&#39;&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">recipients</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">EmailAddressModel</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="n">default_factory</span><span class="o">=</span><span class="nb">list</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;List of recipient email addresses&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">cc_recipients</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">EmailAddressModel</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="n">default_factory</span><span class="o">=</span><span class="nb">list</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;CC recipients&quot;</span>
    <span class="p">)</span>
    <span class="n">bcc_recipients</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">EmailAddressModel</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="n">default_factory</span><span class="o">=</span><span class="nb">list</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;BCC recipients&quot;</span>
    <span class="p">)</span>
    <span class="n">body_text</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Plain text email body&quot;</span><span class="p">)</span>
    <span class="n">body_html</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;HTML email body&quot;</span><span class="p">)</span>
    <span class="n">date_sent</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">datetime</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Email send date&quot;</span><span class="p">)</span>
    <span class="n">date_received</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">datetime</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Email received date&quot;</span>
    <span class="p">)</span>
    <span class="n">status</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="n">default</span><span class="o">=</span><span class="s2">&quot;unread&quot;</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Email status (unread, read, draft, sent, trash)&quot;</span>
    <span class="p">)</span>
    <span class="n">attachments</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="n">default_factory</span><span class="o">=</span><span class="nb">list</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Email attachments as list of dicts&quot;</span>
    <span class="p">)</span>
    <span class="n">thread_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Email thread ID&quot;</span><span class="p">)</span>
    <span class="n">conversation_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Email conversation ID&quot;</span>
    <span class="p">)</span>
    <span class="n">folder</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Email folder/path&quot;</span><span class="p">)</span>
    <span class="n">metadata</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="n">default_factory</span><span class="o">=</span><span class="nb">dict</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Additional email metadata&quot;</span>
    <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_body</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the best available body content (HTML preferred, fallback to text).</span>

<span class="sd">        This method matches the EmailMessage.get_body() interface for compatibility.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: Email body content (HTML if available, otherwise text)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">body_html</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">body_html</span> <span class="k">else</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">body_text</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_all_recipients</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">EmailAddressModel</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get all recipients including CC and BCC.</span>

<span class="sd">        Returns:</span>
<span class="sd">            List of EmailAddressModel instances (recipients + cc_recipients + bcc_recipients)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">recipients</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">cc_recipients</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">bcc_recipients</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">to_email_message</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;EmailMessage&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Convert EmailMessageModel to EmailMessage dataclass.</span>

<span class="sd">        Returns:</span>
<span class="sd">            EmailMessage: EmailMessage dataclass instance</span>

<span class="sd">        Raises:</span>
<span class="sd">            ImportError: If email_utils.models cannot be imported</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Convert sender EmailAddressModel to EmailAddress</span>
        <span class="n">sender_addr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sender</span><span class="o">.</span><span class="n">to_email_address</span><span class="p">()</span>

        <span class="c1"># Convert recipients</span>
        <span class="n">recipients_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">r</span><span class="o">.</span><span class="n">to_email_address</span><span class="p">()</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">recipients</span><span class="p">]</span>
        <span class="n">cc_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">r</span><span class="o">.</span><span class="n">to_email_address</span><span class="p">()</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cc_recipients</span><span class="p">]</span>
        <span class="n">bcc_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">r</span><span class="o">.</span><span class="n">to_email_address</span><span class="p">()</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">bcc_recipients</span><span class="p">]</span>

        <span class="c1"># Convert attachments</span>
        <span class="n">attachments_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">att</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">attachments</span><span class="p">:</span>
            <span class="n">attachments_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="n">EmailAttachment</span><span class="p">(</span>
                    <span class="n">filename</span><span class="o">=</span><span class="n">att</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;filename&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
                    <span class="n">content_type</span><span class="o">=</span><span class="n">att</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;content_type&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
                    <span class="n">size</span><span class="o">=</span><span class="n">att</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;size&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                    <span class="n">content</span><span class="o">=</span><span class="n">att</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;content&quot;</span><span class="p">),</span>
                    <span class="n">content_id</span><span class="o">=</span><span class="n">att</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;content_id&quot;</span><span class="p">),</span>
                <span class="p">)</span>
            <span class="p">)</span>

        <span class="c1"># Convert status string to enum</span>
        <span class="n">status_enum</span> <span class="o">=</span> <span class="n">MessageStatus</span><span class="o">.</span><span class="n">UNREAD</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">status_enum</span> <span class="o">=</span> <span class="n">MessageStatus</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="n">status_enum</span> <span class="o">=</span> <span class="n">MessageStatus</span><span class="o">.</span><span class="n">UNREAD</span>

        <span class="k">return</span> <span class="n">EmailMessage</span><span class="p">(</span>
            <span class="n">message_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">message_id</span><span class="p">,</span>
            <span class="n">subject</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">subject</span><span class="p">,</span>
            <span class="n">sender</span><span class="o">=</span><span class="n">sender_addr</span><span class="p">,</span>
            <span class="n">recipients</span><span class="o">=</span><span class="n">recipients_list</span><span class="p">,</span>
            <span class="n">cc_recipients</span><span class="o">=</span><span class="n">cc_list</span><span class="p">,</span>
            <span class="n">bcc_recipients</span><span class="o">=</span><span class="n">bcc_list</span><span class="p">,</span>
            <span class="n">body_text</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">body_text</span><span class="p">,</span>
            <span class="n">body_html</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">body_html</span><span class="p">,</span>
            <span class="n">date_sent</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">date_sent</span><span class="p">,</span>
            <span class="n">date_received</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">date_received</span><span class="p">,</span>
            <span class="n">status</span><span class="o">=</span><span class="n">status_enum</span><span class="p">,</span>
            <span class="n">attachments</span><span class="o">=</span><span class="n">attachments_list</span><span class="p">,</span>
            <span class="n">thread_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">thread_id</span><span class="p">,</span>
            <span class="n">conversation_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">conversation_id</span><span class="p">,</span>
            <span class="n">folder</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">folder</span><span class="p">,</span>
            <span class="n">metadata</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_email_message</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">email</span><span class="p">:</span> <span class="s2">&quot;EmailMessage&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;EmailMessageModel&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create EmailMessageModel from EmailMessage dataclass.</span>

<span class="sd">        Args:</span>
<span class="sd">            email: EmailMessage dataclass instance</span>

<span class="sd">        Returns:</span>
<span class="sd">            EmailMessageModel: EmailMessageModel Pydantic model instance</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Convert sender EmailAddress to EmailAddressModel</span>
        <span class="n">sender_model</span> <span class="o">=</span> <span class="n">EmailAddressModel</span><span class="o">.</span><span class="n">from_email_address</span><span class="p">(</span><span class="n">email</span><span class="o">.</span><span class="n">sender</span><span class="p">)</span>

        <span class="c1"># Convert recipients</span>
        <span class="n">recipients_list</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">EmailAddressModel</span><span class="o">.</span><span class="n">from_email_address</span><span class="p">(</span><span class="n">r</span><span class="p">)</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">email</span><span class="o">.</span><span class="n">recipients</span>
        <span class="p">]</span>
        <span class="n">cc_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">EmailAddressModel</span><span class="o">.</span><span class="n">from_email_address</span><span class="p">(</span><span class="n">r</span><span class="p">)</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">email</span><span class="o">.</span><span class="n">cc_recipients</span><span class="p">]</span>
        <span class="n">bcc_list</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">EmailAddressModel</span><span class="o">.</span><span class="n">from_email_address</span><span class="p">(</span><span class="n">r</span><span class="p">)</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">email</span><span class="o">.</span><span class="n">bcc_recipients</span>
        <span class="p">]</span>

        <span class="c1"># Convert attachments</span>
        <span class="n">attachments_list</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">{</span>
                <span class="s2">&quot;filename&quot;</span><span class="p">:</span> <span class="n">att</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span>
                <span class="s2">&quot;content_type&quot;</span><span class="p">:</span> <span class="n">att</span><span class="o">.</span><span class="n">content_type</span><span class="p">,</span>
                <span class="s2">&quot;size&quot;</span><span class="p">:</span> <span class="n">att</span><span class="o">.</span><span class="n">size</span><span class="p">,</span>
                <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="n">att</span><span class="o">.</span><span class="n">content</span><span class="p">,</span>
                <span class="s2">&quot;content_id&quot;</span><span class="p">:</span> <span class="n">att</span><span class="o">.</span><span class="n">content_id</span><span class="p">,</span>
            <span class="p">}</span>
            <span class="k">for</span> <span class="n">att</span> <span class="ow">in</span> <span class="n">email</span><span class="o">.</span><span class="n">attachments</span>
        <span class="p">]</span>

        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span>
            <span class="n">message_id</span><span class="o">=</span><span class="n">email</span><span class="o">.</span><span class="n">message_id</span><span class="p">,</span>
            <span class="n">subject</span><span class="o">=</span><span class="n">email</span><span class="o">.</span><span class="n">subject</span><span class="p">,</span>
            <span class="n">sender</span><span class="o">=</span><span class="n">sender_model</span><span class="p">,</span>
            <span class="n">recipients</span><span class="o">=</span><span class="n">recipients_list</span><span class="p">,</span>
            <span class="n">cc_recipients</span><span class="o">=</span><span class="n">cc_list</span><span class="p">,</span>
            <span class="n">bcc_recipients</span><span class="o">=</span><span class="n">bcc_list</span><span class="p">,</span>
            <span class="n">body_text</span><span class="o">=</span><span class="n">email</span><span class="o">.</span><span class="n">body_text</span><span class="p">,</span>
            <span class="n">body_html</span><span class="o">=</span><span class="n">email</span><span class="o">.</span><span class="n">body_html</span><span class="p">,</span>
            <span class="n">date_sent</span><span class="o">=</span><span class="n">email</span><span class="o">.</span><span class="n">date_sent</span><span class="p">,</span>
            <span class="n">date_received</span><span class="o">=</span><span class="n">email</span><span class="o">.</span><span class="n">date_received</span><span class="p">,</span>
            <span class="n">status</span><span class="o">=</span><span class="n">email</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">value</span> <span class="k">if</span> <span class="n">email</span><span class="o">.</span><span class="n">status</span> <span class="k">else</span> <span class="s2">&quot;unread&quot;</span><span class="p">,</span>
            <span class="n">attachments</span><span class="o">=</span><span class="n">attachments_list</span><span class="p">,</span>
            <span class="n">thread_id</span><span class="o">=</span><span class="n">email</span><span class="o">.</span><span class="n">thread_id</span><span class="p">,</span>
            <span class="n">conversation_id</span><span class="o">=</span><span class="n">email</span><span class="o">.</span><span class="n">conversation_id</span><span class="p">,</span>
            <span class="n">folder</span><span class="o">=</span><span class="n">email</span><span class="o">.</span><span class="n">folder</span><span class="p">,</span>
            <span class="n">metadata</span><span class="o">=</span><span class="n">email</span><span class="o">.</span><span class="n">metadata</span><span class="p">,</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h5 id="ragora.core.models.EmailMessageModel.from_email_message" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">from_email_message</span><span class="p">(</span><span class="n">email</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

<a href="#ragora.core.models.EmailMessageModel.from_email_message" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Create EmailMessageModel from EmailMessage dataclass.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>email</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="EmailMessage


  
      dataclass
   (ragora.utils.email_utils.models.EmailMessage)" href="#ragora.utils.email_utils.models.EmailMessage">EmailMessage</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>EmailMessage dataclass instance</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>EmailMessageModel</code></td>            <td>
                  <code><a class="autorefs autorefs-internal" title="EmailMessageModel (ragora.core.models.EmailMessageModel)" href="#ragora.core.models.EmailMessageModel">EmailMessageModel</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>EmailMessageModel Pydantic model instance</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/core/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">from_email_message</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">email</span><span class="p">:</span> <span class="s2">&quot;EmailMessage&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;EmailMessageModel&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create EmailMessageModel from EmailMessage dataclass.</span>

<span class="sd">    Args:</span>
<span class="sd">        email: EmailMessage dataclass instance</span>

<span class="sd">    Returns:</span>
<span class="sd">        EmailMessageModel: EmailMessageModel Pydantic model instance</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Convert sender EmailAddress to EmailAddressModel</span>
    <span class="n">sender_model</span> <span class="o">=</span> <span class="n">EmailAddressModel</span><span class="o">.</span><span class="n">from_email_address</span><span class="p">(</span><span class="n">email</span><span class="o">.</span><span class="n">sender</span><span class="p">)</span>

    <span class="c1"># Convert recipients</span>
    <span class="n">recipients_list</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">EmailAddressModel</span><span class="o">.</span><span class="n">from_email_address</span><span class="p">(</span><span class="n">r</span><span class="p">)</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">email</span><span class="o">.</span><span class="n">recipients</span>
    <span class="p">]</span>
    <span class="n">cc_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">EmailAddressModel</span><span class="o">.</span><span class="n">from_email_address</span><span class="p">(</span><span class="n">r</span><span class="p">)</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">email</span><span class="o">.</span><span class="n">cc_recipients</span><span class="p">]</span>
    <span class="n">bcc_list</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">EmailAddressModel</span><span class="o">.</span><span class="n">from_email_address</span><span class="p">(</span><span class="n">r</span><span class="p">)</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">email</span><span class="o">.</span><span class="n">bcc_recipients</span>
    <span class="p">]</span>

    <span class="c1"># Convert attachments</span>
    <span class="n">attachments_list</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="s2">&quot;filename&quot;</span><span class="p">:</span> <span class="n">att</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span>
            <span class="s2">&quot;content_type&quot;</span><span class="p">:</span> <span class="n">att</span><span class="o">.</span><span class="n">content_type</span><span class="p">,</span>
            <span class="s2">&quot;size&quot;</span><span class="p">:</span> <span class="n">att</span><span class="o">.</span><span class="n">size</span><span class="p">,</span>
            <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="n">att</span><span class="o">.</span><span class="n">content</span><span class="p">,</span>
            <span class="s2">&quot;content_id&quot;</span><span class="p">:</span> <span class="n">att</span><span class="o">.</span><span class="n">content_id</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="k">for</span> <span class="n">att</span> <span class="ow">in</span> <span class="n">email</span><span class="o">.</span><span class="n">attachments</span>
    <span class="p">]</span>

    <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span>
        <span class="n">message_id</span><span class="o">=</span><span class="n">email</span><span class="o">.</span><span class="n">message_id</span><span class="p">,</span>
        <span class="n">subject</span><span class="o">=</span><span class="n">email</span><span class="o">.</span><span class="n">subject</span><span class="p">,</span>
        <span class="n">sender</span><span class="o">=</span><span class="n">sender_model</span><span class="p">,</span>
        <span class="n">recipients</span><span class="o">=</span><span class="n">recipients_list</span><span class="p">,</span>
        <span class="n">cc_recipients</span><span class="o">=</span><span class="n">cc_list</span><span class="p">,</span>
        <span class="n">bcc_recipients</span><span class="o">=</span><span class="n">bcc_list</span><span class="p">,</span>
        <span class="n">body_text</span><span class="o">=</span><span class="n">email</span><span class="o">.</span><span class="n">body_text</span><span class="p">,</span>
        <span class="n">body_html</span><span class="o">=</span><span class="n">email</span><span class="o">.</span><span class="n">body_html</span><span class="p">,</span>
        <span class="n">date_sent</span><span class="o">=</span><span class="n">email</span><span class="o">.</span><span class="n">date_sent</span><span class="p">,</span>
        <span class="n">date_received</span><span class="o">=</span><span class="n">email</span><span class="o">.</span><span class="n">date_received</span><span class="p">,</span>
        <span class="n">status</span><span class="o">=</span><span class="n">email</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">value</span> <span class="k">if</span> <span class="n">email</span><span class="o">.</span><span class="n">status</span> <span class="k">else</span> <span class="s2">&quot;unread&quot;</span><span class="p">,</span>
        <span class="n">attachments</span><span class="o">=</span><span class="n">attachments_list</span><span class="p">,</span>
        <span class="n">thread_id</span><span class="o">=</span><span class="n">email</span><span class="o">.</span><span class="n">thread_id</span><span class="p">,</span>
        <span class="n">conversation_id</span><span class="o">=</span><span class="n">email</span><span class="o">.</span><span class="n">conversation_id</span><span class="p">,</span>
        <span class="n">folder</span><span class="o">=</span><span class="n">email</span><span class="o">.</span><span class="n">folder</span><span class="p">,</span>
        <span class="n">metadata</span><span class="o">=</span><span class="n">email</span><span class="o">.</span><span class="n">metadata</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="ragora.core.models.EmailMessageModel.get_all_recipients" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_all_recipients</span><span class="p">()</span></code>

<a href="#ragora.core.models.EmailMessageModel.get_all_recipients" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Get all recipients including CC and BCC.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.List">List</span>[<a class="autorefs autorefs-internal" title="EmailAddressModel (ragora.core.models.EmailAddressModel)" href="#ragora.core.models.EmailAddressModel">EmailAddressModel</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of EmailAddressModel instances (recipients + cc_recipients + bcc_recipients)</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/core/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_all_recipients</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">EmailAddressModel</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get all recipients including CC and BCC.</span>

<span class="sd">    Returns:</span>
<span class="sd">        List of EmailAddressModel instances (recipients + cc_recipients + bcc_recipients)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">recipients</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">cc_recipients</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">bcc_recipients</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="ragora.core.models.EmailMessageModel.get_body" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_body</span><span class="p">()</span></code>

<a href="#ragora.core.models.EmailMessageModel.get_body" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Get the best available body content (HTML preferred, fallback to text).</p>
<p>This method matches the EmailMessage.get_body() interface for compatibility.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>str</code></td>            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Email body content (HTML if available, otherwise text)</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/core/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_body</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the best available body content (HTML preferred, fallback to text).</span>

<span class="sd">    This method matches the EmailMessage.get_body() interface for compatibility.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: Email body content (HTML if available, otherwise text)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">body_html</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">body_html</span> <span class="k">else</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">body_text</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="ragora.core.models.EmailMessageModel.to_email_message" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">to_email_message</span><span class="p">()</span></code>

<a href="#ragora.core.models.EmailMessageModel.to_email_message" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Convert EmailMessageModel to EmailMessage dataclass.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>EmailMessage</code></td>            <td>
                  <code><a class="autorefs autorefs-internal" title="EmailMessage


  
      dataclass
   (ragora.utils.email_utils.models.EmailMessage)" href="#ragora.utils.email_utils.models.EmailMessage">EmailMessage</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>EmailMessage dataclass instance</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ImportError">ImportError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If email_utils.models cannot be imported</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/core/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">to_email_message</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;EmailMessage&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Convert EmailMessageModel to EmailMessage dataclass.</span>

<span class="sd">    Returns:</span>
<span class="sd">        EmailMessage: EmailMessage dataclass instance</span>

<span class="sd">    Raises:</span>
<span class="sd">        ImportError: If email_utils.models cannot be imported</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Convert sender EmailAddressModel to EmailAddress</span>
    <span class="n">sender_addr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sender</span><span class="o">.</span><span class="n">to_email_address</span><span class="p">()</span>

    <span class="c1"># Convert recipients</span>
    <span class="n">recipients_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">r</span><span class="o">.</span><span class="n">to_email_address</span><span class="p">()</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">recipients</span><span class="p">]</span>
    <span class="n">cc_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">r</span><span class="o">.</span><span class="n">to_email_address</span><span class="p">()</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cc_recipients</span><span class="p">]</span>
    <span class="n">bcc_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">r</span><span class="o">.</span><span class="n">to_email_address</span><span class="p">()</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">bcc_recipients</span><span class="p">]</span>

    <span class="c1"># Convert attachments</span>
    <span class="n">attachments_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">att</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">attachments</span><span class="p">:</span>
        <span class="n">attachments_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="n">EmailAttachment</span><span class="p">(</span>
                <span class="n">filename</span><span class="o">=</span><span class="n">att</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;filename&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
                <span class="n">content_type</span><span class="o">=</span><span class="n">att</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;content_type&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
                <span class="n">size</span><span class="o">=</span><span class="n">att</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;size&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                <span class="n">content</span><span class="o">=</span><span class="n">att</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;content&quot;</span><span class="p">),</span>
                <span class="n">content_id</span><span class="o">=</span><span class="n">att</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;content_id&quot;</span><span class="p">),</span>
            <span class="p">)</span>
        <span class="p">)</span>

    <span class="c1"># Convert status string to enum</span>
    <span class="n">status_enum</span> <span class="o">=</span> <span class="n">MessageStatus</span><span class="o">.</span><span class="n">UNREAD</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">status_enum</span> <span class="o">=</span> <span class="n">MessageStatus</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="n">status_enum</span> <span class="o">=</span> <span class="n">MessageStatus</span><span class="o">.</span><span class="n">UNREAD</span>

    <span class="k">return</span> <span class="n">EmailMessage</span><span class="p">(</span>
        <span class="n">message_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">message_id</span><span class="p">,</span>
        <span class="n">subject</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">subject</span><span class="p">,</span>
        <span class="n">sender</span><span class="o">=</span><span class="n">sender_addr</span><span class="p">,</span>
        <span class="n">recipients</span><span class="o">=</span><span class="n">recipients_list</span><span class="p">,</span>
        <span class="n">cc_recipients</span><span class="o">=</span><span class="n">cc_list</span><span class="p">,</span>
        <span class="n">bcc_recipients</span><span class="o">=</span><span class="n">bcc_list</span><span class="p">,</span>
        <span class="n">body_text</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">body_text</span><span class="p">,</span>
        <span class="n">body_html</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">body_html</span><span class="p">,</span>
        <span class="n">date_sent</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">date_sent</span><span class="p">,</span>
        <span class="n">date_received</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">date_received</span><span class="p">,</span>
        <span class="n">status</span><span class="o">=</span><span class="n">status_enum</span><span class="p">,</span>
        <span class="n">attachments</span><span class="o">=</span><span class="n">attachments_list</span><span class="p">,</span>
        <span class="n">thread_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">thread_id</span><span class="p">,</span>
        <span class="n">conversation_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">conversation_id</span><span class="p">,</span>
        <span class="n">folder</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">folder</span><span class="p">,</span>
        <span class="n">metadata</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="ragora.core.models.RetrievalMetadata" class="doc doc-heading">
            <code>RetrievalMetadata</code>


<a href="#ragora.core.models.RetrievalMetadata" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="pydantic.BaseModel">BaseModel</span></code></p>


        <p>Structured metadata for search results.</p>
<p>Extracts and organizes metadata fields from stored properties,
providing type-safe access to chunk, document, and email metadata.</p>








              <details class="quote">
                <summary>Source code in <code>ragora/ragora/core/models.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">RetrievalMetadata</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Structured metadata for search results.</span>

<span class="sd">    Extracts and organizes metadata fields from stored properties,</span>
<span class="sd">    providing type-safe access to chunk, document, and email metadata.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Chunk metadata</span>
    <span class="n">chunk_idx</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Chunk index&quot;</span><span class="p">)</span>
    <span class="n">chunk_size</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Chunk size&quot;</span><span class="p">)</span>
    <span class="n">total_chunks</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Total chunks in document&quot;</span>
    <span class="p">)</span>
    <span class="n">created_at</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Creation timestamp&quot;</span><span class="p">)</span>

    <span class="c1"># Document metadata</span>
    <span class="n">source_document</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Source document filename&quot;</span>
    <span class="p">)</span>
    <span class="n">page_number</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Page number&quot;</span><span class="p">)</span>
    <span class="n">section_title</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Section or chapter title&quot;</span>
    <span class="p">)</span>
    <span class="n">chunk_type</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Type of chunk (text, citation, equation, etc.)&quot;</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># Email metadata</span>
    <span class="n">email_subject</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Email subject line&quot;</span><span class="p">)</span>
    <span class="n">email_sender</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Email sender address&quot;</span>
    <span class="p">)</span>
    <span class="n">email_recipient</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Email recipient address&quot;</span>
    <span class="p">)</span>
    <span class="n">email_date</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Email timestamp&quot;</span><span class="p">)</span>
    <span class="n">email_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Unique email identifier&quot;</span><span class="p">)</span>
    <span class="n">email_folder</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Email folder/path&quot;</span><span class="p">)</span>

    <span class="c1"># Custom metadata</span>
    <span class="n">custom_metadata</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Custom metadata dictionary&quot;</span>
    <span class="p">)</span>
    <span class="n">language</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Content language (e.g., en, es, fr)&quot;</span>
    <span class="p">)</span>
    <span class="n">domain</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Content domain (e.g., scientific, legal, medical)&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">confidence</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Processing confidence score (0.0-1.0)&quot;</span>
    <span class="p">)</span>
    <span class="n">tags</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Comma-separated tags/categories&quot;</span>
    <span class="p">)</span>
    <span class="n">priority</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Content priority/importance level&quot;</span>
    <span class="p">)</span>
    <span class="n">content_category</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Fine-grained content categorization&quot;</span>
    <span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_properties</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">properties</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="s2">&quot;RetrievalMetadata&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create RetrievalMetadata from properties dictionary.</span>

<span class="sd">        Args:</span>
<span class="sd">            properties: Dictionary containing stored properties</span>

<span class="sd">        Returns:</span>
<span class="sd">            RetrievalMetadata instance</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Parse custom_metadata JSON string if present</span>
        <span class="n">custom_meta</span> <span class="o">=</span> <span class="n">properties</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;custom_metadata&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">custom_meta</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">custom_meta</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">custom_meta</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">custom_meta</span><span class="p">)</span> <span class="k">if</span> <span class="n">custom_meta</span> <span class="k">else</span> <span class="kc">None</span>
                <span class="k">except</span> <span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">JSONDecodeError</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">):</span>
                    <span class="n">custom_meta</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">custom_meta</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="n">custom_meta</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">custom_meta</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span>
            <span class="n">chunk_idx</span><span class="o">=</span><span class="n">properties</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;metadata_chunk_idx&quot;</span><span class="p">),</span>
            <span class="n">chunk_size</span><span class="o">=</span><span class="n">properties</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;metadata_chunk_size&quot;</span><span class="p">),</span>
            <span class="n">total_chunks</span><span class="o">=</span><span class="n">properties</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;metadata_total_chunks&quot;</span><span class="p">),</span>
            <span class="n">created_at</span><span class="o">=</span><span class="n">properties</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;metadata_created_at&quot;</span><span class="p">)</span>
            <span class="ow">or</span> <span class="n">properties</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;created_at&quot;</span><span class="p">),</span>
            <span class="n">source_document</span><span class="o">=</span><span class="n">properties</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;source_document&quot;</span><span class="p">),</span>
            <span class="n">page_number</span><span class="o">=</span><span class="n">properties</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;page_number&quot;</span><span class="p">),</span>
            <span class="n">section_title</span><span class="o">=</span><span class="n">properties</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;section_title&quot;</span><span class="p">),</span>
            <span class="n">chunk_type</span><span class="o">=</span><span class="n">properties</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;chunk_type&quot;</span><span class="p">),</span>
            <span class="n">email_subject</span><span class="o">=</span><span class="n">properties</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;email_subject&quot;</span><span class="p">),</span>
            <span class="n">email_sender</span><span class="o">=</span><span class="n">properties</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;email_sender&quot;</span><span class="p">),</span>
            <span class="n">email_recipient</span><span class="o">=</span><span class="n">properties</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;email_recipient&quot;</span><span class="p">),</span>
            <span class="n">email_date</span><span class="o">=</span><span class="n">properties</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;email_date&quot;</span><span class="p">),</span>
            <span class="n">email_id</span><span class="o">=</span><span class="n">properties</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;email_id&quot;</span><span class="p">),</span>
            <span class="n">email_folder</span><span class="o">=</span><span class="n">properties</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;email_folder&quot;</span><span class="p">),</span>
            <span class="n">custom_metadata</span><span class="o">=</span><span class="n">custom_meta</span><span class="p">,</span>
            <span class="n">language</span><span class="o">=</span><span class="n">properties</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;language&quot;</span><span class="p">),</span>
            <span class="n">domain</span><span class="o">=</span><span class="n">properties</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;domain&quot;</span><span class="p">),</span>
            <span class="n">confidence</span><span class="o">=</span><span class="n">properties</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;confidence&quot;</span><span class="p">),</span>
            <span class="n">tags</span><span class="o">=</span><span class="n">properties</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;tags&quot;</span><span class="p">),</span>
            <span class="n">priority</span><span class="o">=</span><span class="n">properties</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;priority&quot;</span><span class="p">),</span>
            <span class="n">content_category</span><span class="o">=</span><span class="n">properties</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;content_category&quot;</span><span class="p">),</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h5 id="ragora.core.models.RetrievalMetadata.from_properties" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">from_properties</span><span class="p">(</span><span class="n">properties</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

<a href="#ragora.core.models.RetrievalMetadata.from_properties" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Create RetrievalMetadata from properties dictionary.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>properties</code>
            </td>
            <td>
                  <code><span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dictionary containing stored properties</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="RetrievalMetadata (ragora.core.models.RetrievalMetadata)" href="#ragora.core.models.RetrievalMetadata">RetrievalMetadata</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>RetrievalMetadata instance</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/core/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">from_properties</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">properties</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="s2">&quot;RetrievalMetadata&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create RetrievalMetadata from properties dictionary.</span>

<span class="sd">    Args:</span>
<span class="sd">        properties: Dictionary containing stored properties</span>

<span class="sd">    Returns:</span>
<span class="sd">        RetrievalMetadata instance</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Parse custom_metadata JSON string if present</span>
    <span class="n">custom_meta</span> <span class="o">=</span> <span class="n">properties</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;custom_metadata&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">custom_meta</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">custom_meta</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">custom_meta</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">custom_meta</span><span class="p">)</span> <span class="k">if</span> <span class="n">custom_meta</span> <span class="k">else</span> <span class="kc">None</span>
            <span class="k">except</span> <span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">JSONDecodeError</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">):</span>
                <span class="n">custom_meta</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">custom_meta</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="n">custom_meta</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">custom_meta</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span>
        <span class="n">chunk_idx</span><span class="o">=</span><span class="n">properties</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;metadata_chunk_idx&quot;</span><span class="p">),</span>
        <span class="n">chunk_size</span><span class="o">=</span><span class="n">properties</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;metadata_chunk_size&quot;</span><span class="p">),</span>
        <span class="n">total_chunks</span><span class="o">=</span><span class="n">properties</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;metadata_total_chunks&quot;</span><span class="p">),</span>
        <span class="n">created_at</span><span class="o">=</span><span class="n">properties</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;metadata_created_at&quot;</span><span class="p">)</span>
        <span class="ow">or</span> <span class="n">properties</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;created_at&quot;</span><span class="p">),</span>
        <span class="n">source_document</span><span class="o">=</span><span class="n">properties</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;source_document&quot;</span><span class="p">),</span>
        <span class="n">page_number</span><span class="o">=</span><span class="n">properties</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;page_number&quot;</span><span class="p">),</span>
        <span class="n">section_title</span><span class="o">=</span><span class="n">properties</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;section_title&quot;</span><span class="p">),</span>
        <span class="n">chunk_type</span><span class="o">=</span><span class="n">properties</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;chunk_type&quot;</span><span class="p">),</span>
        <span class="n">email_subject</span><span class="o">=</span><span class="n">properties</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;email_subject&quot;</span><span class="p">),</span>
        <span class="n">email_sender</span><span class="o">=</span><span class="n">properties</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;email_sender&quot;</span><span class="p">),</span>
        <span class="n">email_recipient</span><span class="o">=</span><span class="n">properties</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;email_recipient&quot;</span><span class="p">),</span>
        <span class="n">email_date</span><span class="o">=</span><span class="n">properties</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;email_date&quot;</span><span class="p">),</span>
        <span class="n">email_id</span><span class="o">=</span><span class="n">properties</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;email_id&quot;</span><span class="p">),</span>
        <span class="n">email_folder</span><span class="o">=</span><span class="n">properties</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;email_folder&quot;</span><span class="p">),</span>
        <span class="n">custom_metadata</span><span class="o">=</span><span class="n">custom_meta</span><span class="p">,</span>
        <span class="n">language</span><span class="o">=</span><span class="n">properties</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;language&quot;</span><span class="p">),</span>
        <span class="n">domain</span><span class="o">=</span><span class="n">properties</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;domain&quot;</span><span class="p">),</span>
        <span class="n">confidence</span><span class="o">=</span><span class="n">properties</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;confidence&quot;</span><span class="p">),</span>
        <span class="n">tags</span><span class="o">=</span><span class="n">properties</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;tags&quot;</span><span class="p">),</span>
        <span class="n">priority</span><span class="o">=</span><span class="n">properties</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;priority&quot;</span><span class="p">),</span>
        <span class="n">content_category</span><span class="o">=</span><span class="n">properties</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;content_category&quot;</span><span class="p">),</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="ragora.core.models.RetrievalResultItem" class="doc doc-heading">
            <code>RetrievalResultItem</code>


<a href="#ragora.core.models.RetrievalResultItem" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="pydantic.BaseModel">BaseModel</span></code></p>


        <p>Base class for all chunk retrieval results.</p>
<p>Contains common fields shared by both direct retrieval and search
results. This base class provides the core chunk data without
retrieval-specific context.</p>








              <details class="quote">
                <summary>Source code in <code>ragora/ragora/core/models.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">RetrievalResultItem</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Base class for all chunk retrieval results.</span>

<span class="sd">    Contains common fields shared by both direct retrieval and search</span>
<span class="sd">    results. This base class provides the core chunk data without</span>
<span class="sd">    retrieval-specific context.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Core content</span>
    <span class="n">content</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Text content of the chunk&quot;</span><span class="p">)</span>
    <span class="n">chunk_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Unique chunk identifier&quot;</span><span class="p">)</span>

    <span class="c1"># All stored properties (full dict for backward compatibility)</span>
    <span class="n">properties</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="n">default_factory</span><span class="o">=</span><span class="nb">dict</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;All stored properties from the vector database&quot;</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># Structured metadata</span>
    <span class="n">metadata</span><span class="p">:</span> <span class="n">RetrievalMetadata</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="n">default_factory</span><span class="o">=</span><span class="n">RetrievalMetadata</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Structured metadata extracted from properties&quot;</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="ragora.core.models.SearchResultItem" class="doc doc-heading">
            <code>SearchResultItem</code>


<a href="#ragora.core.models.SearchResultItem" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="RetrievalResultItem (ragora.core.models.RetrievalResultItem)" href="#ragora.core.models.RetrievalResultItem">RetrievalResultItem</a></code></p>


        <p>Search result item extending base retrieval result.</p>
<p>Adds search-specific context: scores, retrieval method, and timestamp.
Score fields correspond to Weaviate GraphQL search operators
(<a href="https://weaviate.io/developers/weaviate/api/graphql/search-operators">https://weaviate.io/developers/weaviate/api/graphql/search-operators</a>):</p>
<ul>
<li><code>distance</code> - metadata from <code>collection.query.near_text</code> (lower is
  closer)</li>
<li><code>hybrid_score</code> - metadata from <code>collection.query.hybrid</code> (alpha mix)</li>
<li><code>bm25_score</code> - metadata from <code>collection.query.bm25</code> (lexical match)</li>
<li><code>similarity_score</code> - derived <code>1 - distance</code> for vector/hybrid
  results; keyword searches leave it empty</li>
</ul>








              <details class="quote">
                <summary>Source code in <code>ragora/ragora/core/models.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">SearchResultItem</span><span class="p">(</span><span class="n">RetrievalResultItem</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Search result item extending base retrieval result.</span>

<span class="sd">    Adds search-specific context: scores, retrieval method, and timestamp.</span>
<span class="sd">    Score fields correspond to Weaviate GraphQL search operators</span>
<span class="sd">    (https://weaviate.io/developers/weaviate/api/graphql/search-operators):</span>

<span class="sd">    * ``distance`` - metadata from ``collection.query.near_text`` (lower is</span>
<span class="sd">      closer)</span>
<span class="sd">    * ``hybrid_score`` - metadata from ``collection.query.hybrid`` (alpha mix)</span>
<span class="sd">    * ``bm25_score`` - metadata from ``collection.query.bm25`` (lexical match)</span>
<span class="sd">    * ``similarity_score`` - derived ``1 - distance`` for vector/hybrid</span>
<span class="sd">      results; keyword searches leave it empty</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Retrieval scores</span>
    <span class="n">similarity_score</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">ge</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
        <span class="n">le</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="p">(</span>
            <span class="s2">&quot;Vector similarity in the 0-1 range. Populated for near_text and &quot;</span>
            <span class="s2">&quot;hybrid results as 1 - distance. Keyword (BM25) searches leave it &quot;</span>
            <span class="s2">&quot;empty.&quot;</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="n">distance</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="p">(</span>
            <span class="s2">&quot;Raw vector distance returned by Weaviate near_text queries. &quot;</span>
            <span class="s2">&quot;Lower values indicate higher semantic similarity.&quot;</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="n">hybrid_score</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="p">(</span>
            <span class="s2">&quot;Combined relevance from Weaviate hybrid search. Represents the &quot;</span>
            <span class="s2">&quot;alpha-weighted blend of vector similarity and BM25 scores.&quot;</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="n">bm25_score</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="p">(</span>
            <span class="s2">&quot;Unbounded BM25 relevance score returned by Weaviate bm25 queries. &quot;</span>
            <span class="s2">&quot;Higher values indicate stronger lexical matches.&quot;</span>
        <span class="p">),</span>
    <span class="p">)</span>

    <span class="c1"># Retrieval context</span>
    <span class="n">retrieval_method</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span>
        <span class="s2">&quot;vector_similarity&quot;</span><span class="p">,</span> <span class="s2">&quot;hybrid_search&quot;</span><span class="p">,</span> <span class="s2">&quot;keyword_search&quot;</span>
    <span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Method used for retrieval&quot;</span><span class="p">)</span>
    <span class="n">retrieval_timestamp</span><span class="p">:</span> <span class="n">datetime</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="n">default_factory</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Timestamp when retrieval occurred&quot;</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># Convenience properties for email results</span>
    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">subject</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Email subject (if applicable).&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">properties</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;email_subject&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">email_subject</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">sender</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Email sender (if applicable).&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">properties</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;email_sender&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">email_sender</span>

    <span class="nd">@field_validator</span><span class="p">(</span><span class="s2">&quot;retrieval_timestamp&quot;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;before&quot;</span><span class="p">)</span>
    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">parse_timestamp</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">v</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">datetime</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Parse timestamp from string or datetime.</span>

<span class="sd">        Args:</span>
<span class="sd">            v: Timestamp value (datetime or ISO format string)</span>

<span class="sd">        Returns:</span>
<span class="sd">            datetime: Parsed datetime object</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If the value cannot be parsed into a valid datetime</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">datetime</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">v</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">datetime</span><span class="o">.</span><span class="n">fromisoformat</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;Z&quot;</span><span class="p">,</span> <span class="s2">&quot;+00:00&quot;</span><span class="p">))</span>
            <span class="k">except</span> <span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="ne">AttributeError</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Invalid timestamp string format: </span><span class="si">{</span><span class="n">v</span><span class="si">}</span><span class="s2">. &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;Expected ISO 8601 format (e.g., &#39;2024-01-15T14:30:00Z&#39;).&quot;</span>
                <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>
        <span class="k">if</span> <span class="n">v</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;retrieval_timestamp cannot be None. &quot;</span>
                <span class="s2">&quot;If not provided, it will default to the current time.&quot;</span>
            <span class="p">)</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Invalid timestamp type: </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">. &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;Expected datetime or ISO 8601 format string.&quot;</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h5 id="ragora.core.models.SearchResultItem.sender" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">sender</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#ragora.core.models.SearchResultItem.sender" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Email sender (if applicable).</p>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="ragora.core.models.SearchResultItem.subject" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">subject</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#ragora.core.models.SearchResultItem.subject" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Email subject (if applicable).</p>

    </div>

</div>




<div class="doc doc-object doc-function">


<h5 id="ragora.core.models.SearchResultItem.parse_timestamp" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">parse_timestamp</span><span class="p">(</span><span class="n">v</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

<a href="#ragora.core.models.SearchResultItem.parse_timestamp" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Parse timestamp from string or datetime.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>v</code>
            </td>
            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Timestamp value (datetime or ISO format string)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>datetime</code></td>            <td>
                  <code><span title="datetime.datetime">datetime</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Parsed datetime object</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If the value cannot be parsed into a valid datetime</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/core/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@field_validator</span><span class="p">(</span><span class="s2">&quot;retrieval_timestamp&quot;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;before&quot;</span><span class="p">)</span>
<span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">parse_timestamp</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">v</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">datetime</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Parse timestamp from string or datetime.</span>

<span class="sd">    Args:</span>
<span class="sd">        v: Timestamp value (datetime or ISO format string)</span>

<span class="sd">    Returns:</span>
<span class="sd">        datetime: Parsed datetime object</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If the value cannot be parsed into a valid datetime</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">datetime</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">v</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">datetime</span><span class="o">.</span><span class="n">fromisoformat</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;Z&quot;</span><span class="p">,</span> <span class="s2">&quot;+00:00&quot;</span><span class="p">))</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="ne">AttributeError</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Invalid timestamp string format: </span><span class="si">{</span><span class="n">v</span><span class="si">}</span><span class="s2">. &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;Expected ISO 8601 format (e.g., &#39;2024-01-15T14:30:00Z&#39;).&quot;</span>
            <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>
    <span class="k">if</span> <span class="n">v</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;retrieval_timestamp cannot be None. &quot;</span>
            <span class="s2">&quot;If not provided, it will default to the current time.&quot;</span>
        <span class="p">)</span>
    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;Invalid timestamp type: </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">. &quot;</span>
        <span class="sa">f</span><span class="s2">&quot;Expected datetime or ISO 8601 format string.&quot;</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div><h3 id="retriever">Retriever<a class="headerlink" href="#retriever" title="Permanent link">&para;</a></h3>


<div class="doc doc-object doc-module">



<a id="ragora.core.retriever"></a>
    <div class="doc doc-contents first">

        <p>Search utilities that power Ragora retrieval workflows.</p>
<p>The :class:<code>Retriever</code> encapsulates vector, keyword, and hybrid search strategies
while delegating persistence to :class:<code>~ragora.core.database_manager.DatabaseManager</code>.</p>










  <div class="doc doc-children">









<div class="doc doc-object doc-class">



<h4 id="ragora.core.retriever.Retriever" class="doc doc-heading">
            <code>Retriever</code>


<a href="#ragora.core.retriever.Retriever" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">


        <p>Encapsulates reusable retrieval strategies for Ragora.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="ragora.core.retriever.Retriever.db_manager">db_manager</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Database access layer.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="ragora.core.retriever.Retriever.embedding_engine">embedding_engine</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional embedding provider for custom workflows.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="ragora.core.retriever.Retriever.logger">logger</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Logger used for diagnostic output.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">ragora.core.database_manager</span><span class="w"> </span><span class="kn">import</span> <span class="n">DatabaseManager</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">ragora.core.retriever</span><span class="w"> </span><span class="kn">import</span> <span class="n">Retriever</span>

<span class="n">db</span> <span class="o">=</span> <span class="n">DatabaseManager</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="s2">&quot;http://localhost:8080&quot;</span><span class="p">)</span>
<span class="n">retriever</span> <span class="o">=</span> <span class="n">Retriever</span><span class="p">(</span><span class="n">db_manager</span><span class="o">=</span><span class="n">db</span><span class="p">)</span>
<span class="n">hits</span> <span class="o">=</span> <span class="n">retriever</span><span class="o">.</span><span class="n">search_similar</span><span class="p">(</span><span class="s2">&quot;neural networks&quot;</span><span class="p">,</span> <span class="n">collection</span><span class="o">=</span><span class="s2">&quot;Document&quot;</span><span class="p">)</span>
</code></pre></div>








              <details class="quote">
                <summary>Source code in <code>ragora/ragora/core/retriever.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">Retriever</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Encapsulates reusable retrieval strategies for Ragora.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        db_manager: Database access layer.</span>
<span class="sd">        embedding_engine: Optional embedding provider for custom workflows.</span>
<span class="sd">        logger: Logger used for diagnostic output.</span>

<span class="sd">    Examples:</span>
<span class="sd">        ```python</span>
<span class="sd">        from ragora.core.database_manager import DatabaseManager</span>
<span class="sd">        from ragora.core.retriever import Retriever</span>

<span class="sd">        db = DatabaseManager(url=&quot;http://localhost:8080&quot;)</span>
<span class="sd">        retriever = Retriever(db_manager=db)</span>
<span class="sd">        hits = retriever.search_similar(&quot;neural networks&quot;, collection=&quot;Document&quot;)</span>
<span class="sd">        ```</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">db_manager</span><span class="p">:</span> <span class="n">DatabaseManager</span><span class="p">,</span>
        <span class="n">embedding_engine</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">EmbeddingEngine</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the Retriever.</span>

<span class="sd">        Args:</span>
<span class="sd">            db_manager: DatabaseManager instance for database access</span>
<span class="sd">            embedding_engine: EmbeddingEngine instance</span>
<span class="sd">                (optional, defaults to None)</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If db_manager is None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">db_manager</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;DatabaseManager cannot be None&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">db_manager</span> <span class="o">=</span> <span class="n">db_manager</span>

        <span class="c1"># Note: Embedding engine is not needed when using Weaviate&#39;s</span>
        <span class="c1"># text2vec-transformers. Weaviate handles embeddings server-side.</span>
        <span class="c1"># EmbeddingEngine is only kept for potential future use cases where</span>
        <span class="c1"># client-side embeddings might be needed. DO NOT initialize it by</span>
        <span class="c1"># default to avoid unnecessary model loading.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">embedding_engine</span> <span class="o">=</span> <span class="n">embedding_engine</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">search_similar</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">query</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">collection</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">top_k</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
        <span class="n">score_threshold</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
        <span class="nb">filter</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Filter</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">SearchResultItem</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Search for similar documents using vector similarity.</span>

<span class="sd">        This method performs semantic search using vector embeddings to find</span>
<span class="sd">        documents that are semantically similar to the query.</span>

<span class="sd">        Args:</span>
<span class="sd">            query: Search query text</span>
<span class="sd">            collection: Collection name to search</span>
<span class="sd">            top_k: Number of results to return</span>
<span class="sd">            score_threshold: Minimum similarity score threshold</span>
<span class="sd">            filter: Optional Weaviate Filter object to filter results</span>

<span class="sd">        Returns:</span>
<span class="sd">            List[SearchResultItem]: List of search result items</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If query is empty</span>

<span class="sd">        Examples:</span>
<span class="sd">            ```python</span>
<span class="sd">            hits = retriever.search_similar(&quot;rag pipeline&quot;, &quot;Document&quot;, top_k=10)</span>
<span class="sd">            ```</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">query</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">query</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Query cannot be empty&quot;</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Performing vector similarity search: &#39;</span><span class="si">{</span><span class="n">query</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>

            <span class="c1"># Preprocess query for better results</span>
            <span class="n">processed_query</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_preprocess_query</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>

            <span class="c1"># Get collection and execute search using Weaviate APIs</span>
            <span class="n">collection</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">db_manager</span><span class="o">.</span><span class="n">get_collection</span><span class="p">(</span><span class="n">collection</span><span class="p">)</span>

            <span class="c1"># Use Weaviate&#39;s native near_text API</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">collection</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">near_text</span><span class="p">(</span>
                <span class="n">query</span><span class="o">=</span><span class="n">processed_query</span><span class="p">,</span>
                <span class="n">limit</span><span class="o">=</span><span class="n">top_k</span><span class="p">,</span>
                <span class="n">return_metadata</span><span class="o">=</span><span class="n">MetadataQuery</span><span class="p">(</span><span class="n">distance</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
                <span class="n">filters</span><span class="o">=</span><span class="nb">filter</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="c1"># Process results</span>
            <span class="n">processed_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_process_vector_results</span><span class="p">(</span>
                <span class="n">result</span><span class="o">.</span><span class="n">objects</span><span class="p">,</span> <span class="n">score_threshold</span>
            <span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Found </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">processed_results</span><span class="p">)</span><span class="si">}</span><span class="s2"> similar results for: &#39;</span><span class="si">{</span><span class="n">query</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="n">processed_results</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Vector similarity search failed: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">raise</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">search_hybrid</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">query</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">collection</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">top_k</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
        <span class="n">alpha</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span>
        <span class="n">score_threshold</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
        <span class="nb">filter</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Filter</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">SearchResultItem</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Perform hybrid search combining vector and keyword search.</span>

<span class="sd">        This method combines semantic similarity search with traditional</span>
<span class="sd">        keyword search to provide more comprehensive results.</span>

<span class="sd">        Args:</span>
<span class="sd">            query: Search query text</span>
<span class="sd">            collection: Collection name to search</span>
<span class="sd">            top_k: Number of results to return</span>
<span class="sd">            alpha: Weight for vector search (0.0 = keyword only,</span>
<span class="sd">                1.0 = vector only)</span>
<span class="sd">            score_threshold: Minimum similarity score threshold</span>
<span class="sd">            filter: Optional Weaviate Filter object to filter results</span>
<span class="sd">                by properties</span>

<span class="sd">        Returns:</span>
<span class="sd">            List[SearchResultItem]: List of search result items</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If query is empty or alpha is out of range</span>

<span class="sd">        Examples:</span>
<span class="sd">            ```python</span>
<span class="sd">            hits = retriever.search_hybrid(</span>
<span class="sd">                &quot;retrieval strategies&quot;,</span>
<span class="sd">                collection=&quot;Document&quot;,</span>
<span class="sd">                alpha=0.7,</span>
<span class="sd">            )</span>
<span class="sd">            ```</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">query</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">query</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Query cannot be empty&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="mf">0.0</span> <span class="o">&lt;=</span> <span class="n">alpha</span> <span class="o">&lt;=</span> <span class="mf">1.0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Alpha must be between 0.0 and 1.0&quot;</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Performing hybrid search: &#39;</span><span class="si">{</span><span class="n">query</span><span class="si">}</span><span class="s2">&#39; with alpha=</span><span class="si">{</span><span class="n">alpha</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="c1"># Preprocess query for better results</span>
            <span class="n">processed_query</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_preprocess_query</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>

            <span class="c1"># Get collection and execute hybrid search using Weaviate APIs</span>
            <span class="n">collection</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">db_manager</span><span class="o">.</span><span class="n">get_collection</span><span class="p">(</span><span class="n">collection</span><span class="p">)</span>

            <span class="c1"># Use Weaviate&#39;s native hybrid API</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">collection</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">hybrid</span><span class="p">(</span>
                <span class="n">query</span><span class="o">=</span><span class="n">processed_query</span><span class="p">,</span>
                <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span>
                <span class="n">limit</span><span class="o">=</span><span class="n">top_k</span><span class="p">,</span>
                <span class="n">return_metadata</span><span class="o">=</span><span class="n">MetadataQuery</span><span class="p">(</span><span class="n">score</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
                <span class="n">filters</span><span class="o">=</span><span class="nb">filter</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="c1"># Process results</span>
            <span class="n">processed_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_process_hybrid_results</span><span class="p">(</span>
                <span class="n">result</span><span class="o">.</span><span class="n">objects</span><span class="p">,</span> <span class="n">score_threshold</span>
            <span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Found </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">processed_results</span><span class="p">)</span><span class="si">}</span><span class="s2"> hybrid results for: &#39;</span><span class="si">{</span><span class="n">query</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="n">processed_results</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Hybrid search failed: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">raise</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_preprocess_query</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Preprocess query for better search results.</span>

<span class="sd">        Args:</span>
<span class="sd">            query: Original query text</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: Preprocessed query text</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Basic preprocessing - normalize whitespace and case</span>
        <span class="kn">import</span><span class="w"> </span><span class="nn">re</span>

        <span class="n">processed</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\s+&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="n">query</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
        <span class="n">processed</span> <span class="o">=</span> <span class="n">processed</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">processed</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">search_keyword</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">query</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">collection</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">top_k</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
        <span class="n">score_threshold</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
        <span class="nb">filter</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Filter</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">SearchResultItem</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Perform keyword search using BM25 algorithm.</span>

<span class="sd">        This method performs traditional keyword search using BM25 algorithm</span>
<span class="sd">        to find documents containing specific keywords.</span>

<span class="sd">        Args:</span>
<span class="sd">            query: Search query text</span>
<span class="sd">            collection: Collection name to search</span>
<span class="sd">            top_k: Number of results to return</span>
<span class="sd">            score_threshold: Minimum similarity score threshold</span>
<span class="sd">            filter: Optional Weaviate Filter object to filter results</span>
<span class="sd">                by properties</span>

<span class="sd">        Returns:</span>
<span class="sd">            List[SearchResultItem]: List of search result items</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If query is empty</span>

<span class="sd">        Examples:</span>
<span class="sd">            ```python</span>
<span class="sd">            hits = retriever.search_keyword(&quot;BM25 overview&quot;, &quot;Document&quot;, top_k=3)</span>
<span class="sd">            ```</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">query</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">query</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Query cannot be empty&quot;</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Performing keyword search: &#39;</span><span class="si">{</span><span class="n">query</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>

            <span class="c1"># Preprocess query for better results</span>
            <span class="n">processed_query</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_preprocess_query</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>

            <span class="c1"># Get collection and execute keyword search using Weaviate APIs</span>
            <span class="n">collection</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">db_manager</span><span class="o">.</span><span class="n">get_collection</span><span class="p">(</span><span class="n">collection</span><span class="p">)</span>

            <span class="c1"># Use Weaviate&#39;s native BM25 API</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">collection</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">bm25</span><span class="p">(</span>
                <span class="n">query</span><span class="o">=</span><span class="n">processed_query</span><span class="p">,</span>
                <span class="n">limit</span><span class="o">=</span><span class="n">top_k</span><span class="p">,</span>
                <span class="n">return_metadata</span><span class="o">=</span><span class="n">MetadataQuery</span><span class="p">(</span><span class="n">score</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
                <span class="n">filters</span><span class="o">=</span><span class="nb">filter</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="c1"># Process results</span>
            <span class="n">processed_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_process_keyword_results</span><span class="p">(</span>
                <span class="n">result</span><span class="o">.</span><span class="n">objects</span><span class="p">,</span> <span class="n">score_threshold</span>
            <span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Found </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">processed_results</span><span class="p">)</span><span class="si">}</span><span class="s2"> keyword results for: &#39;</span><span class="si">{</span><span class="n">query</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="n">processed_results</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Keyword search failed: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">raise</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_process_vector_results</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">objects</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Any</span><span class="p">],</span> <span class="n">score_threshold</span><span class="p">:</span> <span class="nb">float</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">SearchResultItem</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Process vector search results from Weaviate.</span>

<span class="sd">        Args:</span>
<span class="sd">            objects: Raw Weaviate objects</span>
<span class="sd">            score_threshold: Minimum score threshold</span>

<span class="sd">        Returns:</span>
<span class="sd">            List[SearchResultItem]: Processed results</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">objects</span><span class="p">:</span>
            <span class="c1"># Calculate similarity score from distance</span>
            <span class="n">distance</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">obj</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">distance</span> <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">metadata</span> <span class="ow">and</span> <span class="n">obj</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">distance</span> <span class="k">else</span> <span class="mf">1.0</span>
            <span class="p">)</span>
            <span class="n">similarity_score</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="n">distance</span>

            <span class="k">if</span> <span class="n">similarity_score</span> <span class="o">&gt;=</span> <span class="n">score_threshold</span><span class="p">:</span>
                <span class="c1"># Build a consistent result that includes all stored properties</span>
                <span class="n">properties</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">properties</span> <span class="ow">or</span> <span class="p">{})</span>

                <span class="c1"># Create RetrievalMetadata from properties</span>
                <span class="n">metadata</span> <span class="o">=</span> <span class="n">RetrievalMetadata</span><span class="o">.</span><span class="n">from_properties</span><span class="p">(</span><span class="n">properties</span><span class="p">)</span>

                <span class="c1"># Build SearchResultItem</span>
                <span class="n">result</span> <span class="o">=</span> <span class="n">SearchResultItem</span><span class="p">(</span>
                    <span class="n">content</span><span class="o">=</span><span class="n">properties</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;content&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
                    <span class="n">chunk_id</span><span class="o">=</span><span class="n">properties</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;chunk_id&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
                    <span class="n">properties</span><span class="o">=</span><span class="n">properties</span><span class="p">,</span>
                    <span class="n">similarity_score</span><span class="o">=</span><span class="n">similarity_score</span><span class="p">,</span>
                    <span class="n">distance</span><span class="o">=</span><span class="n">distance</span><span class="p">,</span>
                    <span class="n">retrieval_method</span><span class="o">=</span><span class="s2">&quot;vector_similarity&quot;</span><span class="p">,</span>
                    <span class="n">retrieval_timestamp</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_current_timestamp</span><span class="p">(),</span>
                    <span class="n">metadata</span><span class="o">=</span><span class="n">metadata</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

        <span class="c1"># Sort by similarity score (highest first)</span>
        <span class="n">results</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">similarity_score</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">results</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_process_hybrid_results</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">objects</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Any</span><span class="p">],</span> <span class="n">score_threshold</span><span class="p">:</span> <span class="nb">float</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">SearchResultItem</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Process hybrid search results from Weaviate.</span>

<span class="sd">        Args:</span>
<span class="sd">            objects: Raw Weaviate objects</span>
<span class="sd">            score_threshold: Minimum score threshold</span>

<span class="sd">        Returns:</span>
<span class="sd">            List[SearchResultItem]: Processed results</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">objects</span><span class="p">:</span>
            <span class="c1"># Get hybrid score</span>
            <span class="n">hybrid_score</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">obj</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">score</span> <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">metadata</span> <span class="ow">and</span> <span class="n">obj</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">score</span> <span class="k">else</span> <span class="mf">0.0</span>
            <span class="p">)</span>

            <span class="k">if</span> <span class="n">hybrid_score</span> <span class="o">&gt;=</span> <span class="n">score_threshold</span><span class="p">:</span>
                <span class="c1"># Build a consistent result that includes all stored properties</span>
                <span class="n">properties</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">properties</span> <span class="ow">or</span> <span class="p">{})</span>

                <span class="c1"># Create RetrievalMetadata from properties</span>
                <span class="n">metadata</span> <span class="o">=</span> <span class="n">RetrievalMetadata</span><span class="o">.</span><span class="n">from_properties</span><span class="p">(</span><span class="n">properties</span><span class="p">)</span>

                <span class="c1"># Build SearchResultItem</span>
                <span class="n">result</span> <span class="o">=</span> <span class="n">SearchResultItem</span><span class="p">(</span>
                    <span class="n">content</span><span class="o">=</span><span class="n">properties</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;content&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
                    <span class="n">chunk_id</span><span class="o">=</span><span class="n">properties</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;chunk_id&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
                    <span class="n">properties</span><span class="o">=</span><span class="n">properties</span><span class="p">,</span>
                    <span class="n">similarity_score</span><span class="o">=</span><span class="n">hybrid_score</span><span class="p">,</span>
                    <span class="n">hybrid_score</span><span class="o">=</span><span class="n">hybrid_score</span><span class="p">,</span>
                    <span class="n">retrieval_method</span><span class="o">=</span><span class="s2">&quot;hybrid_search&quot;</span><span class="p">,</span>
                    <span class="n">retrieval_timestamp</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_current_timestamp</span><span class="p">(),</span>
                    <span class="n">metadata</span><span class="o">=</span><span class="n">metadata</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

        <span class="c1"># Sort by hybrid score (highest first)</span>
        <span class="n">results</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">hybrid_score</span> <span class="ow">or</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">results</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_process_keyword_results</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">objects</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Any</span><span class="p">],</span> <span class="n">score_threshold</span><span class="p">:</span> <span class="nb">float</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">SearchResultItem</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Process keyword search results from Weaviate.</span>

<span class="sd">        Args:</span>
<span class="sd">            objects: Raw Weaviate objects</span>
<span class="sd">            score_threshold: Minimum score threshold</span>

<span class="sd">        Returns:</span>
<span class="sd">            List[SearchResultItem]: Processed results</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">objects</span><span class="p">:</span>
            <span class="c1"># Get BM25 score</span>
            <span class="n">bm25_score</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">obj</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">score</span> <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">metadata</span> <span class="ow">and</span> <span class="n">obj</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">score</span> <span class="k">else</span> <span class="mf">0.0</span>
            <span class="p">)</span>

            <span class="k">if</span> <span class="n">bm25_score</span> <span class="o">&gt;=</span> <span class="n">score_threshold</span><span class="p">:</span>
                <span class="c1"># Build a consistent result that includes all stored properties</span>
                <span class="n">properties</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">properties</span> <span class="ow">or</span> <span class="p">{})</span>

                <span class="c1"># Create RetrievalMetadata from properties</span>
                <span class="n">metadata</span> <span class="o">=</span> <span class="n">RetrievalMetadata</span><span class="o">.</span><span class="n">from_properties</span><span class="p">(</span><span class="n">properties</span><span class="p">)</span>

                <span class="c1"># Build SearchResultItem</span>
                <span class="n">result</span> <span class="o">=</span> <span class="n">SearchResultItem</span><span class="p">(</span>
                    <span class="n">content</span><span class="o">=</span><span class="n">properties</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;content&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
                    <span class="n">chunk_id</span><span class="o">=</span><span class="n">properties</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;chunk_id&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
                    <span class="n">properties</span><span class="o">=</span><span class="n">properties</span><span class="p">,</span>
                    <span class="n">similarity_score</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                    <span class="n">bm25_score</span><span class="o">=</span><span class="n">bm25_score</span><span class="p">,</span>
                    <span class="n">retrieval_method</span><span class="o">=</span><span class="s2">&quot;keyword_search&quot;</span><span class="p">,</span>
                    <span class="n">retrieval_timestamp</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_current_timestamp</span><span class="p">(),</span>
                    <span class="n">metadata</span><span class="o">=</span><span class="n">metadata</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

        <span class="c1"># Sort by BM25 score (highest first)</span>
        <span class="n">results</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">bm25_score</span> <span class="ow">or</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">results</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_get_current_timestamp</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get current timestamp for result metadata.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: Current timestamp</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span>

        <span class="k">return</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_retrieval_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">collection</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get retrieval system statistics.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Dict[str, Any]: Retrieval statistics</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Get database manager stats</span>
            <span class="n">db_stats</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;is_connected&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">db_manager</span><span class="o">.</span><span class="n">is_connected</span><span class="p">,</span>
                <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">db_manager</span><span class="o">.</span><span class="n">url</span><span class="p">,</span>
                <span class="s2">&quot;collections&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">db_manager</span><span class="o">.</span><span class="n">list_collections</span><span class="p">(),</span>
            <span class="p">}</span>

            <span class="c1"># Add retrieval-specific stats</span>
            <span class="n">embedding_info</span> <span class="o">=</span> <span class="p">(</span>
                <span class="p">{</span>
                    <span class="s2">&quot;embedding_model&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">embedding_engine</span><span class="o">.</span><span class="n">model_name</span><span class="p">,</span>
                    <span class="s2">&quot;embedding_dimension&quot;</span><span class="p">:</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">embedding_engine</span><span class="o">.</span><span class="n">embedding_dimension</span><span class="p">),</span>
                <span class="p">}</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">embedding_engine</span>
                <span class="k">else</span> <span class="p">{</span>
                    <span class="s2">&quot;embedding_model&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;Weaviate text2vec-transformers (server-side)&quot;</span><span class="p">),</span>
                    <span class="s2">&quot;embedding_dimension&quot;</span><span class="p">:</span> <span class="s2">&quot;N/A (server-side)&quot;</span><span class="p">,</span>
                <span class="p">}</span>
            <span class="p">)</span>

            <span class="n">retrieval_stats</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;database_stats&quot;</span><span class="p">:</span> <span class="n">db_stats</span><span class="p">,</span>
                <span class="s2">&quot;collection&quot;</span><span class="p">:</span> <span class="n">collection</span><span class="p">,</span>
                <span class="o">**</span><span class="n">embedding_info</span><span class="p">,</span>
                <span class="s2">&quot;retrieval_methods&quot;</span><span class="p">:</span> <span class="p">[</span>
                    <span class="s2">&quot;vector_similarity&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;hybrid_search&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;keyword_search&quot;</span><span class="p">,</span>
                <span class="p">],</span>
            <span class="p">}</span>

            <span class="k">return</span> <span class="n">retrieval_stats</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to get retrieval stats: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">raise</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h5 id="ragora.core.retriever.Retriever._get_current_timestamp" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">_get_current_timestamp</span><span class="p">()</span></code>

<a href="#ragora.core.retriever.Retriever._get_current_timestamp" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Get current timestamp for result metadata.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>str</code></td>            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Current timestamp</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/core/retriever.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">_get_current_timestamp</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get current timestamp for result metadata.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: Current timestamp</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span>

    <span class="k">return</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="ragora.core.retriever.Retriever._preprocess_query" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">_preprocess_query</span><span class="p">(</span><span class="n">query</span><span class="p">)</span></code>

<a href="#ragora.core.retriever.Retriever._preprocess_query" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Preprocess query for better search results.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>query</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Original query text</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>str</code></td>            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Preprocessed query text</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/core/retriever.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">_preprocess_query</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Preprocess query for better search results.</span>

<span class="sd">    Args:</span>
<span class="sd">        query: Original query text</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: Preprocessed query text</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Basic preprocessing - normalize whitespace and case</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">re</span>

    <span class="n">processed</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\s+&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="n">query</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
    <span class="n">processed</span> <span class="o">=</span> <span class="n">processed</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">processed</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="ragora.core.retriever.Retriever._process_hybrid_results" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">_process_hybrid_results</span><span class="p">(</span><span class="n">objects</span><span class="p">,</span> <span class="n">score_threshold</span><span class="p">)</span></code>

<a href="#ragora.core.retriever.Retriever._process_hybrid_results" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Process hybrid search results from Weaviate.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>objects</code>
            </td>
            <td>
                  <code><span title="typing.List">List</span>[<span title="typing.Any">Any</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Raw Weaviate objects</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>score_threshold</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Minimum score threshold</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.List">List</span>[<a class="autorefs autorefs-internal" title="SearchResultItem (ragora.core.models.SearchResultItem)" href="#ragora.core.models.SearchResultItem">SearchResultItem</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List[SearchResultItem]: Processed results</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/core/retriever.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">_process_hybrid_results</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">objects</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Any</span><span class="p">],</span> <span class="n">score_threshold</span><span class="p">:</span> <span class="nb">float</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">SearchResultItem</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Process hybrid search results from Weaviate.</span>

<span class="sd">    Args:</span>
<span class="sd">        objects: Raw Weaviate objects</span>
<span class="sd">        score_threshold: Minimum score threshold</span>

<span class="sd">    Returns:</span>
<span class="sd">        List[SearchResultItem]: Processed results</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">objects</span><span class="p">:</span>
        <span class="c1"># Get hybrid score</span>
        <span class="n">hybrid_score</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">score</span> <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">metadata</span> <span class="ow">and</span> <span class="n">obj</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">score</span> <span class="k">else</span> <span class="mf">0.0</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">hybrid_score</span> <span class="o">&gt;=</span> <span class="n">score_threshold</span><span class="p">:</span>
            <span class="c1"># Build a consistent result that includes all stored properties</span>
            <span class="n">properties</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">properties</span> <span class="ow">or</span> <span class="p">{})</span>

            <span class="c1"># Create RetrievalMetadata from properties</span>
            <span class="n">metadata</span> <span class="o">=</span> <span class="n">RetrievalMetadata</span><span class="o">.</span><span class="n">from_properties</span><span class="p">(</span><span class="n">properties</span><span class="p">)</span>

            <span class="c1"># Build SearchResultItem</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">SearchResultItem</span><span class="p">(</span>
                <span class="n">content</span><span class="o">=</span><span class="n">properties</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;content&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
                <span class="n">chunk_id</span><span class="o">=</span><span class="n">properties</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;chunk_id&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
                <span class="n">properties</span><span class="o">=</span><span class="n">properties</span><span class="p">,</span>
                <span class="n">similarity_score</span><span class="o">=</span><span class="n">hybrid_score</span><span class="p">,</span>
                <span class="n">hybrid_score</span><span class="o">=</span><span class="n">hybrid_score</span><span class="p">,</span>
                <span class="n">retrieval_method</span><span class="o">=</span><span class="s2">&quot;hybrid_search&quot;</span><span class="p">,</span>
                <span class="n">retrieval_timestamp</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_current_timestamp</span><span class="p">(),</span>
                <span class="n">metadata</span><span class="o">=</span><span class="n">metadata</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

    <span class="c1"># Sort by hybrid score (highest first)</span>
    <span class="n">results</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">hybrid_score</span> <span class="ow">or</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">results</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="ragora.core.retriever.Retriever._process_keyword_results" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">_process_keyword_results</span><span class="p">(</span><span class="n">objects</span><span class="p">,</span> <span class="n">score_threshold</span><span class="p">)</span></code>

<a href="#ragora.core.retriever.Retriever._process_keyword_results" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Process keyword search results from Weaviate.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>objects</code>
            </td>
            <td>
                  <code><span title="typing.List">List</span>[<span title="typing.Any">Any</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Raw Weaviate objects</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>score_threshold</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Minimum score threshold</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.List">List</span>[<a class="autorefs autorefs-internal" title="SearchResultItem (ragora.core.models.SearchResultItem)" href="#ragora.core.models.SearchResultItem">SearchResultItem</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List[SearchResultItem]: Processed results</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/core/retriever.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">_process_keyword_results</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">objects</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Any</span><span class="p">],</span> <span class="n">score_threshold</span><span class="p">:</span> <span class="nb">float</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">SearchResultItem</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Process keyword search results from Weaviate.</span>

<span class="sd">    Args:</span>
<span class="sd">        objects: Raw Weaviate objects</span>
<span class="sd">        score_threshold: Minimum score threshold</span>

<span class="sd">    Returns:</span>
<span class="sd">        List[SearchResultItem]: Processed results</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">objects</span><span class="p">:</span>
        <span class="c1"># Get BM25 score</span>
        <span class="n">bm25_score</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">score</span> <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">metadata</span> <span class="ow">and</span> <span class="n">obj</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">score</span> <span class="k">else</span> <span class="mf">0.0</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">bm25_score</span> <span class="o">&gt;=</span> <span class="n">score_threshold</span><span class="p">:</span>
            <span class="c1"># Build a consistent result that includes all stored properties</span>
            <span class="n">properties</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">properties</span> <span class="ow">or</span> <span class="p">{})</span>

            <span class="c1"># Create RetrievalMetadata from properties</span>
            <span class="n">metadata</span> <span class="o">=</span> <span class="n">RetrievalMetadata</span><span class="o">.</span><span class="n">from_properties</span><span class="p">(</span><span class="n">properties</span><span class="p">)</span>

            <span class="c1"># Build SearchResultItem</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">SearchResultItem</span><span class="p">(</span>
                <span class="n">content</span><span class="o">=</span><span class="n">properties</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;content&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
                <span class="n">chunk_id</span><span class="o">=</span><span class="n">properties</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;chunk_id&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
                <span class="n">properties</span><span class="o">=</span><span class="n">properties</span><span class="p">,</span>
                <span class="n">similarity_score</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                <span class="n">bm25_score</span><span class="o">=</span><span class="n">bm25_score</span><span class="p">,</span>
                <span class="n">retrieval_method</span><span class="o">=</span><span class="s2">&quot;keyword_search&quot;</span><span class="p">,</span>
                <span class="n">retrieval_timestamp</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_current_timestamp</span><span class="p">(),</span>
                <span class="n">metadata</span><span class="o">=</span><span class="n">metadata</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

    <span class="c1"># Sort by BM25 score (highest first)</span>
    <span class="n">results</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">bm25_score</span> <span class="ow">or</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">results</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="ragora.core.retriever.Retriever._process_vector_results" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">_process_vector_results</span><span class="p">(</span><span class="n">objects</span><span class="p">,</span> <span class="n">score_threshold</span><span class="p">)</span></code>

<a href="#ragora.core.retriever.Retriever._process_vector_results" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Process vector search results from Weaviate.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>objects</code>
            </td>
            <td>
                  <code><span title="typing.List">List</span>[<span title="typing.Any">Any</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Raw Weaviate objects</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>score_threshold</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Minimum score threshold</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.List">List</span>[<a class="autorefs autorefs-internal" title="SearchResultItem (ragora.core.models.SearchResultItem)" href="#ragora.core.models.SearchResultItem">SearchResultItem</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List[SearchResultItem]: Processed results</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/core/retriever.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">_process_vector_results</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">objects</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Any</span><span class="p">],</span> <span class="n">score_threshold</span><span class="p">:</span> <span class="nb">float</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">SearchResultItem</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Process vector search results from Weaviate.</span>

<span class="sd">    Args:</span>
<span class="sd">        objects: Raw Weaviate objects</span>
<span class="sd">        score_threshold: Minimum score threshold</span>

<span class="sd">    Returns:</span>
<span class="sd">        List[SearchResultItem]: Processed results</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">objects</span><span class="p">:</span>
        <span class="c1"># Calculate similarity score from distance</span>
        <span class="n">distance</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">distance</span> <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">metadata</span> <span class="ow">and</span> <span class="n">obj</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">distance</span> <span class="k">else</span> <span class="mf">1.0</span>
        <span class="p">)</span>
        <span class="n">similarity_score</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="n">distance</span>

        <span class="k">if</span> <span class="n">similarity_score</span> <span class="o">&gt;=</span> <span class="n">score_threshold</span><span class="p">:</span>
            <span class="c1"># Build a consistent result that includes all stored properties</span>
            <span class="n">properties</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">properties</span> <span class="ow">or</span> <span class="p">{})</span>

            <span class="c1"># Create RetrievalMetadata from properties</span>
            <span class="n">metadata</span> <span class="o">=</span> <span class="n">RetrievalMetadata</span><span class="o">.</span><span class="n">from_properties</span><span class="p">(</span><span class="n">properties</span><span class="p">)</span>

            <span class="c1"># Build SearchResultItem</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">SearchResultItem</span><span class="p">(</span>
                <span class="n">content</span><span class="o">=</span><span class="n">properties</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;content&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
                <span class="n">chunk_id</span><span class="o">=</span><span class="n">properties</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;chunk_id&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
                <span class="n">properties</span><span class="o">=</span><span class="n">properties</span><span class="p">,</span>
                <span class="n">similarity_score</span><span class="o">=</span><span class="n">similarity_score</span><span class="p">,</span>
                <span class="n">distance</span><span class="o">=</span><span class="n">distance</span><span class="p">,</span>
                <span class="n">retrieval_method</span><span class="o">=</span><span class="s2">&quot;vector_similarity&quot;</span><span class="p">,</span>
                <span class="n">retrieval_timestamp</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_current_timestamp</span><span class="p">(),</span>
                <span class="n">metadata</span><span class="o">=</span><span class="n">metadata</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

    <span class="c1"># Sort by similarity score (highest first)</span>
    <span class="n">results</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">similarity_score</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">results</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="ragora.core.retriever.Retriever.get_retrieval_stats" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_retrieval_stats</span><span class="p">(</span><span class="n">collection</span><span class="p">)</span></code>

<a href="#ragora.core.retriever.Retriever.get_retrieval_stats" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Get retrieval system statistics.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dict[str, Any]: Retrieval statistics</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/core/retriever.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_retrieval_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">collection</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get retrieval system statistics.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Dict[str, Any]: Retrieval statistics</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Get database manager stats</span>
        <span class="n">db_stats</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;is_connected&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">db_manager</span><span class="o">.</span><span class="n">is_connected</span><span class="p">,</span>
            <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">db_manager</span><span class="o">.</span><span class="n">url</span><span class="p">,</span>
            <span class="s2">&quot;collections&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">db_manager</span><span class="o">.</span><span class="n">list_collections</span><span class="p">(),</span>
        <span class="p">}</span>

        <span class="c1"># Add retrieval-specific stats</span>
        <span class="n">embedding_info</span> <span class="o">=</span> <span class="p">(</span>
            <span class="p">{</span>
                <span class="s2">&quot;embedding_model&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">embedding_engine</span><span class="o">.</span><span class="n">model_name</span><span class="p">,</span>
                <span class="s2">&quot;embedding_dimension&quot;</span><span class="p">:</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">embedding_engine</span><span class="o">.</span><span class="n">embedding_dimension</span><span class="p">),</span>
            <span class="p">}</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">embedding_engine</span>
            <span class="k">else</span> <span class="p">{</span>
                <span class="s2">&quot;embedding_model&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;Weaviate text2vec-transformers (server-side)&quot;</span><span class="p">),</span>
                <span class="s2">&quot;embedding_dimension&quot;</span><span class="p">:</span> <span class="s2">&quot;N/A (server-side)&quot;</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="p">)</span>

        <span class="n">retrieval_stats</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;database_stats&quot;</span><span class="p">:</span> <span class="n">db_stats</span><span class="p">,</span>
            <span class="s2">&quot;collection&quot;</span><span class="p">:</span> <span class="n">collection</span><span class="p">,</span>
            <span class="o">**</span><span class="n">embedding_info</span><span class="p">,</span>
            <span class="s2">&quot;retrieval_methods&quot;</span><span class="p">:</span> <span class="p">[</span>
                <span class="s2">&quot;vector_similarity&quot;</span><span class="p">,</span>
                <span class="s2">&quot;hybrid_search&quot;</span><span class="p">,</span>
                <span class="s2">&quot;keyword_search&quot;</span><span class="p">,</span>
            <span class="p">],</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="n">retrieval_stats</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to get retrieval stats: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">raise</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="ragora.core.retriever.Retriever.search_hybrid" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">search_hybrid</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">collection</span><span class="p">,</span> <span class="n">top_k</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">score_threshold</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="nb">filter</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#ragora.core.retriever.Retriever.search_hybrid" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Perform hybrid search combining vector and keyword search.</p>
<p>This method combines semantic similarity search with traditional
keyword search to provide more comprehensive results.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>query</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Search query text</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>collection</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Collection name to search</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>top_k</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of results to return</p>
              </div>
            </td>
            <td>
                  <code>5</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>alpha</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Weight for vector search (0.0 = keyword only,
1.0 = vector only)</p>
              </div>
            </td>
            <td>
                  <code>0.5</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>score_threshold</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Minimum similarity score threshold</p>
              </div>
            </td>
            <td>
                  <code>0.0</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>filter</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="weaviate.classes.query.Filter">Filter</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional Weaviate Filter object to filter results
by properties</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.List">List</span>[<a class="autorefs autorefs-internal" title="SearchResultItem (ragora.core.models.SearchResultItem)" href="#ragora.core.models.SearchResultItem">SearchResultItem</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List[SearchResultItem]: List of search result items</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If query is empty or alpha is out of range</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><span class="n">hits</span> <span class="o">=</span> <span class="n">retriever</span><span class="o">.</span><span class="n">search_hybrid</span><span class="p">(</span>
    <span class="s2">&quot;retrieval strategies&quot;</span><span class="p">,</span>
    <span class="n">collection</span><span class="o">=</span><span class="s2">&quot;Document&quot;</span><span class="p">,</span>
    <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span>
<span class="p">)</span>
</code></pre></div>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/core/retriever.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">search_hybrid</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">query</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">collection</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">top_k</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
    <span class="n">alpha</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span>
    <span class="n">score_threshold</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
    <span class="nb">filter</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Filter</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">SearchResultItem</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Perform hybrid search combining vector and keyword search.</span>

<span class="sd">    This method combines semantic similarity search with traditional</span>
<span class="sd">    keyword search to provide more comprehensive results.</span>

<span class="sd">    Args:</span>
<span class="sd">        query: Search query text</span>
<span class="sd">        collection: Collection name to search</span>
<span class="sd">        top_k: Number of results to return</span>
<span class="sd">        alpha: Weight for vector search (0.0 = keyword only,</span>
<span class="sd">            1.0 = vector only)</span>
<span class="sd">        score_threshold: Minimum similarity score threshold</span>
<span class="sd">        filter: Optional Weaviate Filter object to filter results</span>
<span class="sd">            by properties</span>

<span class="sd">    Returns:</span>
<span class="sd">        List[SearchResultItem]: List of search result items</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If query is empty or alpha is out of range</span>

<span class="sd">    Examples:</span>
<span class="sd">        ```python</span>
<span class="sd">        hits = retriever.search_hybrid(</span>
<span class="sd">            &quot;retrieval strategies&quot;,</span>
<span class="sd">            collection=&quot;Document&quot;,</span>
<span class="sd">            alpha=0.7,</span>
<span class="sd">        )</span>
<span class="sd">        ```</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">query</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">query</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Query cannot be empty&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="mf">0.0</span> <span class="o">&lt;=</span> <span class="n">alpha</span> <span class="o">&lt;=</span> <span class="mf">1.0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Alpha must be between 0.0 and 1.0&quot;</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Performing hybrid search: &#39;</span><span class="si">{</span><span class="n">query</span><span class="si">}</span><span class="s2">&#39; with alpha=</span><span class="si">{</span><span class="n">alpha</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Preprocess query for better results</span>
        <span class="n">processed_query</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_preprocess_query</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>

        <span class="c1"># Get collection and execute hybrid search using Weaviate APIs</span>
        <span class="n">collection</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">db_manager</span><span class="o">.</span><span class="n">get_collection</span><span class="p">(</span><span class="n">collection</span><span class="p">)</span>

        <span class="c1"># Use Weaviate&#39;s native hybrid API</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">collection</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">hybrid</span><span class="p">(</span>
            <span class="n">query</span><span class="o">=</span><span class="n">processed_query</span><span class="p">,</span>
            <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span>
            <span class="n">limit</span><span class="o">=</span><span class="n">top_k</span><span class="p">,</span>
            <span class="n">return_metadata</span><span class="o">=</span><span class="n">MetadataQuery</span><span class="p">(</span><span class="n">score</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
            <span class="n">filters</span><span class="o">=</span><span class="nb">filter</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># Process results</span>
        <span class="n">processed_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_process_hybrid_results</span><span class="p">(</span>
            <span class="n">result</span><span class="o">.</span><span class="n">objects</span><span class="p">,</span> <span class="n">score_threshold</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Found </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">processed_results</span><span class="p">)</span><span class="si">}</span><span class="s2"> hybrid results for: &#39;</span><span class="si">{</span><span class="n">query</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">processed_results</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Hybrid search failed: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">raise</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="ragora.core.retriever.Retriever.search_keyword" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">search_keyword</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">collection</span><span class="p">,</span> <span class="n">top_k</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">score_threshold</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="nb">filter</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#ragora.core.retriever.Retriever.search_keyword" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Perform keyword search using BM25 algorithm.</p>
<p>This method performs traditional keyword search using BM25 algorithm
to find documents containing specific keywords.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>query</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Search query text</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>collection</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Collection name to search</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>top_k</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of results to return</p>
              </div>
            </td>
            <td>
                  <code>5</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>score_threshold</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Minimum similarity score threshold</p>
              </div>
            </td>
            <td>
                  <code>0.0</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>filter</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="weaviate.classes.query.Filter">Filter</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional Weaviate Filter object to filter results
by properties</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.List">List</span>[<a class="autorefs autorefs-internal" title="SearchResultItem (ragora.core.models.SearchResultItem)" href="#ragora.core.models.SearchResultItem">SearchResultItem</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List[SearchResultItem]: List of search result items</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If query is empty</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><span class="n">hits</span> <span class="o">=</span> <span class="n">retriever</span><span class="o">.</span><span class="n">search_keyword</span><span class="p">(</span><span class="s2">&quot;BM25 overview&quot;</span><span class="p">,</span> <span class="s2">&quot;Document&quot;</span><span class="p">,</span> <span class="n">top_k</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
</code></pre></div>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/core/retriever.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">search_keyword</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">query</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">collection</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">top_k</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
    <span class="n">score_threshold</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
    <span class="nb">filter</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Filter</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">SearchResultItem</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Perform keyword search using BM25 algorithm.</span>

<span class="sd">    This method performs traditional keyword search using BM25 algorithm</span>
<span class="sd">    to find documents containing specific keywords.</span>

<span class="sd">    Args:</span>
<span class="sd">        query: Search query text</span>
<span class="sd">        collection: Collection name to search</span>
<span class="sd">        top_k: Number of results to return</span>
<span class="sd">        score_threshold: Minimum similarity score threshold</span>
<span class="sd">        filter: Optional Weaviate Filter object to filter results</span>
<span class="sd">            by properties</span>

<span class="sd">    Returns:</span>
<span class="sd">        List[SearchResultItem]: List of search result items</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If query is empty</span>

<span class="sd">    Examples:</span>
<span class="sd">        ```python</span>
<span class="sd">        hits = retriever.search_keyword(&quot;BM25 overview&quot;, &quot;Document&quot;, top_k=3)</span>
<span class="sd">        ```</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">query</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">query</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Query cannot be empty&quot;</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Performing keyword search: &#39;</span><span class="si">{</span><span class="n">query</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>

        <span class="c1"># Preprocess query for better results</span>
        <span class="n">processed_query</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_preprocess_query</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>

        <span class="c1"># Get collection and execute keyword search using Weaviate APIs</span>
        <span class="n">collection</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">db_manager</span><span class="o">.</span><span class="n">get_collection</span><span class="p">(</span><span class="n">collection</span><span class="p">)</span>

        <span class="c1"># Use Weaviate&#39;s native BM25 API</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">collection</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">bm25</span><span class="p">(</span>
            <span class="n">query</span><span class="o">=</span><span class="n">processed_query</span><span class="p">,</span>
            <span class="n">limit</span><span class="o">=</span><span class="n">top_k</span><span class="p">,</span>
            <span class="n">return_metadata</span><span class="o">=</span><span class="n">MetadataQuery</span><span class="p">(</span><span class="n">score</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
            <span class="n">filters</span><span class="o">=</span><span class="nb">filter</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># Process results</span>
        <span class="n">processed_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_process_keyword_results</span><span class="p">(</span>
            <span class="n">result</span><span class="o">.</span><span class="n">objects</span><span class="p">,</span> <span class="n">score_threshold</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Found </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">processed_results</span><span class="p">)</span><span class="si">}</span><span class="s2"> keyword results for: &#39;</span><span class="si">{</span><span class="n">query</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">processed_results</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Keyword search failed: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">raise</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="ragora.core.retriever.Retriever.search_similar" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">search_similar</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">collection</span><span class="p">,</span> <span class="n">top_k</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">score_threshold</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="nb">filter</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#ragora.core.retriever.Retriever.search_similar" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Search for similar documents using vector similarity.</p>
<p>This method performs semantic search using vector embeddings to find
documents that are semantically similar to the query.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>query</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Search query text</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>collection</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Collection name to search</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>top_k</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of results to return</p>
              </div>
            </td>
            <td>
                  <code>5</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>score_threshold</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Minimum similarity score threshold</p>
              </div>
            </td>
            <td>
                  <code>0.0</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>filter</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="weaviate.classes.query.Filter">Filter</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional Weaviate Filter object to filter results</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.List">List</span>[<a class="autorefs autorefs-internal" title="SearchResultItem (ragora.core.models.SearchResultItem)" href="#ragora.core.models.SearchResultItem">SearchResultItem</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List[SearchResultItem]: List of search result items</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If query is empty</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><span class="n">hits</span> <span class="o">=</span> <span class="n">retriever</span><span class="o">.</span><span class="n">search_similar</span><span class="p">(</span><span class="s2">&quot;rag pipeline&quot;</span><span class="p">,</span> <span class="s2">&quot;Document&quot;</span><span class="p">,</span> <span class="n">top_k</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</code></pre></div>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/core/retriever.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">search_similar</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">query</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">collection</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">top_k</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
    <span class="n">score_threshold</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
    <span class="nb">filter</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Filter</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">SearchResultItem</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Search for similar documents using vector similarity.</span>

<span class="sd">    This method performs semantic search using vector embeddings to find</span>
<span class="sd">    documents that are semantically similar to the query.</span>

<span class="sd">    Args:</span>
<span class="sd">        query: Search query text</span>
<span class="sd">        collection: Collection name to search</span>
<span class="sd">        top_k: Number of results to return</span>
<span class="sd">        score_threshold: Minimum similarity score threshold</span>
<span class="sd">        filter: Optional Weaviate Filter object to filter results</span>

<span class="sd">    Returns:</span>
<span class="sd">        List[SearchResultItem]: List of search result items</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If query is empty</span>

<span class="sd">    Examples:</span>
<span class="sd">        ```python</span>
<span class="sd">        hits = retriever.search_similar(&quot;rag pipeline&quot;, &quot;Document&quot;, top_k=10)</span>
<span class="sd">        ```</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">query</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">query</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Query cannot be empty&quot;</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Performing vector similarity search: &#39;</span><span class="si">{</span><span class="n">query</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>

        <span class="c1"># Preprocess query for better results</span>
        <span class="n">processed_query</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_preprocess_query</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>

        <span class="c1"># Get collection and execute search using Weaviate APIs</span>
        <span class="n">collection</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">db_manager</span><span class="o">.</span><span class="n">get_collection</span><span class="p">(</span><span class="n">collection</span><span class="p">)</span>

        <span class="c1"># Use Weaviate&#39;s native near_text API</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">collection</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">near_text</span><span class="p">(</span>
            <span class="n">query</span><span class="o">=</span><span class="n">processed_query</span><span class="p">,</span>
            <span class="n">limit</span><span class="o">=</span><span class="n">top_k</span><span class="p">,</span>
            <span class="n">return_metadata</span><span class="o">=</span><span class="n">MetadataQuery</span><span class="p">(</span><span class="n">distance</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
            <span class="n">filters</span><span class="o">=</span><span class="nb">filter</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># Process results</span>
        <span class="n">processed_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_process_vector_results</span><span class="p">(</span>
            <span class="n">result</span><span class="o">.</span><span class="n">objects</span><span class="p">,</span> <span class="n">score_threshold</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Found </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">processed_results</span><span class="p">)</span><span class="si">}</span><span class="s2"> similar results for: &#39;</span><span class="si">{</span><span class="n">query</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">processed_results</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Vector similarity search failed: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">raise</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div><h3 id="vector-store">Vector Store<a class="headerlink" href="#vector-store" title="Permanent link">&para;</a></h3>


<div class="doc doc-object doc-module">



<a id="ragora.core.vector_store"></a>
    <div class="doc doc-contents first">

        <p>Adapter that persists Ragora chunks inside a Weaviate collection.</p>










  <div class="doc doc-children">









<div class="doc doc-object doc-class">



<h4 id="ragora.core.vector_store.VectorStore" class="doc doc-heading">
            <code>VectorStore</code>


<a href="#ragora.core.vector_store.VectorStore" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">


        <p>Persist and retrieve :class:<code>DataChunk</code> objects from Weaviate.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="ragora.core.vector_store.VectorStore.db_manager">db_manager</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Database connection manager.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="ragora.core.vector_store.VectorStore.collection">collection</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Weaviate class name that stores chunks.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="ragora.core.vector_store.VectorStore.embedding_engine">embedding_engine</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional embedding engine for client-side vectors.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="ragora.core.vector_store.VectorStore.logger">logger</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Module logger.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">ragora.core.database_manager</span><span class="w"> </span><span class="kn">import</span> <span class="n">DatabaseManager</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">ragora.core.vector_store</span><span class="w"> </span><span class="kn">import</span> <span class="n">VectorStore</span>

<span class="n">db</span> <span class="o">=</span> <span class="n">DatabaseManager</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="s2">&quot;http://localhost:8080&quot;</span><span class="p">)</span>
<span class="n">store</span> <span class="o">=</span> <span class="n">VectorStore</span><span class="p">(</span><span class="n">db_manager</span><span class="o">=</span><span class="n">db</span><span class="p">,</span> <span class="n">collection</span><span class="o">=</span><span class="s2">&quot;Document&quot;</span><span class="p">)</span>
<span class="n">store</span><span class="o">.</span><span class="n">create_schema</span><span class="p">(</span><span class="s2">&quot;Document&quot;</span><span class="p">)</span>
</code></pre></div>








              <details class="quote">
                <summary>Source code in <code>ragora/ragora/core/vector_store.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">VectorStore</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Persist and retrieve :class:`DataChunk` objects from Weaviate.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        db_manager: Database connection manager.</span>
<span class="sd">        collection: Weaviate class name that stores chunks.</span>
<span class="sd">        embedding_engine: Optional embedding engine for client-side vectors.</span>
<span class="sd">        logger: Module logger.</span>

<span class="sd">    Examples:</span>
<span class="sd">        ```python</span>
<span class="sd">        from ragora.core.database_manager import DatabaseManager</span>
<span class="sd">        from ragora.core.vector_store import VectorStore</span>

<span class="sd">        db = DatabaseManager(url=&quot;http://localhost:8080&quot;)</span>
<span class="sd">        store = VectorStore(db_manager=db, collection=&quot;Document&quot;)</span>
<span class="sd">        store.create_schema(&quot;Document&quot;)</span>
<span class="sd">        ```</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">db_manager</span><span class="p">:</span> <span class="n">DatabaseManager</span><span class="p">,</span>
        <span class="n">collection</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;Document&quot;</span><span class="p">,</span>
        <span class="n">embedding_engine</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">EmbeddingEngine</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the VectorStore with DatabaseManager.</span>

<span class="sd">        Args:</span>
<span class="sd">            db_manager: DatabaseManager instance for database operations</span>
<span class="sd">            collection: Name of the Weaviate class for document storage</span>
<span class="sd">            embedding_engine: EmbeddingEngine instance (optional, defaults to None)</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If invalid parameters are provided</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">db_manager</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;DatabaseManager cannot be None&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">db_manager</span> <span class="o">=</span> <span class="n">db_manager</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">collection</span> <span class="o">=</span> <span class="n">collection</span>

        <span class="c1"># Set up logging</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

        <span class="c1"># Note: Embedding engine is not needed when using Weaviate&#39;s text2vec-transformers</span>
        <span class="c1"># Weaviate handles embeddings server-side. EmbeddingEngine is only kept for</span>
        <span class="c1"># potential future use cases where client-side embeddings might be needed.</span>
        <span class="c1"># DO NOT initialize it by default to avoid unnecessary model loading.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">embedding_engine</span> <span class="o">=</span> <span class="n">embedding_engine</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">is_connected</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if the vector store is connected to the database.</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool: True if connected</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">db_manager</span><span class="o">.</span><span class="n">is_connected</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">create_schema</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">collection</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">force_recreate</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create the Weaviate collection for document storage using V4 API.</span>

<span class="sd">        Args:</span>
<span class="sd">            collection: Name of the collection for document storage</span>
<span class="sd">            force_recreate: If True, delete existing collection before</span>
<span class="sd">                creating new one</span>

<span class="sd">        Returns:</span>
<span class="sd">            None</span>

<span class="sd">        Raises:</span>
<span class="sd">            WeaviateBaseError: If collection creation fails</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Check if collection already exists</span>
            <span class="n">collection_exists</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">db_manager</span><span class="o">.</span><span class="n">collection_exists</span><span class="p">(</span><span class="n">collection</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">collection_exists</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">force_recreate</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Deleting existing collection: </span><span class="si">{</span><span class="n">collection</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">db_manager</span><span class="o">.</span><span class="n">delete_collection</span><span class="p">(</span><span class="n">collection</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Collection </span><span class="si">{</span><span class="n">collection</span><span class="si">}</span><span class="s2"> already exists returning without creating new one&quot;</span>
                    <span class="p">)</span>
                    <span class="k">return</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Creating new collection: </span><span class="si">{</span><span class="n">collection</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="c1"># Define schema properties</span>
            <span class="n">properties</span> <span class="o">=</span> <span class="p">[</span>
                <span class="c1"># Core fields</span>
                <span class="n">Property</span><span class="p">(</span>
                    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;content&quot;</span><span class="p">,</span>
                    <span class="n">data_type</span><span class="o">=</span><span class="n">DataType</span><span class="o">.</span><span class="n">TEXT</span><span class="p">,</span>
                    <span class="n">description</span><span class="o">=</span><span class="s2">&quot;The text content of the document chunk&quot;</span><span class="p">,</span>
                    <span class="n">vectorize_property_name</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="p">),</span>
                <span class="n">Property</span><span class="p">(</span>
                    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;chunk_id&quot;</span><span class="p">,</span>
                    <span class="n">data_type</span><span class="o">=</span><span class="n">DataType</span><span class="o">.</span><span class="n">TEXT</span><span class="p">,</span>
                    <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Unique identifier for the chunk&quot;</span><span class="p">,</span>
                    <span class="n">vectorize_property_name</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="p">),</span>
                <span class="n">Property</span><span class="p">(</span>
                    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;chunk_key&quot;</span><span class="p">,</span>
                    <span class="n">data_type</span><span class="o">=</span><span class="n">DataType</span><span class="o">.</span><span class="n">TEXT</span><span class="p">,</span>
                    <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Key for the chunk (UUID5)&quot;</span><span class="p">,</span>
                    <span class="n">vectorize_property_name</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="p">),</span>
                <span class="n">Property</span><span class="p">(</span>
                    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;source_document&quot;</span><span class="p">,</span>
                    <span class="n">data_type</span><span class="o">=</span><span class="n">DataType</span><span class="o">.</span><span class="n">TEXT</span><span class="p">,</span>
                    <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Source document filename&quot;</span><span class="p">,</span>
                    <span class="n">vectorize_property_name</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="p">),</span>
                <span class="n">Property</span><span class="p">(</span>
                    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;chunk_type&quot;</span><span class="p">,</span>
                    <span class="n">data_type</span><span class="o">=</span><span class="n">DataType</span><span class="o">.</span><span class="n">TEXT</span><span class="p">,</span>
                    <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Type of chunk (text, citation, equation, etc.)&quot;</span><span class="p">,</span>
                    <span class="n">vectorize_property_name</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="p">),</span>
                <span class="n">Property</span><span class="p">(</span>
                    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;created_at&quot;</span><span class="p">,</span>
                    <span class="n">data_type</span><span class="o">=</span><span class="n">DataType</span><span class="o">.</span><span class="n">TEXT</span><span class="p">,</span>
                    <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Creation timestamp&quot;</span><span class="p">,</span>
                    <span class="n">vectorize_property_name</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="p">),</span>
                <span class="c1"># Document-specific fields</span>
                <span class="n">Property</span><span class="p">(</span>
                    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;metadata_chunk_idx&quot;</span><span class="p">,</span>
                    <span class="n">data_type</span><span class="o">=</span><span class="n">DataType</span><span class="o">.</span><span class="n">INT</span><span class="p">,</span>
                    <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Chunk index from metadata&quot;</span><span class="p">,</span>
                    <span class="n">vectorize_property_name</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="p">),</span>
                <span class="n">Property</span><span class="p">(</span>
                    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;metadata_chunk_size&quot;</span><span class="p">,</span>
                    <span class="n">data_type</span><span class="o">=</span><span class="n">DataType</span><span class="o">.</span><span class="n">INT</span><span class="p">,</span>
                    <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Chunk size from metadata&quot;</span><span class="p">,</span>
                    <span class="n">vectorize_property_name</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="p">),</span>
                <span class="n">Property</span><span class="p">(</span>
                    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;metadata_total_chunks&quot;</span><span class="p">,</span>
                    <span class="n">data_type</span><span class="o">=</span><span class="n">DataType</span><span class="o">.</span><span class="n">INT</span><span class="p">,</span>
                    <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Total chunks from metadata&quot;</span><span class="p">,</span>
                    <span class="n">vectorize_property_name</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="p">),</span>
                <span class="n">Property</span><span class="p">(</span>
                    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;metadata_created_at&quot;</span><span class="p">,</span>
                    <span class="n">data_type</span><span class="o">=</span><span class="n">DataType</span><span class="o">.</span><span class="n">TEXT</span><span class="p">,</span>
                    <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Created at timestamp from metadata&quot;</span><span class="p">,</span>
                    <span class="n">vectorize_property_name</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="p">),</span>
                <span class="n">Property</span><span class="p">(</span>
                    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;page_number&quot;</span><span class="p">,</span>
                    <span class="n">data_type</span><span class="o">=</span><span class="n">DataType</span><span class="o">.</span><span class="n">INT</span><span class="p">,</span>
                    <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Page number in source document&quot;</span><span class="p">,</span>
                    <span class="n">vectorize_property_name</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="p">),</span>
                <span class="n">Property</span><span class="p">(</span>
                    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;section_title&quot;</span><span class="p">,</span>
                    <span class="n">data_type</span><span class="o">=</span><span class="n">DataType</span><span class="o">.</span><span class="n">TEXT</span><span class="p">,</span>
                    <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Section or chapter title&quot;</span><span class="p">,</span>
                    <span class="n">vectorize_property_name</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="p">),</span>
                <span class="c1"># Email-specific fields</span>
                <span class="n">Property</span><span class="p">(</span>
                    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;email_subject&quot;</span><span class="p">,</span>
                    <span class="n">data_type</span><span class="o">=</span><span class="n">DataType</span><span class="o">.</span><span class="n">TEXT</span><span class="p">,</span>
                    <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Email subject line&quot;</span><span class="p">,</span>
                    <span class="n">vectorize_property_name</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="p">),</span>
                <span class="n">Property</span><span class="p">(</span>
                    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;email_sender&quot;</span><span class="p">,</span>
                    <span class="n">data_type</span><span class="o">=</span><span class="n">DataType</span><span class="o">.</span><span class="n">TEXT</span><span class="p">,</span>
                    <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Email sender address&quot;</span><span class="p">,</span>
                    <span class="n">vectorize_property_name</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="p">),</span>
                <span class="n">Property</span><span class="p">(</span>
                    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;email_recipient&quot;</span><span class="p">,</span>
                    <span class="n">data_type</span><span class="o">=</span><span class="n">DataType</span><span class="o">.</span><span class="n">TEXT</span><span class="p">,</span>
                    <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Email recipient address&quot;</span><span class="p">,</span>
                    <span class="n">vectorize_property_name</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="p">),</span>
                <span class="n">Property</span><span class="p">(</span>
                    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;email_date&quot;</span><span class="p">,</span>
                    <span class="n">data_type</span><span class="o">=</span><span class="n">DataType</span><span class="o">.</span><span class="n">TEXT</span><span class="p">,</span>
                    <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Email timestamp&quot;</span><span class="p">,</span>
                    <span class="n">vectorize_property_name</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="p">),</span>
                <span class="n">Property</span><span class="p">(</span>
                    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;email_id&quot;</span><span class="p">,</span>
                    <span class="n">data_type</span><span class="o">=</span><span class="n">DataType</span><span class="o">.</span><span class="n">TEXT</span><span class="p">,</span>
                    <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Unique email identifier&quot;</span><span class="p">,</span>
                    <span class="n">vectorize_property_name</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="p">),</span>
                <span class="n">Property</span><span class="p">(</span>
                    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;email_folder&quot;</span><span class="p">,</span>
                    <span class="n">data_type</span><span class="o">=</span><span class="n">DataType</span><span class="o">.</span><span class="n">TEXT</span><span class="p">,</span>
                    <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Email folder/path&quot;</span><span class="p">,</span>
                    <span class="n">vectorize_property_name</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="p">),</span>
                <span class="c1"># Custom metadata fields</span>
                <span class="n">Property</span><span class="p">(</span>
                    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;custom_metadata&quot;</span><span class="p">,</span>
                    <span class="n">data_type</span><span class="o">=</span><span class="n">DataType</span><span class="o">.</span><span class="n">TEXT</span><span class="p">,</span>
                    <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Custom metadata as JSON string&quot;</span><span class="p">,</span>
                    <span class="n">vectorize_property_name</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="p">),</span>
                <span class="n">Property</span><span class="p">(</span>
                    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;language&quot;</span><span class="p">,</span>
                    <span class="n">data_type</span><span class="o">=</span><span class="n">DataType</span><span class="o">.</span><span class="n">TEXT</span><span class="p">,</span>
                    <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Content language (e.g., en, es, fr)&quot;</span><span class="p">,</span>
                    <span class="n">vectorize_property_name</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="p">),</span>
                <span class="n">Property</span><span class="p">(</span>
                    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;domain&quot;</span><span class="p">,</span>
                    <span class="n">data_type</span><span class="o">=</span><span class="n">DataType</span><span class="o">.</span><span class="n">TEXT</span><span class="p">,</span>
                    <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Content domain (e.g., scientific, legal, medical)&quot;</span><span class="p">,</span>
                    <span class="n">vectorize_property_name</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="p">),</span>
                <span class="n">Property</span><span class="p">(</span>
                    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;confidence&quot;</span><span class="p">,</span>
                    <span class="n">data_type</span><span class="o">=</span><span class="n">DataType</span><span class="o">.</span><span class="n">NUMBER</span><span class="p">,</span>
                    <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Processing confidence score (0.0-1.0)&quot;</span><span class="p">,</span>
                    <span class="n">vectorize_property_name</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="p">),</span>
                <span class="n">Property</span><span class="p">(</span>
                    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;tags&quot;</span><span class="p">,</span>
                    <span class="n">data_type</span><span class="o">=</span><span class="n">DataType</span><span class="o">.</span><span class="n">TEXT</span><span class="p">,</span>
                    <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Comma-separated tags/categories&quot;</span><span class="p">,</span>
                    <span class="n">vectorize_property_name</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="p">),</span>
                <span class="n">Property</span><span class="p">(</span>
                    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;priority&quot;</span><span class="p">,</span>
                    <span class="n">data_type</span><span class="o">=</span><span class="n">DataType</span><span class="o">.</span><span class="n">INT</span><span class="p">,</span>
                    <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Content priority/importance level&quot;</span><span class="p">,</span>
                    <span class="n">vectorize_property_name</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="p">),</span>
                <span class="n">Property</span><span class="p">(</span>
                    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;content_category&quot;</span><span class="p">,</span>
                    <span class="n">data_type</span><span class="o">=</span><span class="n">DataType</span><span class="o">.</span><span class="n">TEXT</span><span class="p">,</span>
                    <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Fine-grained content categorization&quot;</span><span class="p">,</span>
                    <span class="n">vectorize_property_name</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="p">),</span>
            <span class="p">]</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Creating collection: </span><span class="si">{</span><span class="n">collection</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="c1"># Create the collection using DatabaseManager</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">db_manager</span><span class="o">.</span><span class="n">create_collection</span><span class="p">(</span>
                <span class="n">name</span><span class="o">=</span><span class="n">collection</span><span class="p">,</span>
                <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Document chunks with embeddings for RAG system&quot;</span><span class="p">,</span>
                <span class="n">vectorizer_config</span><span class="o">=</span><span class="n">Configure</span><span class="o">.</span><span class="n">Vectorizer</span><span class="o">.</span><span class="n">text2vec_transformers</span><span class="p">(),</span>
                <span class="n">properties</span><span class="o">=</span><span class="n">properties</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Successfully created collection: </span><span class="si">{</span><span class="n">collection</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">except</span> <span class="n">WeaviateBaseError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to create collection: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">raise</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">store_chunk</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">chunk</span><span class="p">:</span> <span class="n">DataChunk</span><span class="p">,</span> <span class="n">collection</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Store a single DataChunk in the vector store using V4 API.</span>

<span class="sd">        Args:</span>
<span class="sd">            chunk: DataChunk object to store</span>
<span class="sd">            collection: Name of the Weaviate class for document storage</span>
<span class="sd">        Returns:</span>
<span class="sd">            str: UUID of the stored chunk</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If chunk is None or empty</span>
<span class="sd">            WeaviateBaseError: If storage operation fails</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">chunk</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Chunk cannot be None&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">chunk</span><span class="o">.</span><span class="n">text</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">chunk</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Chunk text cannot be empty&quot;</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Ensure collection exists before storing chunks</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">create_schema</span><span class="p">(</span><span class="n">collection</span><span class="p">)</span>

            <span class="c1"># Get the collection</span>
            <span class="n">collection</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">db_manager</span><span class="o">.</span><span class="n">get_collection</span><span class="p">(</span><span class="n">collection</span><span class="p">)</span>

            <span class="c1"># Prepare the object data</span>
            <span class="n">object_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prepare_data_object</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>

            <span class="c1"># Store the object using V4 API</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Storing chunk: </span><span class="si">{</span><span class="n">chunk</span><span class="o">.</span><span class="n">chunk_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">collection</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span>
                <span class="n">properties</span><span class="o">=</span><span class="n">object_data</span><span class="p">,</span>
                <span class="n">uuid</span><span class="o">=</span><span class="n">object_data</span><span class="p">[</span><span class="s2">&quot;chunk_key&quot;</span><span class="p">],</span>
            <span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Successfully stored chunk </span><span class="si">{</span><span class="n">chunk</span><span class="o">.</span><span class="n">chunk_id</span><span class="si">}</span><span class="s2"> with UUID: </span><span class="si">{</span><span class="n">object_data</span><span class="p">[</span><span class="s1">&#39;chunk_key&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>

            <span class="k">return</span> <span class="n">object_data</span><span class="p">[</span><span class="s2">&quot;chunk_key&quot;</span><span class="p">]</span>

        <span class="k">except</span> <span class="n">WeaviateBaseError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to store chunk </span><span class="si">{</span><span class="n">chunk</span><span class="o">.</span><span class="n">chunk_id</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">raise</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">store_chunks</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">chunks</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">DataChunk</span><span class="p">],</span> <span class="n">collection</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">batch_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Store multiple DataChunks in the vector store using V4 API.</span>

<span class="sd">        Args:</span>
<span class="sd">            chunks: List of DataChunk objects to store</span>
<span class="sd">            collection: Name of the Weaviate class for document storage</span>
<span class="sd">            batch_size: Number of chunks to process in each batch</span>

<span class="sd">        Returns:</span>
<span class="sd">            List[str]: List of chunk keys (UUIDs) that were stored</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If chunks list is empty or contains invalid chunks</span>
<span class="sd">            WeaviateBaseError: If storage operation fails</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">chunks</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Chunks list cannot be empty&quot;</span><span class="p">)</span>

        <span class="c1"># Filter out invalid chunks</span>
        <span class="n">valid_chunks</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="n">chunks</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">chunk</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">chunk</span><span class="o">.</span><span class="n">text</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">chunk</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Skipping invalid chunk: </span><span class="si">{</span><span class="n">chunk</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">continue</span>
            <span class="n">valid_chunks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">valid_chunks</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No valid chunks found in the list&quot;</span><span class="p">)</span>

        <span class="n">total_chunks</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">valid_chunks</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Ensure collection exists before storing chunks</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">create_schema</span><span class="p">(</span><span class="n">collection</span><span class="p">)</span>

            <span class="c1"># Get the collection</span>
            <span class="n">collection</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">db_manager</span><span class="o">.</span><span class="n">get_collection</span><span class="p">(</span><span class="n">collection</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Storing </span><span class="si">{</span><span class="n">total_chunks</span><span class="si">}</span><span class="s2"> chunks in batches of </span><span class="si">{</span><span class="n">batch_size</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>

            <span class="c1"># Store UUIDs for return</span>
            <span class="n">stored_uuids</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="c1"># Process chunks in batches using V4 API</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">total_chunks</span><span class="p">,</span> <span class="n">batch_size</span><span class="p">):</span>
                <span class="n">batch</span> <span class="o">=</span> <span class="n">valid_chunks</span><span class="p">[</span><span class="n">i</span> <span class="p">:</span> <span class="n">i</span> <span class="o">+</span> <span class="n">batch_size</span><span class="p">]</span>

                <span class="c1"># Prepare batch data</span>
                <span class="n">batch_data</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="n">batch</span><span class="p">:</span>
                    <span class="n">object_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prepare_data_object</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>
                    <span class="n">batch_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">object_data</span><span class="p">)</span>

                <span class="c1"># Store each chunk individually to avoid gRPC issues</span>
                <span class="n">batch_num</span> <span class="o">=</span> <span class="n">i</span> <span class="o">//</span> <span class="n">batch_size</span> <span class="o">+</span> <span class="mi">1</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Storing batch </span><span class="si">{</span><span class="n">batch_num</span><span class="si">}</span><span class="s2"> with </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">batch</span><span class="p">)</span><span class="si">}</span><span class="s2"> chunks&quot;</span><span class="p">)</span>

                <span class="k">for</span> <span class="n">object_data</span> <span class="ow">in</span> <span class="n">batch_data</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="c1"># Insert individual object using V4 API</span>
                        <span class="n">collection</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span>
                            <span class="n">properties</span><span class="o">=</span><span class="n">object_data</span><span class="p">,</span>
                            <span class="n">uuid</span><span class="o">=</span><span class="n">object_data</span><span class="p">[</span><span class="s2">&quot;chunk_key&quot;</span><span class="p">],</span>
                        <span class="p">)</span>
                        <span class="n">stored_uuids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">object_data</span><span class="p">[</span><span class="s2">&quot;chunk_key&quot;</span><span class="p">])</span>

                    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to insert object: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                        <span class="k">continue</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Successfully stored </span><span class="si">{</span><span class="n">total_chunks</span><span class="si">}</span><span class="s2"> chunks&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">stored_uuids</span>

        <span class="k">except</span> <span class="n">WeaviateBaseError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to store chunks: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">raise</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">prepare_data_object</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">chunk</span><span class="p">:</span> <span class="n">DataChunk</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Prepare the data object for the chunk.</span>

<span class="sd">        Args:</span>
<span class="sd">            chunk: DataChunk object to prepare</span>

<span class="sd">        Returns:</span>
<span class="sd">            Dict[str, Any]: Prepared data object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">chunk</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Chunk cannot be None&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">chunk</span><span class="o">.</span><span class="n">text</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">chunk</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Chunk text cannot be empty&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">chunk</span><span class="o">.</span><span class="n">chunk_id</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">chunk</span><span class="o">.</span><span class="n">chunk_id</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Chunk ID cannot be empty&quot;</span><span class="p">)</span>

        <span class="n">custom_meta</span> <span class="o">=</span> <span class="n">chunk</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">custom_metadata</span> <span class="ow">or</span> <span class="p">{}</span>
        <span class="n">custom_metadata_json</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">custom_meta</span><span class="p">)</span> <span class="k">if</span> <span class="n">custom_meta</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>

        <span class="c1"># Extract tags value to avoid redundant dictionary lookups</span>
        <span class="n">tags_value</span> <span class="o">=</span> <span class="n">custom_meta</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;tags&quot;</span><span class="p">,</span> <span class="p">[])</span>
        <span class="n">tags_string</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tags_value</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tags_value</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="k">else</span> <span class="nb">str</span><span class="p">(</span><span class="n">tags_value</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="p">{</span>
            <span class="c1"># Core fields</span>
            <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="n">chunk</span><span class="o">.</span><span class="n">text</span><span class="p">,</span>
            <span class="s2">&quot;chunk_id&quot;</span><span class="p">:</span> <span class="n">chunk</span><span class="o">.</span><span class="n">chunk_id</span><span class="p">,</span>
            <span class="s2">&quot;chunk_key&quot;</span><span class="p">:</span> <span class="n">generate_uuid5</span><span class="p">(</span><span class="n">chunk</span><span class="o">.</span><span class="n">chunk_id</span><span class="p">),</span>
            <span class="s2">&quot;source_document&quot;</span><span class="p">:</span> <span class="n">chunk</span><span class="o">.</span><span class="n">source_document</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="s2">&quot;chunk_type&quot;</span><span class="p">:</span> <span class="n">chunk</span><span class="o">.</span><span class="n">chunk_type</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="s2">&quot;created_at&quot;</span><span class="p">:</span> <span class="n">chunk</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">created_at</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="c1"># Document-specific fields</span>
            <span class="s2">&quot;metadata_chunk_idx&quot;</span><span class="p">:</span> <span class="n">chunk</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">chunk_idx</span><span class="p">,</span>
            <span class="s2">&quot;metadata_chunk_size&quot;</span><span class="p">:</span> <span class="n">chunk</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">chunk_size</span><span class="p">,</span>
            <span class="s2">&quot;metadata_total_chunks&quot;</span><span class="p">:</span> <span class="n">chunk</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">total_chunks</span><span class="p">,</span>
            <span class="s2">&quot;metadata_created_at&quot;</span><span class="p">:</span> <span class="n">chunk</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">created_at</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="s2">&quot;page_number&quot;</span><span class="p">:</span> <span class="n">chunk</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">page_number</span> <span class="ow">or</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s2">&quot;section_title&quot;</span><span class="p">:</span> <span class="n">chunk</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">section_title</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="c1"># Email-specific fields</span>
            <span class="s2">&quot;email_subject&quot;</span><span class="p">:</span> <span class="n">chunk</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">email_subject</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="s2">&quot;email_sender&quot;</span><span class="p">:</span> <span class="n">chunk</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">email_sender</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="s2">&quot;email_recipient&quot;</span><span class="p">:</span> <span class="n">chunk</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">email_recipient</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="s2">&quot;email_date&quot;</span><span class="p">:</span> <span class="n">chunk</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">email_date</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="s2">&quot;email_id&quot;</span><span class="p">:</span> <span class="n">chunk</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">email_id</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="s2">&quot;email_folder&quot;</span><span class="p">:</span> <span class="n">chunk</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">email_folder</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="c1"># Custom metadata fields</span>
            <span class="s2">&quot;custom_metadata&quot;</span><span class="p">:</span> <span class="n">custom_metadata_json</span><span class="p">,</span>
            <span class="s2">&quot;language&quot;</span><span class="p">:</span> <span class="n">custom_meta</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;language&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
            <span class="s2">&quot;domain&quot;</span><span class="p">:</span> <span class="n">custom_meta</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;domain&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
            <span class="s2">&quot;confidence&quot;</span><span class="p">:</span> <span class="n">custom_meta</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;confidence&quot;</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
            <span class="s2">&quot;tags&quot;</span><span class="p">:</span> <span class="n">tags_string</span><span class="p">,</span>
            <span class="s2">&quot;priority&quot;</span><span class="p">:</span> <span class="n">custom_meta</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;priority&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
            <span class="s2">&quot;content_category&quot;</span><span class="p">:</span> <span class="n">custom_meta</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;content_category&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
        <span class="p">}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_chunk_by_id</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">chunk_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">collection</span><span class="p">:</span> <span class="nb">str</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">RetrievalResultItem</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Retrieve a specific chunk by its chunk_id using V4 API.</span>

<span class="sd">        Args:</span>
<span class="sd">            chunk_id: ID of the chunk</span>
<span class="sd">            collection: Name of the Weaviate class for document storage</span>
<span class="sd">        Returns:</span>
<span class="sd">            Optional[RetrievalResultItem]: Chunk data if found, None otherwise</span>

<span class="sd">        Raises:</span>
<span class="sd">            WeaviateBaseError: If retrieval operation fails</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Get the collection</span>
            <span class="n">collection</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">db_manager</span><span class="o">.</span><span class="n">get_collection</span><span class="p">(</span><span class="n">collection</span><span class="p">)</span>

            <span class="c1"># Query using V4 API</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">collection</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">fetch_object_by_id</span><span class="p">(</span>
                <span class="n">uuid</span><span class="o">=</span><span class="n">generate_uuid5</span><span class="p">(</span><span class="n">chunk_id</span><span class="p">),</span>
            <span class="p">)</span>

            <span class="k">if</span> <span class="n">result</span><span class="p">:</span>
                <span class="n">properties</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">properties</span>
                <span class="c1"># Create RetrievalResultItem with structured metadata</span>
                <span class="k">return</span> <span class="n">RetrievalResultItem</span><span class="p">(</span>
                    <span class="n">content</span><span class="o">=</span><span class="n">properties</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;content&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
                    <span class="n">chunk_id</span><span class="o">=</span><span class="n">properties</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;chunk_id&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
                    <span class="n">properties</span><span class="o">=</span><span class="n">properties</span><span class="p">,</span>
                    <span class="n">metadata</span><span class="o">=</span><span class="n">RetrievalMetadata</span><span class="o">.</span><span class="n">from_properties</span><span class="p">(</span><span class="n">properties</span><span class="p">),</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">None</span>

        <span class="k">except</span> <span class="n">WeaviateBaseError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to retrieve chunk </span><span class="si">{</span><span class="n">chunk_id</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">raise</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">delete_chunk</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">chunk_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">collection</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Delete a chunk by its chunk_id using V4 API.</span>

<span class="sd">        Args:</span>
<span class="sd">            chunk_id: ID of the chunk to delete</span>
<span class="sd">            collection: Name of the Weaviate class for document storage</span>
<span class="sd">        Returns:</span>
<span class="sd">            bool: True if deletion was successful, False otherwise</span>

<span class="sd">        Raises:</span>
<span class="sd">            WeaviateBaseError: If deletion operation fails</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Get the collection</span>
            <span class="n">collection</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">db_manager</span><span class="o">.</span><span class="n">get_collection</span><span class="p">(</span><span class="n">collection</span><span class="p">)</span>

            <span class="c1"># Delete by ID</span>
            <span class="n">collection</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">delete_by_id</span><span class="p">(</span><span class="n">uuid</span><span class="o">=</span><span class="n">generate_uuid5</span><span class="p">(</span><span class="n">chunk_id</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Successfully deleted chunk: </span><span class="si">{</span><span class="n">chunk_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">True</span>

        <span class="k">except</span> <span class="n">WeaviateBaseError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to delete chunk </span><span class="si">{</span><span class="n">chunk_id</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">raise</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">update_chunk</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">chunk_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">properties</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">collection</span><span class="p">:</span> <span class="nb">str</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Update a chunk by its chunk_id using V4 API.</span>

<span class="sd">        Args:</span>
<span class="sd">            chunk_id: ID of the chunk to update</span>
<span class="sd">            properties: Properties to update</span>
<span class="sd">            collection: Name of the Weaviate class for document storage</span>
<span class="sd">        Returns:</span>
<span class="sd">            bool: True if update was successful, False otherwise</span>

<span class="sd">        Raises:</span>
<span class="sd">            WeaviateBaseError: If update operation fails</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Get the collection</span>
            <span class="n">collection</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">db_manager</span><span class="o">.</span><span class="n">get_collection</span><span class="p">(</span><span class="n">collection</span><span class="p">)</span>

            <span class="c1"># Update by ID</span>
            <span class="n">collection</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">update_by_id</span><span class="p">(</span>
                <span class="n">uuid</span><span class="o">=</span><span class="n">generate_uuid5</span><span class="p">(</span><span class="n">chunk_id</span><span class="p">),</span>
                <span class="n">properties</span><span class="o">=</span><span class="n">properties</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Successfully updated chunk: </span><span class="si">{</span><span class="n">chunk_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">True</span>

        <span class="k">except</span> <span class="n">WeaviateBaseError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to update chunk </span><span class="si">{</span><span class="n">chunk_id</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">raise</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">chunk_exists</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">chunk_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">collection</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if a chunk exists by its chunk_id using V4 API.</span>

<span class="sd">        Args:</span>
<span class="sd">            chunk_id: ID of the chunk to check</span>
<span class="sd">            collection: Name of the Weaviate class for document storage</span>
<span class="sd">        Returns:</span>
<span class="sd">            bool: True if chunk exists, False otherwise</span>

<span class="sd">        Raises:</span>
<span class="sd">            WeaviateBaseError: If check operation fails</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Get the collection</span>
            <span class="n">collection</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">db_manager</span><span class="o">.</span><span class="n">get_collection</span><span class="p">(</span><span class="n">collection</span><span class="p">)</span>

            <span class="c1"># Check if chunk exists by ID</span>
            <span class="k">return</span> <span class="n">collection</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">uuid</span><span class="o">=</span><span class="n">generate_uuid5</span><span class="p">(</span><span class="n">chunk_id</span><span class="p">))</span>
        <span class="k">except</span> <span class="n">WeaviateBaseError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to check if chunk </span><span class="si">{</span><span class="n">chunk_id</span><span class="si">}</span><span class="s2"> exists: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">raise</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">collection</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get statistics about the vector store using V4 API.</span>

<span class="sd">        Args:</span>
<span class="sd">            collection: Name of the Weaviate class for document storage</span>

<span class="sd">        Returns:</span>
<span class="sd">            Dict[str, Any]: Statistics including total objects, collection</span>
<span class="sd">                info, etc.</span>

<span class="sd">        Raises:</span>
<span class="sd">            WeaviateBaseError: If stats retrieval fails</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Get the collection</span>
            <span class="n">collection</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">db_manager</span><span class="o">.</span><span class="n">get_collection</span><span class="p">(</span><span class="n">collection</span><span class="p">)</span>

            <span class="c1"># Get total object count using V4 API</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">collection</span><span class="o">.</span><span class="n">aggregate</span><span class="o">.</span><span class="n">over_all</span><span class="p">(</span><span class="n">total_count</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

            <span class="n">total_objects</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">total_count</span> <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">total_count</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="mi">0</span>

            <span class="c1"># Get collection information</span>
            <span class="n">collection_info</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">collection</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">collection</span><span class="o">.</span><span class="n">config</span><span class="p">,</span> <span class="s2">&quot;description&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
                <span class="s2">&quot;vectorizer&quot;</span><span class="p">:</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">collection</span><span class="o">.</span><span class="n">config</span><span class="p">,</span> <span class="s2">&quot;vectorizer_config&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
            <span class="p">}</span>

            <span class="k">return</span> <span class="p">{</span>
                <span class="s2">&quot;total_objects&quot;</span><span class="p">:</span> <span class="n">total_objects</span><span class="p">,</span>
                <span class="s2">&quot;collection&quot;</span><span class="p">:</span> <span class="n">collection</span><span class="p">,</span>
                <span class="s2">&quot;collection_info&quot;</span><span class="p">:</span> <span class="n">collection_info</span><span class="p">,</span>
                <span class="s2">&quot;is_connected&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_connected</span><span class="p">(),</span>
                <span class="s2">&quot;db_manager_url&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">db_manager</span><span class="o">.</span><span class="n">url</span><span class="p">,</span>
            <span class="p">}</span>

        <span class="k">except</span> <span class="n">WeaviateBaseError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to get stats: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">raise</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">clear_all</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">collection</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Clear all objects from the vector store using V4 API.</span>

<span class="sd">        Args:</span>
<span class="sd">            collection: Name of the Weaviate class for document storage</span>

<span class="sd">        Returns:</span>
<span class="sd">            None</span>

<span class="sd">        Raises:</span>
<span class="sd">            WeaviateBaseError: If clearing operation fails</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Clearing all objects from collection: </span><span class="si">{</span><span class="n">collection</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">db_manager</span><span class="o">.</span><span class="n">delete_collection</span><span class="p">(</span><span class="n">collection</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Successfully cleared all objects from collection: </span><span class="si">{</span><span class="n">collection</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
        <span class="k">except</span> <span class="n">WeaviateBaseError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to clear all objects: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">raise</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Close the connection to Weaviate.</span>

<span class="sd">        Returns:</span>
<span class="sd">            None</span>

<span class="sd">        Raises:</span>
<span class="sd">            Exception: If closing operation fails</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;db_manager&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">db_manager</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">db_manager</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Vector store connection closed&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error closing vector store: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Context manager entry.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exc_type</span><span class="p">,</span> <span class="n">exc_val</span><span class="p">,</span> <span class="n">exc_tb</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Context manager exit.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h5 id="ragora.core.vector_store.VectorStore.chunk_exists" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">chunk_exists</span><span class="p">(</span><span class="n">chunk_id</span><span class="p">,</span> <span class="n">collection</span><span class="p">)</span></code>

<a href="#ragora.core.vector_store.VectorStore.chunk_exists" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Check if a chunk exists by its chunk_id using V4 API.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>chunk_id</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>ID of the chunk to check</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>collection</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Name of the Weaviate class for document storage</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>
        <p>Returns:
    bool: True if chunk exists, False otherwise</p>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="weaviate.exceptions.WeaviateBaseError">WeaviateBaseError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If check operation fails</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/core/vector_store.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">chunk_exists</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">chunk_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">collection</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Check if a chunk exists by its chunk_id using V4 API.</span>

<span class="sd">    Args:</span>
<span class="sd">        chunk_id: ID of the chunk to check</span>
<span class="sd">        collection: Name of the Weaviate class for document storage</span>
<span class="sd">    Returns:</span>
<span class="sd">        bool: True if chunk exists, False otherwise</span>

<span class="sd">    Raises:</span>
<span class="sd">        WeaviateBaseError: If check operation fails</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Get the collection</span>
        <span class="n">collection</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">db_manager</span><span class="o">.</span><span class="n">get_collection</span><span class="p">(</span><span class="n">collection</span><span class="p">)</span>

        <span class="c1"># Check if chunk exists by ID</span>
        <span class="k">return</span> <span class="n">collection</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">uuid</span><span class="o">=</span><span class="n">generate_uuid5</span><span class="p">(</span><span class="n">chunk_id</span><span class="p">))</span>
    <span class="k">except</span> <span class="n">WeaviateBaseError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to check if chunk </span><span class="si">{</span><span class="n">chunk_id</span><span class="si">}</span><span class="s2"> exists: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">raise</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="ragora.core.vector_store.VectorStore.clear_all" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">clear_all</span><span class="p">(</span><span class="n">collection</span><span class="p">)</span></code>

<a href="#ragora.core.vector_store.VectorStore.clear_all" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Clear all objects from the vector store using V4 API.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>collection</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Name of the Weaviate class for document storage</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>None</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="weaviate.exceptions.WeaviateBaseError">WeaviateBaseError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If clearing operation fails</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/core/vector_store.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">clear_all</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">collection</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Clear all objects from the vector store using V4 API.</span>

<span class="sd">    Args:</span>
<span class="sd">        collection: Name of the Weaviate class for document storage</span>

<span class="sd">    Returns:</span>
<span class="sd">        None</span>

<span class="sd">    Raises:</span>
<span class="sd">        WeaviateBaseError: If clearing operation fails</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Clearing all objects from collection: </span><span class="si">{</span><span class="n">collection</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">db_manager</span><span class="o">.</span><span class="n">delete_collection</span><span class="p">(</span><span class="n">collection</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Successfully cleared all objects from collection: </span><span class="si">{</span><span class="n">collection</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
    <span class="k">except</span> <span class="n">WeaviateBaseError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to clear all objects: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">raise</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="ragora.core.vector_store.VectorStore.close" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">close</span><span class="p">()</span></code>

<a href="#ragora.core.vector_store.VectorStore.close" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Close the connection to Weaviate.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>None</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="Exception">Exception</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If closing operation fails</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/core/vector_store.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Close the connection to Weaviate.</span>

<span class="sd">    Returns:</span>
<span class="sd">        None</span>

<span class="sd">    Raises:</span>
<span class="sd">        Exception: If closing operation fails</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;db_manager&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">db_manager</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">db_manager</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Vector store connection closed&quot;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error closing vector store: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="ragora.core.vector_store.VectorStore.create_schema" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">create_schema</span><span class="p">(</span><span class="n">collection</span><span class="p">,</span> <span class="n">force_recreate</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#ragora.core.vector_store.VectorStore.create_schema" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Create the Weaviate collection for document storage using V4 API.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>collection</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Name of the collection for document storage</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>force_recreate</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, delete existing collection before
creating new one</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>None</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="weaviate.exceptions.WeaviateBaseError">WeaviateBaseError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If collection creation fails</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/core/vector_store.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">create_schema</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">collection</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">force_recreate</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create the Weaviate collection for document storage using V4 API.</span>

<span class="sd">    Args:</span>
<span class="sd">        collection: Name of the collection for document storage</span>
<span class="sd">        force_recreate: If True, delete existing collection before</span>
<span class="sd">            creating new one</span>

<span class="sd">    Returns:</span>
<span class="sd">        None</span>

<span class="sd">    Raises:</span>
<span class="sd">        WeaviateBaseError: If collection creation fails</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Check if collection already exists</span>
        <span class="n">collection_exists</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">db_manager</span><span class="o">.</span><span class="n">collection_exists</span><span class="p">(</span><span class="n">collection</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">collection_exists</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">force_recreate</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Deleting existing collection: </span><span class="si">{</span><span class="n">collection</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">db_manager</span><span class="o">.</span><span class="n">delete_collection</span><span class="p">(</span><span class="n">collection</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Collection </span><span class="si">{</span><span class="n">collection</span><span class="si">}</span><span class="s2"> already exists returning without creating new one&quot;</span>
                <span class="p">)</span>
                <span class="k">return</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Creating new collection: </span><span class="si">{</span><span class="n">collection</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="c1"># Define schema properties</span>
        <span class="n">properties</span> <span class="o">=</span> <span class="p">[</span>
            <span class="c1"># Core fields</span>
            <span class="n">Property</span><span class="p">(</span>
                <span class="n">name</span><span class="o">=</span><span class="s2">&quot;content&quot;</span><span class="p">,</span>
                <span class="n">data_type</span><span class="o">=</span><span class="n">DataType</span><span class="o">.</span><span class="n">TEXT</span><span class="p">,</span>
                <span class="n">description</span><span class="o">=</span><span class="s2">&quot;The text content of the document chunk&quot;</span><span class="p">,</span>
                <span class="n">vectorize_property_name</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="n">Property</span><span class="p">(</span>
                <span class="n">name</span><span class="o">=</span><span class="s2">&quot;chunk_id&quot;</span><span class="p">,</span>
                <span class="n">data_type</span><span class="o">=</span><span class="n">DataType</span><span class="o">.</span><span class="n">TEXT</span><span class="p">,</span>
                <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Unique identifier for the chunk&quot;</span><span class="p">,</span>
                <span class="n">vectorize_property_name</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="n">Property</span><span class="p">(</span>
                <span class="n">name</span><span class="o">=</span><span class="s2">&quot;chunk_key&quot;</span><span class="p">,</span>
                <span class="n">data_type</span><span class="o">=</span><span class="n">DataType</span><span class="o">.</span><span class="n">TEXT</span><span class="p">,</span>
                <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Key for the chunk (UUID5)&quot;</span><span class="p">,</span>
                <span class="n">vectorize_property_name</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="n">Property</span><span class="p">(</span>
                <span class="n">name</span><span class="o">=</span><span class="s2">&quot;source_document&quot;</span><span class="p">,</span>
                <span class="n">data_type</span><span class="o">=</span><span class="n">DataType</span><span class="o">.</span><span class="n">TEXT</span><span class="p">,</span>
                <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Source document filename&quot;</span><span class="p">,</span>
                <span class="n">vectorize_property_name</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="n">Property</span><span class="p">(</span>
                <span class="n">name</span><span class="o">=</span><span class="s2">&quot;chunk_type&quot;</span><span class="p">,</span>
                <span class="n">data_type</span><span class="o">=</span><span class="n">DataType</span><span class="o">.</span><span class="n">TEXT</span><span class="p">,</span>
                <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Type of chunk (text, citation, equation, etc.)&quot;</span><span class="p">,</span>
                <span class="n">vectorize_property_name</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="n">Property</span><span class="p">(</span>
                <span class="n">name</span><span class="o">=</span><span class="s2">&quot;created_at&quot;</span><span class="p">,</span>
                <span class="n">data_type</span><span class="o">=</span><span class="n">DataType</span><span class="o">.</span><span class="n">TEXT</span><span class="p">,</span>
                <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Creation timestamp&quot;</span><span class="p">,</span>
                <span class="n">vectorize_property_name</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="c1"># Document-specific fields</span>
            <span class="n">Property</span><span class="p">(</span>
                <span class="n">name</span><span class="o">=</span><span class="s2">&quot;metadata_chunk_idx&quot;</span><span class="p">,</span>
                <span class="n">data_type</span><span class="o">=</span><span class="n">DataType</span><span class="o">.</span><span class="n">INT</span><span class="p">,</span>
                <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Chunk index from metadata&quot;</span><span class="p">,</span>
                <span class="n">vectorize_property_name</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="n">Property</span><span class="p">(</span>
                <span class="n">name</span><span class="o">=</span><span class="s2">&quot;metadata_chunk_size&quot;</span><span class="p">,</span>
                <span class="n">data_type</span><span class="o">=</span><span class="n">DataType</span><span class="o">.</span><span class="n">INT</span><span class="p">,</span>
                <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Chunk size from metadata&quot;</span><span class="p">,</span>
                <span class="n">vectorize_property_name</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="n">Property</span><span class="p">(</span>
                <span class="n">name</span><span class="o">=</span><span class="s2">&quot;metadata_total_chunks&quot;</span><span class="p">,</span>
                <span class="n">data_type</span><span class="o">=</span><span class="n">DataType</span><span class="o">.</span><span class="n">INT</span><span class="p">,</span>
                <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Total chunks from metadata&quot;</span><span class="p">,</span>
                <span class="n">vectorize_property_name</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="n">Property</span><span class="p">(</span>
                <span class="n">name</span><span class="o">=</span><span class="s2">&quot;metadata_created_at&quot;</span><span class="p">,</span>
                <span class="n">data_type</span><span class="o">=</span><span class="n">DataType</span><span class="o">.</span><span class="n">TEXT</span><span class="p">,</span>
                <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Created at timestamp from metadata&quot;</span><span class="p">,</span>
                <span class="n">vectorize_property_name</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="n">Property</span><span class="p">(</span>
                <span class="n">name</span><span class="o">=</span><span class="s2">&quot;page_number&quot;</span><span class="p">,</span>
                <span class="n">data_type</span><span class="o">=</span><span class="n">DataType</span><span class="o">.</span><span class="n">INT</span><span class="p">,</span>
                <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Page number in source document&quot;</span><span class="p">,</span>
                <span class="n">vectorize_property_name</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="n">Property</span><span class="p">(</span>
                <span class="n">name</span><span class="o">=</span><span class="s2">&quot;section_title&quot;</span><span class="p">,</span>
                <span class="n">data_type</span><span class="o">=</span><span class="n">DataType</span><span class="o">.</span><span class="n">TEXT</span><span class="p">,</span>
                <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Section or chapter title&quot;</span><span class="p">,</span>
                <span class="n">vectorize_property_name</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="c1"># Email-specific fields</span>
            <span class="n">Property</span><span class="p">(</span>
                <span class="n">name</span><span class="o">=</span><span class="s2">&quot;email_subject&quot;</span><span class="p">,</span>
                <span class="n">data_type</span><span class="o">=</span><span class="n">DataType</span><span class="o">.</span><span class="n">TEXT</span><span class="p">,</span>
                <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Email subject line&quot;</span><span class="p">,</span>
                <span class="n">vectorize_property_name</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="n">Property</span><span class="p">(</span>
                <span class="n">name</span><span class="o">=</span><span class="s2">&quot;email_sender&quot;</span><span class="p">,</span>
                <span class="n">data_type</span><span class="o">=</span><span class="n">DataType</span><span class="o">.</span><span class="n">TEXT</span><span class="p">,</span>
                <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Email sender address&quot;</span><span class="p">,</span>
                <span class="n">vectorize_property_name</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="n">Property</span><span class="p">(</span>
                <span class="n">name</span><span class="o">=</span><span class="s2">&quot;email_recipient&quot;</span><span class="p">,</span>
                <span class="n">data_type</span><span class="o">=</span><span class="n">DataType</span><span class="o">.</span><span class="n">TEXT</span><span class="p">,</span>
                <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Email recipient address&quot;</span><span class="p">,</span>
                <span class="n">vectorize_property_name</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="n">Property</span><span class="p">(</span>
                <span class="n">name</span><span class="o">=</span><span class="s2">&quot;email_date&quot;</span><span class="p">,</span>
                <span class="n">data_type</span><span class="o">=</span><span class="n">DataType</span><span class="o">.</span><span class="n">TEXT</span><span class="p">,</span>
                <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Email timestamp&quot;</span><span class="p">,</span>
                <span class="n">vectorize_property_name</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="n">Property</span><span class="p">(</span>
                <span class="n">name</span><span class="o">=</span><span class="s2">&quot;email_id&quot;</span><span class="p">,</span>
                <span class="n">data_type</span><span class="o">=</span><span class="n">DataType</span><span class="o">.</span><span class="n">TEXT</span><span class="p">,</span>
                <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Unique email identifier&quot;</span><span class="p">,</span>
                <span class="n">vectorize_property_name</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="n">Property</span><span class="p">(</span>
                <span class="n">name</span><span class="o">=</span><span class="s2">&quot;email_folder&quot;</span><span class="p">,</span>
                <span class="n">data_type</span><span class="o">=</span><span class="n">DataType</span><span class="o">.</span><span class="n">TEXT</span><span class="p">,</span>
                <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Email folder/path&quot;</span><span class="p">,</span>
                <span class="n">vectorize_property_name</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="c1"># Custom metadata fields</span>
            <span class="n">Property</span><span class="p">(</span>
                <span class="n">name</span><span class="o">=</span><span class="s2">&quot;custom_metadata&quot;</span><span class="p">,</span>
                <span class="n">data_type</span><span class="o">=</span><span class="n">DataType</span><span class="o">.</span><span class="n">TEXT</span><span class="p">,</span>
                <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Custom metadata as JSON string&quot;</span><span class="p">,</span>
                <span class="n">vectorize_property_name</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="n">Property</span><span class="p">(</span>
                <span class="n">name</span><span class="o">=</span><span class="s2">&quot;language&quot;</span><span class="p">,</span>
                <span class="n">data_type</span><span class="o">=</span><span class="n">DataType</span><span class="o">.</span><span class="n">TEXT</span><span class="p">,</span>
                <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Content language (e.g., en, es, fr)&quot;</span><span class="p">,</span>
                <span class="n">vectorize_property_name</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="n">Property</span><span class="p">(</span>
                <span class="n">name</span><span class="o">=</span><span class="s2">&quot;domain&quot;</span><span class="p">,</span>
                <span class="n">data_type</span><span class="o">=</span><span class="n">DataType</span><span class="o">.</span><span class="n">TEXT</span><span class="p">,</span>
                <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Content domain (e.g., scientific, legal, medical)&quot;</span><span class="p">,</span>
                <span class="n">vectorize_property_name</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="n">Property</span><span class="p">(</span>
                <span class="n">name</span><span class="o">=</span><span class="s2">&quot;confidence&quot;</span><span class="p">,</span>
                <span class="n">data_type</span><span class="o">=</span><span class="n">DataType</span><span class="o">.</span><span class="n">NUMBER</span><span class="p">,</span>
                <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Processing confidence score (0.0-1.0)&quot;</span><span class="p">,</span>
                <span class="n">vectorize_property_name</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="n">Property</span><span class="p">(</span>
                <span class="n">name</span><span class="o">=</span><span class="s2">&quot;tags&quot;</span><span class="p">,</span>
                <span class="n">data_type</span><span class="o">=</span><span class="n">DataType</span><span class="o">.</span><span class="n">TEXT</span><span class="p">,</span>
                <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Comma-separated tags/categories&quot;</span><span class="p">,</span>
                <span class="n">vectorize_property_name</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="n">Property</span><span class="p">(</span>
                <span class="n">name</span><span class="o">=</span><span class="s2">&quot;priority&quot;</span><span class="p">,</span>
                <span class="n">data_type</span><span class="o">=</span><span class="n">DataType</span><span class="o">.</span><span class="n">INT</span><span class="p">,</span>
                <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Content priority/importance level&quot;</span><span class="p">,</span>
                <span class="n">vectorize_property_name</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="n">Property</span><span class="p">(</span>
                <span class="n">name</span><span class="o">=</span><span class="s2">&quot;content_category&quot;</span><span class="p">,</span>
                <span class="n">data_type</span><span class="o">=</span><span class="n">DataType</span><span class="o">.</span><span class="n">TEXT</span><span class="p">,</span>
                <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Fine-grained content categorization&quot;</span><span class="p">,</span>
                <span class="n">vectorize_property_name</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Creating collection: </span><span class="si">{</span><span class="n">collection</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Create the collection using DatabaseManager</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">db_manager</span><span class="o">.</span><span class="n">create_collection</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="n">collection</span><span class="p">,</span>
            <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Document chunks with embeddings for RAG system&quot;</span><span class="p">,</span>
            <span class="n">vectorizer_config</span><span class="o">=</span><span class="n">Configure</span><span class="o">.</span><span class="n">Vectorizer</span><span class="o">.</span><span class="n">text2vec_transformers</span><span class="p">(),</span>
            <span class="n">properties</span><span class="o">=</span><span class="n">properties</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Successfully created collection: </span><span class="si">{</span><span class="n">collection</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">except</span> <span class="n">WeaviateBaseError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to create collection: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">raise</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="ragora.core.vector_store.VectorStore.delete_chunk" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">delete_chunk</span><span class="p">(</span><span class="n">chunk_id</span><span class="p">,</span> <span class="n">collection</span><span class="p">)</span></code>

<a href="#ragora.core.vector_store.VectorStore.delete_chunk" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Delete a chunk by its chunk_id using V4 API.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>chunk_id</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>ID of the chunk to delete</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>collection</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Name of the Weaviate class for document storage</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>
        <p>Returns:
    bool: True if deletion was successful, False otherwise</p>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="weaviate.exceptions.WeaviateBaseError">WeaviateBaseError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If deletion operation fails</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/core/vector_store.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">delete_chunk</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">chunk_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">collection</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Delete a chunk by its chunk_id using V4 API.</span>

<span class="sd">    Args:</span>
<span class="sd">        chunk_id: ID of the chunk to delete</span>
<span class="sd">        collection: Name of the Weaviate class for document storage</span>
<span class="sd">    Returns:</span>
<span class="sd">        bool: True if deletion was successful, False otherwise</span>

<span class="sd">    Raises:</span>
<span class="sd">        WeaviateBaseError: If deletion operation fails</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Get the collection</span>
        <span class="n">collection</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">db_manager</span><span class="o">.</span><span class="n">get_collection</span><span class="p">(</span><span class="n">collection</span><span class="p">)</span>

        <span class="c1"># Delete by ID</span>
        <span class="n">collection</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">delete_by_id</span><span class="p">(</span><span class="n">uuid</span><span class="o">=</span><span class="n">generate_uuid5</span><span class="p">(</span><span class="n">chunk_id</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Successfully deleted chunk: </span><span class="si">{</span><span class="n">chunk_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">except</span> <span class="n">WeaviateBaseError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to delete chunk </span><span class="si">{</span><span class="n">chunk_id</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">raise</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="ragora.core.vector_store.VectorStore.get_chunk_by_id" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_chunk_by_id</span><span class="p">(</span><span class="n">chunk_id</span><span class="p">,</span> <span class="n">collection</span><span class="p">)</span></code>

<a href="#ragora.core.vector_store.VectorStore.get_chunk_by_id" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Retrieve a specific chunk by its chunk_id using V4 API.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>chunk_id</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>ID of the chunk</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>collection</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Name of the Weaviate class for document storage</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>
        <p>Returns:
    Optional[RetrievalResultItem]: Chunk data if found, None otherwise</p>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="weaviate.exceptions.WeaviateBaseError">WeaviateBaseError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If retrieval operation fails</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/core/vector_store.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_chunk_by_id</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">chunk_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">collection</span><span class="p">:</span> <span class="nb">str</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">RetrievalResultItem</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Retrieve a specific chunk by its chunk_id using V4 API.</span>

<span class="sd">    Args:</span>
<span class="sd">        chunk_id: ID of the chunk</span>
<span class="sd">        collection: Name of the Weaviate class for document storage</span>
<span class="sd">    Returns:</span>
<span class="sd">        Optional[RetrievalResultItem]: Chunk data if found, None otherwise</span>

<span class="sd">    Raises:</span>
<span class="sd">        WeaviateBaseError: If retrieval operation fails</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Get the collection</span>
        <span class="n">collection</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">db_manager</span><span class="o">.</span><span class="n">get_collection</span><span class="p">(</span><span class="n">collection</span><span class="p">)</span>

        <span class="c1"># Query using V4 API</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">collection</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">fetch_object_by_id</span><span class="p">(</span>
            <span class="n">uuid</span><span class="o">=</span><span class="n">generate_uuid5</span><span class="p">(</span><span class="n">chunk_id</span><span class="p">),</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">result</span><span class="p">:</span>
            <span class="n">properties</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">properties</span>
            <span class="c1"># Create RetrievalResultItem with structured metadata</span>
            <span class="k">return</span> <span class="n">RetrievalResultItem</span><span class="p">(</span>
                <span class="n">content</span><span class="o">=</span><span class="n">properties</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;content&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
                <span class="n">chunk_id</span><span class="o">=</span><span class="n">properties</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;chunk_id&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
                <span class="n">properties</span><span class="o">=</span><span class="n">properties</span><span class="p">,</span>
                <span class="n">metadata</span><span class="o">=</span><span class="n">RetrievalMetadata</span><span class="o">.</span><span class="n">from_properties</span><span class="p">(</span><span class="n">properties</span><span class="p">),</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

    <span class="k">except</span> <span class="n">WeaviateBaseError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to retrieve chunk </span><span class="si">{</span><span class="n">chunk_id</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">raise</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="ragora.core.vector_store.VectorStore.get_stats" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_stats</span><span class="p">(</span><span class="n">collection</span><span class="p">)</span></code>

<a href="#ragora.core.vector_store.VectorStore.get_stats" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Get statistics about the vector store using V4 API.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>collection</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Name of the Weaviate class for document storage</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dict[str, Any]: Statistics including total objects, collection
info, etc.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="weaviate.exceptions.WeaviateBaseError">WeaviateBaseError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If stats retrieval fails</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/core/vector_store.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">collection</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get statistics about the vector store using V4 API.</span>

<span class="sd">    Args:</span>
<span class="sd">        collection: Name of the Weaviate class for document storage</span>

<span class="sd">    Returns:</span>
<span class="sd">        Dict[str, Any]: Statistics including total objects, collection</span>
<span class="sd">            info, etc.</span>

<span class="sd">    Raises:</span>
<span class="sd">        WeaviateBaseError: If stats retrieval fails</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Get the collection</span>
        <span class="n">collection</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">db_manager</span><span class="o">.</span><span class="n">get_collection</span><span class="p">(</span><span class="n">collection</span><span class="p">)</span>

        <span class="c1"># Get total object count using V4 API</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">collection</span><span class="o">.</span><span class="n">aggregate</span><span class="o">.</span><span class="n">over_all</span><span class="p">(</span><span class="n">total_count</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="n">total_objects</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">total_count</span> <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">total_count</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="mi">0</span>

        <span class="c1"># Get collection information</span>
        <span class="n">collection_info</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">collection</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
            <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">collection</span><span class="o">.</span><span class="n">config</span><span class="p">,</span> <span class="s2">&quot;description&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
            <span class="s2">&quot;vectorizer&quot;</span><span class="p">:</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">collection</span><span class="o">.</span><span class="n">config</span><span class="p">,</span> <span class="s2">&quot;vectorizer_config&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;total_objects&quot;</span><span class="p">:</span> <span class="n">total_objects</span><span class="p">,</span>
            <span class="s2">&quot;collection&quot;</span><span class="p">:</span> <span class="n">collection</span><span class="p">,</span>
            <span class="s2">&quot;collection_info&quot;</span><span class="p">:</span> <span class="n">collection_info</span><span class="p">,</span>
            <span class="s2">&quot;is_connected&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_connected</span><span class="p">(),</span>
            <span class="s2">&quot;db_manager_url&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">db_manager</span><span class="o">.</span><span class="n">url</span><span class="p">,</span>
        <span class="p">}</span>

    <span class="k">except</span> <span class="n">WeaviateBaseError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to get stats: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">raise</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="ragora.core.vector_store.VectorStore.is_connected" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">is_connected</span><span class="p">()</span></code>

<a href="#ragora.core.vector_store.VectorStore.is_connected" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Check if the vector store is connected to the database.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>bool</code></td>            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>True if connected</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/core/vector_store.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">is_connected</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Check if the vector store is connected to the database.</span>

<span class="sd">    Returns:</span>
<span class="sd">        bool: True if connected</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">db_manager</span><span class="o">.</span><span class="n">is_connected</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="ragora.core.vector_store.VectorStore.prepare_data_object" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">prepare_data_object</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span></code>

<a href="#ragora.core.vector_store.VectorStore.prepare_data_object" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Prepare the data object for the chunk.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>chunk</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="DataChunk


  
      dataclass
   (ragora.core.chunking.DataChunk)" href="#ragora.core.chunking.DataChunk">DataChunk</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>DataChunk object to prepare</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dict[str, Any]: Prepared data object</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/core/vector_store.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">prepare_data_object</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">chunk</span><span class="p">:</span> <span class="n">DataChunk</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Prepare the data object for the chunk.</span>

<span class="sd">    Args:</span>
<span class="sd">        chunk: DataChunk object to prepare</span>

<span class="sd">    Returns:</span>
<span class="sd">        Dict[str, Any]: Prepared data object</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">chunk</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Chunk cannot be None&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">chunk</span><span class="o">.</span><span class="n">text</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">chunk</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Chunk text cannot be empty&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">chunk</span><span class="o">.</span><span class="n">chunk_id</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">chunk</span><span class="o">.</span><span class="n">chunk_id</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Chunk ID cannot be empty&quot;</span><span class="p">)</span>

    <span class="n">custom_meta</span> <span class="o">=</span> <span class="n">chunk</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">custom_metadata</span> <span class="ow">or</span> <span class="p">{}</span>
    <span class="n">custom_metadata_json</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">custom_meta</span><span class="p">)</span> <span class="k">if</span> <span class="n">custom_meta</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>

    <span class="c1"># Extract tags value to avoid redundant dictionary lookups</span>
    <span class="n">tags_value</span> <span class="o">=</span> <span class="n">custom_meta</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;tags&quot;</span><span class="p">,</span> <span class="p">[])</span>
    <span class="n">tags_string</span> <span class="o">=</span> <span class="p">(</span>
        <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tags_value</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tags_value</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="k">else</span> <span class="nb">str</span><span class="p">(</span><span class="n">tags_value</span><span class="p">)</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="p">{</span>
        <span class="c1"># Core fields</span>
        <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="n">chunk</span><span class="o">.</span><span class="n">text</span><span class="p">,</span>
        <span class="s2">&quot;chunk_id&quot;</span><span class="p">:</span> <span class="n">chunk</span><span class="o">.</span><span class="n">chunk_id</span><span class="p">,</span>
        <span class="s2">&quot;chunk_key&quot;</span><span class="p">:</span> <span class="n">generate_uuid5</span><span class="p">(</span><span class="n">chunk</span><span class="o">.</span><span class="n">chunk_id</span><span class="p">),</span>
        <span class="s2">&quot;source_document&quot;</span><span class="p">:</span> <span class="n">chunk</span><span class="o">.</span><span class="n">source_document</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="s2">&quot;chunk_type&quot;</span><span class="p">:</span> <span class="n">chunk</span><span class="o">.</span><span class="n">chunk_type</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="s2">&quot;created_at&quot;</span><span class="p">:</span> <span class="n">chunk</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">created_at</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="c1"># Document-specific fields</span>
        <span class="s2">&quot;metadata_chunk_idx&quot;</span><span class="p">:</span> <span class="n">chunk</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">chunk_idx</span><span class="p">,</span>
        <span class="s2">&quot;metadata_chunk_size&quot;</span><span class="p">:</span> <span class="n">chunk</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">chunk_size</span><span class="p">,</span>
        <span class="s2">&quot;metadata_total_chunks&quot;</span><span class="p">:</span> <span class="n">chunk</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">total_chunks</span><span class="p">,</span>
        <span class="s2">&quot;metadata_created_at&quot;</span><span class="p">:</span> <span class="n">chunk</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">created_at</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="s2">&quot;page_number&quot;</span><span class="p">:</span> <span class="n">chunk</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">page_number</span> <span class="ow">or</span> <span class="mi">0</span><span class="p">,</span>
        <span class="s2">&quot;section_title&quot;</span><span class="p">:</span> <span class="n">chunk</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">section_title</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="c1"># Email-specific fields</span>
        <span class="s2">&quot;email_subject&quot;</span><span class="p">:</span> <span class="n">chunk</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">email_subject</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="s2">&quot;email_sender&quot;</span><span class="p">:</span> <span class="n">chunk</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">email_sender</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="s2">&quot;email_recipient&quot;</span><span class="p">:</span> <span class="n">chunk</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">email_recipient</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="s2">&quot;email_date&quot;</span><span class="p">:</span> <span class="n">chunk</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">email_date</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="s2">&quot;email_id&quot;</span><span class="p">:</span> <span class="n">chunk</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">email_id</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="s2">&quot;email_folder&quot;</span><span class="p">:</span> <span class="n">chunk</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">email_folder</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="c1"># Custom metadata fields</span>
        <span class="s2">&quot;custom_metadata&quot;</span><span class="p">:</span> <span class="n">custom_metadata_json</span><span class="p">,</span>
        <span class="s2">&quot;language&quot;</span><span class="p">:</span> <span class="n">custom_meta</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;language&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
        <span class="s2">&quot;domain&quot;</span><span class="p">:</span> <span class="n">custom_meta</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;domain&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
        <span class="s2">&quot;confidence&quot;</span><span class="p">:</span> <span class="n">custom_meta</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;confidence&quot;</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
        <span class="s2">&quot;tags&quot;</span><span class="p">:</span> <span class="n">tags_string</span><span class="p">,</span>
        <span class="s2">&quot;priority&quot;</span><span class="p">:</span> <span class="n">custom_meta</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;priority&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
        <span class="s2">&quot;content_category&quot;</span><span class="p">:</span> <span class="n">custom_meta</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;content_category&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
    <span class="p">}</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="ragora.core.vector_store.VectorStore.store_chunk" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">store_chunk</span><span class="p">(</span><span class="n">chunk</span><span class="p">,</span> <span class="n">collection</span><span class="p">)</span></code>

<a href="#ragora.core.vector_store.VectorStore.store_chunk" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Store a single DataChunk in the vector store using V4 API.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>chunk</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="DataChunk


  
      dataclass
   (ragora.core.chunking.DataChunk)" href="#ragora.core.chunking.DataChunk">DataChunk</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>DataChunk object to store</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>collection</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Name of the Weaviate class for document storage</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>
        <p>Returns:
    str: UUID of the stored chunk</p>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If chunk is None or empty</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="weaviate.exceptions.WeaviateBaseError">WeaviateBaseError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If storage operation fails</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/core/vector_store.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">store_chunk</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">chunk</span><span class="p">:</span> <span class="n">DataChunk</span><span class="p">,</span> <span class="n">collection</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Store a single DataChunk in the vector store using V4 API.</span>

<span class="sd">    Args:</span>
<span class="sd">        chunk: DataChunk object to store</span>
<span class="sd">        collection: Name of the Weaviate class for document storage</span>
<span class="sd">    Returns:</span>
<span class="sd">        str: UUID of the stored chunk</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If chunk is None or empty</span>
<span class="sd">        WeaviateBaseError: If storage operation fails</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">chunk</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Chunk cannot be None&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">chunk</span><span class="o">.</span><span class="n">text</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">chunk</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Chunk text cannot be empty&quot;</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Ensure collection exists before storing chunks</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">create_schema</span><span class="p">(</span><span class="n">collection</span><span class="p">)</span>

        <span class="c1"># Get the collection</span>
        <span class="n">collection</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">db_manager</span><span class="o">.</span><span class="n">get_collection</span><span class="p">(</span><span class="n">collection</span><span class="p">)</span>

        <span class="c1"># Prepare the object data</span>
        <span class="n">object_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prepare_data_object</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>

        <span class="c1"># Store the object using V4 API</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Storing chunk: </span><span class="si">{</span><span class="n">chunk</span><span class="o">.</span><span class="n">chunk_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">collection</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span>
            <span class="n">properties</span><span class="o">=</span><span class="n">object_data</span><span class="p">,</span>
            <span class="n">uuid</span><span class="o">=</span><span class="n">object_data</span><span class="p">[</span><span class="s2">&quot;chunk_key&quot;</span><span class="p">],</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Successfully stored chunk </span><span class="si">{</span><span class="n">chunk</span><span class="o">.</span><span class="n">chunk_id</span><span class="si">}</span><span class="s2"> with UUID: </span><span class="si">{</span><span class="n">object_data</span><span class="p">[</span><span class="s1">&#39;chunk_key&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">object_data</span><span class="p">[</span><span class="s2">&quot;chunk_key&quot;</span><span class="p">]</span>

    <span class="k">except</span> <span class="n">WeaviateBaseError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to store chunk </span><span class="si">{</span><span class="n">chunk</span><span class="o">.</span><span class="n">chunk_id</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">raise</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="ragora.core.vector_store.VectorStore.store_chunks" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">store_chunks</span><span class="p">(</span><span class="n">chunks</span><span class="p">,</span> <span class="n">collection</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span></code>

<a href="#ragora.core.vector_store.VectorStore.store_chunks" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Store multiple DataChunks in the vector store using V4 API.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>chunks</code>
            </td>
            <td>
                  <code><span title="typing.List">List</span>[<a class="autorefs autorefs-internal" title="DataChunk


  
      dataclass
   (ragora.core.chunking.DataChunk)" href="#ragora.core.chunking.DataChunk">DataChunk</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of DataChunk objects to store</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>collection</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Name of the Weaviate class for document storage</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>batch_size</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of chunks to process in each batch</p>
              </div>
            </td>
            <td>
                  <code>100</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.List">List</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List[str]: List of chunk keys (UUIDs) that were stored</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If chunks list is empty or contains invalid chunks</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="weaviate.exceptions.WeaviateBaseError">WeaviateBaseError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If storage operation fails</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/core/vector_store.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">store_chunks</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">chunks</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">DataChunk</span><span class="p">],</span> <span class="n">collection</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">batch_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Store multiple DataChunks in the vector store using V4 API.</span>

<span class="sd">    Args:</span>
<span class="sd">        chunks: List of DataChunk objects to store</span>
<span class="sd">        collection: Name of the Weaviate class for document storage</span>
<span class="sd">        batch_size: Number of chunks to process in each batch</span>

<span class="sd">    Returns:</span>
<span class="sd">        List[str]: List of chunk keys (UUIDs) that were stored</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If chunks list is empty or contains invalid chunks</span>
<span class="sd">        WeaviateBaseError: If storage operation fails</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">chunks</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Chunks list cannot be empty&quot;</span><span class="p">)</span>

    <span class="c1"># Filter out invalid chunks</span>
    <span class="n">valid_chunks</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="n">chunks</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">chunk</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">chunk</span><span class="o">.</span><span class="n">text</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">chunk</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Skipping invalid chunk: </span><span class="si">{</span><span class="n">chunk</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">continue</span>
        <span class="n">valid_chunks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">valid_chunks</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No valid chunks found in the list&quot;</span><span class="p">)</span>

    <span class="n">total_chunks</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">valid_chunks</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Ensure collection exists before storing chunks</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">create_schema</span><span class="p">(</span><span class="n">collection</span><span class="p">)</span>

        <span class="c1"># Get the collection</span>
        <span class="n">collection</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">db_manager</span><span class="o">.</span><span class="n">get_collection</span><span class="p">(</span><span class="n">collection</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Storing </span><span class="si">{</span><span class="n">total_chunks</span><span class="si">}</span><span class="s2"> chunks in batches of </span><span class="si">{</span><span class="n">batch_size</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>

        <span class="c1"># Store UUIDs for return</span>
        <span class="n">stored_uuids</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># Process chunks in batches using V4 API</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">total_chunks</span><span class="p">,</span> <span class="n">batch_size</span><span class="p">):</span>
            <span class="n">batch</span> <span class="o">=</span> <span class="n">valid_chunks</span><span class="p">[</span><span class="n">i</span> <span class="p">:</span> <span class="n">i</span> <span class="o">+</span> <span class="n">batch_size</span><span class="p">]</span>

            <span class="c1"># Prepare batch data</span>
            <span class="n">batch_data</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="n">batch</span><span class="p">:</span>
                <span class="n">object_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prepare_data_object</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>
                <span class="n">batch_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">object_data</span><span class="p">)</span>

            <span class="c1"># Store each chunk individually to avoid gRPC issues</span>
            <span class="n">batch_num</span> <span class="o">=</span> <span class="n">i</span> <span class="o">//</span> <span class="n">batch_size</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Storing batch </span><span class="si">{</span><span class="n">batch_num</span><span class="si">}</span><span class="s2"> with </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">batch</span><span class="p">)</span><span class="si">}</span><span class="s2"> chunks&quot;</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">object_data</span> <span class="ow">in</span> <span class="n">batch_data</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="c1"># Insert individual object using V4 API</span>
                    <span class="n">collection</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span>
                        <span class="n">properties</span><span class="o">=</span><span class="n">object_data</span><span class="p">,</span>
                        <span class="n">uuid</span><span class="o">=</span><span class="n">object_data</span><span class="p">[</span><span class="s2">&quot;chunk_key&quot;</span><span class="p">],</span>
                    <span class="p">)</span>
                    <span class="n">stored_uuids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">object_data</span><span class="p">[</span><span class="s2">&quot;chunk_key&quot;</span><span class="p">])</span>

                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to insert object: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="k">continue</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Successfully stored </span><span class="si">{</span><span class="n">total_chunks</span><span class="si">}</span><span class="s2"> chunks&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">stored_uuids</span>

    <span class="k">except</span> <span class="n">WeaviateBaseError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to store chunks: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">raise</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="ragora.core.vector_store.VectorStore.update_chunk" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">update_chunk</span><span class="p">(</span><span class="n">chunk_id</span><span class="p">,</span> <span class="n">properties</span><span class="p">,</span> <span class="n">collection</span><span class="p">)</span></code>

<a href="#ragora.core.vector_store.VectorStore.update_chunk" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Update a chunk by its chunk_id using V4 API.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>chunk_id</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>ID of the chunk to update</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>properties</code>
            </td>
            <td>
                  <code><span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Properties to update</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>collection</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Name of the Weaviate class for document storage</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>
        <p>Returns:
    bool: True if update was successful, False otherwise</p>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="weaviate.exceptions.WeaviateBaseError">WeaviateBaseError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If update operation fails</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/core/vector_store.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">update_chunk</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">chunk_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">properties</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">collection</span><span class="p">:</span> <span class="nb">str</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Update a chunk by its chunk_id using V4 API.</span>

<span class="sd">    Args:</span>
<span class="sd">        chunk_id: ID of the chunk to update</span>
<span class="sd">        properties: Properties to update</span>
<span class="sd">        collection: Name of the Weaviate class for document storage</span>
<span class="sd">    Returns:</span>
<span class="sd">        bool: True if update was successful, False otherwise</span>

<span class="sd">    Raises:</span>
<span class="sd">        WeaviateBaseError: If update operation fails</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Get the collection</span>
        <span class="n">collection</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">db_manager</span><span class="o">.</span><span class="n">get_collection</span><span class="p">(</span><span class="n">collection</span><span class="p">)</span>

        <span class="c1"># Update by ID</span>
        <span class="n">collection</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">update_by_id</span><span class="p">(</span>
            <span class="n">uuid</span><span class="o">=</span><span class="n">generate_uuid5</span><span class="p">(</span><span class="n">chunk_id</span><span class="p">),</span>
            <span class="n">properties</span><span class="o">=</span><span class="n">properties</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Successfully updated chunk: </span><span class="si">{</span><span class="n">chunk_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">except</span> <span class="n">WeaviateBaseError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to update chunk </span><span class="si">{</span><span class="n">chunk_id</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">raise</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div><h3 id="database-manager">Database Manager<a class="headerlink" href="#database-manager" title="Permanent link">&para;</a></h3>


<div class="doc doc-object doc-module">



<a id="ragora.core.database_manager"></a>
    <div class="doc doc-contents first">

        <p>Infrastructure helpers for connecting Ragora to Weaviate.</p>










  <div class="doc doc-children">









<div class="doc doc-object doc-class">



<h4 id="ragora.core.database_manager.DatabaseManager" class="doc doc-heading">
            <code>DatabaseManager</code>


<a href="#ragora.core.database_manager.DatabaseManager" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">


        <p>Lightweight faade over the Weaviate Python client.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="ragora.core.database_manager.DatabaseManager.client">client</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Low-level Weaviate client instance.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="ragora.core.database_manager.DatabaseManager.url">url</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Weaviate HTTP endpoint.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="ragora.core.database_manager.DatabaseManager.grpc_port">grpc_port</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional gRPC port.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="ragora.core.database_manager.DatabaseManager.timeout">timeout</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Request timeout in seconds.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="ragora.core.database_manager.DatabaseManager.retry_attempts">retry_attempts</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>How many retries to attempt for transient failures.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="ragora.core.database_manager.DatabaseManager.is_connected">is_connected</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Indicates whether :meth:<code>_test_connection</code> succeeded.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="ragora.core.database_manager.DatabaseManager.logger">logger</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Module logger.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">ragora.core.database_manager</span><span class="w"> </span><span class="kn">import</span> <span class="n">DatabaseManager</span>

<span class="n">db</span> <span class="o">=</span> <span class="n">DatabaseManager</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="s2">&quot;http://localhost:8080&quot;</span><span class="p">)</span>
<span class="n">collections</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">list_collections</span><span class="p">()</span>
</code></pre></div>








              <details class="quote">
                <summary>Source code in <code>ragora/ragora/core/database_manager.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 11</span>
<span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">DatabaseManager</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Lightweight faade over the Weaviate Python client.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        client: Low-level Weaviate client instance.</span>
<span class="sd">        url: Weaviate HTTP endpoint.</span>
<span class="sd">        grpc_port: Optional gRPC port.</span>
<span class="sd">        timeout: Request timeout in seconds.</span>
<span class="sd">        retry_attempts: How many retries to attempt for transient failures.</span>
<span class="sd">        is_connected: Indicates whether :meth:`_test_connection` succeeded.</span>
<span class="sd">        logger: Module logger.</span>

<span class="sd">    Examples:</span>
<span class="sd">        ```python</span>
<span class="sd">        from ragora.core.database_manager import DatabaseManager</span>

<span class="sd">        db = DatabaseManager(url=&quot;http://localhost:8080&quot;)</span>
<span class="sd">        collections = db.list_collections()</span>
<span class="sd">        ```</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">url</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;http://localhost:8080&quot;</span><span class="p">,</span>
        <span class="n">grpc_port</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">50051</span><span class="p">,</span>
        <span class="n">timeout</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">60</span><span class="p">,</span>
        <span class="n">retry_attempts</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the DatabaseManager with Weaviate connection.</span>

<span class="sd">        Args:</span>
<span class="sd">            url: Weaviate server URL</span>
<span class="sd">            grpc_port: gRPC port for Weaviate connection</span>
<span class="sd">            timeout: Connection timeout in seconds</span>
<span class="sd">            retry_attempts: Number of retry attempts for failed operations</span>

<span class="sd">        Raises:</span>
<span class="sd">            ConnectionError: If unable to connect to Weaviate</span>
<span class="sd">            ValueError: If invalid parameters are provided</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">url</span> <span class="o">=</span> <span class="n">url</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grpc_port</span> <span class="o">=</span> <span class="n">grpc_port</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timeout</span> <span class="o">=</span> <span class="n">timeout</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">retry_attempts</span> <span class="o">=</span> <span class="n">retry_attempts</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_connected</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># Set up logging</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

        <span class="c1"># Initialize Weaviate client</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Connecting to Weaviate at </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="c1"># Parse URL to extract host and port</span>
            <span class="n">connection_param</span> <span class="o">=</span> <span class="n">ConnectionParams</span><span class="o">.</span><span class="n">from_url</span><span class="p">(</span>
                <span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span>
                <span class="c1"># Keep gRPC port but it will fail gracefully</span>
                <span class="n">grpc_port</span><span class="o">=</span><span class="n">grpc_port</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">client</span> <span class="o">=</span> <span class="n">WeaviateClient</span><span class="p">(</span><span class="n">connection_param</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_test_connection</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Successfully connected to Weaviate&quot;</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to connect to Weaviate: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">ConnectionError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not connect to Weaviate at </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_test_connection</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test the connection to Weaviate.</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool: True if connection is successful</span>

<span class="sd">        Raises:</span>
<span class="sd">            ConnectionError: If connection test fails</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Test connection by checking if Weaviate is ready</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">is_ready</span><span class="p">():</span>
                <span class="k">raise</span> <span class="ne">ConnectionError</span><span class="p">(</span><span class="s2">&quot;Weaviate is not ready&quot;</span><span class="p">)</span>

            <span class="c1"># Test with a simple query - V4 API</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">collections</span><span class="o">.</span><span class="n">list_all</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">is_connected</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">is_connected</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">raise</span> <span class="ne">ConnectionError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Connection test failed: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_normalize_collection_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Normalize collection name to Weaviate&#39;s naming convention.</span>

<span class="sd">        Weaviate automatically capitalizes the first letter of collection</span>
<span class="sd">        names. This method ensures we match Weaviate&#39;s expected format.</span>

<span class="sd">        Args:</span>
<span class="sd">            name: The original collection name</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: Collection name with first letter capitalized</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If name is empty</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">name</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">name</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Collection name cannot be empty&quot;</span><span class="p">)</span>

        <span class="c1"># Capitalize first letter, keep rest as-is</span>
        <span class="k">return</span> <span class="n">name</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">+</span> <span class="n">name</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">is_ready</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if the database is ready for operations.</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool: True if database is ready</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">is_ready</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Database readiness check failed: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_collection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get a collection reference by name.</span>

<span class="sd">        Args:</span>
<span class="sd">            name: Name of the collection to retrieve</span>

<span class="sd">        Returns:</span>
<span class="sd">            Collection object for the specified name</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If collection name is empty</span>
<span class="sd">            WeaviateBaseError: If collection access fails</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">name</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">name</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Collection name cannot be empty&quot;</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Normalize name to Weaviate&#39;s naming convention</span>
            <span class="n">normalized_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_normalize_collection_name</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="n">collection</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">collections</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">normalized_name</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Retrieved collection: </span><span class="si">{</span><span class="n">normalized_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">collection</span>
        <span class="k">except</span> <span class="n">WeaviateBaseError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to get collection </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">raise</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">create_collection</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">description</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">vectorizer_config</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">properties</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a new collection with the specified configuration.</span>

<span class="sd">        Args:</span>
<span class="sd">            name: Name of the collection to create</span>
<span class="sd">            description: Description of the collection</span>
<span class="sd">            vectorizer_config: Vectorizer configuration</span>
<span class="sd">            properties: List of property configurations</span>

<span class="sd">        Returns:</span>
<span class="sd">            Created collection object</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If collection name is empty</span>
<span class="sd">            WeaviateBaseError: If collection creation fails</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">name</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">name</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Collection name cannot be empty&quot;</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Normalize name to Weaviate&#39;s naming convention</span>
            <span class="n">normalized_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_normalize_collection_name</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Creating collection: </span><span class="si">{</span><span class="n">normalized_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="c1"># Create the collection using V4 API</span>
            <span class="n">collection</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">collections</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
                <span class="n">name</span><span class="o">=</span><span class="n">normalized_name</span><span class="p">,</span>
                <span class="n">description</span><span class="o">=</span><span class="n">description</span><span class="p">,</span>
                <span class="n">vectorizer_config</span><span class="o">=</span><span class="n">vectorizer_config</span><span class="p">,</span>
                <span class="n">properties</span><span class="o">=</span><span class="n">properties</span> <span class="ow">or</span> <span class="p">[],</span>
            <span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Successfully created collection: </span><span class="si">{</span><span class="n">normalized_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">collection</span>

        <span class="k">except</span> <span class="n">WeaviateBaseError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to create collection </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">raise</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">delete_collection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Delete a collection by name.</span>

<span class="sd">        Args:</span>
<span class="sd">            name: Name of the collection to delete</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool: True if deletion was successful</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If collection name is empty</span>
<span class="sd">            WeaviateBaseError: If collection deletion fails</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">name</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">name</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Collection name cannot be empty&quot;</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Normalize name to Weaviate&#39;s naming convention</span>
            <span class="n">normalized_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_normalize_collection_name</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Deleting collection: </span><span class="si">{</span><span class="n">normalized_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">collections</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">normalized_name</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Successfully deleted collection: </span><span class="si">{</span><span class="n">normalized_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">True</span>

        <span class="k">except</span> <span class="n">WeaviateBaseError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to delete collection </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">raise</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">list_collections</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;List all available collections.</span>

<span class="sd">        Returns:</span>
<span class="sd">            List[str]: List of collection names</span>

<span class="sd">        Raises:</span>
<span class="sd">            WeaviateBaseError: If listing collections fails</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">collections</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">collections</span><span class="o">.</span><span class="n">list_all</span><span class="p">()</span>
            <span class="n">collection_names</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">collections</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Found </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">collection_names</span><span class="p">)</span><span class="si">}</span><span class="s2"> collections&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">collection_names</span>
        <span class="k">except</span> <span class="n">WeaviateBaseError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to list collections: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">raise</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">collection_exists</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if a collection exists.</span>

<span class="sd">        Args:</span>
<span class="sd">            name: Name of the collection to check</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool: True if collection exists</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If collection name is empty</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">name</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">name</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Collection name cannot be empty&quot;</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Normalize the name to Weaviate&#39;s naming convention</span>
            <span class="n">normalized_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_normalize_collection_name</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="n">collections</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">list_collections</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">normalized_name</span> <span class="ow">in</span> <span class="n">collections</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to check if collection </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> exists: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_client</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">WeaviateClient</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the underlying Weaviate client.</span>

<span class="sd">        Returns:</span>
<span class="sd">            WeaviateClient: The underlying client instance</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Close the connection to Weaviate.&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;client&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="p">:</span>
                <span class="c1"># Weaviate client doesn&#39;t have an explicit close method</span>
                <span class="c1"># but we can mark the connection as closed</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">is_connected</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Database manager connection closed&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error closing database manager: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Context manager entry.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exc_type</span><span class="p">,</span> <span class="n">exc_val</span><span class="p">,</span> <span class="n">exc_tb</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Context manager exit.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h5 id="ragora.core.database_manager.DatabaseManager._normalize_collection_name" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">_normalize_collection_name</span><span class="p">(</span><span class="n">name</span><span class="p">)</span></code>

<a href="#ragora.core.database_manager.DatabaseManager._normalize_collection_name" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Normalize collection name to Weaviate's naming convention.</p>
<p>Weaviate automatically capitalizes the first letter of collection
names. This method ensures we match Weaviate's expected format.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The original collection name</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>str</code></td>            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Collection name with first letter capitalized</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If name is empty</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/core/database_manager.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">_normalize_collection_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Normalize collection name to Weaviate&#39;s naming convention.</span>

<span class="sd">    Weaviate automatically capitalizes the first letter of collection</span>
<span class="sd">    names. This method ensures we match Weaviate&#39;s expected format.</span>

<span class="sd">    Args:</span>
<span class="sd">        name: The original collection name</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: Collection name with first letter capitalized</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If name is empty</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">name</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">name</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Collection name cannot be empty&quot;</span><span class="p">)</span>

    <span class="c1"># Capitalize first letter, keep rest as-is</span>
    <span class="k">return</span> <span class="n">name</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">+</span> <span class="n">name</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="ragora.core.database_manager.DatabaseManager._test_connection" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">_test_connection</span><span class="p">()</span></code>

<a href="#ragora.core.database_manager.DatabaseManager._test_connection" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Test the connection to Weaviate.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>bool</code></td>            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>True if connection is successful</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ConnectionError">ConnectionError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If connection test fails</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/core/database_manager.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span>
<span class="normal">93</span>
<span class="normal">94</span>
<span class="normal">95</span>
<span class="normal">96</span>
<span class="normal">97</span>
<span class="normal">98</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">_test_connection</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test the connection to Weaviate.</span>

<span class="sd">    Returns:</span>
<span class="sd">        bool: True if connection is successful</span>

<span class="sd">    Raises:</span>
<span class="sd">        ConnectionError: If connection test fails</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Test connection by checking if Weaviate is ready</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">is_ready</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">ConnectionError</span><span class="p">(</span><span class="s2">&quot;Weaviate is not ready&quot;</span><span class="p">)</span>

        <span class="c1"># Test with a simple query - V4 API</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">collections</span><span class="o">.</span><span class="n">list_all</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_connected</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_connected</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">raise</span> <span class="ne">ConnectionError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Connection test failed: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="ragora.core.database_manager.DatabaseManager.close" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">close</span><span class="p">()</span></code>

<a href="#ragora.core.database_manager.DatabaseManager.close" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Close the connection to Weaviate.</p>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/core/database_manager.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Close the connection to Weaviate.&quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;client&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="p">:</span>
            <span class="c1"># Weaviate client doesn&#39;t have an explicit close method</span>
            <span class="c1"># but we can mark the connection as closed</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">is_connected</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Database manager connection closed&quot;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error closing database manager: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="ragora.core.database_manager.DatabaseManager.collection_exists" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">collection_exists</span><span class="p">(</span><span class="n">name</span><span class="p">)</span></code>

<a href="#ragora.core.database_manager.DatabaseManager.collection_exists" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Check if a collection exists.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Name of the collection to check</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>bool</code></td>            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>True if collection exists</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If collection name is empty</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/core/database_manager.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">collection_exists</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Check if a collection exists.</span>

<span class="sd">    Args:</span>
<span class="sd">        name: Name of the collection to check</span>

<span class="sd">    Returns:</span>
<span class="sd">        bool: True if collection exists</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If collection name is empty</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">name</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">name</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Collection name cannot be empty&quot;</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Normalize the name to Weaviate&#39;s naming convention</span>
        <span class="n">normalized_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_normalize_collection_name</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="n">collections</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">list_collections</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">normalized_name</span> <span class="ow">in</span> <span class="n">collections</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to check if collection </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> exists: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="ragora.core.database_manager.DatabaseManager.create_collection" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">create_collection</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">vectorizer_config</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">properties</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#ragora.core.database_manager.DatabaseManager.create_collection" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Create a new collection with the specified configuration.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Name of the collection to create</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>description</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Description of the collection</p>
              </div>
            </td>
            <td>
                  <code>&#39;&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>vectorizer_config</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Vectorizer configuration</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>properties</code>
            </td>
            <td>
                  <code><span title="typing.List">List</span>[<span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of property configurations</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Created collection object</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If collection name is empty</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="weaviate.exceptions.WeaviateBaseError">WeaviateBaseError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If collection creation fails</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/core/database_manager.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">create_collection</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">description</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="n">vectorizer_config</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">properties</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create a new collection with the specified configuration.</span>

<span class="sd">    Args:</span>
<span class="sd">        name: Name of the collection to create</span>
<span class="sd">        description: Description of the collection</span>
<span class="sd">        vectorizer_config: Vectorizer configuration</span>
<span class="sd">        properties: List of property configurations</span>

<span class="sd">    Returns:</span>
<span class="sd">        Created collection object</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If collection name is empty</span>
<span class="sd">        WeaviateBaseError: If collection creation fails</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">name</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">name</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Collection name cannot be empty&quot;</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Normalize name to Weaviate&#39;s naming convention</span>
        <span class="n">normalized_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_normalize_collection_name</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Creating collection: </span><span class="si">{</span><span class="n">normalized_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Create the collection using V4 API</span>
        <span class="n">collection</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">collections</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="n">normalized_name</span><span class="p">,</span>
            <span class="n">description</span><span class="o">=</span><span class="n">description</span><span class="p">,</span>
            <span class="n">vectorizer_config</span><span class="o">=</span><span class="n">vectorizer_config</span><span class="p">,</span>
            <span class="n">properties</span><span class="o">=</span><span class="n">properties</span> <span class="ow">or</span> <span class="p">[],</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Successfully created collection: </span><span class="si">{</span><span class="n">normalized_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">collection</span>

    <span class="k">except</span> <span class="n">WeaviateBaseError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to create collection </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">raise</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="ragora.core.database_manager.DatabaseManager.delete_collection" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">delete_collection</span><span class="p">(</span><span class="n">name</span><span class="p">)</span></code>

<a href="#ragora.core.database_manager.DatabaseManager.delete_collection" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Delete a collection by name.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Name of the collection to delete</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>bool</code></td>            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>True if deletion was successful</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If collection name is empty</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="weaviate.exceptions.WeaviateBaseError">WeaviateBaseError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If collection deletion fails</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/core/database_manager.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">delete_collection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Delete a collection by name.</span>

<span class="sd">    Args:</span>
<span class="sd">        name: Name of the collection to delete</span>

<span class="sd">    Returns:</span>
<span class="sd">        bool: True if deletion was successful</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If collection name is empty</span>
<span class="sd">        WeaviateBaseError: If collection deletion fails</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">name</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">name</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Collection name cannot be empty&quot;</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Normalize name to Weaviate&#39;s naming convention</span>
        <span class="n">normalized_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_normalize_collection_name</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Deleting collection: </span><span class="si">{</span><span class="n">normalized_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">collections</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">normalized_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Successfully deleted collection: </span><span class="si">{</span><span class="n">normalized_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">except</span> <span class="n">WeaviateBaseError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to delete collection </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">raise</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="ragora.core.database_manager.DatabaseManager.get_client" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_client</span><span class="p">()</span></code>

<a href="#ragora.core.database_manager.DatabaseManager.get_client" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Get the underlying Weaviate client.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>WeaviateClient</code></td>            <td>
                  <code><span title="weaviate.WeaviateClient">WeaviateClient</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The underlying client instance</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/core/database_manager.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_client</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">WeaviateClient</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the underlying Weaviate client.</span>

<span class="sd">    Returns:</span>
<span class="sd">        WeaviateClient: The underlying client instance</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="ragora.core.database_manager.DatabaseManager.get_collection" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_collection</span><span class="p">(</span><span class="n">name</span><span class="p">)</span></code>

<a href="#ragora.core.database_manager.DatabaseManager.get_collection" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Get a collection reference by name.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Name of the collection to retrieve</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Collection object for the specified name</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If collection name is empty</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="weaviate.exceptions.WeaviateBaseError">WeaviateBaseError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If collection access fails</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/core/database_manager.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_collection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get a collection reference by name.</span>

<span class="sd">    Args:</span>
<span class="sd">        name: Name of the collection to retrieve</span>

<span class="sd">    Returns:</span>
<span class="sd">        Collection object for the specified name</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If collection name is empty</span>
<span class="sd">        WeaviateBaseError: If collection access fails</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">name</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">name</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Collection name cannot be empty&quot;</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Normalize name to Weaviate&#39;s naming convention</span>
        <span class="n">normalized_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_normalize_collection_name</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="n">collection</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">collections</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">normalized_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Retrieved collection: </span><span class="si">{</span><span class="n">normalized_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">collection</span>
    <span class="k">except</span> <span class="n">WeaviateBaseError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to get collection </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">raise</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="ragora.core.database_manager.DatabaseManager.is_ready" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">is_ready</span><span class="p">()</span></code>

<a href="#ragora.core.database_manager.DatabaseManager.is_ready" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Check if the database is ready for operations.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>bool</code></td>            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>True if database is ready</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/core/database_manager.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">is_ready</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Check if the database is ready for operations.</span>

<span class="sd">    Returns:</span>
<span class="sd">        bool: True if database is ready</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">is_ready</span><span class="p">()</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Database readiness check failed: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="ragora.core.database_manager.DatabaseManager.list_collections" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">list_collections</span><span class="p">()</span></code>

<a href="#ragora.core.database_manager.DatabaseManager.list_collections" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>List all available collections.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.List">List</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List[str]: List of collection names</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="weaviate.exceptions.WeaviateBaseError">WeaviateBaseError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If listing collections fails</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/core/database_manager.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">list_collections</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;List all available collections.</span>

<span class="sd">    Returns:</span>
<span class="sd">        List[str]: List of collection names</span>

<span class="sd">    Raises:</span>
<span class="sd">        WeaviateBaseError: If listing collections fails</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">collections</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">collections</span><span class="o">.</span><span class="n">list_all</span><span class="p">()</span>
        <span class="n">collection_names</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">collections</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Found </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">collection_names</span><span class="p">)</span><span class="si">}</span><span class="s2"> collections&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">collection_names</span>
    <span class="k">except</span> <span class="n">WeaviateBaseError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to list collections: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">raise</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div><h3 id="chunking">Chunking<a class="headerlink" href="#chunking" title="Permanent link">&para;</a></h3>


<div class="doc doc-object doc-module">



<a id="ragora.core.chunking"></a>
    <div class="doc doc-contents first">

        <p>Chunking system for Ragora.</p>
<p>This module provides the core chunking functionality for the Ragora system,
including data structures, context management, and the main chunker interface.</p>
<h5 id="ragora.core.chunking--architecture-overview">Architecture Overview<a class="headerlink" href="#ragora.core.chunking--architecture-overview" title="Permanent link">&para;</a></h5>
<p>The chunking system uses a Strategy Pattern to support different types of content
chunking (text, documents, emails) with a clean, extensible API. The main components are:</p>
<ul>
<li><strong>DataChunker</strong>: Main interface for chunking operations</li>
<li><strong>ChunkingContext</strong>: Contains metadata and configuration for chunking</li>
<li><strong>ChunkingContextBuilder</strong>: Fluent API for creating contexts</li>
<li><strong>ChunkingStrategy</strong>: Abstract base for different chunking implementations</li>
<li><strong>DataChunk</strong>: Result object containing chunked text and metadata</li>
</ul>
<h5 id="ragora.core.chunking--quick-start">Quick Start<a class="headerlink" href="#ragora.core.chunking--quick-start" title="Permanent link">&para;</a></h5>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">ragora</span><span class="w"> </span><span class="kn">import</span> <span class="n">DataChunker</span><span class="p">,</span> <span class="n">ChunkingContextBuilder</span>

<span class="c1"># Create a chunker</span>
<span class="n">chunker</span> <span class="o">=</span> <span class="n">DataChunker</span><span class="p">()</span>

<span class="c1"># Basic text chunking</span>
<span class="n">context</span> <span class="o">=</span> <span class="n">ChunkingContextBuilder</span><span class="p">()</span><span class="o">.</span><span class="n">for_text</span><span class="p">()</span><span class="o">.</span><span class="n">build</span><span class="p">()</span>
<span class="n">chunks</span> <span class="o">=</span> <span class="n">chunker</span><span class="o">.</span><span class="n">chunk</span><span class="p">(</span><span class="s2">&quot;Your text here&quot;</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>

<span class="c1"># Document chunking with metadata</span>
<span class="n">context</span> <span class="o">=</span> <span class="p">(</span><span class="n">ChunkingContextBuilder</span><span class="p">()</span>
          <span class="o">.</span><span class="n">for_document</span><span class="p">()</span>
          <span class="o">.</span><span class="n">with_source</span><span class="p">(</span><span class="s2">&quot;paper.pdf&quot;</span><span class="p">)</span>
          <span class="o">.</span><span class="n">with_page</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
          <span class="o">.</span><span class="n">with_section</span><span class="p">(</span><span class="s2">&quot;Introduction&quot;</span><span class="p">)</span>
          <span class="o">.</span><span class="n">build</span><span class="p">())</span>
<span class="n">chunks</span> <span class="o">=</span> <span class="n">chunker</span><span class="o">.</span><span class="n">chunk</span><span class="p">(</span><span class="n">document_text</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>

<span class="c1"># Email chunking</span>
<span class="n">context</span> <span class="o">=</span> <span class="p">(</span><span class="n">ChunkingContextBuilder</span><span class="p">()</span>
          <span class="o">.</span><span class="n">for_email</span><span class="p">()</span>
          <span class="o">.</span><span class="n">with_email_info</span><span class="p">(</span><span class="s2">&quot;Meeting Notes&quot;</span><span class="p">,</span> <span class="s2">&quot;john@example.com&quot;</span><span class="p">,</span> <span class="s2">&quot;team@example.com&quot;</span><span class="p">)</span>
          <span class="o">.</span><span class="n">build</span><span class="p">())</span>
<span class="n">chunks</span> <span class="o">=</span> <span class="n">chunker</span><span class="o">.</span><span class="n">chunk</span><span class="p">(</span><span class="n">email_text</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
</code></pre></div>
<h5 id="ragora.core.chunking--detailed-usage-guide">Detailed Usage Guide<a class="headerlink" href="#ragora.core.chunking--detailed-usage-guide" title="Permanent link">&para;</a></h5>
<h6 id="ragora.core.chunking--1-basic-text-chunking">1. Basic Text Chunking<a class="headerlink" href="#ragora.core.chunking--1-basic-text-chunking" title="Permanent link">&para;</a></h6>
<p>For simple text chunking without special metadata:</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">ragora</span><span class="w"> </span><span class="kn">import</span> <span class="n">DataChunker</span><span class="p">,</span> <span class="n">ChunkingContextBuilder</span>

<span class="n">chunker</span> <span class="o">=</span> <span class="n">DataChunker</span><span class="p">()</span>
<span class="n">context</span> <span class="o">=</span> <span class="n">ChunkingContextBuilder</span><span class="p">()</span><span class="o">.</span><span class="n">for_text</span><span class="p">()</span><span class="o">.</span><span class="n">build</span><span class="p">()</span>
<span class="n">chunks</span> <span class="o">=</span> <span class="n">chunker</span><span class="o">.</span><span class="n">chunk</span><span class="p">(</span><span class="s2">&quot;This is a long text that will be chunked...&quot;</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>

<span class="c1"># Access chunk data</span>
<span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="n">chunks</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Chunk </span><span class="si">{</span><span class="n">chunk</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">chunk_id</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">chunk</span><span class="o">.</span><span class="n">text</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Size: </span><span class="si">{</span><span class="n">chunk</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">chunk_size</span><span class="si">}</span><span class="s2"> characters&quot;</span><span class="p">)</span>
</code></pre></div>
<h6 id="ragora.core.chunking--2-document-chunking">2. Document Chunking<a class="headerlink" href="#ragora.core.chunking--2-document-chunking" title="Permanent link">&para;</a></h6>
<p>For academic papers, reports, or structured documents:</p>
<div class="highlight"><pre><span></span><code><span class="n">context</span> <span class="o">=</span> <span class="p">(</span><span class="n">ChunkingContextBuilder</span><span class="p">()</span>
          <span class="o">.</span><span class="n">for_document</span><span class="p">()</span>
          <span class="o">.</span><span class="n">with_source</span><span class="p">(</span><span class="s2">&quot;research_paper.pdf&quot;</span><span class="p">)</span>
          <span class="o">.</span><span class="n">with_page</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
          <span class="o">.</span><span class="n">with_section</span><span class="p">(</span><span class="s2">&quot;Methodology&quot;</span><span class="p">)</span>
          <span class="o">.</span><span class="n">with_created_at</span><span class="p">(</span><span class="s2">&quot;2024-01-15&quot;</span><span class="p">)</span>
          <span class="o">.</span><span class="n">build</span><span class="p">())</span>

<span class="n">chunks</span> <span class="o">=</span> <span class="n">chunker</span><span class="o">.</span><span class="n">chunk</span><span class="p">(</span><span class="n">document_content</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>

<span class="c1"># Document chunks include page and section information</span>
<span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="n">chunks</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Page </span><span class="si">{</span><span class="n">chunk</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">page_number</span><span class="si">}</span><span class="s2">, Section: </span><span class="si">{</span><span class="n">chunk</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">section_title</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>
<h6 id="ragora.core.chunking--3-email-chunking">3. Email Chunking<a class="headerlink" href="#ragora.core.chunking--3-email-chunking" title="Permanent link">&para;</a></h6>
<p>For email content with sender/recipient metadata:</p>
<div class="highlight"><pre><span></span><code><span class="n">context</span> <span class="o">=</span> <span class="p">(</span><span class="n">ChunkingContextBuilder</span><span class="p">()</span>
          <span class="o">.</span><span class="n">for_email</span><span class="p">()</span>
          <span class="o">.</span><span class="n">with_email_info</span><span class="p">(</span>
              <span class="n">subject</span><span class="o">=</span><span class="s2">&quot;Project Update&quot;</span><span class="p">,</span>
              <span class="n">sender</span><span class="o">=</span><span class="s2">&quot;manager@company.com&quot;</span><span class="p">,</span>
              <span class="n">recipient</span><span class="o">=</span><span class="s2">&quot;team@company.com&quot;</span><span class="p">,</span>
              <span class="n">email_id</span><span class="o">=</span><span class="s2">&quot;msg_12345&quot;</span><span class="p">,</span>
              <span class="n">email_date</span><span class="o">=</span><span class="s2">&quot;2024-01-15T14:30:00Z&quot;</span>
          <span class="p">)</span>
          <span class="o">.</span><span class="n">build</span><span class="p">())</span>

<span class="n">chunks</span> <span class="o">=</span> <span class="n">chunker</span><span class="o">.</span><span class="n">chunk</span><span class="p">(</span><span class="n">email_body</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>

<span class="c1"># Email chunks preserve sender/recipient information</span>
<span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="n">chunks</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;From: </span><span class="si">{</span><span class="n">chunk</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">email_sender</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Subject: </span><span class="si">{</span><span class="n">chunk</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">email_subject</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>
<h6 id="ragora.core.chunking--4-custom-chunking-strategies">4. Custom Chunking Strategies<a class="headerlink" href="#ragora.core.chunking--4-custom-chunking-strategies" title="Permanent link">&para;</a></h6>
<p>Create your own chunking logic for specialized content:</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">ragora</span><span class="w"> </span><span class="kn">import</span> <span class="n">ChunkingStrategy</span><span class="p">,</span> <span class="n">ChunkingContext</span><span class="p">,</span> <span class="n">DataChunk</span><span class="p">,</span> <span class="n">ChunkMetadata</span>

<span class="k">class</span><span class="w"> </span><span class="nc">CodeChunkingStrategy</span><span class="p">(</span><span class="n">ChunkingStrategy</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">chunk_size</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">overlap_size</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">chunk</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">ChunkingContext</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">DataChunk</span><span class="p">]:</span>
        <span class="c1"># Custom logic for code chunking (e.g., preserve function boundaries)</span>
        <span class="c1"># Implementation here...</span>
        <span class="k">pass</span>

<span class="c1"># Register and use custom strategy</span>
<span class="n">chunker</span> <span class="o">=</span> <span class="n">DataChunker</span><span class="p">()</span>
<span class="n">chunker</span><span class="o">.</span><span class="n">register_strategy</span><span class="p">(</span><span class="s2">&quot;code&quot;</span><span class="p">,</span> <span class="n">CodeChunkingStrategy</span><span class="p">())</span>

<span class="n">context</span> <span class="o">=</span> <span class="n">ChunkingContextBuilder</span><span class="p">()</span><span class="o">.</span><span class="n">for_text</span><span class="p">()</span><span class="o">.</span><span class="n">build</span><span class="p">()</span>
<span class="n">context</span><span class="o">.</span><span class="n">chunk_type</span> <span class="o">=</span> <span class="s2">&quot;code&quot;</span>  <span class="c1"># Use custom strategy</span>
<span class="n">chunks</span> <span class="o">=</span> <span class="n">chunker</span><span class="o">.</span><span class="n">chunk</span><span class="p">(</span><span class="n">code_text</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
</code></pre></div>
<h6 id="ragora.core.chunking--5-stateless-chunk-id-management">5. Stateless Chunk ID Management<a class="headerlink" href="#ragora.core.chunking--5-stateless-chunk-id-management" title="Permanent link">&para;</a></h6>
<p>Control chunk ID generation for consistent results:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Start chunking from sequence index 100</span>
<span class="n">context</span> <span class="o">=</span> <span class="p">(</span><span class="n">ChunkingContextBuilder</span><span class="p">()</span>
          <span class="o">.</span><span class="n">for_document</span><span class="p">()</span>
          <span class="o">.</span><span class="n">with_start_sequence_idx</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
          <span class="o">.</span><span class="n">build</span><span class="p">())</span>

<span class="n">chunks</span> <span class="o">=</span> <span class="n">chunker</span><span class="o">.</span><span class="n">chunk</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
<span class="c1"># First chunk will have sequence number 100, second chunk 101, etc.</span>

<span class="c1"># Continue chunking from where you left off</span>
<span class="n">next_context</span> <span class="o">=</span> <span class="p">(</span><span class="n">ChunkingContextBuilder</span><span class="p">()</span>
               <span class="o">.</span><span class="n">for_document</span><span class="p">()</span>
               <span class="o">.</span><span class="n">with_start_sequence_idx</span><span class="p">(</span><span class="mi">100</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">chunks</span><span class="p">))</span>
               <span class="o">.</span><span class="n">build</span><span class="p">())</span>
<span class="n">more_chunks</span> <span class="o">=</span> <span class="n">chunker</span><span class="o">.</span><span class="n">chunk</span><span class="p">(</span><span class="n">more_text</span><span class="p">,</span> <span class="n">next_context</span><span class="p">)</span>
</code></pre></div>
<h6 id="ragora.core.chunking--6-batch-processing-multiple-documents">6. Batch Processing Multiple Documents<a class="headerlink" href="#ragora.core.chunking--6-batch-processing-multiple-documents" title="Permanent link">&para;</a></h6>
<p>Process multiple documents while maintaining unique chunk IDs:</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">process_documents</span><span class="p">(</span><span class="n">documents</span><span class="p">):</span>
    <span class="n">chunker</span> <span class="o">=</span> <span class="n">DataChunker</span><span class="p">()</span>
    <span class="n">all_chunks</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">sequence_idx_counter</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">documents</span><span class="p">:</span>
        <span class="n">context</span> <span class="o">=</span> <span class="p">(</span><span class="n">ChunkingContextBuilder</span><span class="p">()</span>
                  <span class="o">.</span><span class="n">for_document</span><span class="p">()</span>
                  <span class="o">.</span><span class="n">with_source</span><span class="p">(</span><span class="n">doc</span><span class="o">.</span><span class="n">filename</span><span class="p">)</span>
                  <span class="o">.</span><span class="n">with_start_sequence_idx</span><span class="p">(</span><span class="n">sequence_idx_counter</span><span class="p">)</span>
                  <span class="o">.</span><span class="n">build</span><span class="p">())</span>

        <span class="n">chunks</span> <span class="o">=</span> <span class="n">chunker</span><span class="o">.</span><span class="n">chunk</span><span class="p">(</span><span class="n">doc</span><span class="o">.</span><span class="n">content</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
        <span class="n">all_chunks</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">chunks</span><span class="p">)</span>
        <span class="n">sequence_idx_counter</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">chunks</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">all_chunks</span>
</code></pre></div>
<h5 id="ragora.core.chunking--strategy-types-and-defaults">Strategy Types and Defaults<a class="headerlink" href="#ragora.core.chunking--strategy-types-and-defaults" title="Permanent link">&para;</a></h5>
<table>
<thead>
<tr>
<th>Strategy</th>
<th>Chunk Size</th>
<th>Overlap</th>
<th>Use Case</th>
</tr>
</thead>
<tbody>
<tr>
<td>TextChunkingStrategy</td>
<td>768</td>
<td>100</td>
<td>General text content</td>
</tr>
<tr>
<td>DocumentChunkingStrategy</td>
<td>768</td>
<td>100</td>
<td>Academic papers, reports</td>
</tr>
<tr>
<td>EmailChunkingStrategy</td>
<td>512</td>
<td>50</td>
<td>Email messages</td>
</tr>
</tbody>
</table>
<h5 id="ragora.core.chunking--advanced-features">Advanced Features<a class="headerlink" href="#ragora.core.chunking--advanced-features" title="Permanent link">&para;</a></h5>
<h6 id="ragora.core.chunking--custom-metadata">Custom Metadata<a class="headerlink" href="#ragora.core.chunking--custom-metadata" title="Permanent link">&para;</a></h6>
<p>Add custom fields for future extensions:</p>
<div class="highlight"><pre><span></span><code><span class="n">context</span> <span class="o">=</span> <span class="p">(</span><span class="n">ChunkingContextBuilder</span><span class="p">()</span>
          <span class="o">.</span><span class="n">for_text</span><span class="p">()</span>
          <span class="o">.</span><span class="n">with_custom_metadata</span><span class="p">({</span>
              <span class="s2">&quot;language&quot;</span><span class="p">:</span> <span class="s2">&quot;en&quot;</span><span class="p">,</span>
              <span class="s2">&quot;domain&quot;</span><span class="p">:</span> <span class="s2">&quot;scientific&quot;</span><span class="p">,</span>
              <span class="s2">&quot;confidence&quot;</span><span class="p">:</span> <span class="mf">0.95</span>
          <span class="p">})</span>
          <span class="o">.</span><span class="n">build</span><span class="p">())</span>
</code></pre></div>
<h6 id="ragora.core.chunking--strategy-selection">Strategy Selection<a class="headerlink" href="#ragora.core.chunking--strategy-selection" title="Permanent link">&para;</a></h6>
<p>The chunker automatically selects strategies based on <code>context.chunk_type</code>:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># These will use different strategies:</span>
<span class="n">text_context</span> <span class="o">=</span> <span class="n">ChunkingContextBuilder</span><span class="p">()</span><span class="o">.</span><span class="n">for_text</span><span class="p">()</span><span class="o">.</span><span class="n">build</span><span class="p">()</span>      <span class="c1"># TextChunkingStrategy</span>
<span class="n">doc_context</span> <span class="o">=</span> <span class="n">ChunkingContextBuilder</span><span class="p">()</span><span class="o">.</span><span class="n">for_document</span><span class="p">()</span><span class="o">.</span><span class="n">build</span><span class="p">()</span>  <span class="c1"># DocumentChunkingStrategy</span>
<span class="n">email_context</span> <span class="o">=</span> <span class="n">ChunkingContextBuilder</span><span class="p">()</span><span class="o">.</span><span class="n">for_email</span><span class="p">()</span><span class="o">.</span><span class="n">build</span><span class="p">()</span>  <span class="c1"># EmailChunkingStrategy</span>
</code></pre></div>
<h5 id="ragora.core.chunking--performance-considerations">Performance Considerations<a class="headerlink" href="#ragora.core.chunking--performance-considerations" title="Permanent link">&para;</a></h5>
<ul>
<li><strong>Chunk Size</strong>: Larger chunks (768+) work well for documents, smaller (512) for emails</li>
<li><strong>Overlap</strong>: Higher overlap (100) preserves context, lower (50) reduces redundancy</li>
<li><strong>Memory</strong>: Chunking is memory-efficient, processing text in streams</li>
<li><strong>Threading</strong>: Strategies are stateless and thread-safe</li>
</ul>
<h5 id="ragora.core.chunking--error-handling">Error Handling<a class="headerlink" href="#ragora.core.chunking--error-handling" title="Permanent link">&para;</a></h5>
<p>The chunking system handles edge cases gracefully:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Empty text returns empty list</span>
<span class="n">chunks</span> <span class="o">=</span> <span class="n">chunker</span><span class="o">.</span><span class="n">chunk</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>  <span class="c1"># Returns []</span>

<span class="c1"># Whitespace-only text returns empty list</span>
<span class="n">chunks</span> <span class="o">=</span> <span class="n">chunker</span><span class="o">.</span><span class="n">chunk</span><span class="p">(</span><span class="s2">&quot;   </span>
           <span class="s2">&quot;, context)  # Returns []</span>

<span class="c1"># Invalid context falls back to default strategy</span>
<span class="n">context</span><span class="o">.</span><span class="n">chunk_type</span> <span class="o">=</span> <span class="s2">&quot;unknown&quot;</span>
<span class="n">chunks</span> <span class="o">=</span> <span class="n">chunker</span><span class="o">.</span><span class="n">chunk</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>  <span class="c1"># Uses default_strategy</span>
</code></pre></div>










  <div class="doc doc-children">









<div class="doc doc-object doc-class">



<h4 id="ragora.core.chunking.ChunkIdGenerator" class="doc doc-heading">
            <code>ChunkIdGenerator</code>


<a href="#ragora.core.chunking.ChunkIdGenerator" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">


        <p>Centralized, deterministic chunk ID generator for all chunking strategies.</p>
<p>This class provides a unified way to generate human-readable, deterministic
chunk IDs across all content types and chunking strategies. The IDs follow
a composite format that includes content type, source identification,
location information, and sequence numbering.</p>
<p>ID Format: {content_type}:{source_id}:{location_id}:{sequence_id}</p>
<p>Examples:
- text:doc_001:0:0001
- document:paper_2024_01:page_5:0003
- email:msg_abc123:thread_001:0001
- custom:user_data:batch_001:0002</p>








              <details class="quote">
                <summary>Source code in <code>ragora/ragora/core/chunking.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">ChunkIdGenerator</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Centralized, deterministic chunk ID generator for all chunking strategies.</span>

<span class="sd">    This class provides a unified way to generate human-readable, deterministic</span>
<span class="sd">    chunk IDs across all content types and chunking strategies. The IDs follow</span>
<span class="sd">    a composite format that includes content type, source identification,</span>
<span class="sd">    location information, and sequence numbering.</span>

<span class="sd">    ID Format: {content_type}:{source_id}:{location_id}:{sequence_id}</span>

<span class="sd">    Examples:</span>
<span class="sd">    - text:doc_001:0:0001</span>
<span class="sd">    - document:paper_2024_01:page_5:0003</span>
<span class="sd">    - email:msg_abc123:thread_001:0001</span>
<span class="sd">    - custom:user_data:batch_001:0002</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">generate_chunk_id</span><span class="p">(</span>
        <span class="n">content_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">source_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">location_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;0&quot;</span><span class="p">,</span>
        <span class="n">sequence_id</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="n">chunk_idx</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate a deterministic, human-readable chunk ID.</span>

<span class="sd">        Args:</span>
<span class="sd">            content_type: Type of content (text, document, email, custom)</span>
<span class="sd">            source_id: Unique identifier for the source document/content</span>
<span class="sd">            location_id: Location within source (page, section, etc.)</span>
<span class="sd">            sequence_id: Starting sequence number for this chunking session</span>
<span class="sd">            chunk_idx: Index of this chunk within the sequence</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: Deterministic chunk ID in format</span>
<span class="sd">                 content_type:source_id:location_id:sequence_num</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Normalize inputs</span>
        <span class="n">content_type</span> <span class="o">=</span> <span class="n">ChunkIdGenerator</span><span class="o">.</span><span class="n">_normalize_content_type</span><span class="p">(</span><span class="n">content_type</span><span class="p">)</span>
        <span class="n">source_id</span> <span class="o">=</span> <span class="n">ChunkIdGenerator</span><span class="o">.</span><span class="n">_normalize_source_id</span><span class="p">(</span><span class="n">source_id</span><span class="p">)</span>
        <span class="n">location_id</span> <span class="o">=</span> <span class="n">ChunkIdGenerator</span><span class="o">.</span><span class="n">_normalize_location_id</span><span class="p">(</span><span class="n">location_id</span><span class="p">)</span>

        <span class="c1"># Generate sequence number</span>
        <span class="n">sequence_num</span> <span class="o">=</span> <span class="n">sequence_id</span> <span class="o">+</span> <span class="n">chunk_idx</span>

        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">content_type</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">source_id</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">location_id</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">sequence_num</span><span class="si">:</span><span class="s2">04d</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_normalize_content_type</span><span class="p">(</span><span class="n">content_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Normalize content type for consistent formatting.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">content_type</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;text&quot;</span>

        <span class="c1"># Convert to lowercase and validate</span>
        <span class="n">normalized</span> <span class="o">=</span> <span class="n">content_type</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

        <span class="c1"># Map common variations to standard types</span>
        <span class="n">type_mapping</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;doc&quot;</span><span class="p">:</span> <span class="s2">&quot;document&quot;</span><span class="p">,</span>
            <span class="s2">&quot;docs&quot;</span><span class="p">:</span> <span class="s2">&quot;document&quot;</span><span class="p">,</span>
            <span class="s2">&quot;msg&quot;</span><span class="p">:</span> <span class="s2">&quot;email&quot;</span><span class="p">,</span>
            <span class="s2">&quot;mail&quot;</span><span class="p">:</span> <span class="s2">&quot;email&quot;</span><span class="p">,</span>
            <span class="s2">&quot;txt&quot;</span><span class="p">:</span> <span class="s2">&quot;text&quot;</span><span class="p">,</span>
            <span class="s2">&quot;plain&quot;</span><span class="p">:</span> <span class="s2">&quot;text&quot;</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="n">type_mapping</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">normalized</span><span class="p">,</span> <span class="n">normalized</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_normalize_source_id</span><span class="p">(</span><span class="n">source_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Normalize source ID for consistent formatting.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">source_id</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;unknown&quot;</span>

        <span class="c1"># Remove special characters, convert to lowercase, limit length</span>
        <span class="n">normalized</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;[^a-zA-Z0-9_-]&quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">,</span> <span class="n">source_id</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
        <span class="n">normalized</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;_+&quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">,</span> <span class="n">normalized</span><span class="p">)</span>  <span class="c1"># Collapse multiple underscores</span>
        <span class="n">normalized</span> <span class="o">=</span> <span class="n">normalized</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)</span>  <span class="c1"># Remove leading/trailing underscores</span>

        <span class="k">return</span> <span class="n">normalized</span><span class="p">[:</span><span class="mi">20</span><span class="p">]</span> <span class="k">if</span> <span class="n">normalized</span> <span class="k">else</span> <span class="s2">&quot;unknown&quot;</span>  <span class="c1"># Limit to 20 chars</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_normalize_location_id</span><span class="p">(</span><span class="n">location_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Normalize location ID for consistent formatting.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">location_id</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;0&quot;</span>

        <span class="c1"># Convert to string and normalize</span>
        <span class="n">location_str</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">location_id</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

        <span class="c1"># Handle common location patterns</span>
        <span class="k">if</span> <span class="n">location_str</span> <span class="o">==</span> <span class="s2">&quot;0&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;0&quot;</span>  <span class="c1"># Keep &quot;0&quot; as is for default case</span>
        <span class="k">elif</span> <span class="n">location_str</span><span class="o">.</span><span class="n">isdigit</span><span class="p">():</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;pos_</span><span class="si">{</span><span class="n">location_str</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">elif</span> <span class="n">location_str</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;page_&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">location_str</span>
        <span class="k">elif</span> <span class="n">location_str</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;sec_&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">location_str</span>
        <span class="k">elif</span> <span class="n">location_str</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;msg_&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">location_str</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># General normalization</span>
            <span class="n">normalized</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;[^a-zA-Z0-9_-]&quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">,</span> <span class="n">location_str</span><span class="p">)</span>
            <span class="n">normalized</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;_+&quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">,</span> <span class="n">normalized</span><span class="p">)</span>
            <span class="n">normalized</span> <span class="o">=</span> <span class="n">normalized</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">normalized</span><span class="p">[:</span><span class="mi">15</span><span class="p">]</span> <span class="k">if</span> <span class="n">normalized</span> <span class="k">else</span> <span class="s2">&quot;0&quot;</span>  <span class="c1"># Limit to 15 chars</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">parse_chunk_id</span><span class="p">(</span><span class="n">chunk_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Parse a chunk ID back into its components.</span>

<span class="sd">        Args:</span>
<span class="sd">            chunk_id: The chunk ID to parse</span>

<span class="sd">        Returns:</span>
<span class="sd">            Dict containing parsed components: content_type, source_id, location_id, sequence_num</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If chunk ID format is invalid</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">parts</span> <span class="o">=</span> <span class="n">chunk_id</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">4</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Invalid chunk ID format: </span><span class="si">{</span><span class="n">chunk_id</span><span class="si">}</span><span class="s2">. Expected format: content_type:source_id:location_id:sequence_num&quot;</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;content_type&quot;</span><span class="p">:</span> <span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="s2">&quot;source_id&quot;</span><span class="p">:</span> <span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
            <span class="s2">&quot;location_id&quot;</span><span class="p">:</span> <span class="n">parts</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
            <span class="s2">&quot;sequence_num&quot;</span><span class="p">:</span> <span class="n">parts</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span>
        <span class="p">}</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_source_hash</span><span class="p">(</span><span class="n">source_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">max_length</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">8</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate a short hash for source ID when it&#39;s too long.</span>

<span class="sd">        Args:</span>
<span class="sd">            source_id: The source ID to hash</span>
<span class="sd">            max_length: Maximum length of the hash</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: Short hash of the source ID</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">source_id</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;unknown&quot;</span>

        <span class="c1"># Create a deterministic hash</span>
        <span class="n">hash_obj</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">md5</span><span class="p">(</span><span class="n">source_id</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">))</span>
        <span class="n">hash_hex</span> <span class="o">=</span> <span class="n">hash_obj</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">hash_hex</span><span class="p">[:</span><span class="n">max_length</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h5 id="ragora.core.chunking.ChunkIdGenerator._normalize_content_type" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">_normalize_content_type</span><span class="p">(</span><span class="n">content_type</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#ragora.core.chunking.ChunkIdGenerator._normalize_content_type" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Normalize content type for consistent formatting.</p>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/core/chunking.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">_normalize_content_type</span><span class="p">(</span><span class="n">content_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Normalize content type for consistent formatting.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">content_type</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;text&quot;</span>

    <span class="c1"># Convert to lowercase and validate</span>
    <span class="n">normalized</span> <span class="o">=</span> <span class="n">content_type</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

    <span class="c1"># Map common variations to standard types</span>
    <span class="n">type_mapping</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;doc&quot;</span><span class="p">:</span> <span class="s2">&quot;document&quot;</span><span class="p">,</span>
        <span class="s2">&quot;docs&quot;</span><span class="p">:</span> <span class="s2">&quot;document&quot;</span><span class="p">,</span>
        <span class="s2">&quot;msg&quot;</span><span class="p">:</span> <span class="s2">&quot;email&quot;</span><span class="p">,</span>
        <span class="s2">&quot;mail&quot;</span><span class="p">:</span> <span class="s2">&quot;email&quot;</span><span class="p">,</span>
        <span class="s2">&quot;txt&quot;</span><span class="p">:</span> <span class="s2">&quot;text&quot;</span><span class="p">,</span>
        <span class="s2">&quot;plain&quot;</span><span class="p">:</span> <span class="s2">&quot;text&quot;</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">type_mapping</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">normalized</span><span class="p">,</span> <span class="n">normalized</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="ragora.core.chunking.ChunkIdGenerator._normalize_location_id" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">_normalize_location_id</span><span class="p">(</span><span class="n">location_id</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#ragora.core.chunking.ChunkIdGenerator._normalize_location_id" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Normalize location ID for consistent formatting.</p>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/core/chunking.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">_normalize_location_id</span><span class="p">(</span><span class="n">location_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Normalize location ID for consistent formatting.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">location_id</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;0&quot;</span>

    <span class="c1"># Convert to string and normalize</span>
    <span class="n">location_str</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">location_id</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

    <span class="c1"># Handle common location patterns</span>
    <span class="k">if</span> <span class="n">location_str</span> <span class="o">==</span> <span class="s2">&quot;0&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;0&quot;</span>  <span class="c1"># Keep &quot;0&quot; as is for default case</span>
    <span class="k">elif</span> <span class="n">location_str</span><span class="o">.</span><span class="n">isdigit</span><span class="p">():</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;pos_</span><span class="si">{</span><span class="n">location_str</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="k">elif</span> <span class="n">location_str</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;page_&quot;</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">location_str</span>
    <span class="k">elif</span> <span class="n">location_str</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;sec_&quot;</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">location_str</span>
    <span class="k">elif</span> <span class="n">location_str</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;msg_&quot;</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">location_str</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># General normalization</span>
        <span class="n">normalized</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;[^a-zA-Z0-9_-]&quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">,</span> <span class="n">location_str</span><span class="p">)</span>
        <span class="n">normalized</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;_+&quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">,</span> <span class="n">normalized</span><span class="p">)</span>
        <span class="n">normalized</span> <span class="o">=</span> <span class="n">normalized</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">normalized</span><span class="p">[:</span><span class="mi">15</span><span class="p">]</span> <span class="k">if</span> <span class="n">normalized</span> <span class="k">else</span> <span class="s2">&quot;0&quot;</span>  <span class="c1"># Limit to 15 chars</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="ragora.core.chunking.ChunkIdGenerator._normalize_source_id" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">_normalize_source_id</span><span class="p">(</span><span class="n">source_id</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#ragora.core.chunking.ChunkIdGenerator._normalize_source_id" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Normalize source ID for consistent formatting.</p>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/core/chunking.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">_normalize_source_id</span><span class="p">(</span><span class="n">source_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Normalize source ID for consistent formatting.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">source_id</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;unknown&quot;</span>

    <span class="c1"># Remove special characters, convert to lowercase, limit length</span>
    <span class="n">normalized</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;[^a-zA-Z0-9_-]&quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">,</span> <span class="n">source_id</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
    <span class="n">normalized</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;_+&quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">,</span> <span class="n">normalized</span><span class="p">)</span>  <span class="c1"># Collapse multiple underscores</span>
    <span class="n">normalized</span> <span class="o">=</span> <span class="n">normalized</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)</span>  <span class="c1"># Remove leading/trailing underscores</span>

    <span class="k">return</span> <span class="n">normalized</span><span class="p">[:</span><span class="mi">20</span><span class="p">]</span> <span class="k">if</span> <span class="n">normalized</span> <span class="k">else</span> <span class="s2">&quot;unknown&quot;</span>  <span class="c1"># Limit to 20 chars</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="ragora.core.chunking.ChunkIdGenerator.generate_chunk_id" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">generate_chunk_id</span><span class="p">(</span><span class="n">content_type</span><span class="p">,</span> <span class="n">source_id</span><span class="p">,</span> <span class="n">location_id</span><span class="o">=</span><span class="s1">&#39;0&#39;</span><span class="p">,</span> <span class="n">sequence_id</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">chunk_idx</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#ragora.core.chunking.ChunkIdGenerator.generate_chunk_id" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Generate a deterministic, human-readable chunk ID.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>content_type</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Type of content (text, document, email, custom)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>source_id</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Unique identifier for the source document/content</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>location_id</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Location within source (page, section, etc.)</p>
              </div>
            </td>
            <td>
                  <code>&#39;0&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>sequence_id</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Starting sequence number for this chunking session</p>
              </div>
            </td>
            <td>
                  <code>0</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>chunk_idx</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Index of this chunk within the sequence</p>
              </div>
            </td>
            <td>
                  <code>0</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>str</code></td>            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Deterministic chunk ID in format
 content_type:source_id:location_id:sequence_num</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/core/chunking.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">generate_chunk_id</span><span class="p">(</span>
    <span class="n">content_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">source_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">location_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;0&quot;</span><span class="p">,</span>
    <span class="n">sequence_id</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="n">chunk_idx</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate a deterministic, human-readable chunk ID.</span>

<span class="sd">    Args:</span>
<span class="sd">        content_type: Type of content (text, document, email, custom)</span>
<span class="sd">        source_id: Unique identifier for the source document/content</span>
<span class="sd">        location_id: Location within source (page, section, etc.)</span>
<span class="sd">        sequence_id: Starting sequence number for this chunking session</span>
<span class="sd">        chunk_idx: Index of this chunk within the sequence</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: Deterministic chunk ID in format</span>
<span class="sd">             content_type:source_id:location_id:sequence_num</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Normalize inputs</span>
    <span class="n">content_type</span> <span class="o">=</span> <span class="n">ChunkIdGenerator</span><span class="o">.</span><span class="n">_normalize_content_type</span><span class="p">(</span><span class="n">content_type</span><span class="p">)</span>
    <span class="n">source_id</span> <span class="o">=</span> <span class="n">ChunkIdGenerator</span><span class="o">.</span><span class="n">_normalize_source_id</span><span class="p">(</span><span class="n">source_id</span><span class="p">)</span>
    <span class="n">location_id</span> <span class="o">=</span> <span class="n">ChunkIdGenerator</span><span class="o">.</span><span class="n">_normalize_location_id</span><span class="p">(</span><span class="n">location_id</span><span class="p">)</span>

    <span class="c1"># Generate sequence number</span>
    <span class="n">sequence_num</span> <span class="o">=</span> <span class="n">sequence_id</span> <span class="o">+</span> <span class="n">chunk_idx</span>

    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">content_type</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">source_id</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">location_id</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">sequence_num</span><span class="si">:</span><span class="s2">04d</span><span class="si">}</span><span class="s2">&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="ragora.core.chunking.ChunkIdGenerator.get_source_hash" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_source_hash</span><span class="p">(</span><span class="n">source_id</span><span class="p">,</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#ragora.core.chunking.ChunkIdGenerator.get_source_hash" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Generate a short hash for source ID when it's too long.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>source_id</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The source ID to hash</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>max_length</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Maximum length of the hash</p>
              </div>
            </td>
            <td>
                  <code>8</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>str</code></td>            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Short hash of the source ID</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/core/chunking.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">get_source_hash</span><span class="p">(</span><span class="n">source_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">max_length</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">8</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate a short hash for source ID when it&#39;s too long.</span>

<span class="sd">    Args:</span>
<span class="sd">        source_id: The source ID to hash</span>
<span class="sd">        max_length: Maximum length of the hash</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: Short hash of the source ID</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">source_id</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;unknown&quot;</span>

    <span class="c1"># Create a deterministic hash</span>
    <span class="n">hash_obj</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">md5</span><span class="p">(</span><span class="n">source_id</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">))</span>
    <span class="n">hash_hex</span> <span class="o">=</span> <span class="n">hash_obj</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">hash_hex</span><span class="p">[:</span><span class="n">max_length</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="ragora.core.chunking.ChunkIdGenerator.parse_chunk_id" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">parse_chunk_id</span><span class="p">(</span><span class="n">chunk_id</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#ragora.core.chunking.ChunkIdGenerator.parse_chunk_id" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Parse a chunk ID back into its components.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>chunk_id</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The chunk ID to parse</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dict containing parsed components: content_type, source_id, location_id, sequence_num</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If chunk ID format is invalid</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/core/chunking.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">parse_chunk_id</span><span class="p">(</span><span class="n">chunk_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Parse a chunk ID back into its components.</span>

<span class="sd">    Args:</span>
<span class="sd">        chunk_id: The chunk ID to parse</span>

<span class="sd">    Returns:</span>
<span class="sd">        Dict containing parsed components: content_type, source_id, location_id, sequence_num</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If chunk ID format is invalid</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">parts</span> <span class="o">=</span> <span class="n">chunk_id</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">4</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Invalid chunk ID format: </span><span class="si">{</span><span class="n">chunk_id</span><span class="si">}</span><span class="s2">. Expected format: content_type:source_id:location_id:sequence_num&quot;</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="p">{</span>
        <span class="s2">&quot;content_type&quot;</span><span class="p">:</span> <span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
        <span class="s2">&quot;source_id&quot;</span><span class="p">:</span> <span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
        <span class="s2">&quot;location_id&quot;</span><span class="p">:</span> <span class="n">parts</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
        <span class="s2">&quot;sequence_num&quot;</span><span class="p">:</span> <span class="n">parts</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span>
    <span class="p">}</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="ragora.core.chunking.ChunkMetadata" class="doc doc-heading">
            <code>ChunkMetadata</code>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

<a href="#ragora.core.chunking.ChunkMetadata" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">


        <p>Metadata for a data chunk in Ragora.</p>
<p>This dataclass provides structured metadata for document chunks,
ensuring type safety and clear field definitions.</p>








              <details class="quote">
                <summary>Source code in <code>ragora/ragora/core/chunking.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">ChunkMetadata</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Metadata for a data chunk in Ragora.</span>

<span class="sd">    This dataclass provides structured metadata for document chunks,</span>
<span class="sd">    ensuring type safety and clear field definitions.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">chunk_idx</span><span class="p">:</span> <span class="nb">int</span>  <span class="c1"># Index of the chunk in the document</span>
    <span class="n">chunk_size</span><span class="p">:</span> <span class="nb">int</span>  <span class="c1"># Size of the chunk in tokens</span>
    <span class="n">total_chunks</span><span class="p">:</span> <span class="nb">int</span>  <span class="c1"># Total number of chunks in the document</span>
    <span class="n">source_document</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># Source document filename</span>
    <span class="n">page_number</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># Page number of the chunk</span>
    <span class="n">section_title</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># Section title of the chunk</span>
    <span class="n">chunk_type</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># Type of chunk (text, citation, equation, etc.)</span>
    <span class="n">created_at</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># Creation date of the chunk</span>
    <span class="n">email_subject</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># Email subject of the chunk</span>
    <span class="n">email_sender</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># Email sender of the chunk</span>
    <span class="n">email_recipient</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># Email recipient of the chunk</span>
    <span class="n">email_date</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># Email date of the chunk</span>
    <span class="n">email_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># Email id of the chunk</span>
    <span class="n">email_folder</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># Email folder of the chunk</span>
    <span class="n">custom_metadata</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># Custom metadata dictionary</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="ragora.core.chunking.ChunkingContext" class="doc doc-heading">
            <code>ChunkingContext</code>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

<a href="#ragora.core.chunking.ChunkingContext" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">


        <p>Context object containing all chunking metadata and configuration.</p>








              <details class="quote">
                <summary>Source code in <code>ragora/ragora/core/chunking.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">ChunkingContext</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Context object containing all chunking metadata and configuration.&quot;&quot;&quot;</span>

    <span class="n">chunk_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;text&quot;</span>
    <span class="n">source_document</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">page_number</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">section_title</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">created_at</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="c1"># Email-specific fields</span>
    <span class="n">email_subject</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">email_sender</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">email_recipient</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">email_date</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">email_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">email_folder</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="c1"># ID generation parameters</span>
    <span class="n">source_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># Unique source identifier for ID generation</span>
    <span class="n">location_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># Location within source (page, section, etc.)</span>
    <span class="n">start_sequence_idx</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># Starting sequence index for deterministic IDs</span>
    <span class="c1"># Future extensions</span>
    <span class="n">custom_metadata</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="ragora.core.chunking.ChunkingContextBuilder" class="doc doc-heading">
            <code>ChunkingContextBuilder</code>


<a href="#ragora.core.chunking.ChunkingContextBuilder" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">


        <p>Builder for creating ChunkingContext objects with fluent API.</p>








              <details class="quote">
                <summary>Source code in <code>ragora/ragora/core/chunking.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">ChunkingContextBuilder</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Builder for creating ChunkingContext objects with fluent API.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_context</span> <span class="o">=</span> <span class="n">ChunkingContext</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">for_text</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;ChunkingContextBuilder&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set chunk type to text.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_context</span><span class="o">.</span><span class="n">chunk_type</span> <span class="o">=</span> <span class="s2">&quot;text&quot;</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">for_document</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;ChunkingContextBuilder&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set chunk type to document.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_context</span><span class="o">.</span><span class="n">chunk_type</span> <span class="o">=</span> <span class="s2">&quot;document&quot;</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">for_email</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;ChunkingContextBuilder&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set chunk type to email.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_context</span><span class="o">.</span><span class="n">chunk_type</span> <span class="o">=</span> <span class="s2">&quot;email&quot;</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">with_source</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;ChunkingContextBuilder&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set source document.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_context</span><span class="o">.</span><span class="n">source_document</span> <span class="o">=</span> <span class="n">source</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">with_page</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">page</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;ChunkingContextBuilder&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set page number.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_context</span><span class="o">.</span><span class="n">page_number</span> <span class="o">=</span> <span class="n">page</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">with_section</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">section</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;ChunkingContextBuilder&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set section title.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_context</span><span class="o">.</span><span class="n">section_title</span> <span class="o">=</span> <span class="n">section</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">with_created_at</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">created_at</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;ChunkingContextBuilder&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set creation date.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_context</span><span class="o">.</span><span class="n">created_at</span> <span class="o">=</span> <span class="n">created_at</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">with_email_info</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">subject</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">sender</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">recipient</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">email_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">email_date</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">email_folder</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;ChunkingContextBuilder&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set email-specific information.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_context</span><span class="o">.</span><span class="n">email_subject</span> <span class="o">=</span> <span class="n">subject</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_context</span><span class="o">.</span><span class="n">email_sender</span> <span class="o">=</span> <span class="n">sender</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_context</span><span class="o">.</span><span class="n">email_recipient</span> <span class="o">=</span> <span class="n">recipient</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_context</span><span class="o">.</span><span class="n">email_id</span> <span class="o">=</span> <span class="n">email_id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_context</span><span class="o">.</span><span class="n">email_date</span> <span class="o">=</span> <span class="n">email_date</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_context</span><span class="o">.</span><span class="n">email_folder</span> <span class="o">=</span> <span class="n">email_folder</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">with_source_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;ChunkingContextBuilder&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set unique source identifier for deterministic ID generation.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_context</span><span class="o">.</span><span class="n">source_id</span> <span class="o">=</span> <span class="n">source_id</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">with_location_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">location_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;ChunkingContextBuilder&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set location within source for deterministic ID generation.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_context</span><span class="o">.</span><span class="n">location_id</span> <span class="o">=</span> <span class="n">location_id</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">with_start_sequence_idx</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sequence_idx</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;ChunkingContextBuilder&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set starting sequence index for deterministic ID generation.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_context</span><span class="o">.</span><span class="n">start_sequence_idx</span> <span class="o">=</span> <span class="n">sequence_idx</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">with_custom_metadata</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">metadata</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;ChunkingContextBuilder&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set custom metadata.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_context</span><span class="o">.</span><span class="n">custom_metadata</span> <span class="o">=</span> <span class="n">metadata</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">build</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ChunkingContext</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Build the ChunkingContext object.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_context</span>

    <span class="c1"># Convenience methods for common patterns</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">for_document_with_page</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">source_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">page</span><span class="p">:</span> <span class="nb">int</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;ChunkingContextBuilder&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set up for document chunking with page number and source ID.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">for_document</span><span class="p">()</span>
            <span class="o">.</span><span class="n">with_source_id</span><span class="p">(</span><span class="n">source_id</span><span class="p">)</span>
            <span class="o">.</span><span class="n">with_page</span><span class="p">(</span><span class="n">page</span><span class="p">)</span>
            <span class="o">.</span><span class="n">with_location_id</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;page_</span><span class="si">{</span><span class="n">page</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">for_email_with_id</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">email_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">subject</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">sender</span><span class="p">:</span> <span class="nb">str</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;ChunkingContextBuilder&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set up for email chunking with email ID and metadata.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">for_email</span><span class="p">()</span>
            <span class="o">.</span><span class="n">with_source_id</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;email_</span><span class="si">{</span><span class="n">email_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="o">.</span><span class="n">with_email_info</span><span class="p">(</span><span class="n">subject</span><span class="p">,</span> <span class="n">sender</span><span class="p">)</span>
            <span class="o">.</span><span class="n">with_location_id</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;msg_</span><span class="si">{</span><span class="n">email_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">for_text_with_source</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;ChunkingContextBuilder&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set up for text chunking with source ID.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">for_text</span><span class="p">()</span><span class="o">.</span><span class="n">with_source_id</span><span class="p">(</span><span class="n">source_id</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h5 id="ragora.core.chunking.ChunkingContextBuilder.build" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">build</span><span class="p">()</span></code>

<a href="#ragora.core.chunking.ChunkingContextBuilder.build" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Build the ChunkingContext object.</p>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/core/chunking.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">build</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ChunkingContext</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Build the ChunkingContext object.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_context</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="ragora.core.chunking.ChunkingContextBuilder.for_document" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">for_document</span><span class="p">()</span></code>

<a href="#ragora.core.chunking.ChunkingContextBuilder.for_document" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Set chunk type to document.</p>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/core/chunking.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">for_document</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;ChunkingContextBuilder&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Set chunk type to document.&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_context</span><span class="o">.</span><span class="n">chunk_type</span> <span class="o">=</span> <span class="s2">&quot;document&quot;</span>
    <span class="k">return</span> <span class="bp">self</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="ragora.core.chunking.ChunkingContextBuilder.for_document_with_page" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">for_document_with_page</span><span class="p">(</span><span class="n">source_id</span><span class="p">,</span> <span class="n">page</span><span class="p">)</span></code>

<a href="#ragora.core.chunking.ChunkingContextBuilder.for_document_with_page" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Set up for document chunking with page number and source ID.</p>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/core/chunking.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">for_document_with_page</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">source_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">page</span><span class="p">:</span> <span class="nb">int</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;ChunkingContextBuilder&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Set up for document chunking with page number and source ID.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">for_document</span><span class="p">()</span>
        <span class="o">.</span><span class="n">with_source_id</span><span class="p">(</span><span class="n">source_id</span><span class="p">)</span>
        <span class="o">.</span><span class="n">with_page</span><span class="p">(</span><span class="n">page</span><span class="p">)</span>
        <span class="o">.</span><span class="n">with_location_id</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;page_</span><span class="si">{</span><span class="n">page</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="ragora.core.chunking.ChunkingContextBuilder.for_email" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">for_email</span><span class="p">()</span></code>

<a href="#ragora.core.chunking.ChunkingContextBuilder.for_email" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Set chunk type to email.</p>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/core/chunking.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">for_email</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;ChunkingContextBuilder&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Set chunk type to email.&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_context</span><span class="o">.</span><span class="n">chunk_type</span> <span class="o">=</span> <span class="s2">&quot;email&quot;</span>
    <span class="k">return</span> <span class="bp">self</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="ragora.core.chunking.ChunkingContextBuilder.for_email_with_id" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">for_email_with_id</span><span class="p">(</span><span class="n">email_id</span><span class="p">,</span> <span class="n">subject</span><span class="p">,</span> <span class="n">sender</span><span class="p">)</span></code>

<a href="#ragora.core.chunking.ChunkingContextBuilder.for_email_with_id" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Set up for email chunking with email ID and metadata.</p>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/core/chunking.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">for_email_with_id</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">email_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">subject</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">sender</span><span class="p">:</span> <span class="nb">str</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;ChunkingContextBuilder&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Set up for email chunking with email ID and metadata.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">for_email</span><span class="p">()</span>
        <span class="o">.</span><span class="n">with_source_id</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;email_</span><span class="si">{</span><span class="n">email_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="o">.</span><span class="n">with_email_info</span><span class="p">(</span><span class="n">subject</span><span class="p">,</span> <span class="n">sender</span><span class="p">)</span>
        <span class="o">.</span><span class="n">with_location_id</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;msg_</span><span class="si">{</span><span class="n">email_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="ragora.core.chunking.ChunkingContextBuilder.for_text" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">for_text</span><span class="p">()</span></code>

<a href="#ragora.core.chunking.ChunkingContextBuilder.for_text" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Set chunk type to text.</p>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/core/chunking.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">for_text</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;ChunkingContextBuilder&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Set chunk type to text.&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_context</span><span class="o">.</span><span class="n">chunk_type</span> <span class="o">=</span> <span class="s2">&quot;text&quot;</span>
    <span class="k">return</span> <span class="bp">self</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="ragora.core.chunking.ChunkingContextBuilder.for_text_with_source" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">for_text_with_source</span><span class="p">(</span><span class="n">source_id</span><span class="p">)</span></code>

<a href="#ragora.core.chunking.ChunkingContextBuilder.for_text_with_source" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Set up for text chunking with source ID.</p>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/core/chunking.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">for_text_with_source</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;ChunkingContextBuilder&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Set up for text chunking with source ID.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">for_text</span><span class="p">()</span><span class="o">.</span><span class="n">with_source_id</span><span class="p">(</span><span class="n">source_id</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="ragora.core.chunking.ChunkingContextBuilder.with_created_at" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">with_created_at</span><span class="p">(</span><span class="n">created_at</span><span class="p">)</span></code>

<a href="#ragora.core.chunking.ChunkingContextBuilder.with_created_at" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Set creation date.</p>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/core/chunking.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">with_created_at</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">created_at</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;ChunkingContextBuilder&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Set creation date.&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_context</span><span class="o">.</span><span class="n">created_at</span> <span class="o">=</span> <span class="n">created_at</span>
    <span class="k">return</span> <span class="bp">self</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="ragora.core.chunking.ChunkingContextBuilder.with_custom_metadata" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">with_custom_metadata</span><span class="p">(</span><span class="n">metadata</span><span class="p">)</span></code>

<a href="#ragora.core.chunking.ChunkingContextBuilder.with_custom_metadata" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Set custom metadata.</p>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/core/chunking.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">with_custom_metadata</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">metadata</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;ChunkingContextBuilder&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Set custom metadata.&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_context</span><span class="o">.</span><span class="n">custom_metadata</span> <span class="o">=</span> <span class="n">metadata</span>
    <span class="k">return</span> <span class="bp">self</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="ragora.core.chunking.ChunkingContextBuilder.with_email_info" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">with_email_info</span><span class="p">(</span><span class="n">subject</span><span class="p">,</span> <span class="n">sender</span><span class="p">,</span> <span class="n">recipient</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">email_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">email_date</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">email_folder</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#ragora.core.chunking.ChunkingContextBuilder.with_email_info" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Set email-specific information.</p>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/core/chunking.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">with_email_info</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">subject</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">sender</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">recipient</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">email_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">email_date</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">email_folder</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;ChunkingContextBuilder&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Set email-specific information.&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_context</span><span class="o">.</span><span class="n">email_subject</span> <span class="o">=</span> <span class="n">subject</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_context</span><span class="o">.</span><span class="n">email_sender</span> <span class="o">=</span> <span class="n">sender</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_context</span><span class="o">.</span><span class="n">email_recipient</span> <span class="o">=</span> <span class="n">recipient</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_context</span><span class="o">.</span><span class="n">email_id</span> <span class="o">=</span> <span class="n">email_id</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_context</span><span class="o">.</span><span class="n">email_date</span> <span class="o">=</span> <span class="n">email_date</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_context</span><span class="o">.</span><span class="n">email_folder</span> <span class="o">=</span> <span class="n">email_folder</span>
    <span class="k">return</span> <span class="bp">self</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="ragora.core.chunking.ChunkingContextBuilder.with_location_id" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">with_location_id</span><span class="p">(</span><span class="n">location_id</span><span class="p">)</span></code>

<a href="#ragora.core.chunking.ChunkingContextBuilder.with_location_id" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Set location within source for deterministic ID generation.</p>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/core/chunking.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">with_location_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">location_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;ChunkingContextBuilder&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Set location within source for deterministic ID generation.&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_context</span><span class="o">.</span><span class="n">location_id</span> <span class="o">=</span> <span class="n">location_id</span>
    <span class="k">return</span> <span class="bp">self</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="ragora.core.chunking.ChunkingContextBuilder.with_page" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">with_page</span><span class="p">(</span><span class="n">page</span><span class="p">)</span></code>

<a href="#ragora.core.chunking.ChunkingContextBuilder.with_page" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Set page number.</p>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/core/chunking.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">with_page</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">page</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;ChunkingContextBuilder&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Set page number.&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_context</span><span class="o">.</span><span class="n">page_number</span> <span class="o">=</span> <span class="n">page</span>
    <span class="k">return</span> <span class="bp">self</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="ragora.core.chunking.ChunkingContextBuilder.with_section" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">with_section</span><span class="p">(</span><span class="n">section</span><span class="p">)</span></code>

<a href="#ragora.core.chunking.ChunkingContextBuilder.with_section" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Set section title.</p>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/core/chunking.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">with_section</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">section</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;ChunkingContextBuilder&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Set section title.&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_context</span><span class="o">.</span><span class="n">section_title</span> <span class="o">=</span> <span class="n">section</span>
    <span class="k">return</span> <span class="bp">self</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="ragora.core.chunking.ChunkingContextBuilder.with_source" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">with_source</span><span class="p">(</span><span class="n">source</span><span class="p">)</span></code>

<a href="#ragora.core.chunking.ChunkingContextBuilder.with_source" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Set source document.</p>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/core/chunking.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">with_source</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;ChunkingContextBuilder&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Set source document.&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_context</span><span class="o">.</span><span class="n">source_document</span> <span class="o">=</span> <span class="n">source</span>
    <span class="k">return</span> <span class="bp">self</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="ragora.core.chunking.ChunkingContextBuilder.with_source_id" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">with_source_id</span><span class="p">(</span><span class="n">source_id</span><span class="p">)</span></code>

<a href="#ragora.core.chunking.ChunkingContextBuilder.with_source_id" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Set unique source identifier for deterministic ID generation.</p>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/core/chunking.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">with_source_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;ChunkingContextBuilder&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Set unique source identifier for deterministic ID generation.&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_context</span><span class="o">.</span><span class="n">source_id</span> <span class="o">=</span> <span class="n">source_id</span>
    <span class="k">return</span> <span class="bp">self</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="ragora.core.chunking.ChunkingContextBuilder.with_start_sequence_idx" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">with_start_sequence_idx</span><span class="p">(</span><span class="n">sequence_idx</span><span class="p">)</span></code>

<a href="#ragora.core.chunking.ChunkingContextBuilder.with_start_sequence_idx" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Set starting sequence index for deterministic ID generation.</p>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/core/chunking.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">with_start_sequence_idx</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sequence_idx</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;ChunkingContextBuilder&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Set starting sequence index for deterministic ID generation.&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_context</span><span class="o">.</span><span class="n">start_sequence_idx</span> <span class="o">=</span> <span class="n">sequence_idx</span>
    <span class="k">return</span> <span class="bp">self</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="ragora.core.chunking.ChunkingStrategy" class="doc doc-heading">
            <code>ChunkingStrategy</code>


<a href="#ragora.core.chunking.ChunkingStrategy" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="abc.ABC">ABC</span></code></p>


        <p>Abstract base class for different chunking strategies.</p>








              <details class="quote">
                <summary>Source code in <code>ragora/ragora/core/chunking.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">ChunkingStrategy</span><span class="p">(</span><span class="n">ABC</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Abstract base class for different chunking strategies.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">chunk_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">768</span><span class="p">,</span> <span class="n">overlap_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">chunk_size</span> <span class="o">=</span> <span class="n">chunk_size</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">overlap_size</span> <span class="o">=</span> <span class="n">overlap_size</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">chunk</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">ChunkingContext</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">DataChunk</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Chunk text using the specific strategy.&quot;&quot;&quot;</span>
        <span class="k">pass</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_create_chunk_with_id</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">start_idx</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">end_idx</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">chunk_idx</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">context</span><span class="p">:</span> <span class="n">ChunkingContext</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataChunk</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a DataChunk with deterministic ID generation.</span>

<span class="sd">        Args:</span>
<span class="sd">            text: The chunk text content</span>
<span class="sd">            start_idx: Start index in original text</span>
<span class="sd">            end_idx: End index in original text</span>
<span class="sd">            chunk_idx: Index of this chunk in the sequence</span>
<span class="sd">            context: Chunking context with metadata</span>

<span class="sd">        Returns:</span>
<span class="sd">            DataChunk with deterministic chunk_id</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Generate deterministic chunk ID</span>
        <span class="n">chunk_id</span> <span class="o">=</span> <span class="n">ChunkIdGenerator</span><span class="o">.</span><span class="n">generate_chunk_id</span><span class="p">(</span>
            <span class="n">content_type</span><span class="o">=</span><span class="n">context</span><span class="o">.</span><span class="n">chunk_type</span><span class="p">,</span>
            <span class="n">source_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_source_id</span><span class="p">(</span><span class="n">context</span><span class="p">),</span>
            <span class="n">location_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_location_id</span><span class="p">(</span><span class="n">context</span><span class="p">),</span>
            <span class="n">sequence_id</span><span class="o">=</span><span class="n">context</span><span class="o">.</span><span class="n">start_sequence_idx</span><span class="p">,</span>
            <span class="n">chunk_idx</span><span class="o">=</span><span class="n">chunk_idx</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">DataChunk</span><span class="p">(</span>
            <span class="n">text</span><span class="o">=</span><span class="n">text</span><span class="p">,</span>
            <span class="n">start_idx</span><span class="o">=</span><span class="n">start_idx</span><span class="p">,</span>
            <span class="n">end_idx</span><span class="o">=</span><span class="n">end_idx</span><span class="p">,</span>
            <span class="n">chunk_id</span><span class="o">=</span><span class="n">chunk_id</span><span class="p">,</span>
            <span class="n">metadata</span><span class="o">=</span><span class="n">ChunkMetadata</span><span class="p">(</span>
                <span class="n">chunk_idx</span><span class="o">=</span><span class="n">chunk_idx</span><span class="p">,</span>
                <span class="n">chunk_size</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">text</span><span class="p">),</span>
                <span class="n">total_chunks</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>  <span class="c1"># Will be updated after all chunks</span>
                <span class="n">source_document</span><span class="o">=</span><span class="n">context</span><span class="o">.</span><span class="n">source_document</span><span class="p">,</span>
                <span class="n">page_number</span><span class="o">=</span><span class="n">context</span><span class="o">.</span><span class="n">page_number</span><span class="p">,</span>
                <span class="n">section_title</span><span class="o">=</span><span class="n">context</span><span class="o">.</span><span class="n">section_title</span><span class="p">,</span>
                <span class="n">chunk_type</span><span class="o">=</span><span class="n">context</span><span class="o">.</span><span class="n">chunk_type</span><span class="p">,</span>
                <span class="n">created_at</span><span class="o">=</span><span class="n">context</span><span class="o">.</span><span class="n">created_at</span><span class="p">,</span>
                <span class="n">email_subject</span><span class="o">=</span><span class="n">context</span><span class="o">.</span><span class="n">email_subject</span><span class="p">,</span>
                <span class="n">email_sender</span><span class="o">=</span><span class="n">context</span><span class="o">.</span><span class="n">email_sender</span><span class="p">,</span>
                <span class="n">email_recipient</span><span class="o">=</span><span class="n">context</span><span class="o">.</span><span class="n">email_recipient</span><span class="p">,</span>
                <span class="n">email_date</span><span class="o">=</span><span class="n">context</span><span class="o">.</span><span class="n">email_date</span><span class="p">,</span>
                <span class="n">email_id</span><span class="o">=</span><span class="n">context</span><span class="o">.</span><span class="n">email_id</span><span class="p">,</span>
                <span class="n">email_folder</span><span class="o">=</span><span class="n">context</span><span class="o">.</span><span class="n">email_folder</span><span class="p">,</span>
                <span class="n">custom_metadata</span><span class="o">=</span><span class="n">context</span><span class="o">.</span><span class="n">custom_metadata</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="n">chunk_type</span><span class="o">=</span><span class="n">context</span><span class="o">.</span><span class="n">chunk_type</span><span class="p">,</span>
            <span class="n">source_document</span><span class="o">=</span><span class="n">context</span><span class="o">.</span><span class="n">source_document</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_get_source_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">ChunkingContext</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get source ID for chunk ID generation.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">context</span><span class="o">.</span><span class="n">source_id</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">context</span><span class="o">.</span><span class="n">source_id</span>
        <span class="k">elif</span> <span class="n">context</span><span class="o">.</span><span class="n">source_document</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">context</span><span class="o">.</span><span class="n">source_document</span>
        <span class="k">elif</span> <span class="n">context</span><span class="o">.</span><span class="n">email_id</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;email_</span><span class="si">{</span><span class="n">context</span><span class="o">.</span><span class="n">email_id</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;unknown&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_get_location_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">ChunkingContext</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get location ID for chunk ID generation.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">context</span><span class="o">.</span><span class="n">location_id</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">context</span><span class="o">.</span><span class="n">location_id</span>
        <span class="k">elif</span> <span class="n">context</span><span class="o">.</span><span class="n">chunk_type</span> <span class="o">==</span> <span class="s2">&quot;document&quot;</span> <span class="ow">and</span> <span class="n">context</span><span class="o">.</span><span class="n">page_number</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;page_</span><span class="si">{</span><span class="n">context</span><span class="o">.</span><span class="n">page_number</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">elif</span> <span class="n">context</span><span class="o">.</span><span class="n">chunk_type</span> <span class="o">==</span> <span class="s2">&quot;email&quot;</span> <span class="ow">and</span> <span class="n">context</span><span class="o">.</span><span class="n">email_id</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;msg_</span><span class="si">{</span><span class="n">context</span><span class="o">.</span><span class="n">email_id</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">elif</span> <span class="n">context</span><span class="o">.</span><span class="n">section_title</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;sec_</span><span class="si">{</span><span class="n">context</span><span class="o">.</span><span class="n">section_title</span><span class="p">[:</span><span class="mi">10</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;0&quot;</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h5 id="ragora.core.chunking.ChunkingStrategy._create_chunk_with_id" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">_create_chunk_with_id</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">start_idx</span><span class="p">,</span> <span class="n">end_idx</span><span class="p">,</span> <span class="n">chunk_idx</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span></code>

<a href="#ragora.core.chunking.ChunkingStrategy._create_chunk_with_id" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Create a DataChunk with deterministic ID generation.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>text</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The chunk text content</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>start_idx</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Start index in original text</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>end_idx</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>End index in original text</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>chunk_idx</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Index of this chunk in the sequence</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>context</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="ChunkingContext


  
      dataclass
   (ragora.core.chunking.ChunkingContext)" href="#ragora.core.chunking.ChunkingContext">ChunkingContext</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Chunking context with metadata</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="DataChunk


  
      dataclass
   (ragora.core.chunking.DataChunk)" href="#ragora.core.chunking.DataChunk">DataChunk</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>DataChunk with deterministic chunk_id</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/core/chunking.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">_create_chunk_with_id</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">start_idx</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">end_idx</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">chunk_idx</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">context</span><span class="p">:</span> <span class="n">ChunkingContext</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataChunk</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create a DataChunk with deterministic ID generation.</span>

<span class="sd">    Args:</span>
<span class="sd">        text: The chunk text content</span>
<span class="sd">        start_idx: Start index in original text</span>
<span class="sd">        end_idx: End index in original text</span>
<span class="sd">        chunk_idx: Index of this chunk in the sequence</span>
<span class="sd">        context: Chunking context with metadata</span>

<span class="sd">    Returns:</span>
<span class="sd">        DataChunk with deterministic chunk_id</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Generate deterministic chunk ID</span>
    <span class="n">chunk_id</span> <span class="o">=</span> <span class="n">ChunkIdGenerator</span><span class="o">.</span><span class="n">generate_chunk_id</span><span class="p">(</span>
        <span class="n">content_type</span><span class="o">=</span><span class="n">context</span><span class="o">.</span><span class="n">chunk_type</span><span class="p">,</span>
        <span class="n">source_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_source_id</span><span class="p">(</span><span class="n">context</span><span class="p">),</span>
        <span class="n">location_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_location_id</span><span class="p">(</span><span class="n">context</span><span class="p">),</span>
        <span class="n">sequence_id</span><span class="o">=</span><span class="n">context</span><span class="o">.</span><span class="n">start_sequence_idx</span><span class="p">,</span>
        <span class="n">chunk_idx</span><span class="o">=</span><span class="n">chunk_idx</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">DataChunk</span><span class="p">(</span>
        <span class="n">text</span><span class="o">=</span><span class="n">text</span><span class="p">,</span>
        <span class="n">start_idx</span><span class="o">=</span><span class="n">start_idx</span><span class="p">,</span>
        <span class="n">end_idx</span><span class="o">=</span><span class="n">end_idx</span><span class="p">,</span>
        <span class="n">chunk_id</span><span class="o">=</span><span class="n">chunk_id</span><span class="p">,</span>
        <span class="n">metadata</span><span class="o">=</span><span class="n">ChunkMetadata</span><span class="p">(</span>
            <span class="n">chunk_idx</span><span class="o">=</span><span class="n">chunk_idx</span><span class="p">,</span>
            <span class="n">chunk_size</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">text</span><span class="p">),</span>
            <span class="n">total_chunks</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>  <span class="c1"># Will be updated after all chunks</span>
            <span class="n">source_document</span><span class="o">=</span><span class="n">context</span><span class="o">.</span><span class="n">source_document</span><span class="p">,</span>
            <span class="n">page_number</span><span class="o">=</span><span class="n">context</span><span class="o">.</span><span class="n">page_number</span><span class="p">,</span>
            <span class="n">section_title</span><span class="o">=</span><span class="n">context</span><span class="o">.</span><span class="n">section_title</span><span class="p">,</span>
            <span class="n">chunk_type</span><span class="o">=</span><span class="n">context</span><span class="o">.</span><span class="n">chunk_type</span><span class="p">,</span>
            <span class="n">created_at</span><span class="o">=</span><span class="n">context</span><span class="o">.</span><span class="n">created_at</span><span class="p">,</span>
            <span class="n">email_subject</span><span class="o">=</span><span class="n">context</span><span class="o">.</span><span class="n">email_subject</span><span class="p">,</span>
            <span class="n">email_sender</span><span class="o">=</span><span class="n">context</span><span class="o">.</span><span class="n">email_sender</span><span class="p">,</span>
            <span class="n">email_recipient</span><span class="o">=</span><span class="n">context</span><span class="o">.</span><span class="n">email_recipient</span><span class="p">,</span>
            <span class="n">email_date</span><span class="o">=</span><span class="n">context</span><span class="o">.</span><span class="n">email_date</span><span class="p">,</span>
            <span class="n">email_id</span><span class="o">=</span><span class="n">context</span><span class="o">.</span><span class="n">email_id</span><span class="p">,</span>
            <span class="n">email_folder</span><span class="o">=</span><span class="n">context</span><span class="o">.</span><span class="n">email_folder</span><span class="p">,</span>
            <span class="n">custom_metadata</span><span class="o">=</span><span class="n">context</span><span class="o">.</span><span class="n">custom_metadata</span><span class="p">,</span>
        <span class="p">),</span>
        <span class="n">chunk_type</span><span class="o">=</span><span class="n">context</span><span class="o">.</span><span class="n">chunk_type</span><span class="p">,</span>
        <span class="n">source_document</span><span class="o">=</span><span class="n">context</span><span class="o">.</span><span class="n">source_document</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="ragora.core.chunking.ChunkingStrategy._get_location_id" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">_get_location_id</span><span class="p">(</span><span class="n">context</span><span class="p">)</span></code>

<a href="#ragora.core.chunking.ChunkingStrategy._get_location_id" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Get location ID for chunk ID generation.</p>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/core/chunking.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">_get_location_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">ChunkingContext</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get location ID for chunk ID generation.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">context</span><span class="o">.</span><span class="n">location_id</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">context</span><span class="o">.</span><span class="n">location_id</span>
    <span class="k">elif</span> <span class="n">context</span><span class="o">.</span><span class="n">chunk_type</span> <span class="o">==</span> <span class="s2">&quot;document&quot;</span> <span class="ow">and</span> <span class="n">context</span><span class="o">.</span><span class="n">page_number</span><span class="p">:</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;page_</span><span class="si">{</span><span class="n">context</span><span class="o">.</span><span class="n">page_number</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="k">elif</span> <span class="n">context</span><span class="o">.</span><span class="n">chunk_type</span> <span class="o">==</span> <span class="s2">&quot;email&quot;</span> <span class="ow">and</span> <span class="n">context</span><span class="o">.</span><span class="n">email_id</span><span class="p">:</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;msg_</span><span class="si">{</span><span class="n">context</span><span class="o">.</span><span class="n">email_id</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="k">elif</span> <span class="n">context</span><span class="o">.</span><span class="n">section_title</span><span class="p">:</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;sec_</span><span class="si">{</span><span class="n">context</span><span class="o">.</span><span class="n">section_title</span><span class="p">[:</span><span class="mi">10</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;0&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="ragora.core.chunking.ChunkingStrategy._get_source_id" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">_get_source_id</span><span class="p">(</span><span class="n">context</span><span class="p">)</span></code>

<a href="#ragora.core.chunking.ChunkingStrategy._get_source_id" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Get source ID for chunk ID generation.</p>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/core/chunking.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">_get_source_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">ChunkingContext</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get source ID for chunk ID generation.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">context</span><span class="o">.</span><span class="n">source_id</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">context</span><span class="o">.</span><span class="n">source_id</span>
    <span class="k">elif</span> <span class="n">context</span><span class="o">.</span><span class="n">source_document</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">context</span><span class="o">.</span><span class="n">source_document</span>
    <span class="k">elif</span> <span class="n">context</span><span class="o">.</span><span class="n">email_id</span><span class="p">:</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;email_</span><span class="si">{</span><span class="n">context</span><span class="o">.</span><span class="n">email_id</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;unknown&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="ragora.core.chunking.ChunkingStrategy.chunk" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">chunk</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-abstractmethod"><code>abstractmethod</code></small>
  </span>

<a href="#ragora.core.chunking.ChunkingStrategy.chunk" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Chunk text using the specific strategy.</p>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/core/chunking.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@abstractmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">chunk</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">ChunkingContext</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">DataChunk</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Chunk text using the specific strategy.&quot;&quot;&quot;</span>
    <span class="k">pass</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="ragora.core.chunking.DataChunk" class="doc doc-heading">
            <code>DataChunk</code>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

<a href="#ragora.core.chunking.DataChunk" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">


        <p>Data chunk for Ragora.</p>
<p>This class represents a chunk of data from a document.</p>








              <details class="quote">
                <summary>Source code in <code>ragora/ragora/core/chunking.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">DataChunk</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Data chunk for Ragora.</span>

<span class="sd">    This class represents a chunk of data from a document.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">text</span><span class="p">:</span> <span class="nb">str</span>  <span class="c1"># The text of the chunk</span>
    <span class="n">start_idx</span><span class="p">:</span> <span class="nb">int</span>  <span class="c1"># The start index of the chunk</span>
    <span class="n">end_idx</span><span class="p">:</span> <span class="nb">int</span>  <span class="c1"># The end index of the chunk</span>
    <span class="n">chunk_id</span><span class="p">:</span> <span class="nb">str</span>  <span class="c1"># The deterministic human-readable chunk ID</span>
    <span class="n">metadata</span><span class="p">:</span> <span class="n">ChunkMetadata</span>  <span class="c1"># The metadata of the chunk</span>
    <span class="n">source_document</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># Source document filename</span>
    <span class="n">chunk_type</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># Type of chunk (text, citation, equation, etc.)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="ragora.core.chunking.DataChunker" class="doc doc-heading">
            <code>DataChunker</code>


<a href="#ragora.core.chunking.DataChunker" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">


        <p>Data chunker for RAG system using strategy pattern.</p>
<p>This class delegates chunking to appropriate strategies based on context.</p>








              <details class="quote">
                <summary>Source code in <code>ragora/ragora/core/chunking.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">830</span>
<span class="normal">831</span>
<span class="normal">832</span>
<span class="normal">833</span>
<span class="normal">834</span>
<span class="normal">835</span>
<span class="normal">836</span>
<span class="normal">837</span>
<span class="normal">838</span>
<span class="normal">839</span>
<span class="normal">840</span>
<span class="normal">841</span>
<span class="normal">842</span>
<span class="normal">843</span>
<span class="normal">844</span>
<span class="normal">845</span>
<span class="normal">846</span>
<span class="normal">847</span>
<span class="normal">848</span>
<span class="normal">849</span>
<span class="normal">850</span>
<span class="normal">851</span>
<span class="normal">852</span>
<span class="normal">853</span>
<span class="normal">854</span>
<span class="normal">855</span>
<span class="normal">856</span>
<span class="normal">857</span>
<span class="normal">858</span>
<span class="normal">859</span>
<span class="normal">860</span>
<span class="normal">861</span>
<span class="normal">862</span>
<span class="normal">863</span>
<span class="normal">864</span>
<span class="normal">865</span>
<span class="normal">866</span>
<span class="normal">867</span>
<span class="normal">868</span>
<span class="normal">869</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">DataChunker</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Data chunker for RAG system using strategy pattern.</span>

<span class="sd">    This class delegates chunking to appropriate strategies based on context.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">default_strategy</span><span class="p">:</span> <span class="n">ChunkingStrategy</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the DataChunker with default strategies.</span>

<span class="sd">        Args:</span>
<span class="sd">            default_strategy: Default strategy to use when no specific strategy is registered</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">default_strategy</span> <span class="o">=</span> <span class="n">default_strategy</span> <span class="ow">or</span> <span class="n">TextChunkingStrategy</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">strategies</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">ChunkingStrategy</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="n">TextChunkingStrategy</span><span class="p">(),</span>
            <span class="s2">&quot;document&quot;</span><span class="p">:</span> <span class="n">DocumentChunkingStrategy</span><span class="p">(),</span>
            <span class="s2">&quot;email&quot;</span><span class="p">:</span> <span class="n">EmailChunkingStrategy</span><span class="p">(),</span>
        <span class="p">}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">chunk</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">ChunkingContext</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">DataChunk</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Chunk text using the appropriate strategy based on context.</span>

<span class="sd">        Args:</span>
<span class="sd">            text: Text to chunk</span>
<span class="sd">            context: ChunkingContext containing metadata and configuration</span>

<span class="sd">        Returns:</span>
<span class="sd">            List[DataChunk]: List of DataChunks</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">strategy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">strategies</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">context</span><span class="o">.</span><span class="n">chunk_type</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_strategy</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">strategy</span><span class="o">.</span><span class="n">chunk</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">register_strategy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">chunk_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">strategy</span><span class="p">:</span> <span class="n">ChunkingStrategy</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Register a new chunking strategy.</span>

<span class="sd">        Args:</span>
<span class="sd">            chunk_type: Type identifier for the strategy</span>
<span class="sd">            strategy: ChunkingStrategy implementation</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">strategies</span><span class="p">[</span><span class="n">chunk_type</span><span class="p">]</span> <span class="o">=</span> <span class="n">strategy</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h5 id="ragora.core.chunking.DataChunker.chunk" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">chunk</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span></code>

<a href="#ragora.core.chunking.DataChunker.chunk" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Chunk text using the appropriate strategy based on context.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>text</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Text to chunk</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>context</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="ChunkingContext


  
      dataclass
   (ragora.core.chunking.ChunkingContext)" href="#ragora.core.chunking.ChunkingContext">ChunkingContext</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>ChunkingContext containing metadata and configuration</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.List">List</span>[<a class="autorefs autorefs-internal" title="DataChunk


  
      dataclass
   (ragora.core.chunking.DataChunk)" href="#ragora.core.chunking.DataChunk">DataChunk</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List[DataChunk]: List of DataChunks</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/core/chunking.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">849</span>
<span class="normal">850</span>
<span class="normal">851</span>
<span class="normal">852</span>
<span class="normal">853</span>
<span class="normal">854</span>
<span class="normal">855</span>
<span class="normal">856</span>
<span class="normal">857</span>
<span class="normal">858</span>
<span class="normal">859</span>
<span class="normal">860</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">chunk</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">ChunkingContext</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">DataChunk</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Chunk text using the appropriate strategy based on context.</span>

<span class="sd">    Args:</span>
<span class="sd">        text: Text to chunk</span>
<span class="sd">        context: ChunkingContext containing metadata and configuration</span>

<span class="sd">    Returns:</span>
<span class="sd">        List[DataChunk]: List of DataChunks</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">strategy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">strategies</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">context</span><span class="o">.</span><span class="n">chunk_type</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_strategy</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">strategy</span><span class="o">.</span><span class="n">chunk</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="ragora.core.chunking.DataChunker.register_strategy" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">register_strategy</span><span class="p">(</span><span class="n">chunk_type</span><span class="p">,</span> <span class="n">strategy</span><span class="p">)</span></code>

<a href="#ragora.core.chunking.DataChunker.register_strategy" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Register a new chunking strategy.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>chunk_type</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Type identifier for the strategy</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>strategy</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="ChunkingStrategy (ragora.core.chunking.ChunkingStrategy)" href="#ragora.core.chunking.ChunkingStrategy">ChunkingStrategy</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>ChunkingStrategy implementation</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/core/chunking.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">862</span>
<span class="normal">863</span>
<span class="normal">864</span>
<span class="normal">865</span>
<span class="normal">866</span>
<span class="normal">867</span>
<span class="normal">868</span>
<span class="normal">869</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">register_strategy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">chunk_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">strategy</span><span class="p">:</span> <span class="n">ChunkingStrategy</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Register a new chunking strategy.</span>

<span class="sd">    Args:</span>
<span class="sd">        chunk_type: Type identifier for the strategy</span>
<span class="sd">        strategy: ChunkingStrategy implementation</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">strategies</span><span class="p">[</span><span class="n">chunk_type</span><span class="p">]</span> <span class="o">=</span> <span class="n">strategy</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="ragora.core.chunking.DocumentChunkingStrategy" class="doc doc-heading">
            <code>DocumentChunkingStrategy</code>


<a href="#ragora.core.chunking.DocumentChunkingStrategy" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="ChunkingStrategy (ragora.core.chunking.ChunkingStrategy)" href="#ragora.core.chunking.ChunkingStrategy">ChunkingStrategy</a></code></p>


        <p>Document-specific chunking strategy.</p>








              <details class="quote">
                <summary>Source code in <code>ragora/ragora/core/chunking.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span>
<span class="normal">760</span>
<span class="normal">761</span>
<span class="normal">762</span>
<span class="normal">763</span>
<span class="normal">764</span>
<span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span>
<span class="normal">768</span>
<span class="normal">769</span>
<span class="normal">770</span>
<span class="normal">771</span>
<span class="normal">772</span>
<span class="normal">773</span>
<span class="normal">774</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">DocumentChunkingStrategy</span><span class="p">(</span><span class="n">ChunkingStrategy</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Document-specific chunking strategy.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">chunk_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">768</span><span class="p">,</span> <span class="n">overlap_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">chunk_size</span><span class="p">,</span> <span class="n">overlap_size</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">chunk</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">ChunkingContext</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">DataChunk</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Chunk text using document-aware chunking.&quot;&quot;&quot;</span>
        <span class="c1"># For now, use the same logic as text chunking</span>
        <span class="c1"># Future: could implement section-aware chunking, citation preservation, etc.</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_chunk_text</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_chunk_text</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">ChunkingContext</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">DataChunk</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Core chunking logic (same as TextChunkingStrategy for now).&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">text</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">text</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
            <span class="k">return</span> <span class="p">[]</span>

        <span class="n">chunks</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">start_idx</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">chunk_idx</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># Start at 0, sequence_id is handled in ID generation</span>

        <span class="k">while</span> <span class="n">start_idx</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
            <span class="c1"># Calculate end index for this chunk</span>
            <span class="n">end_idx</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">start_idx</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">chunk_size</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">text</span><span class="p">))</span>

            <span class="c1"># Extract chunk text</span>
            <span class="n">chunk_text</span> <span class="o">=</span> <span class="n">text</span><span class="p">[</span><span class="n">start_idx</span><span class="p">:</span><span class="n">end_idx</span><span class="p">]</span>

            <span class="c1"># Create chunk with deterministic ID</span>
            <span class="n">chunk</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_chunk_with_id</span><span class="p">(</span>
                <span class="n">text</span><span class="o">=</span><span class="n">chunk_text</span><span class="p">,</span>
                <span class="n">start_idx</span><span class="o">=</span><span class="n">start_idx</span><span class="p">,</span>
                <span class="n">end_idx</span><span class="o">=</span><span class="n">end_idx</span><span class="p">,</span>
                <span class="n">chunk_idx</span><span class="o">=</span><span class="n">chunk_idx</span><span class="p">,</span>
                <span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="n">chunks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>
            <span class="n">chunk_idx</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="c1"># Move start index for next chunk with overlap</span>
            <span class="c1"># Ensure we make progress to avoid infinite loop</span>
            <span class="k">if</span> <span class="n">end_idx</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
                <span class="k">break</span>
            <span class="n">start_idx</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">start_idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">end_idx</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">overlap_size</span><span class="p">)</span>

        <span class="c1"># Update total_chunks in metadata</span>
        <span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="n">chunks</span><span class="p">:</span>
            <span class="n">chunk</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">total_chunks</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">chunks</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">chunks</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h5 id="ragora.core.chunking.DocumentChunkingStrategy._chunk_text" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">_chunk_text</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span></code>

<a href="#ragora.core.chunking.DocumentChunkingStrategy._chunk_text" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Core chunking logic (same as TextChunkingStrategy for now).</p>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/core/chunking.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span>
<span class="normal">760</span>
<span class="normal">761</span>
<span class="normal">762</span>
<span class="normal">763</span>
<span class="normal">764</span>
<span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span>
<span class="normal">768</span>
<span class="normal">769</span>
<span class="normal">770</span>
<span class="normal">771</span>
<span class="normal">772</span>
<span class="normal">773</span>
<span class="normal">774</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">_chunk_text</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">ChunkingContext</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">DataChunk</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Core chunking logic (same as TextChunkingStrategy for now).&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">text</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">text</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
        <span class="k">return</span> <span class="p">[]</span>

    <span class="n">chunks</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">start_idx</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">chunk_idx</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># Start at 0, sequence_id is handled in ID generation</span>

    <span class="k">while</span> <span class="n">start_idx</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
        <span class="c1"># Calculate end index for this chunk</span>
        <span class="n">end_idx</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">start_idx</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">chunk_size</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">text</span><span class="p">))</span>

        <span class="c1"># Extract chunk text</span>
        <span class="n">chunk_text</span> <span class="o">=</span> <span class="n">text</span><span class="p">[</span><span class="n">start_idx</span><span class="p">:</span><span class="n">end_idx</span><span class="p">]</span>

        <span class="c1"># Create chunk with deterministic ID</span>
        <span class="n">chunk</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_chunk_with_id</span><span class="p">(</span>
            <span class="n">text</span><span class="o">=</span><span class="n">chunk_text</span><span class="p">,</span>
            <span class="n">start_idx</span><span class="o">=</span><span class="n">start_idx</span><span class="p">,</span>
            <span class="n">end_idx</span><span class="o">=</span><span class="n">end_idx</span><span class="p">,</span>
            <span class="n">chunk_idx</span><span class="o">=</span><span class="n">chunk_idx</span><span class="p">,</span>
            <span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">chunks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>
        <span class="n">chunk_idx</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="c1"># Move start index for next chunk with overlap</span>
        <span class="c1"># Ensure we make progress to avoid infinite loop</span>
        <span class="k">if</span> <span class="n">end_idx</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
            <span class="k">break</span>
        <span class="n">start_idx</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">start_idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">end_idx</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">overlap_size</span><span class="p">)</span>

    <span class="c1"># Update total_chunks in metadata</span>
    <span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="n">chunks</span><span class="p">:</span>
        <span class="n">chunk</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">total_chunks</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">chunks</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">chunks</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="ragora.core.chunking.DocumentChunkingStrategy._create_chunk_with_id" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">_create_chunk_with_id</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">start_idx</span><span class="p">,</span> <span class="n">end_idx</span><span class="p">,</span> <span class="n">chunk_idx</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span></code>

<a href="#ragora.core.chunking.DocumentChunkingStrategy._create_chunk_with_id" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Create a DataChunk with deterministic ID generation.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>text</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The chunk text content</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>start_idx</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Start index in original text</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>end_idx</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>End index in original text</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>chunk_idx</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Index of this chunk in the sequence</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>context</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="ChunkingContext


  
      dataclass
   (ragora.core.chunking.ChunkingContext)" href="#ragora.core.chunking.ChunkingContext">ChunkingContext</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Chunking context with metadata</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="DataChunk


  
      dataclass
   (ragora.core.chunking.DataChunk)" href="#ragora.core.chunking.DataChunk">DataChunk</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>DataChunk with deterministic chunk_id</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/core/chunking.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">_create_chunk_with_id</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">start_idx</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">end_idx</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">chunk_idx</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">context</span><span class="p">:</span> <span class="n">ChunkingContext</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataChunk</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create a DataChunk with deterministic ID generation.</span>

<span class="sd">    Args:</span>
<span class="sd">        text: The chunk text content</span>
<span class="sd">        start_idx: Start index in original text</span>
<span class="sd">        end_idx: End index in original text</span>
<span class="sd">        chunk_idx: Index of this chunk in the sequence</span>
<span class="sd">        context: Chunking context with metadata</span>

<span class="sd">    Returns:</span>
<span class="sd">        DataChunk with deterministic chunk_id</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Generate deterministic chunk ID</span>
    <span class="n">chunk_id</span> <span class="o">=</span> <span class="n">ChunkIdGenerator</span><span class="o">.</span><span class="n">generate_chunk_id</span><span class="p">(</span>
        <span class="n">content_type</span><span class="o">=</span><span class="n">context</span><span class="o">.</span><span class="n">chunk_type</span><span class="p">,</span>
        <span class="n">source_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_source_id</span><span class="p">(</span><span class="n">context</span><span class="p">),</span>
        <span class="n">location_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_location_id</span><span class="p">(</span><span class="n">context</span><span class="p">),</span>
        <span class="n">sequence_id</span><span class="o">=</span><span class="n">context</span><span class="o">.</span><span class="n">start_sequence_idx</span><span class="p">,</span>
        <span class="n">chunk_idx</span><span class="o">=</span><span class="n">chunk_idx</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">DataChunk</span><span class="p">(</span>
        <span class="n">text</span><span class="o">=</span><span class="n">text</span><span class="p">,</span>
        <span class="n">start_idx</span><span class="o">=</span><span class="n">start_idx</span><span class="p">,</span>
        <span class="n">end_idx</span><span class="o">=</span><span class="n">end_idx</span><span class="p">,</span>
        <span class="n">chunk_id</span><span class="o">=</span><span class="n">chunk_id</span><span class="p">,</span>
        <span class="n">metadata</span><span class="o">=</span><span class="n">ChunkMetadata</span><span class="p">(</span>
            <span class="n">chunk_idx</span><span class="o">=</span><span class="n">chunk_idx</span><span class="p">,</span>
            <span class="n">chunk_size</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">text</span><span class="p">),</span>
            <span class="n">total_chunks</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>  <span class="c1"># Will be updated after all chunks</span>
            <span class="n">source_document</span><span class="o">=</span><span class="n">context</span><span class="o">.</span><span class="n">source_document</span><span class="p">,</span>
            <span class="n">page_number</span><span class="o">=</span><span class="n">context</span><span class="o">.</span><span class="n">page_number</span><span class="p">,</span>
            <span class="n">section_title</span><span class="o">=</span><span class="n">context</span><span class="o">.</span><span class="n">section_title</span><span class="p">,</span>
            <span class="n">chunk_type</span><span class="o">=</span><span class="n">context</span><span class="o">.</span><span class="n">chunk_type</span><span class="p">,</span>
            <span class="n">created_at</span><span class="o">=</span><span class="n">context</span><span class="o">.</span><span class="n">created_at</span><span class="p">,</span>
            <span class="n">email_subject</span><span class="o">=</span><span class="n">context</span><span class="o">.</span><span class="n">email_subject</span><span class="p">,</span>
            <span class="n">email_sender</span><span class="o">=</span><span class="n">context</span><span class="o">.</span><span class="n">email_sender</span><span class="p">,</span>
            <span class="n">email_recipient</span><span class="o">=</span><span class="n">context</span><span class="o">.</span><span class="n">email_recipient</span><span class="p">,</span>
            <span class="n">email_date</span><span class="o">=</span><span class="n">context</span><span class="o">.</span><span class="n">email_date</span><span class="p">,</span>
            <span class="n">email_id</span><span class="o">=</span><span class="n">context</span><span class="o">.</span><span class="n">email_id</span><span class="p">,</span>
            <span class="n">email_folder</span><span class="o">=</span><span class="n">context</span><span class="o">.</span><span class="n">email_folder</span><span class="p">,</span>
            <span class="n">custom_metadata</span><span class="o">=</span><span class="n">context</span><span class="o">.</span><span class="n">custom_metadata</span><span class="p">,</span>
        <span class="p">),</span>
        <span class="n">chunk_type</span><span class="o">=</span><span class="n">context</span><span class="o">.</span><span class="n">chunk_type</span><span class="p">,</span>
        <span class="n">source_document</span><span class="o">=</span><span class="n">context</span><span class="o">.</span><span class="n">source_document</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="ragora.core.chunking.DocumentChunkingStrategy._get_location_id" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">_get_location_id</span><span class="p">(</span><span class="n">context</span><span class="p">)</span></code>

<a href="#ragora.core.chunking.DocumentChunkingStrategy._get_location_id" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Get location ID for chunk ID generation.</p>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/core/chunking.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">_get_location_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">ChunkingContext</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get location ID for chunk ID generation.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">context</span><span class="o">.</span><span class="n">location_id</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">context</span><span class="o">.</span><span class="n">location_id</span>
    <span class="k">elif</span> <span class="n">context</span><span class="o">.</span><span class="n">chunk_type</span> <span class="o">==</span> <span class="s2">&quot;document&quot;</span> <span class="ow">and</span> <span class="n">context</span><span class="o">.</span><span class="n">page_number</span><span class="p">:</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;page_</span><span class="si">{</span><span class="n">context</span><span class="o">.</span><span class="n">page_number</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="k">elif</span> <span class="n">context</span><span class="o">.</span><span class="n">chunk_type</span> <span class="o">==</span> <span class="s2">&quot;email&quot;</span> <span class="ow">and</span> <span class="n">context</span><span class="o">.</span><span class="n">email_id</span><span class="p">:</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;msg_</span><span class="si">{</span><span class="n">context</span><span class="o">.</span><span class="n">email_id</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="k">elif</span> <span class="n">context</span><span class="o">.</span><span class="n">section_title</span><span class="p">:</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;sec_</span><span class="si">{</span><span class="n">context</span><span class="o">.</span><span class="n">section_title</span><span class="p">[:</span><span class="mi">10</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;0&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="ragora.core.chunking.DocumentChunkingStrategy._get_source_id" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">_get_source_id</span><span class="p">(</span><span class="n">context</span><span class="p">)</span></code>

<a href="#ragora.core.chunking.DocumentChunkingStrategy._get_source_id" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Get source ID for chunk ID generation.</p>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/core/chunking.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">_get_source_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">ChunkingContext</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get source ID for chunk ID generation.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">context</span><span class="o">.</span><span class="n">source_id</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">context</span><span class="o">.</span><span class="n">source_id</span>
    <span class="k">elif</span> <span class="n">context</span><span class="o">.</span><span class="n">source_document</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">context</span><span class="o">.</span><span class="n">source_document</span>
    <span class="k">elif</span> <span class="n">context</span><span class="o">.</span><span class="n">email_id</span><span class="p">:</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;email_</span><span class="si">{</span><span class="n">context</span><span class="o">.</span><span class="n">email_id</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;unknown&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="ragora.core.chunking.DocumentChunkingStrategy.chunk" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">chunk</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span></code>

<a href="#ragora.core.chunking.DocumentChunkingStrategy.chunk" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Chunk text using document-aware chunking.</p>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/core/chunking.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">chunk</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">ChunkingContext</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">DataChunk</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Chunk text using document-aware chunking.&quot;&quot;&quot;</span>
    <span class="c1"># For now, use the same logic as text chunking</span>
    <span class="c1"># Future: could implement section-aware chunking, citation preservation, etc.</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_chunk_text</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="ragora.core.chunking.EmailChunkingStrategy" class="doc doc-heading">
            <code>EmailChunkingStrategy</code>


<a href="#ragora.core.chunking.EmailChunkingStrategy" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="ChunkingStrategy (ragora.core.chunking.ChunkingStrategy)" href="#ragora.core.chunking.ChunkingStrategy">ChunkingStrategy</a></code></p>


        <p>Email-specific chunking strategy.</p>








              <details class="quote">
                <summary>Source code in <code>ragora/ragora/core/chunking.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">777</span>
<span class="normal">778</span>
<span class="normal">779</span>
<span class="normal">780</span>
<span class="normal">781</span>
<span class="normal">782</span>
<span class="normal">783</span>
<span class="normal">784</span>
<span class="normal">785</span>
<span class="normal">786</span>
<span class="normal">787</span>
<span class="normal">788</span>
<span class="normal">789</span>
<span class="normal">790</span>
<span class="normal">791</span>
<span class="normal">792</span>
<span class="normal">793</span>
<span class="normal">794</span>
<span class="normal">795</span>
<span class="normal">796</span>
<span class="normal">797</span>
<span class="normal">798</span>
<span class="normal">799</span>
<span class="normal">800</span>
<span class="normal">801</span>
<span class="normal">802</span>
<span class="normal">803</span>
<span class="normal">804</span>
<span class="normal">805</span>
<span class="normal">806</span>
<span class="normal">807</span>
<span class="normal">808</span>
<span class="normal">809</span>
<span class="normal">810</span>
<span class="normal">811</span>
<span class="normal">812</span>
<span class="normal">813</span>
<span class="normal">814</span>
<span class="normal">815</span>
<span class="normal">816</span>
<span class="normal">817</span>
<span class="normal">818</span>
<span class="normal">819</span>
<span class="normal">820</span>
<span class="normal">821</span>
<span class="normal">822</span>
<span class="normal">823</span>
<span class="normal">824</span>
<span class="normal">825</span>
<span class="normal">826</span>
<span class="normal">827</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">EmailChunkingStrategy</span><span class="p">(</span><span class="n">ChunkingStrategy</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Email-specific chunking strategy.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">chunk_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">512</span><span class="p">,</span> <span class="n">overlap_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">50</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">chunk_size</span><span class="p">,</span> <span class="n">overlap_size</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">chunk</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">ChunkingContext</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">DataChunk</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Chunk text using email-aware chunking.&quot;&quot;&quot;</span>
        <span class="c1"># For now, use the same logic as text chunking</span>
        <span class="c1"># Future: could implement thread-aware chunking, attachment handling, etc.</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_chunk_text</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_chunk_text</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">ChunkingContext</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">DataChunk</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Core chunking logic (same as TextChunkingStrategy for now).&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">text</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">text</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
            <span class="k">return</span> <span class="p">[]</span>

        <span class="n">chunks</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">start_idx</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">chunk_idx</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># Start at 0, sequence_id is handled in ID generation</span>

        <span class="k">while</span> <span class="n">start_idx</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
            <span class="c1"># Calculate end index for this chunk</span>
            <span class="n">end_idx</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">start_idx</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">chunk_size</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">text</span><span class="p">))</span>

            <span class="c1"># Extract chunk text</span>
            <span class="n">chunk_text</span> <span class="o">=</span> <span class="n">text</span><span class="p">[</span><span class="n">start_idx</span><span class="p">:</span><span class="n">end_idx</span><span class="p">]</span>

            <span class="c1"># Create chunk with deterministic ID</span>
            <span class="n">chunk</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_chunk_with_id</span><span class="p">(</span>
                <span class="n">text</span><span class="o">=</span><span class="n">chunk_text</span><span class="p">,</span>
                <span class="n">start_idx</span><span class="o">=</span><span class="n">start_idx</span><span class="p">,</span>
                <span class="n">end_idx</span><span class="o">=</span><span class="n">end_idx</span><span class="p">,</span>
                <span class="n">chunk_idx</span><span class="o">=</span><span class="n">chunk_idx</span><span class="p">,</span>
                <span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="n">chunks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>
            <span class="n">chunk_idx</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="c1"># Move start index for next chunk with overlap</span>
            <span class="c1"># Ensure we make progress to avoid infinite loop</span>
            <span class="k">if</span> <span class="n">end_idx</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
                <span class="k">break</span>
            <span class="n">start_idx</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">start_idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">end_idx</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">overlap_size</span><span class="p">)</span>

        <span class="c1"># Update total_chunks in metadata</span>
        <span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="n">chunks</span><span class="p">:</span>
            <span class="n">chunk</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">total_chunks</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">chunks</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">chunks</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h5 id="ragora.core.chunking.EmailChunkingStrategy._chunk_text" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">_chunk_text</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span></code>

<a href="#ragora.core.chunking.EmailChunkingStrategy._chunk_text" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Core chunking logic (same as TextChunkingStrategy for now).</p>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/core/chunking.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">789</span>
<span class="normal">790</span>
<span class="normal">791</span>
<span class="normal">792</span>
<span class="normal">793</span>
<span class="normal">794</span>
<span class="normal">795</span>
<span class="normal">796</span>
<span class="normal">797</span>
<span class="normal">798</span>
<span class="normal">799</span>
<span class="normal">800</span>
<span class="normal">801</span>
<span class="normal">802</span>
<span class="normal">803</span>
<span class="normal">804</span>
<span class="normal">805</span>
<span class="normal">806</span>
<span class="normal">807</span>
<span class="normal">808</span>
<span class="normal">809</span>
<span class="normal">810</span>
<span class="normal">811</span>
<span class="normal">812</span>
<span class="normal">813</span>
<span class="normal">814</span>
<span class="normal">815</span>
<span class="normal">816</span>
<span class="normal">817</span>
<span class="normal">818</span>
<span class="normal">819</span>
<span class="normal">820</span>
<span class="normal">821</span>
<span class="normal">822</span>
<span class="normal">823</span>
<span class="normal">824</span>
<span class="normal">825</span>
<span class="normal">826</span>
<span class="normal">827</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">_chunk_text</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">ChunkingContext</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">DataChunk</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Core chunking logic (same as TextChunkingStrategy for now).&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">text</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">text</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
        <span class="k">return</span> <span class="p">[]</span>

    <span class="n">chunks</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">start_idx</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">chunk_idx</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># Start at 0, sequence_id is handled in ID generation</span>

    <span class="k">while</span> <span class="n">start_idx</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
        <span class="c1"># Calculate end index for this chunk</span>
        <span class="n">end_idx</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">start_idx</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">chunk_size</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">text</span><span class="p">))</span>

        <span class="c1"># Extract chunk text</span>
        <span class="n">chunk_text</span> <span class="o">=</span> <span class="n">text</span><span class="p">[</span><span class="n">start_idx</span><span class="p">:</span><span class="n">end_idx</span><span class="p">]</span>

        <span class="c1"># Create chunk with deterministic ID</span>
        <span class="n">chunk</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_chunk_with_id</span><span class="p">(</span>
            <span class="n">text</span><span class="o">=</span><span class="n">chunk_text</span><span class="p">,</span>
            <span class="n">start_idx</span><span class="o">=</span><span class="n">start_idx</span><span class="p">,</span>
            <span class="n">end_idx</span><span class="o">=</span><span class="n">end_idx</span><span class="p">,</span>
            <span class="n">chunk_idx</span><span class="o">=</span><span class="n">chunk_idx</span><span class="p">,</span>
            <span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">chunks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>
        <span class="n">chunk_idx</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="c1"># Move start index for next chunk with overlap</span>
        <span class="c1"># Ensure we make progress to avoid infinite loop</span>
        <span class="k">if</span> <span class="n">end_idx</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
            <span class="k">break</span>
        <span class="n">start_idx</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">start_idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">end_idx</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">overlap_size</span><span class="p">)</span>

    <span class="c1"># Update total_chunks in metadata</span>
    <span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="n">chunks</span><span class="p">:</span>
        <span class="n">chunk</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">total_chunks</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">chunks</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">chunks</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="ragora.core.chunking.EmailChunkingStrategy._create_chunk_with_id" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">_create_chunk_with_id</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">start_idx</span><span class="p">,</span> <span class="n">end_idx</span><span class="p">,</span> <span class="n">chunk_idx</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span></code>

<a href="#ragora.core.chunking.EmailChunkingStrategy._create_chunk_with_id" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Create a DataChunk with deterministic ID generation.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>text</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The chunk text content</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>start_idx</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Start index in original text</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>end_idx</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>End index in original text</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>chunk_idx</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Index of this chunk in the sequence</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>context</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="ChunkingContext


  
      dataclass
   (ragora.core.chunking.ChunkingContext)" href="#ragora.core.chunking.ChunkingContext">ChunkingContext</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Chunking context with metadata</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="DataChunk


  
      dataclass
   (ragora.core.chunking.DataChunk)" href="#ragora.core.chunking.DataChunk">DataChunk</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>DataChunk with deterministic chunk_id</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/core/chunking.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">_create_chunk_with_id</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">start_idx</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">end_idx</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">chunk_idx</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">context</span><span class="p">:</span> <span class="n">ChunkingContext</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataChunk</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create a DataChunk with deterministic ID generation.</span>

<span class="sd">    Args:</span>
<span class="sd">        text: The chunk text content</span>
<span class="sd">        start_idx: Start index in original text</span>
<span class="sd">        end_idx: End index in original text</span>
<span class="sd">        chunk_idx: Index of this chunk in the sequence</span>
<span class="sd">        context: Chunking context with metadata</span>

<span class="sd">    Returns:</span>
<span class="sd">        DataChunk with deterministic chunk_id</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Generate deterministic chunk ID</span>
    <span class="n">chunk_id</span> <span class="o">=</span> <span class="n">ChunkIdGenerator</span><span class="o">.</span><span class="n">generate_chunk_id</span><span class="p">(</span>
        <span class="n">content_type</span><span class="o">=</span><span class="n">context</span><span class="o">.</span><span class="n">chunk_type</span><span class="p">,</span>
        <span class="n">source_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_source_id</span><span class="p">(</span><span class="n">context</span><span class="p">),</span>
        <span class="n">location_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_location_id</span><span class="p">(</span><span class="n">context</span><span class="p">),</span>
        <span class="n">sequence_id</span><span class="o">=</span><span class="n">context</span><span class="o">.</span><span class="n">start_sequence_idx</span><span class="p">,</span>
        <span class="n">chunk_idx</span><span class="o">=</span><span class="n">chunk_idx</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">DataChunk</span><span class="p">(</span>
        <span class="n">text</span><span class="o">=</span><span class="n">text</span><span class="p">,</span>
        <span class="n">start_idx</span><span class="o">=</span><span class="n">start_idx</span><span class="p">,</span>
        <span class="n">end_idx</span><span class="o">=</span><span class="n">end_idx</span><span class="p">,</span>
        <span class="n">chunk_id</span><span class="o">=</span><span class="n">chunk_id</span><span class="p">,</span>
        <span class="n">metadata</span><span class="o">=</span><span class="n">ChunkMetadata</span><span class="p">(</span>
            <span class="n">chunk_idx</span><span class="o">=</span><span class="n">chunk_idx</span><span class="p">,</span>
            <span class="n">chunk_size</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">text</span><span class="p">),</span>
            <span class="n">total_chunks</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>  <span class="c1"># Will be updated after all chunks</span>
            <span class="n">source_document</span><span class="o">=</span><span class="n">context</span><span class="o">.</span><span class="n">source_document</span><span class="p">,</span>
            <span class="n">page_number</span><span class="o">=</span><span class="n">context</span><span class="o">.</span><span class="n">page_number</span><span class="p">,</span>
            <span class="n">section_title</span><span class="o">=</span><span class="n">context</span><span class="o">.</span><span class="n">section_title</span><span class="p">,</span>
            <span class="n">chunk_type</span><span class="o">=</span><span class="n">context</span><span class="o">.</span><span class="n">chunk_type</span><span class="p">,</span>
            <span class="n">created_at</span><span class="o">=</span><span class="n">context</span><span class="o">.</span><span class="n">created_at</span><span class="p">,</span>
            <span class="n">email_subject</span><span class="o">=</span><span class="n">context</span><span class="o">.</span><span class="n">email_subject</span><span class="p">,</span>
            <span class="n">email_sender</span><span class="o">=</span><span class="n">context</span><span class="o">.</span><span class="n">email_sender</span><span class="p">,</span>
            <span class="n">email_recipient</span><span class="o">=</span><span class="n">context</span><span class="o">.</span><span class="n">email_recipient</span><span class="p">,</span>
            <span class="n">email_date</span><span class="o">=</span><span class="n">context</span><span class="o">.</span><span class="n">email_date</span><span class="p">,</span>
            <span class="n">email_id</span><span class="o">=</span><span class="n">context</span><span class="o">.</span><span class="n">email_id</span><span class="p">,</span>
            <span class="n">email_folder</span><span class="o">=</span><span class="n">context</span><span class="o">.</span><span class="n">email_folder</span><span class="p">,</span>
            <span class="n">custom_metadata</span><span class="o">=</span><span class="n">context</span><span class="o">.</span><span class="n">custom_metadata</span><span class="p">,</span>
        <span class="p">),</span>
        <span class="n">chunk_type</span><span class="o">=</span><span class="n">context</span><span class="o">.</span><span class="n">chunk_type</span><span class="p">,</span>
        <span class="n">source_document</span><span class="o">=</span><span class="n">context</span><span class="o">.</span><span class="n">source_document</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="ragora.core.chunking.EmailChunkingStrategy._get_location_id" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">_get_location_id</span><span class="p">(</span><span class="n">context</span><span class="p">)</span></code>

<a href="#ragora.core.chunking.EmailChunkingStrategy._get_location_id" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Get location ID for chunk ID generation.</p>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/core/chunking.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">_get_location_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">ChunkingContext</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get location ID for chunk ID generation.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">context</span><span class="o">.</span><span class="n">location_id</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">context</span><span class="o">.</span><span class="n">location_id</span>
    <span class="k">elif</span> <span class="n">context</span><span class="o">.</span><span class="n">chunk_type</span> <span class="o">==</span> <span class="s2">&quot;document&quot;</span> <span class="ow">and</span> <span class="n">context</span><span class="o">.</span><span class="n">page_number</span><span class="p">:</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;page_</span><span class="si">{</span><span class="n">context</span><span class="o">.</span><span class="n">page_number</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="k">elif</span> <span class="n">context</span><span class="o">.</span><span class="n">chunk_type</span> <span class="o">==</span> <span class="s2">&quot;email&quot;</span> <span class="ow">and</span> <span class="n">context</span><span class="o">.</span><span class="n">email_id</span><span class="p">:</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;msg_</span><span class="si">{</span><span class="n">context</span><span class="o">.</span><span class="n">email_id</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="k">elif</span> <span class="n">context</span><span class="o">.</span><span class="n">section_title</span><span class="p">:</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;sec_</span><span class="si">{</span><span class="n">context</span><span class="o">.</span><span class="n">section_title</span><span class="p">[:</span><span class="mi">10</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;0&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="ragora.core.chunking.EmailChunkingStrategy._get_source_id" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">_get_source_id</span><span class="p">(</span><span class="n">context</span><span class="p">)</span></code>

<a href="#ragora.core.chunking.EmailChunkingStrategy._get_source_id" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Get source ID for chunk ID generation.</p>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/core/chunking.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">_get_source_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">ChunkingContext</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get source ID for chunk ID generation.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">context</span><span class="o">.</span><span class="n">source_id</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">context</span><span class="o">.</span><span class="n">source_id</span>
    <span class="k">elif</span> <span class="n">context</span><span class="o">.</span><span class="n">source_document</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">context</span><span class="o">.</span><span class="n">source_document</span>
    <span class="k">elif</span> <span class="n">context</span><span class="o">.</span><span class="n">email_id</span><span class="p">:</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;email_</span><span class="si">{</span><span class="n">context</span><span class="o">.</span><span class="n">email_id</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;unknown&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="ragora.core.chunking.EmailChunkingStrategy.chunk" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">chunk</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span></code>

<a href="#ragora.core.chunking.EmailChunkingStrategy.chunk" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Chunk text using email-aware chunking.</p>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/core/chunking.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">783</span>
<span class="normal">784</span>
<span class="normal">785</span>
<span class="normal">786</span>
<span class="normal">787</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">chunk</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">ChunkingContext</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">DataChunk</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Chunk text using email-aware chunking.&quot;&quot;&quot;</span>
    <span class="c1"># For now, use the same logic as text chunking</span>
    <span class="c1"># Future: could implement thread-aware chunking, attachment handling, etc.</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_chunk_text</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="ragora.core.chunking.TextChunkingStrategy" class="doc doc-heading">
            <code>TextChunkingStrategy</code>


<a href="#ragora.core.chunking.TextChunkingStrategy" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="ChunkingStrategy (ragora.core.chunking.ChunkingStrategy)" href="#ragora.core.chunking.ChunkingStrategy">ChunkingStrategy</a></code></p>


        <p>Standard text chunking strategy.</p>








              <details class="quote">
                <summary>Source code in <code>ragora/ragora/core/chunking.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">TextChunkingStrategy</span><span class="p">(</span><span class="n">ChunkingStrategy</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Standard text chunking strategy.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">chunk_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">768</span><span class="p">,</span> <span class="n">overlap_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">chunk_size</span><span class="p">,</span> <span class="n">overlap_size</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">chunk</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">ChunkingContext</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">DataChunk</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Chunk text using standard character-based chunking.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_chunk_text</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_chunk_text</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">ChunkingContext</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">DataChunk</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Core chunking logic.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">text</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">text</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
            <span class="k">return</span> <span class="p">[]</span>

        <span class="n">chunks</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">start_idx</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">chunk_idx</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># Start at 0, sequence_id is handled in ID generation</span>

        <span class="k">while</span> <span class="n">start_idx</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
            <span class="c1"># Calculate end index for this chunk</span>
            <span class="n">end_idx</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">start_idx</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">chunk_size</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">text</span><span class="p">))</span>

            <span class="c1"># Extract chunk text</span>
            <span class="n">chunk_text</span> <span class="o">=</span> <span class="n">text</span><span class="p">[</span><span class="n">start_idx</span><span class="p">:</span><span class="n">end_idx</span><span class="p">]</span>

            <span class="c1"># Create chunk with deterministic ID</span>
            <span class="n">chunk</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_chunk_with_id</span><span class="p">(</span>
                <span class="n">text</span><span class="o">=</span><span class="n">chunk_text</span><span class="p">,</span>
                <span class="n">start_idx</span><span class="o">=</span><span class="n">start_idx</span><span class="p">,</span>
                <span class="n">end_idx</span><span class="o">=</span><span class="n">end_idx</span><span class="p">,</span>
                <span class="n">chunk_idx</span><span class="o">=</span><span class="n">chunk_idx</span><span class="p">,</span>
                <span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="n">chunks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>
            <span class="n">chunk_idx</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="c1"># Move start index for next chunk with overlap</span>
            <span class="c1"># Ensure we make progress to avoid infinite loop</span>
            <span class="k">if</span> <span class="n">end_idx</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
                <span class="k">break</span>
            <span class="n">start_idx</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">start_idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">end_idx</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">overlap_size</span><span class="p">)</span>

        <span class="c1"># Update total_chunks in metadata</span>
        <span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="n">chunks</span><span class="p">:</span>
            <span class="n">chunk</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">total_chunks</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">chunks</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">chunks</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h5 id="ragora.core.chunking.TextChunkingStrategy._chunk_text" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">_chunk_text</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span></code>

<a href="#ragora.core.chunking.TextChunkingStrategy._chunk_text" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Core chunking logic.</p>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/core/chunking.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">_chunk_text</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">ChunkingContext</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">DataChunk</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Core chunking logic.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">text</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">text</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
        <span class="k">return</span> <span class="p">[]</span>

    <span class="n">chunks</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">start_idx</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">chunk_idx</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># Start at 0, sequence_id is handled in ID generation</span>

    <span class="k">while</span> <span class="n">start_idx</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
        <span class="c1"># Calculate end index for this chunk</span>
        <span class="n">end_idx</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">start_idx</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">chunk_size</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">text</span><span class="p">))</span>

        <span class="c1"># Extract chunk text</span>
        <span class="n">chunk_text</span> <span class="o">=</span> <span class="n">text</span><span class="p">[</span><span class="n">start_idx</span><span class="p">:</span><span class="n">end_idx</span><span class="p">]</span>

        <span class="c1"># Create chunk with deterministic ID</span>
        <span class="n">chunk</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_chunk_with_id</span><span class="p">(</span>
            <span class="n">text</span><span class="o">=</span><span class="n">chunk_text</span><span class="p">,</span>
            <span class="n">start_idx</span><span class="o">=</span><span class="n">start_idx</span><span class="p">,</span>
            <span class="n">end_idx</span><span class="o">=</span><span class="n">end_idx</span><span class="p">,</span>
            <span class="n">chunk_idx</span><span class="o">=</span><span class="n">chunk_idx</span><span class="p">,</span>
            <span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">chunks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>
        <span class="n">chunk_idx</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="c1"># Move start index for next chunk with overlap</span>
        <span class="c1"># Ensure we make progress to avoid infinite loop</span>
        <span class="k">if</span> <span class="n">end_idx</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
            <span class="k">break</span>
        <span class="n">start_idx</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">start_idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">end_idx</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">overlap_size</span><span class="p">)</span>

    <span class="c1"># Update total_chunks in metadata</span>
    <span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="n">chunks</span><span class="p">:</span>
        <span class="n">chunk</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">total_chunks</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">chunks</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">chunks</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="ragora.core.chunking.TextChunkingStrategy._create_chunk_with_id" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">_create_chunk_with_id</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">start_idx</span><span class="p">,</span> <span class="n">end_idx</span><span class="p">,</span> <span class="n">chunk_idx</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span></code>

<a href="#ragora.core.chunking.TextChunkingStrategy._create_chunk_with_id" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Create a DataChunk with deterministic ID generation.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>text</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The chunk text content</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>start_idx</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Start index in original text</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>end_idx</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>End index in original text</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>chunk_idx</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Index of this chunk in the sequence</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>context</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="ChunkingContext


  
      dataclass
   (ragora.core.chunking.ChunkingContext)" href="#ragora.core.chunking.ChunkingContext">ChunkingContext</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Chunking context with metadata</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="DataChunk


  
      dataclass
   (ragora.core.chunking.DataChunk)" href="#ragora.core.chunking.DataChunk">DataChunk</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>DataChunk with deterministic chunk_id</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/core/chunking.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">_create_chunk_with_id</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">start_idx</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">end_idx</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">chunk_idx</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">context</span><span class="p">:</span> <span class="n">ChunkingContext</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataChunk</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create a DataChunk with deterministic ID generation.</span>

<span class="sd">    Args:</span>
<span class="sd">        text: The chunk text content</span>
<span class="sd">        start_idx: Start index in original text</span>
<span class="sd">        end_idx: End index in original text</span>
<span class="sd">        chunk_idx: Index of this chunk in the sequence</span>
<span class="sd">        context: Chunking context with metadata</span>

<span class="sd">    Returns:</span>
<span class="sd">        DataChunk with deterministic chunk_id</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Generate deterministic chunk ID</span>
    <span class="n">chunk_id</span> <span class="o">=</span> <span class="n">ChunkIdGenerator</span><span class="o">.</span><span class="n">generate_chunk_id</span><span class="p">(</span>
        <span class="n">content_type</span><span class="o">=</span><span class="n">context</span><span class="o">.</span><span class="n">chunk_type</span><span class="p">,</span>
        <span class="n">source_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_source_id</span><span class="p">(</span><span class="n">context</span><span class="p">),</span>
        <span class="n">location_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_location_id</span><span class="p">(</span><span class="n">context</span><span class="p">),</span>
        <span class="n">sequence_id</span><span class="o">=</span><span class="n">context</span><span class="o">.</span><span class="n">start_sequence_idx</span><span class="p">,</span>
        <span class="n">chunk_idx</span><span class="o">=</span><span class="n">chunk_idx</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">DataChunk</span><span class="p">(</span>
        <span class="n">text</span><span class="o">=</span><span class="n">text</span><span class="p">,</span>
        <span class="n">start_idx</span><span class="o">=</span><span class="n">start_idx</span><span class="p">,</span>
        <span class="n">end_idx</span><span class="o">=</span><span class="n">end_idx</span><span class="p">,</span>
        <span class="n">chunk_id</span><span class="o">=</span><span class="n">chunk_id</span><span class="p">,</span>
        <span class="n">metadata</span><span class="o">=</span><span class="n">ChunkMetadata</span><span class="p">(</span>
            <span class="n">chunk_idx</span><span class="o">=</span><span class="n">chunk_idx</span><span class="p">,</span>
            <span class="n">chunk_size</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">text</span><span class="p">),</span>
            <span class="n">total_chunks</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>  <span class="c1"># Will be updated after all chunks</span>
            <span class="n">source_document</span><span class="o">=</span><span class="n">context</span><span class="o">.</span><span class="n">source_document</span><span class="p">,</span>
            <span class="n">page_number</span><span class="o">=</span><span class="n">context</span><span class="o">.</span><span class="n">page_number</span><span class="p">,</span>
            <span class="n">section_title</span><span class="o">=</span><span class="n">context</span><span class="o">.</span><span class="n">section_title</span><span class="p">,</span>
            <span class="n">chunk_type</span><span class="o">=</span><span class="n">context</span><span class="o">.</span><span class="n">chunk_type</span><span class="p">,</span>
            <span class="n">created_at</span><span class="o">=</span><span class="n">context</span><span class="o">.</span><span class="n">created_at</span><span class="p">,</span>
            <span class="n">email_subject</span><span class="o">=</span><span class="n">context</span><span class="o">.</span><span class="n">email_subject</span><span class="p">,</span>
            <span class="n">email_sender</span><span class="o">=</span><span class="n">context</span><span class="o">.</span><span class="n">email_sender</span><span class="p">,</span>
            <span class="n">email_recipient</span><span class="o">=</span><span class="n">context</span><span class="o">.</span><span class="n">email_recipient</span><span class="p">,</span>
            <span class="n">email_date</span><span class="o">=</span><span class="n">context</span><span class="o">.</span><span class="n">email_date</span><span class="p">,</span>
            <span class="n">email_id</span><span class="o">=</span><span class="n">context</span><span class="o">.</span><span class="n">email_id</span><span class="p">,</span>
            <span class="n">email_folder</span><span class="o">=</span><span class="n">context</span><span class="o">.</span><span class="n">email_folder</span><span class="p">,</span>
            <span class="n">custom_metadata</span><span class="o">=</span><span class="n">context</span><span class="o">.</span><span class="n">custom_metadata</span><span class="p">,</span>
        <span class="p">),</span>
        <span class="n">chunk_type</span><span class="o">=</span><span class="n">context</span><span class="o">.</span><span class="n">chunk_type</span><span class="p">,</span>
        <span class="n">source_document</span><span class="o">=</span><span class="n">context</span><span class="o">.</span><span class="n">source_document</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="ragora.core.chunking.TextChunkingStrategy._get_location_id" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">_get_location_id</span><span class="p">(</span><span class="n">context</span><span class="p">)</span></code>

<a href="#ragora.core.chunking.TextChunkingStrategy._get_location_id" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Get location ID for chunk ID generation.</p>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/core/chunking.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">_get_location_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">ChunkingContext</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get location ID for chunk ID generation.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">context</span><span class="o">.</span><span class="n">location_id</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">context</span><span class="o">.</span><span class="n">location_id</span>
    <span class="k">elif</span> <span class="n">context</span><span class="o">.</span><span class="n">chunk_type</span> <span class="o">==</span> <span class="s2">&quot;document&quot;</span> <span class="ow">and</span> <span class="n">context</span><span class="o">.</span><span class="n">page_number</span><span class="p">:</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;page_</span><span class="si">{</span><span class="n">context</span><span class="o">.</span><span class="n">page_number</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="k">elif</span> <span class="n">context</span><span class="o">.</span><span class="n">chunk_type</span> <span class="o">==</span> <span class="s2">&quot;email&quot;</span> <span class="ow">and</span> <span class="n">context</span><span class="o">.</span><span class="n">email_id</span><span class="p">:</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;msg_</span><span class="si">{</span><span class="n">context</span><span class="o">.</span><span class="n">email_id</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="k">elif</span> <span class="n">context</span><span class="o">.</span><span class="n">section_title</span><span class="p">:</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;sec_</span><span class="si">{</span><span class="n">context</span><span class="o">.</span><span class="n">section_title</span><span class="p">[:</span><span class="mi">10</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;0&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="ragora.core.chunking.TextChunkingStrategy._get_source_id" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">_get_source_id</span><span class="p">(</span><span class="n">context</span><span class="p">)</span></code>

<a href="#ragora.core.chunking.TextChunkingStrategy._get_source_id" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Get source ID for chunk ID generation.</p>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/core/chunking.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">_get_source_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">ChunkingContext</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get source ID for chunk ID generation.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">context</span><span class="o">.</span><span class="n">source_id</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">context</span><span class="o">.</span><span class="n">source_id</span>
    <span class="k">elif</span> <span class="n">context</span><span class="o">.</span><span class="n">source_document</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">context</span><span class="o">.</span><span class="n">source_document</span>
    <span class="k">elif</span> <span class="n">context</span><span class="o">.</span><span class="n">email_id</span><span class="p">:</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;email_</span><span class="si">{</span><span class="n">context</span><span class="o">.</span><span class="n">email_id</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;unknown&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="ragora.core.chunking.TextChunkingStrategy.chunk" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">chunk</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span></code>

<a href="#ragora.core.chunking.TextChunkingStrategy.chunk" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Chunk text using standard character-based chunking.</p>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/core/chunking.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">chunk</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">ChunkingContext</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">DataChunk</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Chunk text using standard character-based chunking.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_chunk_text</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div><h3 id="document-preprocessor">Document Preprocessor<a class="headerlink" href="#document-preprocessor" title="Permanent link">&para;</a></h3>


<div class="doc doc-object doc-module">



<a id="ragora.core.document_preprocessor"></a>
    <div class="doc doc-contents first">

        <p>Utilities for parsing and chunking raw documents prior to ingestion.</p>
<p>The module centralizes the logic for turning LaTeX, Markdown, and text files into
<code>DataChunk</code> objects that the rest of the Ragora pipeline can embed and store.</p>










  <div class="doc doc-children">









<div class="doc doc-object doc-class">



<h4 id="ragora.core.document_preprocessor.DocumentPreprocessor" class="doc doc-heading">
            <code>DocumentPreprocessor</code>


<a href="#ragora.core.document_preprocessor.DocumentPreprocessor" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">


        <p>Parse supported file formats into chunkable intermediate data.</p>
<p>The preprocessor delegates parsing to format-specific helpers and then feeds
the resulting representation through a :class:<code>DataChunker</code>.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="ragora.core.document_preprocessor.DocumentPreprocessor.chunker">chunker</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Chunking strategy that controls chunk size and overlap.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">ragora.core.document_preprocessor</span><span class="w"> </span><span class="kn">import</span> <span class="n">DocumentPreprocessor</span>

<span class="n">preprocessor</span> <span class="o">=</span> <span class="n">DocumentPreprocessor</span><span class="p">()</span>
<span class="n">chunks</span> <span class="o">=</span> <span class="n">preprocessor</span><span class="o">.</span><span class="n">preprocess_document</span><span class="p">(</span><span class="s2">&quot;docs/intro.md&quot;</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;markdown&quot;</span><span class="p">)</span>
</code></pre></div>








              <details class="quote">
                <summary>Source code in <code>ragora/ragora/core/document_preprocessor.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">DocumentPreprocessor</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Parse supported file formats into chunkable intermediate data.</span>

<span class="sd">    The preprocessor delegates parsing to format-specific helpers and then feeds</span>
<span class="sd">    the resulting representation through a :class:`DataChunker`.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        chunker: Chunking strategy that controls chunk size and overlap.</span>

<span class="sd">    Examples:</span>
<span class="sd">        ```python</span>
<span class="sd">        from ragora.core.document_preprocessor import DocumentPreprocessor</span>

<span class="sd">        preprocessor = DocumentPreprocessor()</span>
<span class="sd">        chunks = preprocessor.preprocess_document(&quot;docs/intro.md&quot;, format=&quot;markdown&quot;)</span>
<span class="sd">        ```</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">chunker</span><span class="p">:</span> <span class="n">DataChunker</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the DocumentPreprocessor.</span>

<span class="sd">        Args:</span>
<span class="sd">            chunker: DataChunker instance (optional)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">chunker</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">chunker</span> <span class="o">=</span> <span class="n">chunker</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Create a default document strategy with specified parameters</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">chunker</span> <span class="o">=</span> <span class="n">DataChunker</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file_extension_map</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;latex&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;.tex&quot;</span><span class="p">,</span> <span class="s2">&quot;.latex&quot;</span><span class="p">,</span> <span class="s2">&quot;.bib&quot;</span><span class="p">],</span>
            <span class="s2">&quot;pdf&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;.pdf&quot;</span><span class="p">],</span>
            <span class="s2">&quot;docx&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;.docx&quot;</span><span class="p">],</span>
            <span class="s2">&quot;doc&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;.doc&quot;</span><span class="p">],</span>
            <span class="s2">&quot;markdown&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;.md&quot;</span><span class="p">,</span> <span class="s2">&quot;.markdown&quot;</span><span class="p">],</span>
            <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;.txt&quot;</span><span class="p">],</span>
            <span class="s2">&quot;txt&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;.txt&quot;</span><span class="p">],</span>
        <span class="p">}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">latex_parser</span> <span class="o">=</span> <span class="n">LatexParser</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">markdown_parser</span> <span class="o">=</span> <span class="n">MarkdownParser</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">preprocess_document</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">file_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">format</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;latex&quot;</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">DataChunk</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Preprocess a single document into :class:`DataChunk` objects.</span>

<span class="sd">        Args:</span>
<span class="sd">            file_path: Path to the document file.</span>
<span class="sd">            format: Document format (``&quot;latex&quot;``, ``&quot;markdown&quot;``, or ``&quot;text&quot;``).</span>

<span class="sd">        Returns:</span>
<span class="sd">            list[DataChunk]: Chunked content ready for embedding downstream.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If an unsupported format is requested.</span>

<span class="sd">        Examples:</span>
<span class="sd">            ```python</span>
<span class="sd">            chunks = preprocessor.preprocess_document(&quot;paper.tex&quot;, format=&quot;latex&quot;)</span>
<span class="sd">            ```</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">normalized_format</span> <span class="o">=</span> <span class="nb">format</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">normalized_format</span> <span class="o">==</span> <span class="s2">&quot;latex&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">file_path</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.bib&quot;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">latex_parser</span><span class="o">.</span><span class="n">parse_bibliography</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
                <span class="k">return</span> <span class="p">[]</span>
            <span class="n">document</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">latex_parser</span><span class="o">.</span><span class="n">parse_document</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_chunk_documents</span><span class="p">([</span><span class="n">document</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">normalized_format</span> <span class="ow">in</span> <span class="p">{</span><span class="s2">&quot;markdown&quot;</span><span class="p">,</span> <span class="s2">&quot;md&quot;</span><span class="p">,</span> <span class="s2">&quot;text&quot;</span><span class="p">,</span> <span class="s2">&quot;txt&quot;</span><span class="p">}:</span>
            <span class="n">document</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">markdown_parser</span><span class="o">.</span><span class="n">parse_document</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_chunk_markdown_documents</span><span class="p">([</span><span class="n">document</span><span class="p">])</span>

        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unsupported document format: </span><span class="si">{</span><span class="nb">format</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">preprocess_documents</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">file_paths</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="nb">format</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;latex&quot;</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">DataChunk</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Preprocess multiple documents at once.</span>

<span class="sd">        Args:</span>
<span class="sd">            file_paths: Collection of paths to document files.</span>
<span class="sd">            format: Document format (``&quot;latex&quot;``, ``&quot;markdown&quot;``, or ``&quot;text&quot;``).</span>

<span class="sd">        Returns:</span>
<span class="sd">            list[DataChunk]: Combined chunks from all input documents.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If an unsupported format is requested.</span>

<span class="sd">        Examples:</span>
<span class="sd">            ```python</span>
<span class="sd">            chunks = preprocessor.preprocess_documents(</span>
<span class="sd">                [&quot;chapter1.tex&quot;, &quot;chapter2.tex&quot;, &quot;references.bib&quot;],</span>
<span class="sd">                format=&quot;latex&quot;,</span>
<span class="sd">            )</span>
<span class="sd">            ```</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">normalized_format</span> <span class="o">=</span> <span class="nb">format</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">normalized_format</span> <span class="o">==</span> <span class="s2">&quot;latex&quot;</span><span class="p">:</span>
            <span class="c1"># Find the bibliography file</span>
            <span class="n">bibliography_path</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">for</span> <span class="n">file_path</span> <span class="ow">in</span> <span class="n">file_paths</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">file_path</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.bib&quot;</span><span class="p">):</span>
                    <span class="n">bibliography_path</span> <span class="o">=</span> <span class="n">file_path</span>
                    <span class="k">break</span>
            <span class="k">if</span> <span class="n">bibliography_path</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">latex_parser</span><span class="o">.</span><span class="n">parse_bibliography</span><span class="p">(</span><span class="n">bibliography_path</span><span class="p">)</span>
            <span class="n">documents</span> <span class="o">=</span> <span class="p">[</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">latex_parser</span><span class="o">.</span><span class="n">parse_document</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">file_path</span> <span class="ow">in</span> <span class="n">file_paths</span>
                <span class="k">if</span> <span class="n">file_path</span> <span class="o">!=</span> <span class="n">bibliography_path</span>
            <span class="p">]</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_chunk_documents</span><span class="p">(</span><span class="n">documents</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">normalized_format</span> <span class="ow">in</span> <span class="p">{</span><span class="s2">&quot;markdown&quot;</span><span class="p">,</span> <span class="s2">&quot;md&quot;</span><span class="p">,</span> <span class="s2">&quot;text&quot;</span><span class="p">,</span> <span class="s2">&quot;txt&quot;</span><span class="p">}:</span>
            <span class="n">documents</span> <span class="o">=</span> <span class="p">[</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">markdown_parser</span><span class="o">.</span><span class="n">parse_document</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">file_paths</span>
            <span class="p">]</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_chunk_markdown_documents</span><span class="p">(</span><span class="n">documents</span><span class="p">)</span>

        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unsupported document format: </span><span class="si">{</span><span class="nb">format</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">preprocess_document_folder</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">folder_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">format</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;latex&quot;</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">DataChunk</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Preprocess every supported file in a folder.</span>

<span class="sd">        Args:</span>
<span class="sd">            folder_path: Directory containing documents that should be ingested.</span>
<span class="sd">            format: Document format used to interpret files within the folder.</span>

<span class="sd">        Returns:</span>
<span class="sd">            list[DataChunk]: Aggregated chunk list for the entire folder.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If ``format`` is not in the supported extension map.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">normalized_format</span> <span class="o">=</span> <span class="nb">format</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">normalized_format</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_extension_map</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unsupported document format: </span><span class="si">{</span><span class="nb">format</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">file_paths</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">folder_path</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">folder_path</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">any</span><span class="p">(</span>
                <span class="n">file</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="n">ext</span><span class="p">)</span> <span class="k">for</span> <span class="n">ext</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_extension_map</span><span class="p">[</span><span class="n">normalized_format</span><span class="p">]</span>
            <span class="p">)</span>
        <span class="p">]</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">preprocess_documents</span><span class="p">(</span><span class="n">file_paths</span><span class="p">,</span> <span class="n">normalized_format</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_extract_document_text</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">documentList</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">LatexDocument</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Merge one or more parsed LaTeX documents into plain text.</span>

<span class="sd">        Args:</span>
<span class="sd">            documentList: Collection of parsed LaTeX documents to flatten.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: Combined Markdown-like text used for chunking.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">content_parts</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">document</span> <span class="ow">in</span> <span class="n">documentList</span><span class="p">:</span>
            <span class="c1"># Extract from chapters</span>
            <span class="k">if</span> <span class="n">document</span><span class="o">.</span><span class="n">chapters</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">chapter</span> <span class="ow">in</span> <span class="n">document</span><span class="o">.</span><span class="n">chapters</span><span class="p">:</span>
                    <span class="n">content_parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;# </span><span class="si">{</span><span class="n">chapter</span><span class="o">.</span><span class="n">title</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">chapter</span><span class="o">.</span><span class="n">paragraphs</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">para</span> <span class="ow">in</span> <span class="n">chapter</span><span class="o">.</span><span class="n">paragraphs</span><span class="p">:</span>
                            <span class="n">content_parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">para</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">chapter</span><span class="o">.</span><span class="n">sections</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">section</span> <span class="ow">in</span> <span class="n">chapter</span><span class="o">.</span><span class="n">sections</span><span class="p">:</span>
                            <span class="n">content_parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;## </span><span class="si">{</span><span class="n">section</span><span class="o">.</span><span class="n">title</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                            <span class="k">if</span> <span class="n">section</span><span class="o">.</span><span class="n">paragraphs</span><span class="p">:</span>
                                <span class="k">for</span> <span class="n">para</span> <span class="ow">in</span> <span class="n">section</span><span class="o">.</span><span class="n">paragraphs</span><span class="p">:</span>
                                    <span class="n">content_parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">para</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>

            <span class="c1"># Extract from standalone sections</span>
            <span class="k">if</span> <span class="n">document</span><span class="o">.</span><span class="n">sections</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">section</span> <span class="ow">in</span> <span class="n">document</span><span class="o">.</span><span class="n">sections</span><span class="p">:</span>
                    <span class="n">content_parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;## </span><span class="si">{</span><span class="n">section</span><span class="o">.</span><span class="n">title</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">section</span><span class="o">.</span><span class="n">paragraphs</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">para</span> <span class="ow">in</span> <span class="n">section</span><span class="o">.</span><span class="n">paragraphs</span><span class="p">:</span>
                            <span class="n">content_parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">para</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>

            <span class="c1"># Extract from standalone paragraphs</span>
            <span class="k">if</span> <span class="n">document</span><span class="o">.</span><span class="n">paragraphs</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">para</span> <span class="ow">in</span> <span class="n">document</span><span class="o">.</span><span class="n">paragraphs</span><span class="p">:</span>
                    <span class="n">content_parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">para</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>

            <span class="c1"># Extract from tables</span>
            <span class="k">if</span> <span class="n">document</span><span class="o">.</span><span class="n">tables</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">table</span> <span class="ow">in</span> <span class="n">document</span><span class="o">.</span><span class="n">tables</span><span class="p">:</span>
                    <span class="n">content_parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">to_plain_text</span><span class="p">())</span>

        <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">content_parts</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_chunk_documents</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">documentList</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">LatexDocument</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">DataChunk</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Chunk multiple LaTeX documents.</span>

<span class="sd">        Args:</span>
<span class="sd">            documentList: Parsed LaTeX documents.</span>

<span class="sd">        Returns:</span>
<span class="sd">            list[DataChunk]: Chunked output.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">chunks</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">documentList</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">chunks</span>
        <span class="k">for</span> <span class="n">document</span> <span class="ow">in</span> <span class="n">documentList</span><span class="p">:</span>
            <span class="n">chunks</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_chunk_document</span><span class="p">(</span><span class="n">document</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">chunks</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_chunk_markdown_documents</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">document_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">MarkdownDocument</span><span class="p">]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">DataChunk</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Chunk Markdown or plain text documents.</span>

<span class="sd">        Args:</span>
<span class="sd">            document_list: Parsed Markdown documents.</span>

<span class="sd">        Returns:</span>
<span class="sd">            list[DataChunk]: Chunked output.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">chunks</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">DataChunk</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">document_list</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">chunks</span>

        <span class="k">for</span> <span class="n">document</span> <span class="ow">in</span> <span class="n">document_list</span><span class="p">:</span>
            <span class="n">chunks</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_chunk_markdown_document</span><span class="p">(</span><span class="n">document</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">chunks</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_chunk_markdown_document</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">document</span><span class="p">:</span> <span class="n">MarkdownDocument</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">DataChunk</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Chunk a single Markdown document respecting the original hierarchy.</span>

<span class="sd">        Args:</span>
<span class="sd">            document: Parsed Markdown document.</span>

<span class="sd">        Returns:</span>
<span class="sd">            list[DataChunk]: Chunked output.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If ``document`` is ``None``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">document</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Document cannot be None&quot;</span><span class="p">)</span>

        <span class="n">chunk_id_counter</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">chunks</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">DataChunk</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">if</span> <span class="n">document</span><span class="o">.</span><span class="n">paragraphs</span><span class="p">:</span>
            <span class="n">paragraph_content</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="n">paragraph</span><span class="o">.</span><span class="n">content</span>
                <span class="k">for</span> <span class="n">paragraph</span> <span class="ow">in</span> <span class="n">document</span><span class="o">.</span><span class="n">paragraphs</span>
                <span class="k">if</span> <span class="n">paragraph</span><span class="o">.</span><span class="n">content</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">paragraph_content</span><span class="p">:</span>
                <span class="n">section_label</span> <span class="o">=</span> <span class="n">document</span><span class="o">.</span><span class="n">title</span> <span class="ow">or</span> <span class="n">document</span><span class="o">.</span><span class="n">source_document</span>
                <span class="n">context</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">ChunkingContextBuilder</span><span class="p">()</span>
                    <span class="o">.</span><span class="n">for_document</span><span class="p">()</span>
                    <span class="o">.</span><span class="n">with_source</span><span class="p">(</span><span class="n">document</span><span class="o">.</span><span class="n">source_document</span><span class="p">)</span>
                    <span class="o">.</span><span class="n">with_section</span><span class="p">(</span><span class="n">section_label</span><span class="p">)</span>
                    <span class="o">.</span><span class="n">with_start_sequence_idx</span><span class="p">(</span><span class="n">chunk_id_counter</span><span class="p">)</span>
                    <span class="o">.</span><span class="n">build</span><span class="p">()</span>
                <span class="p">)</span>
                <span class="n">doc_chunks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chunker</span><span class="o">.</span><span class="n">chunk</span><span class="p">(</span><span class="n">paragraph_content</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
                <span class="n">chunks</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">doc_chunks</span><span class="p">)</span>
                <span class="n">chunk_id_counter</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">doc_chunks</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">document</span><span class="o">.</span><span class="n">chapters</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">chapter</span> <span class="ow">in</span> <span class="n">document</span><span class="o">.</span><span class="n">chapters</span><span class="p">:</span>
                <span class="n">chapter_content_parts</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;# </span><span class="si">{</span><span class="n">chapter</span><span class="o">.</span><span class="n">title</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">if</span> <span class="n">chapter</span><span class="o">.</span><span class="n">title</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">]</span>
                <span class="n">chapter_content_parts</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
                    <span class="n">paragraph</span><span class="o">.</span><span class="n">content</span>
                    <span class="k">for</span> <span class="n">paragraph</span> <span class="ow">in</span> <span class="n">chapter</span><span class="o">.</span><span class="n">paragraphs</span>
                    <span class="k">if</span> <span class="n">paragraph</span><span class="o">.</span><span class="n">content</span>
                <span class="p">)</span>
                <span class="n">chapter_content</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                    <span class="n">part</span> <span class="k">for</span> <span class="n">part</span> <span class="ow">in</span> <span class="n">chapter_content_parts</span> <span class="k">if</span> <span class="n">part</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="n">chapter_content</span><span class="p">:</span>
                    <span class="n">section_label</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="n">chapter</span><span class="o">.</span><span class="n">title</span> <span class="ow">or</span> <span class="n">document</span><span class="o">.</span><span class="n">title</span> <span class="ow">or</span> <span class="n">document</span><span class="o">.</span><span class="n">source_document</span>
                    <span class="p">)</span>
                    <span class="n">context</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="n">ChunkingContextBuilder</span><span class="p">()</span>
                        <span class="o">.</span><span class="n">for_document</span><span class="p">()</span>
                        <span class="o">.</span><span class="n">with_source</span><span class="p">(</span><span class="n">document</span><span class="o">.</span><span class="n">source_document</span><span class="p">)</span>
                        <span class="o">.</span><span class="n">with_section</span><span class="p">(</span><span class="n">section_label</span><span class="p">)</span>
                        <span class="o">.</span><span class="n">with_start_sequence_idx</span><span class="p">(</span><span class="n">chunk_id_counter</span><span class="p">)</span>
                        <span class="o">.</span><span class="n">build</span><span class="p">()</span>
                    <span class="p">)</span>
                    <span class="n">doc_chunks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chunker</span><span class="o">.</span><span class="n">chunk</span><span class="p">(</span><span class="n">chapter_content</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
                    <span class="n">chunks</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">doc_chunks</span><span class="p">)</span>
                    <span class="n">chunk_id_counter</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">doc_chunks</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">chapter</span><span class="o">.</span><span class="n">sections</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">section</span> <span class="ow">in</span> <span class="n">chapter</span><span class="o">.</span><span class="n">sections</span><span class="p">:</span>
                        <span class="n">section_content_parts</span> <span class="o">=</span> <span class="p">[</span>
                            <span class="sa">f</span><span class="s2">&quot;## </span><span class="si">{</span><span class="n">section</span><span class="o">.</span><span class="n">title</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">if</span> <span class="n">section</span><span class="o">.</span><span class="n">title</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
                            <span class="o">*</span><span class="p">[</span>
                                <span class="n">paragraph</span><span class="o">.</span><span class="n">content</span>
                                <span class="k">for</span> <span class="n">paragraph</span> <span class="ow">in</span> <span class="n">section</span><span class="o">.</span><span class="n">paragraphs</span>
                                <span class="k">if</span> <span class="n">paragraph</span><span class="o">.</span><span class="n">content</span>
                            <span class="p">],</span>
                        <span class="p">]</span>
                        <span class="n">section_content</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                            <span class="n">part</span> <span class="k">for</span> <span class="n">part</span> <span class="ow">in</span> <span class="n">section_content_parts</span> <span class="k">if</span> <span class="n">part</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                        <span class="p">)</span>
                        <span class="k">if</span> <span class="n">section_content</span><span class="p">:</span>
                            <span class="n">section_label</span> <span class="o">=</span> <span class="p">(</span>
                                <span class="n">section</span><span class="o">.</span><span class="n">title</span>
                                <span class="ow">or</span> <span class="n">chapter</span><span class="o">.</span><span class="n">title</span>
                                <span class="ow">or</span> <span class="n">document</span><span class="o">.</span><span class="n">title</span>
                                <span class="ow">or</span> <span class="n">document</span><span class="o">.</span><span class="n">source_document</span>
                            <span class="p">)</span>
                            <span class="n">context</span> <span class="o">=</span> <span class="p">(</span>
                                <span class="n">ChunkingContextBuilder</span><span class="p">()</span>
                                <span class="o">.</span><span class="n">for_document</span><span class="p">()</span>
                                <span class="o">.</span><span class="n">with_source</span><span class="p">(</span><span class="n">document</span><span class="o">.</span><span class="n">source_document</span><span class="p">)</span>
                                <span class="o">.</span><span class="n">with_section</span><span class="p">(</span><span class="n">section_label</span><span class="p">)</span>
                                <span class="o">.</span><span class="n">with_start_sequence_idx</span><span class="p">(</span><span class="n">chunk_id_counter</span><span class="p">)</span>
                                <span class="o">.</span><span class="n">build</span><span class="p">()</span>
                            <span class="p">)</span>
                            <span class="n">doc_chunks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chunker</span><span class="o">.</span><span class="n">chunk</span><span class="p">(</span><span class="n">section_content</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
                            <span class="n">chunks</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">doc_chunks</span><span class="p">)</span>
                            <span class="n">chunk_id_counter</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">doc_chunks</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">document</span><span class="o">.</span><span class="n">sections</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">section</span> <span class="ow">in</span> <span class="n">document</span><span class="o">.</span><span class="n">sections</span><span class="p">:</span>
                <span class="n">section_content_parts</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="sa">f</span><span class="s2">&quot;## </span><span class="si">{</span><span class="n">section</span><span class="o">.</span><span class="n">title</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">if</span> <span class="n">section</span><span class="o">.</span><span class="n">title</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
                    <span class="o">*</span><span class="p">[</span>
                        <span class="n">paragraph</span><span class="o">.</span><span class="n">content</span>
                        <span class="k">for</span> <span class="n">paragraph</span> <span class="ow">in</span> <span class="n">section</span><span class="o">.</span><span class="n">paragraphs</span>
                        <span class="k">if</span> <span class="n">paragraph</span><span class="o">.</span><span class="n">content</span>
                    <span class="p">],</span>
                <span class="p">]</span>
                <span class="n">section_content</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                    <span class="n">part</span> <span class="k">for</span> <span class="n">part</span> <span class="ow">in</span> <span class="n">section_content_parts</span> <span class="k">if</span> <span class="n">part</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="n">section_content</span><span class="p">:</span>
                    <span class="n">section_label</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="n">section</span><span class="o">.</span><span class="n">title</span> <span class="ow">or</span> <span class="n">document</span><span class="o">.</span><span class="n">title</span> <span class="ow">or</span> <span class="n">document</span><span class="o">.</span><span class="n">source_document</span>
                    <span class="p">)</span>
                    <span class="n">context</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="n">ChunkingContextBuilder</span><span class="p">()</span>
                        <span class="o">.</span><span class="n">for_document</span><span class="p">()</span>
                        <span class="o">.</span><span class="n">with_source</span><span class="p">(</span><span class="n">document</span><span class="o">.</span><span class="n">source_document</span><span class="p">)</span>
                        <span class="o">.</span><span class="n">with_section</span><span class="p">(</span><span class="n">section_label</span><span class="p">)</span>
                        <span class="o">.</span><span class="n">with_start_sequence_idx</span><span class="p">(</span><span class="n">chunk_id_counter</span><span class="p">)</span>
                        <span class="o">.</span><span class="n">build</span><span class="p">()</span>
                    <span class="p">)</span>
                    <span class="n">doc_chunks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chunker</span><span class="o">.</span><span class="n">chunk</span><span class="p">(</span><span class="n">section_content</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
                    <span class="n">chunks</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">doc_chunks</span><span class="p">)</span>
                    <span class="n">chunk_id_counter</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">doc_chunks</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">chunks</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_chunk_document</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">document</span><span class="p">:</span> <span class="n">LatexDocument</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">DataChunk</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Chunk the document into a list of DataChunks.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">document</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Document cannot be None&quot;</span><span class="p">)</span>
        <span class="n">chunks</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">chunk_id_counter</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">if</span> <span class="n">document</span><span class="o">.</span><span class="n">paragraphs</span><span class="p">:</span>
            <span class="n">paragraph_content</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="k">for</span> <span class="n">paragraph</span> <span class="ow">in</span> <span class="n">document</span><span class="o">.</span><span class="n">paragraphs</span><span class="p">:</span>
                <span class="n">paragraph_content</span> <span class="o">+=</span> <span class="n">paragraph</span><span class="o">.</span><span class="n">content</span>
            <span class="n">context</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">ChunkingContextBuilder</span><span class="p">()</span>
                <span class="o">.</span><span class="n">for_document</span><span class="p">()</span>
                <span class="o">.</span><span class="n">with_source</span><span class="p">(</span><span class="n">document</span><span class="o">.</span><span class="n">source_document</span><span class="p">)</span>
                <span class="o">.</span><span class="n">with_section</span><span class="p">(</span><span class="n">document</span><span class="o">.</span><span class="n">title</span><span class="p">)</span>
                <span class="o">.</span><span class="n">with_start_sequence_idx</span><span class="p">(</span><span class="n">chunk_id_counter</span><span class="p">)</span>
                <span class="o">.</span><span class="n">build</span><span class="p">()</span>
            <span class="p">)</span>
            <span class="n">doc_chunks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chunker</span><span class="o">.</span><span class="n">chunk</span><span class="p">(</span><span class="n">paragraph_content</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
            <span class="n">chunks</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">doc_chunks</span><span class="p">)</span>
            <span class="n">chunk_id_counter</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">doc_chunks</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">document</span><span class="o">.</span><span class="n">chapters</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">chapter</span> <span class="ow">in</span> <span class="n">document</span><span class="o">.</span><span class="n">chapters</span><span class="p">:</span>
                <span class="n">chapter_content</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;# </span><span class="si">{</span><span class="n">chapter</span><span class="o">.</span><span class="n">title</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="k">if</span> <span class="n">chapter</span><span class="o">.</span><span class="n">paragraphs</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">paragraph</span> <span class="ow">in</span> <span class="n">chapter</span><span class="o">.</span><span class="n">paragraphs</span><span class="p">:</span>
                        <span class="n">chapter_content</span> <span class="o">+=</span> <span class="n">paragraph</span><span class="o">.</span><span class="n">content</span>
                    <span class="n">context</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="n">ChunkingContextBuilder</span><span class="p">()</span>
                        <span class="o">.</span><span class="n">for_document</span><span class="p">()</span>
                        <span class="o">.</span><span class="n">with_source</span><span class="p">(</span><span class="n">document</span><span class="o">.</span><span class="n">source_document</span><span class="p">)</span>
                        <span class="o">.</span><span class="n">with_section</span><span class="p">(</span><span class="n">chapter</span><span class="o">.</span><span class="n">title</span><span class="p">)</span>
                        <span class="o">.</span><span class="n">with_start_sequence_idx</span><span class="p">(</span><span class="n">chunk_id_counter</span><span class="p">)</span>
                        <span class="o">.</span><span class="n">build</span><span class="p">()</span>
                    <span class="p">)</span>
                    <span class="n">doc_chunks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chunker</span><span class="o">.</span><span class="n">chunk</span><span class="p">(</span><span class="n">chapter_content</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
                    <span class="n">chunks</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">doc_chunks</span><span class="p">)</span>
                    <span class="n">chunk_id_counter</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">doc_chunks</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">chapter</span><span class="o">.</span><span class="n">sections</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">section</span> <span class="ow">in</span> <span class="n">chapter</span><span class="o">.</span><span class="n">sections</span><span class="p">:</span>
                        <span class="n">section_content</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;## </span><span class="si">{</span><span class="n">section</span><span class="o">.</span><span class="n">title</span><span class="si">}</span><span class="s2">&quot;</span>
                        <span class="k">if</span> <span class="n">section</span><span class="o">.</span><span class="n">paragraphs</span><span class="p">:</span>
                            <span class="k">for</span> <span class="n">paragraph</span> <span class="ow">in</span> <span class="n">section</span><span class="o">.</span><span class="n">paragraphs</span><span class="p">:</span>
                                <span class="n">section_content</span> <span class="o">+=</span> <span class="n">paragraph</span><span class="o">.</span><span class="n">content</span>
                            <span class="n">context</span> <span class="o">=</span> <span class="p">(</span>
                                <span class="n">ChunkingContextBuilder</span><span class="p">()</span>
                                <span class="o">.</span><span class="n">for_document</span><span class="p">()</span>
                                <span class="o">.</span><span class="n">with_source</span><span class="p">(</span><span class="n">document</span><span class="o">.</span><span class="n">source_document</span><span class="p">)</span>
                                <span class="o">.</span><span class="n">with_section</span><span class="p">(</span><span class="n">section</span><span class="o">.</span><span class="n">title</span><span class="p">)</span>
                                <span class="o">.</span><span class="n">with_start_sequence_idx</span><span class="p">(</span><span class="n">chunk_id_counter</span><span class="p">)</span>
                                <span class="o">.</span><span class="n">build</span><span class="p">()</span>
                            <span class="p">)</span>
                            <span class="n">doc_chunks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chunker</span><span class="o">.</span><span class="n">chunk</span><span class="p">(</span><span class="n">section_content</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
                            <span class="n">chunks</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">doc_chunks</span><span class="p">)</span>
                            <span class="n">chunk_id_counter</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">doc_chunks</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">document</span><span class="o">.</span><span class="n">sections</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">section</span> <span class="ow">in</span> <span class="n">document</span><span class="o">.</span><span class="n">sections</span><span class="p">:</span>
                <span class="n">section_content</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;## </span><span class="si">{</span><span class="n">section</span><span class="o">.</span><span class="n">title</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="k">if</span> <span class="n">section</span><span class="o">.</span><span class="n">paragraphs</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">paragraph</span> <span class="ow">in</span> <span class="n">section</span><span class="o">.</span><span class="n">paragraphs</span><span class="p">:</span>
                        <span class="n">section_content</span> <span class="o">+=</span> <span class="n">paragraph</span><span class="o">.</span><span class="n">content</span>
                    <span class="n">context</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="n">ChunkingContextBuilder</span><span class="p">()</span>
                        <span class="o">.</span><span class="n">for_document</span><span class="p">()</span>
                        <span class="o">.</span><span class="n">with_source</span><span class="p">(</span><span class="n">document</span><span class="o">.</span><span class="n">source_document</span><span class="p">)</span>
                        <span class="o">.</span><span class="n">with_section</span><span class="p">(</span><span class="n">section</span><span class="o">.</span><span class="n">title</span><span class="p">)</span>
                        <span class="o">.</span><span class="n">with_start_sequence_idx</span><span class="p">(</span><span class="n">chunk_id_counter</span><span class="p">)</span>
                        <span class="o">.</span><span class="n">build</span><span class="p">()</span>
                    <span class="p">)</span>
                    <span class="n">doc_chunks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chunker</span><span class="o">.</span><span class="n">chunk</span><span class="p">(</span><span class="n">section_content</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
                    <span class="n">chunks</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">doc_chunks</span><span class="p">)</span>
                    <span class="n">chunk_id_counter</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">doc_chunks</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">document</span><span class="o">.</span><span class="n">tables</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">table</span> <span class="ow">in</span> <span class="n">document</span><span class="o">.</span><span class="n">tables</span><span class="p">:</span>
                <span class="n">table_content</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">to_plain_text</span><span class="p">()</span>
                <span class="n">context</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">ChunkingContextBuilder</span><span class="p">()</span>
                    <span class="o">.</span><span class="n">for_document</span><span class="p">()</span>
                    <span class="o">.</span><span class="n">with_source</span><span class="p">(</span><span class="n">document</span><span class="o">.</span><span class="n">source_document</span><span class="p">)</span>
                    <span class="o">.</span><span class="n">with_section</span><span class="p">(</span><span class="n">document</span><span class="o">.</span><span class="n">title</span><span class="p">)</span>
                    <span class="o">.</span><span class="n">with_start_sequence_idx</span><span class="p">(</span><span class="n">chunk_id_counter</span><span class="p">)</span>
                    <span class="o">.</span><span class="n">build</span><span class="p">()</span>
                <span class="p">)</span>
                <span class="n">doc_chunks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chunker</span><span class="o">.</span><span class="n">chunk</span><span class="p">(</span><span class="n">table_content</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
                <span class="n">chunks</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">doc_chunks</span><span class="p">)</span>
                <span class="n">chunk_id_counter</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">doc_chunks</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">chunks</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h5 id="ragora.core.document_preprocessor.DocumentPreprocessor._chunk_document" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">_chunk_document</span><span class="p">(</span><span class="n">document</span><span class="p">)</span></code>

<a href="#ragora.core.document_preprocessor.DocumentPreprocessor._chunk_document" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Chunk the document into a list of DataChunks.</p>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/core/document_preprocessor.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">_chunk_document</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">document</span><span class="p">:</span> <span class="n">LatexDocument</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">DataChunk</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Chunk the document into a list of DataChunks.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">document</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Document cannot be None&quot;</span><span class="p">)</span>
    <span class="n">chunks</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">chunk_id_counter</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">if</span> <span class="n">document</span><span class="o">.</span><span class="n">paragraphs</span><span class="p">:</span>
        <span class="n">paragraph_content</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">for</span> <span class="n">paragraph</span> <span class="ow">in</span> <span class="n">document</span><span class="o">.</span><span class="n">paragraphs</span><span class="p">:</span>
            <span class="n">paragraph_content</span> <span class="o">+=</span> <span class="n">paragraph</span><span class="o">.</span><span class="n">content</span>
        <span class="n">context</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">ChunkingContextBuilder</span><span class="p">()</span>
            <span class="o">.</span><span class="n">for_document</span><span class="p">()</span>
            <span class="o">.</span><span class="n">with_source</span><span class="p">(</span><span class="n">document</span><span class="o">.</span><span class="n">source_document</span><span class="p">)</span>
            <span class="o">.</span><span class="n">with_section</span><span class="p">(</span><span class="n">document</span><span class="o">.</span><span class="n">title</span><span class="p">)</span>
            <span class="o">.</span><span class="n">with_start_sequence_idx</span><span class="p">(</span><span class="n">chunk_id_counter</span><span class="p">)</span>
            <span class="o">.</span><span class="n">build</span><span class="p">()</span>
        <span class="p">)</span>
        <span class="n">doc_chunks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chunker</span><span class="o">.</span><span class="n">chunk</span><span class="p">(</span><span class="n">paragraph_content</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
        <span class="n">chunks</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">doc_chunks</span><span class="p">)</span>
        <span class="n">chunk_id_counter</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">doc_chunks</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">document</span><span class="o">.</span><span class="n">chapters</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">chapter</span> <span class="ow">in</span> <span class="n">document</span><span class="o">.</span><span class="n">chapters</span><span class="p">:</span>
            <span class="n">chapter_content</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;# </span><span class="si">{</span><span class="n">chapter</span><span class="o">.</span><span class="n">title</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">if</span> <span class="n">chapter</span><span class="o">.</span><span class="n">paragraphs</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">paragraph</span> <span class="ow">in</span> <span class="n">chapter</span><span class="o">.</span><span class="n">paragraphs</span><span class="p">:</span>
                    <span class="n">chapter_content</span> <span class="o">+=</span> <span class="n">paragraph</span><span class="o">.</span><span class="n">content</span>
                <span class="n">context</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">ChunkingContextBuilder</span><span class="p">()</span>
                    <span class="o">.</span><span class="n">for_document</span><span class="p">()</span>
                    <span class="o">.</span><span class="n">with_source</span><span class="p">(</span><span class="n">document</span><span class="o">.</span><span class="n">source_document</span><span class="p">)</span>
                    <span class="o">.</span><span class="n">with_section</span><span class="p">(</span><span class="n">chapter</span><span class="o">.</span><span class="n">title</span><span class="p">)</span>
                    <span class="o">.</span><span class="n">with_start_sequence_idx</span><span class="p">(</span><span class="n">chunk_id_counter</span><span class="p">)</span>
                    <span class="o">.</span><span class="n">build</span><span class="p">()</span>
                <span class="p">)</span>
                <span class="n">doc_chunks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chunker</span><span class="o">.</span><span class="n">chunk</span><span class="p">(</span><span class="n">chapter_content</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
                <span class="n">chunks</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">doc_chunks</span><span class="p">)</span>
                <span class="n">chunk_id_counter</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">doc_chunks</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">chapter</span><span class="o">.</span><span class="n">sections</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">section</span> <span class="ow">in</span> <span class="n">chapter</span><span class="o">.</span><span class="n">sections</span><span class="p">:</span>
                    <span class="n">section_content</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;## </span><span class="si">{</span><span class="n">section</span><span class="o">.</span><span class="n">title</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="k">if</span> <span class="n">section</span><span class="o">.</span><span class="n">paragraphs</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">paragraph</span> <span class="ow">in</span> <span class="n">section</span><span class="o">.</span><span class="n">paragraphs</span><span class="p">:</span>
                            <span class="n">section_content</span> <span class="o">+=</span> <span class="n">paragraph</span><span class="o">.</span><span class="n">content</span>
                        <span class="n">context</span> <span class="o">=</span> <span class="p">(</span>
                            <span class="n">ChunkingContextBuilder</span><span class="p">()</span>
                            <span class="o">.</span><span class="n">for_document</span><span class="p">()</span>
                            <span class="o">.</span><span class="n">with_source</span><span class="p">(</span><span class="n">document</span><span class="o">.</span><span class="n">source_document</span><span class="p">)</span>
                            <span class="o">.</span><span class="n">with_section</span><span class="p">(</span><span class="n">section</span><span class="o">.</span><span class="n">title</span><span class="p">)</span>
                            <span class="o">.</span><span class="n">with_start_sequence_idx</span><span class="p">(</span><span class="n">chunk_id_counter</span><span class="p">)</span>
                            <span class="o">.</span><span class="n">build</span><span class="p">()</span>
                        <span class="p">)</span>
                        <span class="n">doc_chunks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chunker</span><span class="o">.</span><span class="n">chunk</span><span class="p">(</span><span class="n">section_content</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
                        <span class="n">chunks</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">doc_chunks</span><span class="p">)</span>
                        <span class="n">chunk_id_counter</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">doc_chunks</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">document</span><span class="o">.</span><span class="n">sections</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">section</span> <span class="ow">in</span> <span class="n">document</span><span class="o">.</span><span class="n">sections</span><span class="p">:</span>
            <span class="n">section_content</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;## </span><span class="si">{</span><span class="n">section</span><span class="o">.</span><span class="n">title</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">if</span> <span class="n">section</span><span class="o">.</span><span class="n">paragraphs</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">paragraph</span> <span class="ow">in</span> <span class="n">section</span><span class="o">.</span><span class="n">paragraphs</span><span class="p">:</span>
                    <span class="n">section_content</span> <span class="o">+=</span> <span class="n">paragraph</span><span class="o">.</span><span class="n">content</span>
                <span class="n">context</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">ChunkingContextBuilder</span><span class="p">()</span>
                    <span class="o">.</span><span class="n">for_document</span><span class="p">()</span>
                    <span class="o">.</span><span class="n">with_source</span><span class="p">(</span><span class="n">document</span><span class="o">.</span><span class="n">source_document</span><span class="p">)</span>
                    <span class="o">.</span><span class="n">with_section</span><span class="p">(</span><span class="n">section</span><span class="o">.</span><span class="n">title</span><span class="p">)</span>
                    <span class="o">.</span><span class="n">with_start_sequence_idx</span><span class="p">(</span><span class="n">chunk_id_counter</span><span class="p">)</span>
                    <span class="o">.</span><span class="n">build</span><span class="p">()</span>
                <span class="p">)</span>
                <span class="n">doc_chunks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chunker</span><span class="o">.</span><span class="n">chunk</span><span class="p">(</span><span class="n">section_content</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
                <span class="n">chunks</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">doc_chunks</span><span class="p">)</span>
                <span class="n">chunk_id_counter</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">doc_chunks</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">document</span><span class="o">.</span><span class="n">tables</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">table</span> <span class="ow">in</span> <span class="n">document</span><span class="o">.</span><span class="n">tables</span><span class="p">:</span>
            <span class="n">table_content</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">to_plain_text</span><span class="p">()</span>
            <span class="n">context</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">ChunkingContextBuilder</span><span class="p">()</span>
                <span class="o">.</span><span class="n">for_document</span><span class="p">()</span>
                <span class="o">.</span><span class="n">with_source</span><span class="p">(</span><span class="n">document</span><span class="o">.</span><span class="n">source_document</span><span class="p">)</span>
                <span class="o">.</span><span class="n">with_section</span><span class="p">(</span><span class="n">document</span><span class="o">.</span><span class="n">title</span><span class="p">)</span>
                <span class="o">.</span><span class="n">with_start_sequence_idx</span><span class="p">(</span><span class="n">chunk_id_counter</span><span class="p">)</span>
                <span class="o">.</span><span class="n">build</span><span class="p">()</span>
            <span class="p">)</span>
            <span class="n">doc_chunks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chunker</span><span class="o">.</span><span class="n">chunk</span><span class="p">(</span><span class="n">table_content</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
            <span class="n">chunks</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">doc_chunks</span><span class="p">)</span>
            <span class="n">chunk_id_counter</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">doc_chunks</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">chunks</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="ragora.core.document_preprocessor.DocumentPreprocessor._chunk_documents" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">_chunk_documents</span><span class="p">(</span><span class="n">documentList</span><span class="p">)</span></code>

<a href="#ragora.core.document_preprocessor.DocumentPreprocessor._chunk_documents" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Chunk multiple LaTeX documents.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>documentList</code>
            </td>
            <td>
                  <code><span title="list">list</span>[<a class="autorefs autorefs-internal" title="LatexDocument


  
      dataclass
   (ragora.utils.latex_parser.LatexDocument)" href="#ragora.utils.latex_parser.LatexDocument">LatexDocument</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Parsed LaTeX documents.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="list">list</span>[<a class="autorefs autorefs-internal" title="DataChunk


  
      dataclass
   (ragora.core.chunking.DataChunk)" href="#ragora.core.chunking.DataChunk">DataChunk</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>list[DataChunk]: Chunked output.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/core/document_preprocessor.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">_chunk_documents</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">documentList</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">LatexDocument</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">DataChunk</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Chunk multiple LaTeX documents.</span>

<span class="sd">    Args:</span>
<span class="sd">        documentList: Parsed LaTeX documents.</span>

<span class="sd">    Returns:</span>
<span class="sd">        list[DataChunk]: Chunked output.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">chunks</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">documentList</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">chunks</span>
    <span class="k">for</span> <span class="n">document</span> <span class="ow">in</span> <span class="n">documentList</span><span class="p">:</span>
        <span class="n">chunks</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_chunk_document</span><span class="p">(</span><span class="n">document</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">chunks</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="ragora.core.document_preprocessor.DocumentPreprocessor._chunk_markdown_document" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">_chunk_markdown_document</span><span class="p">(</span><span class="n">document</span><span class="p">)</span></code>

<a href="#ragora.core.document_preprocessor.DocumentPreprocessor._chunk_markdown_document" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Chunk a single Markdown document respecting the original hierarchy.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>document</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="MarkdownDocument


  
      dataclass
   (ragora.utils.markdown_parser.MarkdownDocument)" href="#ragora.utils.markdown_parser.MarkdownDocument">MarkdownDocument</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Parsed Markdown document.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="list">list</span>[<a class="autorefs autorefs-internal" title="DataChunk


  
      dataclass
   (ragora.core.chunking.DataChunk)" href="#ragora.core.chunking.DataChunk">DataChunk</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>list[DataChunk]: Chunked output.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If <code>document</code> is <code>None</code>.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/core/document_preprocessor.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">_chunk_markdown_document</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">document</span><span class="p">:</span> <span class="n">MarkdownDocument</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">DataChunk</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Chunk a single Markdown document respecting the original hierarchy.</span>

<span class="sd">    Args:</span>
<span class="sd">        document: Parsed Markdown document.</span>

<span class="sd">    Returns:</span>
<span class="sd">        list[DataChunk]: Chunked output.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If ``document`` is ``None``.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">document</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Document cannot be None&quot;</span><span class="p">)</span>

    <span class="n">chunk_id_counter</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">chunks</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">DataChunk</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">if</span> <span class="n">document</span><span class="o">.</span><span class="n">paragraphs</span><span class="p">:</span>
        <span class="n">paragraph_content</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="n">paragraph</span><span class="o">.</span><span class="n">content</span>
            <span class="k">for</span> <span class="n">paragraph</span> <span class="ow">in</span> <span class="n">document</span><span class="o">.</span><span class="n">paragraphs</span>
            <span class="k">if</span> <span class="n">paragraph</span><span class="o">.</span><span class="n">content</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">paragraph_content</span><span class="p">:</span>
            <span class="n">section_label</span> <span class="o">=</span> <span class="n">document</span><span class="o">.</span><span class="n">title</span> <span class="ow">or</span> <span class="n">document</span><span class="o">.</span><span class="n">source_document</span>
            <span class="n">context</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">ChunkingContextBuilder</span><span class="p">()</span>
                <span class="o">.</span><span class="n">for_document</span><span class="p">()</span>
                <span class="o">.</span><span class="n">with_source</span><span class="p">(</span><span class="n">document</span><span class="o">.</span><span class="n">source_document</span><span class="p">)</span>
                <span class="o">.</span><span class="n">with_section</span><span class="p">(</span><span class="n">section_label</span><span class="p">)</span>
                <span class="o">.</span><span class="n">with_start_sequence_idx</span><span class="p">(</span><span class="n">chunk_id_counter</span><span class="p">)</span>
                <span class="o">.</span><span class="n">build</span><span class="p">()</span>
            <span class="p">)</span>
            <span class="n">doc_chunks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chunker</span><span class="o">.</span><span class="n">chunk</span><span class="p">(</span><span class="n">paragraph_content</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
            <span class="n">chunks</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">doc_chunks</span><span class="p">)</span>
            <span class="n">chunk_id_counter</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">doc_chunks</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">document</span><span class="o">.</span><span class="n">chapters</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">chapter</span> <span class="ow">in</span> <span class="n">document</span><span class="o">.</span><span class="n">chapters</span><span class="p">:</span>
            <span class="n">chapter_content_parts</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;# </span><span class="si">{</span><span class="n">chapter</span><span class="o">.</span><span class="n">title</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">if</span> <span class="n">chapter</span><span class="o">.</span><span class="n">title</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">]</span>
            <span class="n">chapter_content_parts</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
                <span class="n">paragraph</span><span class="o">.</span><span class="n">content</span>
                <span class="k">for</span> <span class="n">paragraph</span> <span class="ow">in</span> <span class="n">chapter</span><span class="o">.</span><span class="n">paragraphs</span>
                <span class="k">if</span> <span class="n">paragraph</span><span class="o">.</span><span class="n">content</span>
            <span class="p">)</span>
            <span class="n">chapter_content</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="n">part</span> <span class="k">for</span> <span class="n">part</span> <span class="ow">in</span> <span class="n">chapter_content_parts</span> <span class="k">if</span> <span class="n">part</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">chapter_content</span><span class="p">:</span>
                <span class="n">section_label</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">chapter</span><span class="o">.</span><span class="n">title</span> <span class="ow">or</span> <span class="n">document</span><span class="o">.</span><span class="n">title</span> <span class="ow">or</span> <span class="n">document</span><span class="o">.</span><span class="n">source_document</span>
                <span class="p">)</span>
                <span class="n">context</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">ChunkingContextBuilder</span><span class="p">()</span>
                    <span class="o">.</span><span class="n">for_document</span><span class="p">()</span>
                    <span class="o">.</span><span class="n">with_source</span><span class="p">(</span><span class="n">document</span><span class="o">.</span><span class="n">source_document</span><span class="p">)</span>
                    <span class="o">.</span><span class="n">with_section</span><span class="p">(</span><span class="n">section_label</span><span class="p">)</span>
                    <span class="o">.</span><span class="n">with_start_sequence_idx</span><span class="p">(</span><span class="n">chunk_id_counter</span><span class="p">)</span>
                    <span class="o">.</span><span class="n">build</span><span class="p">()</span>
                <span class="p">)</span>
                <span class="n">doc_chunks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chunker</span><span class="o">.</span><span class="n">chunk</span><span class="p">(</span><span class="n">chapter_content</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
                <span class="n">chunks</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">doc_chunks</span><span class="p">)</span>
                <span class="n">chunk_id_counter</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">doc_chunks</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">chapter</span><span class="o">.</span><span class="n">sections</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">section</span> <span class="ow">in</span> <span class="n">chapter</span><span class="o">.</span><span class="n">sections</span><span class="p">:</span>
                    <span class="n">section_content_parts</span> <span class="o">=</span> <span class="p">[</span>
                        <span class="sa">f</span><span class="s2">&quot;## </span><span class="si">{</span><span class="n">section</span><span class="o">.</span><span class="n">title</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">if</span> <span class="n">section</span><span class="o">.</span><span class="n">title</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
                        <span class="o">*</span><span class="p">[</span>
                            <span class="n">paragraph</span><span class="o">.</span><span class="n">content</span>
                            <span class="k">for</span> <span class="n">paragraph</span> <span class="ow">in</span> <span class="n">section</span><span class="o">.</span><span class="n">paragraphs</span>
                            <span class="k">if</span> <span class="n">paragraph</span><span class="o">.</span><span class="n">content</span>
                        <span class="p">],</span>
                    <span class="p">]</span>
                    <span class="n">section_content</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                        <span class="n">part</span> <span class="k">for</span> <span class="n">part</span> <span class="ow">in</span> <span class="n">section_content_parts</span> <span class="k">if</span> <span class="n">part</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                    <span class="p">)</span>
                    <span class="k">if</span> <span class="n">section_content</span><span class="p">:</span>
                        <span class="n">section_label</span> <span class="o">=</span> <span class="p">(</span>
                            <span class="n">section</span><span class="o">.</span><span class="n">title</span>
                            <span class="ow">or</span> <span class="n">chapter</span><span class="o">.</span><span class="n">title</span>
                            <span class="ow">or</span> <span class="n">document</span><span class="o">.</span><span class="n">title</span>
                            <span class="ow">or</span> <span class="n">document</span><span class="o">.</span><span class="n">source_document</span>
                        <span class="p">)</span>
                        <span class="n">context</span> <span class="o">=</span> <span class="p">(</span>
                            <span class="n">ChunkingContextBuilder</span><span class="p">()</span>
                            <span class="o">.</span><span class="n">for_document</span><span class="p">()</span>
                            <span class="o">.</span><span class="n">with_source</span><span class="p">(</span><span class="n">document</span><span class="o">.</span><span class="n">source_document</span><span class="p">)</span>
                            <span class="o">.</span><span class="n">with_section</span><span class="p">(</span><span class="n">section_label</span><span class="p">)</span>
                            <span class="o">.</span><span class="n">with_start_sequence_idx</span><span class="p">(</span><span class="n">chunk_id_counter</span><span class="p">)</span>
                            <span class="o">.</span><span class="n">build</span><span class="p">()</span>
                        <span class="p">)</span>
                        <span class="n">doc_chunks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chunker</span><span class="o">.</span><span class="n">chunk</span><span class="p">(</span><span class="n">section_content</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
                        <span class="n">chunks</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">doc_chunks</span><span class="p">)</span>
                        <span class="n">chunk_id_counter</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">doc_chunks</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">document</span><span class="o">.</span><span class="n">sections</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">section</span> <span class="ow">in</span> <span class="n">document</span><span class="o">.</span><span class="n">sections</span><span class="p">:</span>
            <span class="n">section_content_parts</span> <span class="o">=</span> <span class="p">[</span>
                <span class="sa">f</span><span class="s2">&quot;## </span><span class="si">{</span><span class="n">section</span><span class="o">.</span><span class="n">title</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">if</span> <span class="n">section</span><span class="o">.</span><span class="n">title</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
                <span class="o">*</span><span class="p">[</span>
                    <span class="n">paragraph</span><span class="o">.</span><span class="n">content</span>
                    <span class="k">for</span> <span class="n">paragraph</span> <span class="ow">in</span> <span class="n">section</span><span class="o">.</span><span class="n">paragraphs</span>
                    <span class="k">if</span> <span class="n">paragraph</span><span class="o">.</span><span class="n">content</span>
                <span class="p">],</span>
            <span class="p">]</span>
            <span class="n">section_content</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="n">part</span> <span class="k">for</span> <span class="n">part</span> <span class="ow">in</span> <span class="n">section_content_parts</span> <span class="k">if</span> <span class="n">part</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">section_content</span><span class="p">:</span>
                <span class="n">section_label</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">section</span><span class="o">.</span><span class="n">title</span> <span class="ow">or</span> <span class="n">document</span><span class="o">.</span><span class="n">title</span> <span class="ow">or</span> <span class="n">document</span><span class="o">.</span><span class="n">source_document</span>
                <span class="p">)</span>
                <span class="n">context</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">ChunkingContextBuilder</span><span class="p">()</span>
                    <span class="o">.</span><span class="n">for_document</span><span class="p">()</span>
                    <span class="o">.</span><span class="n">with_source</span><span class="p">(</span><span class="n">document</span><span class="o">.</span><span class="n">source_document</span><span class="p">)</span>
                    <span class="o">.</span><span class="n">with_section</span><span class="p">(</span><span class="n">section_label</span><span class="p">)</span>
                    <span class="o">.</span><span class="n">with_start_sequence_idx</span><span class="p">(</span><span class="n">chunk_id_counter</span><span class="p">)</span>
                    <span class="o">.</span><span class="n">build</span><span class="p">()</span>
                <span class="p">)</span>
                <span class="n">doc_chunks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chunker</span><span class="o">.</span><span class="n">chunk</span><span class="p">(</span><span class="n">section_content</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
                <span class="n">chunks</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">doc_chunks</span><span class="p">)</span>
                <span class="n">chunk_id_counter</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">doc_chunks</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">chunks</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="ragora.core.document_preprocessor.DocumentPreprocessor._chunk_markdown_documents" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">_chunk_markdown_documents</span><span class="p">(</span><span class="n">document_list</span><span class="p">)</span></code>

<a href="#ragora.core.document_preprocessor.DocumentPreprocessor._chunk_markdown_documents" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Chunk Markdown or plain text documents.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>document_list</code>
            </td>
            <td>
                  <code><span title="list">list</span>[<a class="autorefs autorefs-internal" title="MarkdownDocument


  
      dataclass
   (ragora.utils.markdown_parser.MarkdownDocument)" href="#ragora.utils.markdown_parser.MarkdownDocument">MarkdownDocument</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Parsed Markdown documents.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="list">list</span>[<a class="autorefs autorefs-internal" title="DataChunk


  
      dataclass
   (ragora.core.chunking.DataChunk)" href="#ragora.core.chunking.DataChunk">DataChunk</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>list[DataChunk]: Chunked output.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/core/document_preprocessor.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">_chunk_markdown_documents</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">document_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">MarkdownDocument</span><span class="p">]</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">DataChunk</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Chunk Markdown or plain text documents.</span>

<span class="sd">    Args:</span>
<span class="sd">        document_list: Parsed Markdown documents.</span>

<span class="sd">    Returns:</span>
<span class="sd">        list[DataChunk]: Chunked output.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">chunks</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">DataChunk</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">document_list</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">chunks</span>

    <span class="k">for</span> <span class="n">document</span> <span class="ow">in</span> <span class="n">document_list</span><span class="p">:</span>
        <span class="n">chunks</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_chunk_markdown_document</span><span class="p">(</span><span class="n">document</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">chunks</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="ragora.core.document_preprocessor.DocumentPreprocessor._extract_document_text" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">_extract_document_text</span><span class="p">(</span><span class="n">documentList</span><span class="p">)</span></code>

<a href="#ragora.core.document_preprocessor.DocumentPreprocessor._extract_document_text" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Merge one or more parsed LaTeX documents into plain text.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>documentList</code>
            </td>
            <td>
                  <code><span title="list">list</span>[<a class="autorefs autorefs-internal" title="LatexDocument


  
      dataclass
   (ragora.utils.latex_parser.LatexDocument)" href="#ragora.utils.latex_parser.LatexDocument">LatexDocument</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Collection of parsed LaTeX documents to flatten.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>str</code></td>            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Combined Markdown-like text used for chunking.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/core/document_preprocessor.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">_extract_document_text</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">documentList</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">LatexDocument</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Merge one or more parsed LaTeX documents into plain text.</span>

<span class="sd">    Args:</span>
<span class="sd">        documentList: Collection of parsed LaTeX documents to flatten.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: Combined Markdown-like text used for chunking.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">content_parts</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">document</span> <span class="ow">in</span> <span class="n">documentList</span><span class="p">:</span>
        <span class="c1"># Extract from chapters</span>
        <span class="k">if</span> <span class="n">document</span><span class="o">.</span><span class="n">chapters</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">chapter</span> <span class="ow">in</span> <span class="n">document</span><span class="o">.</span><span class="n">chapters</span><span class="p">:</span>
                <span class="n">content_parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;# </span><span class="si">{</span><span class="n">chapter</span><span class="o">.</span><span class="n">title</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">chapter</span><span class="o">.</span><span class="n">paragraphs</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">para</span> <span class="ow">in</span> <span class="n">chapter</span><span class="o">.</span><span class="n">paragraphs</span><span class="p">:</span>
                        <span class="n">content_parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">para</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">chapter</span><span class="o">.</span><span class="n">sections</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">section</span> <span class="ow">in</span> <span class="n">chapter</span><span class="o">.</span><span class="n">sections</span><span class="p">:</span>
                        <span class="n">content_parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;## </span><span class="si">{</span><span class="n">section</span><span class="o">.</span><span class="n">title</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">section</span><span class="o">.</span><span class="n">paragraphs</span><span class="p">:</span>
                            <span class="k">for</span> <span class="n">para</span> <span class="ow">in</span> <span class="n">section</span><span class="o">.</span><span class="n">paragraphs</span><span class="p">:</span>
                                <span class="n">content_parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">para</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>

        <span class="c1"># Extract from standalone sections</span>
        <span class="k">if</span> <span class="n">document</span><span class="o">.</span><span class="n">sections</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">section</span> <span class="ow">in</span> <span class="n">document</span><span class="o">.</span><span class="n">sections</span><span class="p">:</span>
                <span class="n">content_parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;## </span><span class="si">{</span><span class="n">section</span><span class="o">.</span><span class="n">title</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">section</span><span class="o">.</span><span class="n">paragraphs</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">para</span> <span class="ow">in</span> <span class="n">section</span><span class="o">.</span><span class="n">paragraphs</span><span class="p">:</span>
                        <span class="n">content_parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">para</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>

        <span class="c1"># Extract from standalone paragraphs</span>
        <span class="k">if</span> <span class="n">document</span><span class="o">.</span><span class="n">paragraphs</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">para</span> <span class="ow">in</span> <span class="n">document</span><span class="o">.</span><span class="n">paragraphs</span><span class="p">:</span>
                <span class="n">content_parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">para</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>

        <span class="c1"># Extract from tables</span>
        <span class="k">if</span> <span class="n">document</span><span class="o">.</span><span class="n">tables</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">table</span> <span class="ow">in</span> <span class="n">document</span><span class="o">.</span><span class="n">tables</span><span class="p">:</span>
                <span class="n">content_parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">to_plain_text</span><span class="p">())</span>

    <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">content_parts</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="ragora.core.document_preprocessor.DocumentPreprocessor.preprocess_document" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">preprocess_document</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;latex&#39;</span><span class="p">)</span></code>

<a href="#ragora.core.document_preprocessor.DocumentPreprocessor.preprocess_document" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Preprocess a single document into :class:<code>DataChunk</code> objects.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>file_path</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to the document file.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>format</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Document format (<code>"latex"</code>, <code>"markdown"</code>, or <code>"text"</code>).</p>
              </div>
            </td>
            <td>
                  <code>&#39;latex&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="list">list</span>[<a class="autorefs autorefs-internal" title="DataChunk


  
      dataclass
   (ragora.core.chunking.DataChunk)" href="#ragora.core.chunking.DataChunk">DataChunk</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>list[DataChunk]: Chunked content ready for embedding downstream.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If an unsupported format is requested.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><span class="n">chunks</span> <span class="o">=</span> <span class="n">preprocessor</span><span class="o">.</span><span class="n">preprocess_document</span><span class="p">(</span><span class="s2">&quot;paper.tex&quot;</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;latex&quot;</span><span class="p">)</span>
</code></pre></div>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/core/document_preprocessor.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span>
<span class="normal">93</span>
<span class="normal">94</span>
<span class="normal">95</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">preprocess_document</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">file_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">format</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;latex&quot;</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">DataChunk</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Preprocess a single document into :class:`DataChunk` objects.</span>

<span class="sd">    Args:</span>
<span class="sd">        file_path: Path to the document file.</span>
<span class="sd">        format: Document format (``&quot;latex&quot;``, ``&quot;markdown&quot;``, or ``&quot;text&quot;``).</span>

<span class="sd">    Returns:</span>
<span class="sd">        list[DataChunk]: Chunked content ready for embedding downstream.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If an unsupported format is requested.</span>

<span class="sd">    Examples:</span>
<span class="sd">        ```python</span>
<span class="sd">        chunks = preprocessor.preprocess_document(&quot;paper.tex&quot;, format=&quot;latex&quot;)</span>
<span class="sd">        ```</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">normalized_format</span> <span class="o">=</span> <span class="nb">format</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">normalized_format</span> <span class="o">==</span> <span class="s2">&quot;latex&quot;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">file_path</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.bib&quot;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">latex_parser</span><span class="o">.</span><span class="n">parse_bibliography</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">[]</span>
        <span class="n">document</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">latex_parser</span><span class="o">.</span><span class="n">parse_document</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_chunk_documents</span><span class="p">([</span><span class="n">document</span><span class="p">])</span>

    <span class="k">if</span> <span class="n">normalized_format</span> <span class="ow">in</span> <span class="p">{</span><span class="s2">&quot;markdown&quot;</span><span class="p">,</span> <span class="s2">&quot;md&quot;</span><span class="p">,</span> <span class="s2">&quot;text&quot;</span><span class="p">,</span> <span class="s2">&quot;txt&quot;</span><span class="p">}:</span>
        <span class="n">document</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">markdown_parser</span><span class="o">.</span><span class="n">parse_document</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_chunk_markdown_documents</span><span class="p">([</span><span class="n">document</span><span class="p">])</span>

    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unsupported document format: </span><span class="si">{</span><span class="nb">format</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="ragora.core.document_preprocessor.DocumentPreprocessor.preprocess_document_folder" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">preprocess_document_folder</span><span class="p">(</span><span class="n">folder_path</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;latex&#39;</span><span class="p">)</span></code>

<a href="#ragora.core.document_preprocessor.DocumentPreprocessor.preprocess_document_folder" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Preprocess every supported file in a folder.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>folder_path</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Directory containing documents that should be ingested.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>format</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Document format used to interpret files within the folder.</p>
              </div>
            </td>
            <td>
                  <code>&#39;latex&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="list">list</span>[<a class="autorefs autorefs-internal" title="DataChunk


  
      dataclass
   (ragora.core.chunking.DataChunk)" href="#ragora.core.chunking.DataChunk">DataChunk</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>list[DataChunk]: Aggregated chunk list for the entire folder.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If <code>format</code> is not in the supported extension map.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/core/document_preprocessor.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">preprocess_document_folder</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">folder_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">format</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;latex&quot;</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">DataChunk</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Preprocess every supported file in a folder.</span>

<span class="sd">    Args:</span>
<span class="sd">        folder_path: Directory containing documents that should be ingested.</span>
<span class="sd">        format: Document format used to interpret files within the folder.</span>

<span class="sd">    Returns:</span>
<span class="sd">        list[DataChunk]: Aggregated chunk list for the entire folder.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If ``format`` is not in the supported extension map.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">normalized_format</span> <span class="o">=</span> <span class="nb">format</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">normalized_format</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_extension_map</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unsupported document format: </span><span class="si">{</span><span class="nb">format</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">file_paths</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">folder_path</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">folder_path</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span>
            <span class="n">file</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="n">ext</span><span class="p">)</span> <span class="k">for</span> <span class="n">ext</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_extension_map</span><span class="p">[</span><span class="n">normalized_format</span><span class="p">]</span>
        <span class="p">)</span>
    <span class="p">]</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">preprocess_documents</span><span class="p">(</span><span class="n">file_paths</span><span class="p">,</span> <span class="n">normalized_format</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="ragora.core.document_preprocessor.DocumentPreprocessor.preprocess_documents" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">preprocess_documents</span><span class="p">(</span><span class="n">file_paths</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;latex&#39;</span><span class="p">)</span></code>

<a href="#ragora.core.document_preprocessor.DocumentPreprocessor.preprocess_documents" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Preprocess multiple documents at once.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>file_paths</code>
            </td>
            <td>
                  <code><span title="list">list</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Collection of paths to document files.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>format</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Document format (<code>"latex"</code>, <code>"markdown"</code>, or <code>"text"</code>).</p>
              </div>
            </td>
            <td>
                  <code>&#39;latex&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="list">list</span>[<a class="autorefs autorefs-internal" title="DataChunk


  
      dataclass
   (ragora.core.chunking.DataChunk)" href="#ragora.core.chunking.DataChunk">DataChunk</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>list[DataChunk]: Combined chunks from all input documents.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If an unsupported format is requested.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><span class="n">chunks</span> <span class="o">=</span> <span class="n">preprocessor</span><span class="o">.</span><span class="n">preprocess_documents</span><span class="p">(</span>
    <span class="p">[</span><span class="s2">&quot;chapter1.tex&quot;</span><span class="p">,</span> <span class="s2">&quot;chapter2.tex&quot;</span><span class="p">,</span> <span class="s2">&quot;references.bib&quot;</span><span class="p">],</span>
    <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;latex&quot;</span><span class="p">,</span>
<span class="p">)</span>
</code></pre></div>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/core/document_preprocessor.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">preprocess_documents</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">file_paths</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="nb">format</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;latex&quot;</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">DataChunk</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Preprocess multiple documents at once.</span>

<span class="sd">    Args:</span>
<span class="sd">        file_paths: Collection of paths to document files.</span>
<span class="sd">        format: Document format (``&quot;latex&quot;``, ``&quot;markdown&quot;``, or ``&quot;text&quot;``).</span>

<span class="sd">    Returns:</span>
<span class="sd">        list[DataChunk]: Combined chunks from all input documents.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If an unsupported format is requested.</span>

<span class="sd">    Examples:</span>
<span class="sd">        ```python</span>
<span class="sd">        chunks = preprocessor.preprocess_documents(</span>
<span class="sd">            [&quot;chapter1.tex&quot;, &quot;chapter2.tex&quot;, &quot;references.bib&quot;],</span>
<span class="sd">            format=&quot;latex&quot;,</span>
<span class="sd">        )</span>
<span class="sd">        ```</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">normalized_format</span> <span class="o">=</span> <span class="nb">format</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">normalized_format</span> <span class="o">==</span> <span class="s2">&quot;latex&quot;</span><span class="p">:</span>
        <span class="c1"># Find the bibliography file</span>
        <span class="n">bibliography_path</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">file_path</span> <span class="ow">in</span> <span class="n">file_paths</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">file_path</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.bib&quot;</span><span class="p">):</span>
                <span class="n">bibliography_path</span> <span class="o">=</span> <span class="n">file_path</span>
                <span class="k">break</span>
        <span class="k">if</span> <span class="n">bibliography_path</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">latex_parser</span><span class="o">.</span><span class="n">parse_bibliography</span><span class="p">(</span><span class="n">bibliography_path</span><span class="p">)</span>
        <span class="n">documents</span> <span class="o">=</span> <span class="p">[</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">latex_parser</span><span class="o">.</span><span class="n">parse_document</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">file_path</span> <span class="ow">in</span> <span class="n">file_paths</span>
            <span class="k">if</span> <span class="n">file_path</span> <span class="o">!=</span> <span class="n">bibliography_path</span>
        <span class="p">]</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_chunk_documents</span><span class="p">(</span><span class="n">documents</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">normalized_format</span> <span class="ow">in</span> <span class="p">{</span><span class="s2">&quot;markdown&quot;</span><span class="p">,</span> <span class="s2">&quot;md&quot;</span><span class="p">,</span> <span class="s2">&quot;text&quot;</span><span class="p">,</span> <span class="s2">&quot;txt&quot;</span><span class="p">}:</span>
        <span class="n">documents</span> <span class="o">=</span> <span class="p">[</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">markdown_parser</span><span class="o">.</span><span class="n">parse_document</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">file_paths</span>
        <span class="p">]</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_chunk_markdown_documents</span><span class="p">(</span><span class="n">documents</span><span class="p">)</span>

    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unsupported document format: </span><span class="si">{</span><span class="nb">format</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div><h3 id="email-preprocessor">Email Preprocessor<a class="headerlink" href="#email-preprocessor" title="Permanent link">&para;</a></h3>


<div class="doc doc-object doc-module">



<a id="ragora.core.email_preprocessor"></a>
    <div class="doc doc-contents first">

        <p>Email preprocessor for the RAG system.</p>
<p>This module handles the preprocessing of email messages for the RAG system.
It converts email messages into data chunks for the RAG system.</p>
<p>Key responsibilities:
- Convert email messages into data chunks
- Provide a unified interface for preprocessing email messages
- Prepare clean text content for the embedding engine
- Maintain email message structure and metadata
- Clean HTML content and strip quoted replies and signatures</p>
<p>The preprocessor returns structured chunks with metadata that can be directly
fed to the embedding engine for vector database storage.</p>










  <div class="doc doc-children">









<div class="doc doc-object doc-class">



<h4 id="ragora.core.email_preprocessor.EmailPreprocessor" class="doc doc-heading">
            <code>EmailPreprocessor</code>


<a href="#ragora.core.email_preprocessor.EmailPreprocessor" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">


        <p>Email preprocessor for the RAG system.</p>
<p>This class handles the conversion of EmailMessage objects into DataChunks
suitable for vector storage. It follows the same pattern as
DocumentPreprocessor for consistency in the codebase.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="ragora.core.email_preprocessor.EmailPreprocessor.chunker">chunker</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>DataChunker instance for chunking email content</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>








              <details class="quote">
                <summary>Source code in <code>ragora/ragora/core/email_preprocessor.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">EmailPreprocessor</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Email preprocessor for the RAG system.</span>

<span class="sd">    This class handles the conversion of EmailMessage objects into DataChunks</span>
<span class="sd">    suitable for vector storage. It follows the same pattern as</span>
<span class="sd">    DocumentPreprocessor for consistency in the codebase.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        chunker: DataChunker instance for chunking email content</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Email TLDs for signature detection (class-level constant)</span>
    <span class="n">_EMAIL_TLDS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="sa">r</span><span class="s2">&quot;com|org|net|edu|gov|de|uk|fr|it|es|nl|be|ch|at|se|no|&quot;</span>
        <span class="sa">r</span><span class="s2">&quot;dk|fi|pl|cz|hu|ro|gr|pt|ie|lu|mt|cy|sk|si|ee|lv|lt|bg|hr&quot;</span>
    <span class="p">)</span>

    <span class="c1"># Patterns that indicate signature start (class-level constant)</span>
    <span class="n">_SIGNATURE_INDICATORS</span> <span class="o">=</span> <span class="p">[</span>
        <span class="sa">r</span><span class="s2">&quot;^--\s*$&quot;</span><span class="p">,</span>  <span class="c1"># Two dashes on their own line</span>
        <span class="sa">r</span><span class="s2">&quot;^</span><span class="se">\\</span><span class="s2">--\s*$&quot;</span><span class="p">,</span>  <span class="c1"># Escaped two dashes (from HTML/text conversion)</span>
        <span class="sa">r</span><span class="s2">&quot;^---\s*$&quot;</span><span class="p">,</span>  <span class="c1"># Three dashes</span>
        <span class="sa">r</span><span class="s2">&quot;^</span><span class="se">\\</span><span class="s2">---\s*$&quot;</span><span class="p">,</span>  <span class="c1"># Escaped three dashes (from HTML/text conversion)</span>
        <span class="sa">r</span><span class="s2">&quot;^_{3,}$&quot;</span><span class="p">,</span>  <span class="c1"># Underscores</span>
        <span class="sa">r</span><span class="s2">&quot;^={3,}$&quot;</span><span class="p">,</span>  <span class="c1"># Equals signs</span>
        <span class="sa">r</span><span class="s2">&quot;^Best regards&quot;</span><span class="p">,</span>
        <span class="sa">r</span><span class="s2">&quot;^Regards,&quot;</span><span class="p">,</span>
        <span class="sa">r</span><span class="s2">&quot;^Sincerely,&quot;</span><span class="p">,</span>
        <span class="sa">r</span><span class="s2">&quot;^Cheers,&quot;</span><span class="p">,</span>
        <span class="sa">r</span><span class="s2">&quot;^Thanks,&quot;</span><span class="p">,</span>
        <span class="sa">r</span><span class="s2">&quot;^Thank you,&quot;</span><span class="p">,</span>
        <span class="sa">r</span><span class="s2">&quot;^Sent from my&quot;</span><span class="p">,</span>
        <span class="sa">r</span><span class="s2">&quot;^Get Outlook&quot;</span><span class="p">,</span>
    <span class="p">]</span>

    <span class="c1"># Compiled regex patterns for signature indicators (pre-compiled for</span>
    <span class="c1"># performance)</span>
    <span class="n">_SIGNATURE_INDICATOR_PATTERNS</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">)</span> <span class="k">for</span> <span class="n">pattern</span> <span class="ow">in</span> <span class="n">_SIGNATURE_INDICATORS</span>
    <span class="p">]</span>

    <span class="c1"># Patterns that indicate signature content (class-level constant)</span>
    <span class="n">_SIGNATURE_CONTENT_PATTERNS</span> <span class="o">=</span> <span class="p">[</span>
        <span class="c1"># Email addresses</span>
        <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;@.*\.&quot;</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="n">_EMAIL_TLDS</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">),</span>
        <span class="c1"># Phone numbers (international format)</span>
        <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span>
            <span class="sa">r</span><span class="s2">&quot;\+?\d{1,4}[-.\s]?\d{1,4}[-.\s]?\d{1,4}[-.\s]?\d{1,4}&quot;</span> <span class="sa">r</span><span class="s2">&quot;[-.\s]?\d{0,4}&quot;</span><span class="p">,</span>
            <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">,</span>
        <span class="p">),</span>
        <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;^www\.&quot;</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">),</span>
        <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;^http://&quot;</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">),</span>
        <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;^https://&quot;</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">),</span>
        <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;linkedin\.com&quot;</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">),</span>
        <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;facebook\.com&quot;</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">),</span>
        <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;twitter\.com&quot;</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">),</span>
        <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;xing\.com&quot;</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">),</span>
        <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;^\d</span><span class="si">{5}</span><span class="s2">[\s-]?\w+&quot;</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">),</span>  <span class="c1"># Postal codes</span>
        <span class="c1"># Lines ending with comma and country/state (e.g., &quot;Germany&quot;, &quot;USA&quot;)</span>
        <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;,\s*\w+\s*$&quot;</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">),</span>
        <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\(cellphone\)&quot;</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">),</span>
        <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\(mobile\)&quot;</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">),</span>
        <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\(phone\)&quot;</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">),</span>
        <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;Dr\.-?Ing\.&quot;</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">),</span>  <span class="c1"># German academic titles</span>
        <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;Prof\.&quot;</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">),</span>  <span class="c1"># Professor</span>
        <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;PhD&quot;</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">),</span>
    <span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">chunker</span><span class="p">:</span> <span class="n">DataChunker</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the EmailPreprocessor.</span>

<span class="sd">        Args:</span>
<span class="sd">            chunker: DataChunker instance (optional)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">chunker</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">chunker</span> <span class="o">=</span> <span class="n">chunker</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Create a default chunker</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">chunker</span> <span class="o">=</span> <span class="n">DataChunker</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">preprocess_emails</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">emails</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">EmailMessage</span><span class="p">],</span> <span class="n">start_sequence_idx</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">DataChunk</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Preprocess multiple emails into data chunks.</span>

<span class="sd">        This method converts a list of EmailMessage objects into DataChunks</span>
<span class="sd">        for storage in the vector database.</span>

<span class="sd">        Args:</span>
<span class="sd">            emails: List of EmailMessage objects to preprocess</span>
<span class="sd">            start_sequence_idx: Starting sequence index for the emails</span>

<span class="sd">        Returns:</span>
<span class="sd">            List of DataChunks containing the email messages</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">all_chunks</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">chunk_idx_counter</span> <span class="o">=</span> <span class="n">start_sequence_idx</span>

        <span class="k">for</span> <span class="n">email</span> <span class="ow">in</span> <span class="n">emails</span><span class="p">:</span>
            <span class="n">chunks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_email_to_chunks</span><span class="p">(</span><span class="n">email</span><span class="p">,</span> <span class="n">chunk_idx_counter</span><span class="p">)</span>
            <span class="n">all_chunks</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">chunks</span><span class="p">)</span>
            <span class="n">chunk_idx_counter</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">chunks</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">all_chunks</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">preprocess_email</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">email</span><span class="p">:</span> <span class="n">EmailMessage</span><span class="p">,</span> <span class="n">start_sequence_idx</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">DataChunk</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Preprocess a single email into data chunks.</span>

<span class="sd">        This method converts a single EmailMessage object into DataChunks</span>
<span class="sd">        for storage in the vector database.</span>

<span class="sd">        Args:</span>
<span class="sd">            email: EmailMessage object to preprocess</span>
<span class="sd">            start_sequence_idx: Starting sequence index for this email</span>

<span class="sd">        Returns:</span>
<span class="sd">            List of DataChunks containing the email message</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_email_to_chunks</span><span class="p">(</span><span class="n">email</span><span class="p">,</span> <span class="n">start_sequence_idx</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">clean_email_body</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">email</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">EmailMessage</span><span class="p">,</span> <span class="n">EmailMessageModel</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Clean email body by converting HTML, stripping replies,</span>
<span class="sd">        and removing signatures.</span>

<span class="sd">        This method orchestrates all cleaning steps:</span>
<span class="sd">        1. Extract body (HTML preferred, fallback to text)</span>
<span class="sd">        2. Convert HTML to text (if HTML exists)</span>
<span class="sd">        3. Strip quoted replies</span>
<span class="sd">        4. Strip signatures</span>
<span class="sd">        5. Normalize whitespace</span>

<span class="sd">        This method can be used independently to get clean email text</span>
<span class="sd">        for processing with LLMs or other text analysis tools without</span>
<span class="sd">        chunking the content.</span>

<span class="sd">        Args:</span>
<span class="sd">            email: EmailMessage or EmailMessageModel object to clean (both have</span>
<span class="sd">                the same interface: get_body(), body_html, body_text)</span>

<span class="sd">        Returns:</span>
<span class="sd">            Cleaned plain text content. Returns empty string if email</span>
<span class="sd">            has no body content.</span>

<span class="sd">        Example:</span>
<span class="sd">            &gt;&gt;&gt; from ragora import EmailPreprocessor</span>
<span class="sd">            &gt;&gt;&gt; from ragora.utils.email_utils.models import EmailMessage</span>
<span class="sd">            &gt;&gt;&gt; from ragora.core.models import EmailMessageModel</span>
<span class="sd">            &gt;&gt;&gt;</span>
<span class="sd">            &gt;&gt;&gt; preprocessor = EmailPreprocessor()</span>
<span class="sd">            &gt;&gt;&gt; # Works with EmailMessage</span>
<span class="sd">            &gt;&gt;&gt; clean_text = preprocessor.clean_email_body(email_message)</span>
<span class="sd">            &gt;&gt;&gt; # Also works with EmailMessageModel</span>
<span class="sd">            &gt;&gt;&gt; clean_text = preprocessor.clean_email_body(email_item)</span>
<span class="sd">            &gt;&gt;&gt; # Use clean_text with LLM or other processing</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Step 1: Extract body (HTML preferred, fallback to text)</span>
        <span class="n">body</span> <span class="o">=</span> <span class="n">email</span><span class="o">.</span><span class="n">get_body</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">body</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">body</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
            <span class="k">return</span> <span class="s2">&quot;&quot;</span>

        <span class="c1"># Step 2: Convert HTML to text if it&#39;s HTML</span>
        <span class="c1"># Check if body is HTML by looking at email.body_html</span>
        <span class="c1"># or by checking if body contains HTML tags</span>
        <span class="n">is_html</span> <span class="o">=</span> <span class="n">email</span><span class="o">.</span><span class="n">body_html</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">email</span><span class="o">.</span><span class="n">body_html</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">is_html</span><span class="p">:</span>
            <span class="c1"># Also check if body_text itself contains HTML tags</span>
            <span class="n">is_html</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;&lt;[^&gt;]+&gt;&quot;</span><span class="p">,</span> <span class="n">body</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">is_html</span><span class="p">:</span>
            <span class="n">text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_html_to_text</span><span class="p">(</span><span class="n">body</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">text</span> <span class="o">=</span> <span class="n">body</span>

        <span class="c1"># Step 3: Strip quoted replies</span>
        <span class="n">text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_strip_quoted_replies</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>

        <span class="c1"># Step 4: Strip signatures</span>
        <span class="n">text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_strip_signatures</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>

        <span class="c1"># Step 5: Normalize whitespace</span>
        <span class="n">text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_normalize_whitespace</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">text</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_email_to_chunks</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">email</span><span class="p">:</span> <span class="n">EmailMessage</span><span class="p">,</span> <span class="n">start_sequence_idx</span><span class="p">:</span> <span class="nb">int</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">DataChunk</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Convert an EmailMessage to data chunks.</span>

<span class="sd">        Args:</span>
<span class="sd">            email: EmailMessage object to convert</span>
<span class="sd">            start_sequence_idx: Starting sequence index for this email</span>

<span class="sd">        Returns:</span>
<span class="sd">            List of DataChunks for this email</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Clean and extract text content from email</span>
        <span class="n">email_text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">clean_email_body</span><span class="p">(</span><span class="n">email</span><span class="p">)</span>

        <span class="c1"># Create context with email metadata</span>
        <span class="n">context</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">ChunkingContextBuilder</span><span class="p">()</span>
            <span class="o">.</span><span class="n">for_email</span><span class="p">()</span>
            <span class="o">.</span><span class="n">with_email_info</span><span class="p">(</span>
                <span class="n">subject</span><span class="o">=</span><span class="n">email</span><span class="o">.</span><span class="n">subject</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
                <span class="n">sender</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">email</span><span class="o">.</span><span class="n">sender</span><span class="p">)</span> <span class="k">if</span> <span class="n">email</span><span class="o">.</span><span class="n">sender</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
                <span class="n">recipient</span><span class="o">=</span><span class="p">(</span>
                    <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">addr</span><span class="p">)</span> <span class="k">for</span> <span class="n">addr</span> <span class="ow">in</span> <span class="n">email</span><span class="o">.</span><span class="n">recipients</span><span class="p">])</span>
                    <span class="k">if</span> <span class="n">email</span><span class="o">.</span><span class="n">recipients</span>
                    <span class="k">else</span> <span class="s2">&quot;&quot;</span>
                <span class="p">),</span>
                <span class="n">email_id</span><span class="o">=</span><span class="n">email</span><span class="o">.</span><span class="n">message_id</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
                <span class="n">email_date</span><span class="o">=</span><span class="p">(</span><span class="n">email</span><span class="o">.</span><span class="n">date_sent</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span> <span class="k">if</span> <span class="n">email</span><span class="o">.</span><span class="n">date_sent</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
            <span class="p">)</span>
            <span class="o">.</span><span class="n">with_start_sequence_idx</span><span class="p">(</span><span class="n">start_sequence_idx</span><span class="p">)</span>
            <span class="o">.</span><span class="n">build</span><span class="p">()</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">chunker</span><span class="o">.</span><span class="n">chunk</span><span class="p">(</span><span class="n">email_text</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_html_to_text_html2text</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">html_content</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Convert HTML content to plain text using html2text library.</span>

<span class="sd">        Args:</span>
<span class="sd">            html_content: HTML string to convert</span>

<span class="sd">        Returns:</span>
<span class="sd">            Plain text representation of the HTML</span>

<span class="sd">        Raises:</span>
<span class="sd">            ImportError: If html2text library is not available</span>
<span class="sd">            Exception: If conversion fails</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">html2text</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span><span class="s2">&quot;html2text library is not available&quot;</span><span class="p">)</span>

        <span class="n">h</span> <span class="o">=</span> <span class="n">html2text</span><span class="o">.</span><span class="n">HTML2Text</span><span class="p">()</span>
        <span class="n">h</span><span class="o">.</span><span class="n">ignore_links</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">h</span><span class="o">.</span><span class="n">ignore_images</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">h</span><span class="o">.</span><span class="n">body_width</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># Don&#39;t wrap lines</span>
        <span class="n">h</span><span class="o">.</span><span class="n">unicode_snob</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># Use unicode</span>
        <span class="n">text</span> <span class="o">=</span> <span class="n">h</span><span class="o">.</span><span class="n">handle</span><span class="p">(</span><span class="n">html_content</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">text</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_html_to_text_beautifulsoup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">html_content</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Convert HTML content to plain text using BeautifulSoup4.</span>

<span class="sd">        Args:</span>
<span class="sd">            html_content: HTML string to convert</span>

<span class="sd">        Returns:</span>
<span class="sd">            Plain text representation of the HTML</span>

<span class="sd">        Raises:</span>
<span class="sd">            ImportError: If BeautifulSoup4 library is not available</span>
<span class="sd">            Exception: If conversion fails</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">BeautifulSoup</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span><span class="s2">&quot;BeautifulSoup4 library is not available&quot;</span><span class="p">)</span>

        <span class="n">soup</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">html_content</span><span class="p">,</span> <span class="s2">&quot;html.parser&quot;</span><span class="p">)</span>
        <span class="c1"># Remove script and style elements</span>
        <span class="k">for</span> <span class="n">script</span> <span class="ow">in</span> <span class="n">soup</span><span class="p">([</span><span class="s2">&quot;script&quot;</span><span class="p">,</span> <span class="s2">&quot;style&quot;</span><span class="p">]):</span>
            <span class="n">script</span><span class="o">.</span><span class="n">decompose</span><span class="p">()</span>
        <span class="n">text</span> <span class="o">=</span> <span class="n">soup</span><span class="o">.</span><span class="n">get_text</span><span class="p">()</span>
        <span class="c1"># Clean up whitespace</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">text</span><span class="o">.</span><span class="n">splitlines</span><span class="p">())</span>
        <span class="n">chunks</span> <span class="o">=</span> <span class="p">(</span><span class="n">phrase</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span> <span class="k">for</span> <span class="n">phrase</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;  &quot;</span><span class="p">))</span>
        <span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">chunk</span> <span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="n">chunks</span> <span class="k">if</span> <span class="n">chunk</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">text</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_html_to_text_regex</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">html_content</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Convert HTML content to plain text using basic regex cleanup.</span>

<span class="sd">        This is a last-resort fallback method that uses regex to remove</span>
<span class="sd">        HTML tags and decode common HTML entities.</span>

<span class="sd">        Args:</span>
<span class="sd">            html_content: HTML string to convert</span>

<span class="sd">        Returns:</span>
<span class="sd">            Plain text representation of the HTML</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Remove HTML tags</span>
        <span class="n">text</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;&lt;[^&gt;]+&gt;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">html_content</span><span class="p">)</span>
        <span class="c1"># Decode common HTML entities</span>
        <span class="n">text</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&amp;nbsp;&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">)</span>
        <span class="n">text</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&amp;amp;&quot;</span><span class="p">,</span> <span class="s2">&quot;&amp;&quot;</span><span class="p">)</span>
        <span class="n">text</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&amp;lt;&quot;</span><span class="p">,</span> <span class="s2">&quot;&lt;&quot;</span><span class="p">)</span>
        <span class="n">text</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&amp;gt;&quot;</span><span class="p">,</span> <span class="s2">&quot;&gt;&quot;</span><span class="p">)</span>
        <span class="n">text</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&amp;quot;&quot;</span><span class="p">,</span> <span class="s1">&#39;&quot;&#39;</span><span class="p">)</span>
        <span class="n">text</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&amp;#39;&quot;</span><span class="p">,</span> <span class="s2">&quot;&#39;&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">text</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_html_to_text</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">html_content</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Convert HTML content to plain text.</span>

<span class="sd">        Tries multiple approaches in order: html2text, BeautifulSoup4, regex.</span>

<span class="sd">        Args:</span>
<span class="sd">            html_content: HTML string to convert</span>

<span class="sd">        Returns:</span>
<span class="sd">            Plain text representation of the HTML</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">html_content</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">html_content</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
            <span class="k">return</span> <span class="s2">&quot;&quot;</span>

        <span class="c1"># Try html2text first (better for email HTML)</span>
        <span class="k">if</span> <span class="n">html2text</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_html_to_text_html2text</span><span class="p">(</span><span class="n">html_content</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="c1"># Fall through to BeautifulSoup if html2text fails</span>
                <span class="k">pass</span>

        <span class="c1"># Fallback to BeautifulSoup4</span>
        <span class="k">if</span> <span class="n">BeautifulSoup</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_html_to_text_beautifulsoup</span><span class="p">(</span><span class="n">html_content</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="k">pass</span>

        <span class="c1"># Last resort: basic regex cleanup</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_html_to_text_regex</span><span class="p">(</span><span class="n">html_content</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_strip_quoted_replies_library</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Strip quoted reply sections using email_reply_parser library.</span>

<span class="sd">        Args:</span>
<span class="sd">            text: Email text that may contain quoted replies</span>

<span class="sd">        Returns:</span>
<span class="sd">            Text with quoted replies removed</span>

<span class="sd">        Raises:</span>
<span class="sd">            ImportError: If email_reply_parser library is not available</span>
<span class="sd">            Exception: If parsing fails</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">EmailReplyParser</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span><span class="s2">&quot;email_reply_parser library is not available&quot;</span><span class="p">)</span>

        <span class="c1"># Parse the email to get the actual reply</span>
        <span class="n">parsed</span> <span class="o">=</span> <span class="n">EmailReplyParser</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
        <span class="c1"># Extract only the visible (non-quoted) text</span>
        <span class="c1"># Use parsed.reply which contains the reply text without quotes</span>
        <span class="n">reply</span> <span class="o">=</span> <span class="n">parsed</span><span class="o">.</span><span class="n">reply</span>
        <span class="k">if</span> <span class="n">reply</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">reply</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="k">return</span> <span class="s2">&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_strip_quoted_replies_regex</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Strip quoted reply sections using regex-based approach.</span>

<span class="sd">        This is a fallback method that uses regex patterns to identify</span>
<span class="sd">        and remove common quoted reply formats.</span>

<span class="sd">        Args:</span>
<span class="sd">            text: Email text that may contain quoted replies</span>

<span class="sd">        Returns:</span>
<span class="sd">            Text with quoted replies removed</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">cleaned_lines</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">in_quoted_section</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">in_header_block</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># Patterns that indicate start of quoted section</span>
        <span class="n">quote_start_patterns</span> <span class="o">=</span> <span class="p">[</span>
            <span class="sa">r</span><span class="s2">&quot;^On .+ wrote:&quot;</span><span class="p">,</span>
            <span class="sa">r</span><span class="s2">&quot;^From:&quot;</span><span class="p">,</span>
            <span class="sa">r</span><span class="s2">&quot;^-----Original Message-----&quot;</span><span class="p">,</span>
            <span class="sa">r</span><span class="s2">&quot;^&gt;+&quot;</span><span class="p">,</span>
            <span class="sa">r</span><span class="s2">&quot;^--- .+ ---&quot;</span><span class="p">,</span>
            <span class="sa">r</span><span class="s2">&quot;^_{5,}&quot;</span><span class="p">,</span>
            <span class="sa">r</span><span class="s2">&quot;^={5,}&quot;</span><span class="p">,</span>
        <span class="p">]</span>

        <span class="c1"># Patterns for email headers (usually follow &quot;From:&quot; in quotes)</span>
        <span class="n">email_header_pattern</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;^[A-Z][a-zA-Z-]+:&quot;</span>

        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
            <span class="c1"># Check if this line starts a quoted section</span>
            <span class="n">is_quote_start</span> <span class="o">=</span> <span class="nb">any</span><span class="p">(</span>
                <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">line</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">pattern</span> <span class="ow">in</span> <span class="n">quote_start_patterns</span>
            <span class="p">)</span>

            <span class="k">if</span> <span class="n">is_quote_start</span><span class="p">:</span>
                <span class="n">in_quoted_section</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">in_header_block</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">continue</span>

            <span class="c1"># If we hit a blank line after being in quoted section,</span>
            <span class="c1"># we might be transitioning, but continue checking</span>
            <span class="k">if</span> <span class="n">in_quoted_section</span><span class="p">:</span>
                <span class="c1"># Check if line is an email header (part of quote metadata)</span>
                <span class="n">is_email_header</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">email_header_pattern</span><span class="p">,</span> <span class="n">line</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">is_email_header</span><span class="p">:</span>
                    <span class="n">in_header_block</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="k">continue</span>

                <span class="c1"># After email headers, if we see a blank line,</span>
                <span class="c1"># mark that we&#39;re past the header block</span>
                <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">in_header_block</span><span class="p">:</span>
                        <span class="n">in_header_block</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="k">continue</span>

                <span class="c1"># After headers, everything until we see clear break</span>
                <span class="c1"># is quoted content</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">in_header_block</span><span class="p">:</span>
                    <span class="c1"># This is content after headers - should be quoted</span>
                    <span class="k">continue</span>

                <span class="c1"># If we get here, might be actual content again</span>
                <span class="c1"># Exit quoted section if we have content before</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">cleaned_lines</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">in_quoted_section</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="n">in_header_block</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="n">cleaned_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># No content yet, might still be in quote</span>
                    <span class="n">in_header_block</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">continue</span>

            <span class="n">in_header_block</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">cleaned_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>

        <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">cleaned_lines</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_strip_quoted_replies</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Strip quoted reply sections from email text.</span>

<span class="sd">        Tries email_reply_parser library first, falls back to regex approach.</span>

<span class="sd">        Args:</span>
<span class="sd">            text: Email text that may contain quoted replies</span>

<span class="sd">        Returns:</span>
<span class="sd">            Text with quoted replies removed</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">text</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">text</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
            <span class="k">return</span> <span class="s2">&quot;&quot;</span>

        <span class="k">if</span> <span class="n">EmailReplyParser</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_strip_quoted_replies_library</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="c1"># Fall through to regex-based approach if library fails</span>
                <span class="k">pass</span>

        <span class="c1"># Fallback regex-based approach for common reply patterns</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_strip_quoted_replies_regex</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_strip_signatures</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Strip email signatures from text.</span>

<span class="sd">        Uses regex patterns to identify and remove common signature formats.</span>

<span class="sd">        Args:</span>
<span class="sd">            text: Email text that may contain signatures</span>

<span class="sd">        Returns:</span>
<span class="sd">            Text with signatures removed</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">text</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">text</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
            <span class="k">return</span> <span class="s2">&quot;&quot;</span>

        <span class="n">lines</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">cleaned_lines</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">signature_started</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">consecutive_blank_lines</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lines</span><span class="p">):</span>
            <span class="c1"># Check if this line starts a signature</span>
            <span class="n">is_signature_start</span> <span class="o">=</span> <span class="nb">any</span><span class="p">(</span>
                <span class="n">pattern</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="k">for</span> <span class="n">pattern</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_SIGNATURE_INDICATOR_PATTERNS</span>
            <span class="p">)</span>

            <span class="k">if</span> <span class="n">is_signature_start</span><span class="p">:</span>
                <span class="n">signature_started</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">consecutive_blank_lines</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="c1"># Don&#39;t include this line</span>
                <span class="k">continue</span>

            <span class="k">if</span> <span class="n">signature_started</span><span class="p">:</span>
                <span class="c1"># Track consecutive blank lines - multiple blank lines might</span>
                <span class="c1"># indicate end of signature, but we need to be careful</span>
                <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                    <span class="n">consecutive_blank_lines</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="c1"># If we have 2+ consecutive blank lines, check if we&#39;re</span>
                    <span class="c1"># past signature</span>
                    <span class="k">if</span> <span class="n">consecutive_blank_lines</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
                        <span class="c1"># Look ahead to see if there&#39;s actual content</span>
                        <span class="n">next_non_blank_idx</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
                        <span class="k">while</span> <span class="p">(</span>
                            <span class="n">next_non_blank_idx</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>
                            <span class="ow">and</span> <span class="n">lines</span><span class="p">[</span><span class="n">next_non_blank_idx</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span>
                        <span class="p">):</span>
                            <span class="n">next_non_blank_idx</span> <span class="o">+=</span> <span class="mi">1</span>

                        <span class="k">if</span> <span class="n">next_non_blank_idx</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="p">):</span>
                            <span class="n">next_line</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="n">next_non_blank_idx</span><span class="p">]</span>
                            <span class="c1"># Check if next line looks like signature content</span>
                            <span class="n">is_signature_content</span> <span class="o">=</span> <span class="nb">any</span><span class="p">(</span>
                                <span class="n">pattern</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">next_line</span><span class="p">)</span>
                                <span class="k">for</span> <span class="n">pattern</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_SIGNATURE_CONTENT_PATTERNS</span>
                            <span class="p">)</span> <span class="ow">or</span> <span class="nb">any</span><span class="p">(</span>
                                <span class="n">pattern</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">next_line</span><span class="p">)</span>
                                <span class="k">for</span> <span class="n">pattern</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_SIGNATURE_INDICATOR_PATTERNS</span>
                            <span class="p">)</span>

                            <span class="k">if</span> <span class="ow">not</span> <span class="n">is_signature_content</span><span class="p">:</span>
                                <span class="c1"># We&#39;ve hit multiple blank lines followed by</span>
                                <span class="c1"># non-signature content. This likely means</span>
                                <span class="c1"># we&#39;re past the signature</span>
                                <span class="n">signature_started</span> <span class="o">=</span> <span class="kc">False</span>
                                <span class="n">consecutive_blank_lines</span> <span class="o">=</span> <span class="mi">0</span>
                                <span class="c1"># Include the blank lines as they&#39;re part of</span>
                                <span class="c1"># the break</span>
                                <span class="n">cleaned_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
                                <span class="k">continue</span>

                    <span class="c1"># Still in signature, skip blank lines</span>
                    <span class="k">continue</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># Reset blank line counter for non-blank lines</span>
                    <span class="n">consecutive_blank_lines</span> <span class="o">=</span> <span class="mi">0</span>

                    <span class="c1"># Check if line looks like signature content</span>
                    <span class="n">is_signature_content</span> <span class="o">=</span> <span class="nb">any</span><span class="p">(</span>
                        <span class="n">pattern</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
                        <span class="k">for</span> <span class="n">pattern</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_SIGNATURE_CONTENT_PATTERNS</span>
                    <span class="p">)</span>

                    <span class="k">if</span> <span class="n">is_signature_content</span><span class="p">:</span>
                        <span class="c1"># Definitely signature content, skip it</span>
                        <span class="k">continue</span>

                    <span class="c1"># Line doesn&#39;t match signature patterns, but we&#39;re after</span>
                    <span class="c1"># a signature delimiter. Continue skipping unless we see</span>
                    <span class="c1"># a clear break (handled by blank line logic above).</span>
                    <span class="c1"># This handles names, titles, and other signature</span>
                    <span class="c1"># elements that don&#39;t match patterns</span>
                    <span class="k">continue</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">consecutive_blank_lines</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">cleaned_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>

        <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">cleaned_lines</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_normalize_whitespace</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Normalize whitespace in text.</span>

<span class="sd">        Args:</span>
<span class="sd">            text: Text to normalize</span>

<span class="sd">        Returns:</span>
<span class="sd">            Text with normalized whitespace</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">text</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;&quot;</span>

        <span class="c1"># Replace multiple spaces with single space</span>
        <span class="n">text</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot; +&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
        <span class="c1"># Replace multiple newlines with maximum of two</span>
        <span class="n">text</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\n{3,}&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
        <span class="c1"># Remove trailing whitespace from each line</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="p">[</span><span class="n">line</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)]</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h5 id="ragora.core.email_preprocessor.EmailPreprocessor._email_to_chunks" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">_email_to_chunks</span><span class="p">(</span><span class="n">email</span><span class="p">,</span> <span class="n">start_sequence_idx</span><span class="p">)</span></code>

<a href="#ragora.core.email_preprocessor.EmailPreprocessor._email_to_chunks" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Convert an EmailMessage to data chunks.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>email</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="EmailMessage


  
      dataclass
   (ragora.utils.email_utils.models.EmailMessage)" href="#ragora.utils.email_utils.models.EmailMessage">EmailMessage</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>EmailMessage object to convert</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>start_sequence_idx</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Starting sequence index for this email</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.List">List</span>[<a class="autorefs autorefs-internal" title="DataChunk


  
      dataclass
   (ragora.core.chunking.DataChunk)" href="#ragora.core.chunking.DataChunk">DataChunk</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of DataChunks for this email</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/core/email_preprocessor.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">_email_to_chunks</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">email</span><span class="p">:</span> <span class="n">EmailMessage</span><span class="p">,</span> <span class="n">start_sequence_idx</span><span class="p">:</span> <span class="nb">int</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">DataChunk</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Convert an EmailMessage to data chunks.</span>

<span class="sd">    Args:</span>
<span class="sd">        email: EmailMessage object to convert</span>
<span class="sd">        start_sequence_idx: Starting sequence index for this email</span>

<span class="sd">    Returns:</span>
<span class="sd">        List of DataChunks for this email</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Clean and extract text content from email</span>
    <span class="n">email_text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">clean_email_body</span><span class="p">(</span><span class="n">email</span><span class="p">)</span>

    <span class="c1"># Create context with email metadata</span>
    <span class="n">context</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">ChunkingContextBuilder</span><span class="p">()</span>
        <span class="o">.</span><span class="n">for_email</span><span class="p">()</span>
        <span class="o">.</span><span class="n">with_email_info</span><span class="p">(</span>
            <span class="n">subject</span><span class="o">=</span><span class="n">email</span><span class="o">.</span><span class="n">subject</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="n">sender</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">email</span><span class="o">.</span><span class="n">sender</span><span class="p">)</span> <span class="k">if</span> <span class="n">email</span><span class="o">.</span><span class="n">sender</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="n">recipient</span><span class="o">=</span><span class="p">(</span>
                <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">addr</span><span class="p">)</span> <span class="k">for</span> <span class="n">addr</span> <span class="ow">in</span> <span class="n">email</span><span class="o">.</span><span class="n">recipients</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">email</span><span class="o">.</span><span class="n">recipients</span>
                <span class="k">else</span> <span class="s2">&quot;&quot;</span>
            <span class="p">),</span>
            <span class="n">email_id</span><span class="o">=</span><span class="n">email</span><span class="o">.</span><span class="n">message_id</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="n">email_date</span><span class="o">=</span><span class="p">(</span><span class="n">email</span><span class="o">.</span><span class="n">date_sent</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span> <span class="k">if</span> <span class="n">email</span><span class="o">.</span><span class="n">date_sent</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
        <span class="p">)</span>
        <span class="o">.</span><span class="n">with_start_sequence_idx</span><span class="p">(</span><span class="n">start_sequence_idx</span><span class="p">)</span>
        <span class="o">.</span><span class="n">build</span><span class="p">()</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">chunker</span><span class="o">.</span><span class="n">chunk</span><span class="p">(</span><span class="n">email_text</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="ragora.core.email_preprocessor.EmailPreprocessor._html_to_text" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">_html_to_text</span><span class="p">(</span><span class="n">html_content</span><span class="p">)</span></code>

<a href="#ragora.core.email_preprocessor.EmailPreprocessor._html_to_text" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Convert HTML content to plain text.</p>
<p>Tries multiple approaches in order: html2text, BeautifulSoup4, regex.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>html_content</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>HTML string to convert</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Plain text representation of the HTML</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/core/email_preprocessor.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">_html_to_text</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">html_content</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Convert HTML content to plain text.</span>

<span class="sd">    Tries multiple approaches in order: html2text, BeautifulSoup4, regex.</span>

<span class="sd">    Args:</span>
<span class="sd">        html_content: HTML string to convert</span>

<span class="sd">    Returns:</span>
<span class="sd">        Plain text representation of the HTML</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">html_content</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">html_content</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
        <span class="k">return</span> <span class="s2">&quot;&quot;</span>

    <span class="c1"># Try html2text first (better for email HTML)</span>
    <span class="k">if</span> <span class="n">html2text</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_html_to_text_html2text</span><span class="p">(</span><span class="n">html_content</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="c1"># Fall through to BeautifulSoup if html2text fails</span>
            <span class="k">pass</span>

    <span class="c1"># Fallback to BeautifulSoup4</span>
    <span class="k">if</span> <span class="n">BeautifulSoup</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_html_to_text_beautifulsoup</span><span class="p">(</span><span class="n">html_content</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">pass</span>

    <span class="c1"># Last resort: basic regex cleanup</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_html_to_text_regex</span><span class="p">(</span><span class="n">html_content</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="ragora.core.email_preprocessor.EmailPreprocessor._html_to_text_beautifulsoup" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">_html_to_text_beautifulsoup</span><span class="p">(</span><span class="n">html_content</span><span class="p">)</span></code>

<a href="#ragora.core.email_preprocessor.EmailPreprocessor._html_to_text_beautifulsoup" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Convert HTML content to plain text using BeautifulSoup4.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>html_content</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>HTML string to convert</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Plain text representation of the HTML</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ImportError">ImportError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If BeautifulSoup4 library is not available</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="Exception">Exception</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If conversion fails</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/core/email_preprocessor.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">_html_to_text_beautifulsoup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">html_content</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Convert HTML content to plain text using BeautifulSoup4.</span>

<span class="sd">    Args:</span>
<span class="sd">        html_content: HTML string to convert</span>

<span class="sd">    Returns:</span>
<span class="sd">        Plain text representation of the HTML</span>

<span class="sd">    Raises:</span>
<span class="sd">        ImportError: If BeautifulSoup4 library is not available</span>
<span class="sd">        Exception: If conversion fails</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">BeautifulSoup</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span><span class="s2">&quot;BeautifulSoup4 library is not available&quot;</span><span class="p">)</span>

    <span class="n">soup</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">html_content</span><span class="p">,</span> <span class="s2">&quot;html.parser&quot;</span><span class="p">)</span>
    <span class="c1"># Remove script and style elements</span>
    <span class="k">for</span> <span class="n">script</span> <span class="ow">in</span> <span class="n">soup</span><span class="p">([</span><span class="s2">&quot;script&quot;</span><span class="p">,</span> <span class="s2">&quot;style&quot;</span><span class="p">]):</span>
        <span class="n">script</span><span class="o">.</span><span class="n">decompose</span><span class="p">()</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">soup</span><span class="o">.</span><span class="n">get_text</span><span class="p">()</span>
    <span class="c1"># Clean up whitespace</span>
    <span class="n">lines</span> <span class="o">=</span> <span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">text</span><span class="o">.</span><span class="n">splitlines</span><span class="p">())</span>
    <span class="n">chunks</span> <span class="o">=</span> <span class="p">(</span><span class="n">phrase</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span> <span class="k">for</span> <span class="n">phrase</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;  &quot;</span><span class="p">))</span>
    <span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">chunk</span> <span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="n">chunks</span> <span class="k">if</span> <span class="n">chunk</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">text</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="ragora.core.email_preprocessor.EmailPreprocessor._html_to_text_html2text" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">_html_to_text_html2text</span><span class="p">(</span><span class="n">html_content</span><span class="p">)</span></code>

<a href="#ragora.core.email_preprocessor.EmailPreprocessor._html_to_text_html2text" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Convert HTML content to plain text using html2text library.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>html_content</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>HTML string to convert</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Plain text representation of the HTML</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ImportError">ImportError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If html2text library is not available</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="Exception">Exception</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If conversion fails</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/core/email_preprocessor.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">_html_to_text_html2text</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">html_content</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Convert HTML content to plain text using html2text library.</span>

<span class="sd">    Args:</span>
<span class="sd">        html_content: HTML string to convert</span>

<span class="sd">    Returns:</span>
<span class="sd">        Plain text representation of the HTML</span>

<span class="sd">    Raises:</span>
<span class="sd">        ImportError: If html2text library is not available</span>
<span class="sd">        Exception: If conversion fails</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">html2text</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span><span class="s2">&quot;html2text library is not available&quot;</span><span class="p">)</span>

    <span class="n">h</span> <span class="o">=</span> <span class="n">html2text</span><span class="o">.</span><span class="n">HTML2Text</span><span class="p">()</span>
    <span class="n">h</span><span class="o">.</span><span class="n">ignore_links</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">h</span><span class="o">.</span><span class="n">ignore_images</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">h</span><span class="o">.</span><span class="n">body_width</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># Don&#39;t wrap lines</span>
    <span class="n">h</span><span class="o">.</span><span class="n">unicode_snob</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># Use unicode</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">h</span><span class="o">.</span><span class="n">handle</span><span class="p">(</span><span class="n">html_content</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">text</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="ragora.core.email_preprocessor.EmailPreprocessor._html_to_text_regex" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">_html_to_text_regex</span><span class="p">(</span><span class="n">html_content</span><span class="p">)</span></code>

<a href="#ragora.core.email_preprocessor.EmailPreprocessor._html_to_text_regex" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Convert HTML content to plain text using basic regex cleanup.</p>
<p>This is a last-resort fallback method that uses regex to remove
HTML tags and decode common HTML entities.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>html_content</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>HTML string to convert</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Plain text representation of the HTML</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/core/email_preprocessor.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">_html_to_text_regex</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">html_content</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Convert HTML content to plain text using basic regex cleanup.</span>

<span class="sd">    This is a last-resort fallback method that uses regex to remove</span>
<span class="sd">    HTML tags and decode common HTML entities.</span>

<span class="sd">    Args:</span>
<span class="sd">        html_content: HTML string to convert</span>

<span class="sd">    Returns:</span>
<span class="sd">        Plain text representation of the HTML</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Remove HTML tags</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;&lt;[^&gt;]+&gt;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">html_content</span><span class="p">)</span>
    <span class="c1"># Decode common HTML entities</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&amp;nbsp;&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">)</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&amp;amp;&quot;</span><span class="p">,</span> <span class="s2">&quot;&amp;&quot;</span><span class="p">)</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&amp;lt;&quot;</span><span class="p">,</span> <span class="s2">&quot;&lt;&quot;</span><span class="p">)</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&amp;gt;&quot;</span><span class="p">,</span> <span class="s2">&quot;&gt;&quot;</span><span class="p">)</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&amp;quot;&quot;</span><span class="p">,</span> <span class="s1">&#39;&quot;&#39;</span><span class="p">)</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&amp;#39;&quot;</span><span class="p">,</span> <span class="s2">&quot;&#39;&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">text</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="ragora.core.email_preprocessor.EmailPreprocessor._normalize_whitespace" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">_normalize_whitespace</span><span class="p">(</span><span class="n">text</span><span class="p">)</span></code>

<a href="#ragora.core.email_preprocessor.EmailPreprocessor._normalize_whitespace" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Normalize whitespace in text.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>text</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Text to normalize</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Text with normalized whitespace</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/core/email_preprocessor.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">_normalize_whitespace</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Normalize whitespace in text.</span>

<span class="sd">    Args:</span>
<span class="sd">        text: Text to normalize</span>

<span class="sd">    Returns:</span>
<span class="sd">        Text with normalized whitespace</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">text</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;&quot;</span>

    <span class="c1"># Replace multiple spaces with single space</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot; +&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
    <span class="c1"># Replace multiple newlines with maximum of two</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\n{3,}&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
    <span class="c1"># Remove trailing whitespace from each line</span>
    <span class="n">lines</span> <span class="o">=</span> <span class="p">[</span><span class="n">line</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)]</span>
    <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="ragora.core.email_preprocessor.EmailPreprocessor._strip_quoted_replies" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">_strip_quoted_replies</span><span class="p">(</span><span class="n">text</span><span class="p">)</span></code>

<a href="#ragora.core.email_preprocessor.EmailPreprocessor._strip_quoted_replies" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Strip quoted reply sections from email text.</p>
<p>Tries email_reply_parser library first, falls back to regex approach.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>text</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Email text that may contain quoted replies</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Text with quoted replies removed</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/core/email_preprocessor.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">_strip_quoted_replies</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Strip quoted reply sections from email text.</span>

<span class="sd">    Tries email_reply_parser library first, falls back to regex approach.</span>

<span class="sd">    Args:</span>
<span class="sd">        text: Email text that may contain quoted replies</span>

<span class="sd">    Returns:</span>
<span class="sd">        Text with quoted replies removed</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">text</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">text</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
        <span class="k">return</span> <span class="s2">&quot;&quot;</span>

    <span class="k">if</span> <span class="n">EmailReplyParser</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_strip_quoted_replies_library</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="c1"># Fall through to regex-based approach if library fails</span>
            <span class="k">pass</span>

    <span class="c1"># Fallback regex-based approach for common reply patterns</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_strip_quoted_replies_regex</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="ragora.core.email_preprocessor.EmailPreprocessor._strip_quoted_replies_library" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">_strip_quoted_replies_library</span><span class="p">(</span><span class="n">text</span><span class="p">)</span></code>

<a href="#ragora.core.email_preprocessor.EmailPreprocessor._strip_quoted_replies_library" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Strip quoted reply sections using email_reply_parser library.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>text</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Email text that may contain quoted replies</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Text with quoted replies removed</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ImportError">ImportError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If email_reply_parser library is not available</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="Exception">Exception</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If parsing fails</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/core/email_preprocessor.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">_strip_quoted_replies_library</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Strip quoted reply sections using email_reply_parser library.</span>

<span class="sd">    Args:</span>
<span class="sd">        text: Email text that may contain quoted replies</span>

<span class="sd">    Returns:</span>
<span class="sd">        Text with quoted replies removed</span>

<span class="sd">    Raises:</span>
<span class="sd">        ImportError: If email_reply_parser library is not available</span>
<span class="sd">        Exception: If parsing fails</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">EmailReplyParser</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span><span class="s2">&quot;email_reply_parser library is not available&quot;</span><span class="p">)</span>

    <span class="c1"># Parse the email to get the actual reply</span>
    <span class="n">parsed</span> <span class="o">=</span> <span class="n">EmailReplyParser</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
    <span class="c1"># Extract only the visible (non-quoted) text</span>
    <span class="c1"># Use parsed.reply which contains the reply text without quotes</span>
    <span class="n">reply</span> <span class="o">=</span> <span class="n">parsed</span><span class="o">.</span><span class="n">reply</span>
    <span class="k">if</span> <span class="n">reply</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">reply</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
    <span class="k">return</span> <span class="s2">&quot;&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="ragora.core.email_preprocessor.EmailPreprocessor._strip_quoted_replies_regex" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">_strip_quoted_replies_regex</span><span class="p">(</span><span class="n">text</span><span class="p">)</span></code>

<a href="#ragora.core.email_preprocessor.EmailPreprocessor._strip_quoted_replies_regex" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Strip quoted reply sections using regex-based approach.</p>
<p>This is a fallback method that uses regex patterns to identify
and remove common quoted reply formats.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>text</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Email text that may contain quoted replies</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Text with quoted replies removed</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/core/email_preprocessor.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">_strip_quoted_replies_regex</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Strip quoted reply sections using regex-based approach.</span>

<span class="sd">    This is a fallback method that uses regex patterns to identify</span>
<span class="sd">    and remove common quoted reply formats.</span>

<span class="sd">    Args:</span>
<span class="sd">        text: Email text that may contain quoted replies</span>

<span class="sd">    Returns:</span>
<span class="sd">        Text with quoted replies removed</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">lines</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">cleaned_lines</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">in_quoted_section</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">in_header_block</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="c1"># Patterns that indicate start of quoted section</span>
    <span class="n">quote_start_patterns</span> <span class="o">=</span> <span class="p">[</span>
        <span class="sa">r</span><span class="s2">&quot;^On .+ wrote:&quot;</span><span class="p">,</span>
        <span class="sa">r</span><span class="s2">&quot;^From:&quot;</span><span class="p">,</span>
        <span class="sa">r</span><span class="s2">&quot;^-----Original Message-----&quot;</span><span class="p">,</span>
        <span class="sa">r</span><span class="s2">&quot;^&gt;+&quot;</span><span class="p">,</span>
        <span class="sa">r</span><span class="s2">&quot;^--- .+ ---&quot;</span><span class="p">,</span>
        <span class="sa">r</span><span class="s2">&quot;^_{5,}&quot;</span><span class="p">,</span>
        <span class="sa">r</span><span class="s2">&quot;^={5,}&quot;</span><span class="p">,</span>
    <span class="p">]</span>

    <span class="c1"># Patterns for email headers (usually follow &quot;From:&quot; in quotes)</span>
    <span class="n">email_header_pattern</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;^[A-Z][a-zA-Z-]+:&quot;</span>

    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
        <span class="c1"># Check if this line starts a quoted section</span>
        <span class="n">is_quote_start</span> <span class="o">=</span> <span class="nb">any</span><span class="p">(</span>
            <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">line</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">pattern</span> <span class="ow">in</span> <span class="n">quote_start_patterns</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">is_quote_start</span><span class="p">:</span>
            <span class="n">in_quoted_section</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">in_header_block</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">continue</span>

        <span class="c1"># If we hit a blank line after being in quoted section,</span>
        <span class="c1"># we might be transitioning, but continue checking</span>
        <span class="k">if</span> <span class="n">in_quoted_section</span><span class="p">:</span>
            <span class="c1"># Check if line is an email header (part of quote metadata)</span>
            <span class="n">is_email_header</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">email_header_pattern</span><span class="p">,</span> <span class="n">line</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">is_email_header</span><span class="p">:</span>
                <span class="n">in_header_block</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">continue</span>

            <span class="c1"># After email headers, if we see a blank line,</span>
            <span class="c1"># mark that we&#39;re past the header block</span>
            <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">in_header_block</span><span class="p">:</span>
                    <span class="n">in_header_block</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">continue</span>

            <span class="c1"># After headers, everything until we see clear break</span>
            <span class="c1"># is quoted content</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">in_header_block</span><span class="p">:</span>
                <span class="c1"># This is content after headers - should be quoted</span>
                <span class="k">continue</span>

            <span class="c1"># If we get here, might be actual content again</span>
            <span class="c1"># Exit quoted section if we have content before</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">cleaned_lines</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">in_quoted_section</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="n">in_header_block</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="n">cleaned_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># No content yet, might still be in quote</span>
                <span class="n">in_header_block</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">continue</span>

        <span class="n">in_header_block</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">cleaned_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>

    <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">cleaned_lines</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="ragora.core.email_preprocessor.EmailPreprocessor._strip_signatures" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">_strip_signatures</span><span class="p">(</span><span class="n">text</span><span class="p">)</span></code>

<a href="#ragora.core.email_preprocessor.EmailPreprocessor._strip_signatures" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Strip email signatures from text.</p>
<p>Uses regex patterns to identify and remove common signature formats.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>text</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Email text that may contain signatures</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Text with signatures removed</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/core/email_preprocessor.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">_strip_signatures</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Strip email signatures from text.</span>

<span class="sd">    Uses regex patterns to identify and remove common signature formats.</span>

<span class="sd">    Args:</span>
<span class="sd">        text: Email text that may contain signatures</span>

<span class="sd">    Returns:</span>
<span class="sd">        Text with signatures removed</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">text</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">text</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
        <span class="k">return</span> <span class="s2">&quot;&quot;</span>

    <span class="n">lines</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">cleaned_lines</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">signature_started</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">consecutive_blank_lines</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lines</span><span class="p">):</span>
        <span class="c1"># Check if this line starts a signature</span>
        <span class="n">is_signature_start</span> <span class="o">=</span> <span class="nb">any</span><span class="p">(</span>
            <span class="n">pattern</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="k">for</span> <span class="n">pattern</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_SIGNATURE_INDICATOR_PATTERNS</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">is_signature_start</span><span class="p">:</span>
            <span class="n">signature_started</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">consecutive_blank_lines</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="c1"># Don&#39;t include this line</span>
            <span class="k">continue</span>

        <span class="k">if</span> <span class="n">signature_started</span><span class="p">:</span>
            <span class="c1"># Track consecutive blank lines - multiple blank lines might</span>
            <span class="c1"># indicate end of signature, but we need to be careful</span>
            <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                <span class="n">consecutive_blank_lines</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="c1"># If we have 2+ consecutive blank lines, check if we&#39;re</span>
                <span class="c1"># past signature</span>
                <span class="k">if</span> <span class="n">consecutive_blank_lines</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="c1"># Look ahead to see if there&#39;s actual content</span>
                    <span class="n">next_non_blank_idx</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
                    <span class="k">while</span> <span class="p">(</span>
                        <span class="n">next_non_blank_idx</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>
                        <span class="ow">and</span> <span class="n">lines</span><span class="p">[</span><span class="n">next_non_blank_idx</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span>
                    <span class="p">):</span>
                        <span class="n">next_non_blank_idx</span> <span class="o">+=</span> <span class="mi">1</span>

                    <span class="k">if</span> <span class="n">next_non_blank_idx</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="p">):</span>
                        <span class="n">next_line</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="n">next_non_blank_idx</span><span class="p">]</span>
                        <span class="c1"># Check if next line looks like signature content</span>
                        <span class="n">is_signature_content</span> <span class="o">=</span> <span class="nb">any</span><span class="p">(</span>
                            <span class="n">pattern</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">next_line</span><span class="p">)</span>
                            <span class="k">for</span> <span class="n">pattern</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_SIGNATURE_CONTENT_PATTERNS</span>
                        <span class="p">)</span> <span class="ow">or</span> <span class="nb">any</span><span class="p">(</span>
                            <span class="n">pattern</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">next_line</span><span class="p">)</span>
                            <span class="k">for</span> <span class="n">pattern</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_SIGNATURE_INDICATOR_PATTERNS</span>
                        <span class="p">)</span>

                        <span class="k">if</span> <span class="ow">not</span> <span class="n">is_signature_content</span><span class="p">:</span>
                            <span class="c1"># We&#39;ve hit multiple blank lines followed by</span>
                            <span class="c1"># non-signature content. This likely means</span>
                            <span class="c1"># we&#39;re past the signature</span>
                            <span class="n">signature_started</span> <span class="o">=</span> <span class="kc">False</span>
                            <span class="n">consecutive_blank_lines</span> <span class="o">=</span> <span class="mi">0</span>
                            <span class="c1"># Include the blank lines as they&#39;re part of</span>
                            <span class="c1"># the break</span>
                            <span class="n">cleaned_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
                            <span class="k">continue</span>

                <span class="c1"># Still in signature, skip blank lines</span>
                <span class="k">continue</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Reset blank line counter for non-blank lines</span>
                <span class="n">consecutive_blank_lines</span> <span class="o">=</span> <span class="mi">0</span>

                <span class="c1"># Check if line looks like signature content</span>
                <span class="n">is_signature_content</span> <span class="o">=</span> <span class="nb">any</span><span class="p">(</span>
                    <span class="n">pattern</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">pattern</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_SIGNATURE_CONTENT_PATTERNS</span>
                <span class="p">)</span>

                <span class="k">if</span> <span class="n">is_signature_content</span><span class="p">:</span>
                    <span class="c1"># Definitely signature content, skip it</span>
                    <span class="k">continue</span>

                <span class="c1"># Line doesn&#39;t match signature patterns, but we&#39;re after</span>
                <span class="c1"># a signature delimiter. Continue skipping unless we see</span>
                <span class="c1"># a clear break (handled by blank line logic above).</span>
                <span class="c1"># This handles names, titles, and other signature</span>
                <span class="c1"># elements that don&#39;t match patterns</span>
                <span class="k">continue</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">consecutive_blank_lines</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">cleaned_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>

    <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">cleaned_lines</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="ragora.core.email_preprocessor.EmailPreprocessor.clean_email_body" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">clean_email_body</span><span class="p">(</span><span class="n">email</span><span class="p">)</span></code>

<a href="#ragora.core.email_preprocessor.EmailPreprocessor.clean_email_body" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Clean email body by converting HTML, stripping replies,
and removing signatures.</p>
<p>This method orchestrates all cleaning steps:
1. Extract body (HTML preferred, fallback to text)
2. Convert HTML to text (if HTML exists)
3. Strip quoted replies
4. Strip signatures
5. Normalize whitespace</p>
<p>This method can be used independently to get clean email text
for processing with LLMs or other text analysis tools without
chunking the content.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>email</code>
            </td>
            <td>
                  <code><span title="typing.Union">Union</span>[<a class="autorefs autorefs-internal" title="EmailMessage


  
      dataclass
   (ragora.utils.email_utils.models.EmailMessage)" href="#ragora.utils.email_utils.models.EmailMessage">EmailMessage</a>, <a class="autorefs autorefs-internal" title="EmailMessageModel (ragora.core.models.EmailMessageModel)" href="#ragora.core.models.EmailMessageModel">EmailMessageModel</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>EmailMessage or EmailMessageModel object to clean (both have
the same interface: get_body(), body_html, body_text)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Cleaned plain text content. Returns empty string if email</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>has no body content.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="example" open>
  <summary>Example</summary>
  <blockquote>
<blockquote>
<blockquote>
<p>from ragora import EmailPreprocessor
from ragora.utils.email_utils.models import EmailMessage
from ragora.core.models import EmailMessageModel</p>
<p>preprocessor = EmailPreprocessor()</p>
<h6 id="ragora.core.email_preprocessor.EmailPreprocessor.clean_email_body--works-with-emailmessage">Works with EmailMessage<a class="headerlink" href="#ragora.core.email_preprocessor.EmailPreprocessor.clean_email_body--works-with-emailmessage" title="Permanent link">&para;</a></h6>
<p>clean_text = preprocessor.clean_email_body(email_message)</p>
<h6 id="ragora.core.email_preprocessor.EmailPreprocessor.clean_email_body--also-works-with-emailmessagemodel">Also works with EmailMessageModel<a class="headerlink" href="#ragora.core.email_preprocessor.EmailPreprocessor.clean_email_body--also-works-with-emailmessagemodel" title="Permanent link">&para;</a></h6>
<p>clean_text = preprocessor.clean_email_body(email_item)</p>
<h6 id="ragora.core.email_preprocessor.EmailPreprocessor.clean_email_body--use-clean_text-with-llm-or-other-processing">Use clean_text with LLM or other processing<a class="headerlink" href="#ragora.core.email_preprocessor.EmailPreprocessor.clean_email_body--use-clean_text-with-llm-or-other-processing" title="Permanent link">&para;</a></h6>
</blockquote>
</blockquote>
</blockquote>
</details>

            <details class="quote">
              <summary>Source code in <code>ragora/ragora/core/email_preprocessor.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">clean_email_body</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">email</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">EmailMessage</span><span class="p">,</span> <span class="n">EmailMessageModel</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Clean email body by converting HTML, stripping replies,</span>
<span class="sd">    and removing signatures.</span>

<span class="sd">    This method orchestrates all cleaning steps:</span>
<span class="sd">    1. Extract body (HTML preferred, fallback to text)</span>
<span class="sd">    2. Convert HTML to text (if HTML exists)</span>
<span class="sd">    3. Strip quoted replies</span>
<span class="sd">    4. Strip signatures</span>
<span class="sd">    5. Normalize whitespace</span>

<span class="sd">    This method can be used independently to get clean email text</span>
<span class="sd">    for processing with LLMs or other text analysis tools without</span>
<span class="sd">    chunking the content.</span>

<span class="sd">    Args:</span>
<span class="sd">        email: EmailMessage or EmailMessageModel object to clean (both have</span>
<span class="sd">            the same interface: get_body(), body_html, body_text)</span>

<span class="sd">    Returns:</span>
<span class="sd">        Cleaned plain text content. Returns empty string if email</span>
<span class="sd">        has no body content.</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; from ragora import EmailPreprocessor</span>
<span class="sd">        &gt;&gt;&gt; from ragora.utils.email_utils.models import EmailMessage</span>
<span class="sd">        &gt;&gt;&gt; from ragora.core.models import EmailMessageModel</span>
<span class="sd">        &gt;&gt;&gt;</span>
<span class="sd">        &gt;&gt;&gt; preprocessor = EmailPreprocessor()</span>
<span class="sd">        &gt;&gt;&gt; # Works with EmailMessage</span>
<span class="sd">        &gt;&gt;&gt; clean_text = preprocessor.clean_email_body(email_message)</span>
<span class="sd">        &gt;&gt;&gt; # Also works with EmailMessageModel</span>
<span class="sd">        &gt;&gt;&gt; clean_text = preprocessor.clean_email_body(email_item)</span>
<span class="sd">        &gt;&gt;&gt; # Use clean_text with LLM or other processing</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Step 1: Extract body (HTML preferred, fallback to text)</span>
    <span class="n">body</span> <span class="o">=</span> <span class="n">email</span><span class="o">.</span><span class="n">get_body</span><span class="p">()</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">body</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">body</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
        <span class="k">return</span> <span class="s2">&quot;&quot;</span>

    <span class="c1"># Step 2: Convert HTML to text if it&#39;s HTML</span>
    <span class="c1"># Check if body is HTML by looking at email.body_html</span>
    <span class="c1"># or by checking if body contains HTML tags</span>
    <span class="n">is_html</span> <span class="o">=</span> <span class="n">email</span><span class="o">.</span><span class="n">body_html</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">email</span><span class="o">.</span><span class="n">body_html</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">is_html</span><span class="p">:</span>
        <span class="c1"># Also check if body_text itself contains HTML tags</span>
        <span class="n">is_html</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;&lt;[^&gt;]+&gt;&quot;</span><span class="p">,</span> <span class="n">body</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">is_html</span><span class="p">:</span>
        <span class="n">text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_html_to_text</span><span class="p">(</span><span class="n">body</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">text</span> <span class="o">=</span> <span class="n">body</span>

    <span class="c1"># Step 3: Strip quoted replies</span>
    <span class="n">text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_strip_quoted_replies</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>

    <span class="c1"># Step 4: Strip signatures</span>
    <span class="n">text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_strip_signatures</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>

    <span class="c1"># Step 5: Normalize whitespace</span>
    <span class="n">text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_normalize_whitespace</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">text</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="ragora.core.email_preprocessor.EmailPreprocessor.preprocess_email" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">preprocess_email</span><span class="p">(</span><span class="n">email</span><span class="p">,</span> <span class="n">start_sequence_idx</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span></code>

<a href="#ragora.core.email_preprocessor.EmailPreprocessor.preprocess_email" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Preprocess a single email into data chunks.</p>
<p>This method converts a single EmailMessage object into DataChunks
for storage in the vector database.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>email</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="EmailMessage


  
      dataclass
   (ragora.utils.email_utils.models.EmailMessage)" href="#ragora.utils.email_utils.models.EmailMessage">EmailMessage</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>EmailMessage object to preprocess</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>start_sequence_idx</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Starting sequence index for this email</p>
              </div>
            </td>
            <td>
                  <code>0</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.List">List</span>[<a class="autorefs autorefs-internal" title="DataChunk


  
      dataclass
   (ragora.core.chunking.DataChunk)" href="#ragora.core.chunking.DataChunk">DataChunk</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of DataChunks containing the email message</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/core/email_preprocessor.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">preprocess_email</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">email</span><span class="p">:</span> <span class="n">EmailMessage</span><span class="p">,</span> <span class="n">start_sequence_idx</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">DataChunk</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Preprocess a single email into data chunks.</span>

<span class="sd">    This method converts a single EmailMessage object into DataChunks</span>
<span class="sd">    for storage in the vector database.</span>

<span class="sd">    Args:</span>
<span class="sd">        email: EmailMessage object to preprocess</span>
<span class="sd">        start_sequence_idx: Starting sequence index for this email</span>

<span class="sd">    Returns:</span>
<span class="sd">        List of DataChunks containing the email message</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_email_to_chunks</span><span class="p">(</span><span class="n">email</span><span class="p">,</span> <span class="n">start_sequence_idx</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="ragora.core.email_preprocessor.EmailPreprocessor.preprocess_emails" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">preprocess_emails</span><span class="p">(</span><span class="n">emails</span><span class="p">,</span> <span class="n">start_sequence_idx</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span></code>

<a href="#ragora.core.email_preprocessor.EmailPreprocessor.preprocess_emails" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Preprocess multiple emails into data chunks.</p>
<p>This method converts a list of EmailMessage objects into DataChunks
for storage in the vector database.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>emails</code>
            </td>
            <td>
                  <code><span title="typing.List">List</span>[<a class="autorefs autorefs-internal" title="EmailMessage


  
      dataclass
   (ragora.utils.email_utils.models.EmailMessage)" href="#ragora.utils.email_utils.models.EmailMessage">EmailMessage</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of EmailMessage objects to preprocess</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>start_sequence_idx</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Starting sequence index for the emails</p>
              </div>
            </td>
            <td>
                  <code>0</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.List">List</span>[<a class="autorefs autorefs-internal" title="DataChunk


  
      dataclass
   (ragora.core.chunking.DataChunk)" href="#ragora.core.chunking.DataChunk">DataChunk</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of DataChunks containing the email messages</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/core/email_preprocessor.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">preprocess_emails</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">emails</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">EmailMessage</span><span class="p">],</span> <span class="n">start_sequence_idx</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">DataChunk</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Preprocess multiple emails into data chunks.</span>

<span class="sd">    This method converts a list of EmailMessage objects into DataChunks</span>
<span class="sd">    for storage in the vector database.</span>

<span class="sd">    Args:</span>
<span class="sd">        emails: List of EmailMessage objects to preprocess</span>
<span class="sd">        start_sequence_idx: Starting sequence index for the emails</span>

<span class="sd">    Returns:</span>
<span class="sd">        List of DataChunks containing the email messages</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">all_chunks</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">chunk_idx_counter</span> <span class="o">=</span> <span class="n">start_sequence_idx</span>

    <span class="k">for</span> <span class="n">email</span> <span class="ow">in</span> <span class="n">emails</span><span class="p">:</span>
        <span class="n">chunks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_email_to_chunks</span><span class="p">(</span><span class="n">email</span><span class="p">,</span> <span class="n">chunk_idx_counter</span><span class="p">)</span>
        <span class="n">all_chunks</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">chunks</span><span class="p">)</span>
        <span class="n">chunk_idx_counter</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">chunks</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">all_chunks</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div><h3 id="embedding-engine">Embedding Engine<a class="headerlink" href="#embedding-engine" title="Permanent link">&para;</a></h3>


<div class="doc doc-object doc-module">



<a id="ragora.core.embedding_engine"></a>
    <div class="doc doc-contents first">

        <p>Client-side embedding helpers built on top of Sentence Transformers.</p>










  <div class="doc doc-children">









<div class="doc doc-object doc-class">



<h4 id="ragora.core.embedding_engine.EmbeddingEngine" class="doc doc-heading">
            <code>EmbeddingEngine</code>


<a href="#ragora.core.embedding_engine.EmbeddingEngine" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">


        <p>Convert raw text into dense vector embeddings.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="ragora.core.embedding_engine.EmbeddingEngine.model">model</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Loaded <code>SentenceTransformer</code> instance.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="ragora.core.embedding_engine.EmbeddingEngine.model_name">model_name</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Name used to initialize the model.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="ragora.core.embedding_engine.EmbeddingEngine.embedding_dimension">embedding_dimension</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dimensionality of the produced vectors.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="ragora.core.embedding_engine.EmbeddingEngine.logger">logger</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Module logger.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">ragora.core.embedding_engine</span><span class="w"> </span><span class="kn">import</span> <span class="n">EmbeddingEngine</span>

<span class="n">engine</span> <span class="o">=</span> <span class="n">EmbeddingEngine</span><span class="p">(</span><span class="n">model_name</span><span class="o">=</span><span class="s2">&quot;all-mpnet-base-v2&quot;</span><span class="p">)</span>
<span class="n">vector</span> <span class="o">=</span> <span class="n">engine</span><span class="o">.</span><span class="n">embed_text</span><span class="p">(</span><span class="s2">&quot;Ragora makes RAG pipelines easier.&quot;</span><span class="p">)</span>
</code></pre></div>








              <details class="quote">
                <summary>Source code in <code>ragora/ragora/core/embedding_engine.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">EmbeddingEngine</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Convert raw text into dense vector embeddings.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        model: Loaded `SentenceTransformer` instance.</span>
<span class="sd">        model_name: Name used to initialize the model.</span>
<span class="sd">        embedding_dimension: Dimensionality of the produced vectors.</span>
<span class="sd">        logger: Module logger.</span>

<span class="sd">    Examples:</span>
<span class="sd">        ```python</span>
<span class="sd">        from ragora.core.embedding_engine import EmbeddingEngine</span>

<span class="sd">        engine = EmbeddingEngine(model_name=&quot;all-mpnet-base-v2&quot;)</span>
<span class="sd">        vector = engine.embed_text(&quot;Ragora makes RAG pipelines easier.&quot;)</span>
<span class="sd">        ```</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Supported models with their specifications</span>
    <span class="n">SUPPORTED_MODELS</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;all-mpnet-base-v2&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;dimension&quot;</span><span class="p">:</span> <span class="mi">768</span><span class="p">,</span>
            <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;High-quality embeddings for technical content&quot;</span><span class="p">,</span>
            <span class="s2">&quot;pooling_strategy&quot;</span><span class="p">:</span> <span class="s2">&quot;masked_mean&quot;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="s2">&quot;multi-qa-MiniLM-L6-v2&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;dimension&quot;</span><span class="p">:</span> <span class="mi">384</span><span class="p">,</span>
            <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;Optimized for Q&amp;A tasks, faster inference&quot;</span><span class="p">,</span>
            <span class="s2">&quot;pooling_strategy&quot;</span><span class="p">:</span> <span class="s2">&quot;mean&quot;</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">}</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">model_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;all-mpnet-base-v2&quot;</span><span class="p">,</span>
        <span class="n">device</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">cache_folder</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the EmbeddingEngine.</span>

<span class="sd">        Args:</span>
<span class="sd">            model_name: Name of the Sentence Transformer model to use</span>
<span class="sd">            device: Device to run the model on (&#39;cpu&#39;, &#39;cuda&#39;, &#39;mps&#39;, or None</span>
<span class="sd">                for auto). If None, will automatically select the optimal device</span>
<span class="sd">                for the current platform.</span>
<span class="sd">            cache_folder: Folder to cache the model files</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If model_name is not supported</span>
<span class="sd">            ImportError: If sentence-transformers is not installed</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">model_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">SUPPORTED_MODELS</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Model &#39;</span><span class="si">{</span><span class="n">model_name</span><span class="si">}</span><span class="s2">&#39; not supported. &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;Supported models: </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">SUPPORTED_MODELS</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">model_name</span> <span class="o">=</span> <span class="n">model_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">embedding_dimension</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SUPPORTED_MODELS</span><span class="p">[</span><span class="n">model_name</span><span class="p">][</span><span class="s2">&quot;dimension&quot;</span><span class="p">]</span>

        <span class="c1"># Set up logging</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

        <span class="c1"># Auto-select device if not provided</span>
        <span class="k">if</span> <span class="n">device</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">device</span> <span class="o">=</span> <span class="n">get_sentence_transformer_device</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Auto-selected device: </span><span class="si">{</span><span class="n">device</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Initialize the Sentence Transformer model</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Loading Sentence Transformer model: </span><span class="si">{</span><span class="n">model_name</span><span class="si">}</span><span class="s2"> on device: </span><span class="si">{</span><span class="n">device</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">SentenceTransformer</span><span class="p">(</span>
                <span class="n">model_name</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">,</span> <span class="n">cache_folder</span><span class="o">=</span><span class="n">cache_folder</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Successfully loaded model: </span><span class="si">{</span><span class="n">model_name</span><span class="si">}</span><span class="s2"> on device: </span><span class="si">{</span><span class="n">device</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to load model </span><span class="si">{</span><span class="n">model_name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not load Sentence Transformer model: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">embed_text</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate embedding for a single text string.</span>

<span class="sd">        Args:</span>
<span class="sd">            text: Text to embed</span>

<span class="sd">        Returns:</span>
<span class="sd">            np.ndarray: Vector embedding of the text</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If text is empty or None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">text</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">text</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Text cannot be empty or None&quot;</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">embedding</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">convert_to_numpy</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">embedding</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to generate embedding for text: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">raise</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">embed_chunk</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">chunk</span><span class="p">:</span> <span class="n">DataChunk</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate embedding for a DataChunk object.</span>

<span class="sd">        Args:</span>
<span class="sd">            chunk: DataChunk object containing text and metadata</span>

<span class="sd">        Returns:</span>
<span class="sd">            np.ndarray: Vector embedding of the chunk text</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If chunk is None or has empty text</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">chunk</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Chunk cannot be None&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">embed_text</span><span class="p">(</span><span class="n">chunk</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">embed_chunks</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">chunks</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">DataChunk</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate embeddings for multiple DataChunk objects.</span>

<span class="sd">        Args:</span>
<span class="sd">            chunks: List of DataChunk objects</span>

<span class="sd">        Returns:</span>
<span class="sd">            List[np.ndarray]: List of vector embeddings</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If chunks list is empty or contains invalid chunks</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">chunks</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Chunks list cannot be empty&quot;</span><span class="p">)</span>

        <span class="c1"># Extract text from chunks</span>
        <span class="n">texts</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">chunks</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">chunk</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">chunk</span><span class="o">.</span><span class="n">text</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">chunk</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Skipping invalid chunk at index </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">continue</span>
            <span class="n">texts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chunk</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">texts</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No valid text found in chunks&quot;</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Generating embeddings for </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">texts</span><span class="p">)</span><span class="si">}</span><span class="s2"> chunks&quot;</span><span class="p">)</span>
            <span class="n">embeddings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
                <span class="n">texts</span><span class="p">,</span> <span class="n">convert_to_numpy</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">show_progress_bar</span><span class="o">=</span><span class="kc">True</span>
            <span class="p">)</span>

            <span class="c1"># Convert to list of numpy arrays</span>
            <span class="n">embedding_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">embeddings</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">embeddings</span><span class="p">))]</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Successfully generated </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">embedding_list</span><span class="p">)</span><span class="si">}</span><span class="s2"> embeddings&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">embedding_list</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to generate embeddings for chunks: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">raise</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">embed_texts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">texts</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate embeddings for a list of text strings.</span>

<span class="sd">        Args:</span>
<span class="sd">            texts: List of text strings to embed</span>

<span class="sd">        Returns:</span>
<span class="sd">            List[np.ndarray]: List of vector embeddings</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If texts list is empty or contains invalid strings</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">texts</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Texts list cannot be empty&quot;</span><span class="p">)</span>

        <span class="c1"># Filter out empty texts</span>
        <span class="n">valid_texts</span> <span class="o">=</span> <span class="p">[</span><span class="n">text</span> <span class="k">for</span> <span class="n">text</span> <span class="ow">in</span> <span class="n">texts</span> <span class="k">if</span> <span class="n">text</span> <span class="ow">and</span> <span class="n">text</span><span class="o">.</span><span class="n">strip</span><span class="p">()]</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">valid_texts</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No valid text found in texts list&quot;</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Generating embeddings for </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">valid_texts</span><span class="p">)</span><span class="si">}</span><span class="s2"> texts&quot;</span><span class="p">)</span>
            <span class="n">embeddings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
                <span class="n">valid_texts</span><span class="p">,</span> <span class="n">convert_to_numpy</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">show_progress_bar</span><span class="o">=</span><span class="kc">True</span>
            <span class="p">)</span>

            <span class="c1"># Convert to list of numpy arrays</span>
            <span class="n">embedding_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">embeddings</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">embeddings</span><span class="p">))]</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Successfully generated </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">embedding_list</span><span class="p">)</span><span class="si">}</span><span class="s2"> embeddings&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">embedding_list</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to generate embeddings for texts: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">raise</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_embedding_dimension</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the dimension of embeddings produced by this engine.</span>

<span class="sd">        Returns:</span>
<span class="sd">            int: Dimension of the embeddings</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">embedding_dimension</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_model_info</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get information about the current model.</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict: Model information including name, dimension, and</span>
<span class="sd">                description</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;model_name&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_name</span><span class="p">,</span>
            <span class="s2">&quot;dimension&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">embedding_dimension</span><span class="p">,</span>
            <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">SUPPORTED_MODELS</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">model_name</span><span class="p">][</span><span class="s2">&quot;description&quot;</span><span class="p">],</span>
            <span class="s2">&quot;pooling_strategy&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">SUPPORTED_MODELS</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">model_name</span><span class="p">][</span>
                <span class="s2">&quot;pooling_strategy&quot;</span>
            <span class="p">],</span>
        <span class="p">}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">similarity</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">embedding1</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">embedding2</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">method</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;cosine&quot;</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculate similarity between two embeddings using specified method.</span>

<span class="sd">        This function provides a unified interface for different similarity</span>
<span class="sd">        measures, allowing you to choose the most appropriate method for your</span>
<span class="sd">        use case.</span>

<span class="sd">        Method Comparison:</span>
<span class="sd">        - &quot;cosine&quot;: Measures angular similarity (direction-based)</span>
<span class="sd">          * Range: [-1, 1] where higher values = more similar</span>
<span class="sd">          * Best for: Semantic similarity, normalized vectors</span>
<span class="sd">          * Interpretation: 1.0=identical, 0.0=unrelated, -1.0=opposite</span>

<span class="sd">        - &quot;euclidean&quot;: Measures geometric distance (magnitude-based)</span>
<span class="sd">          * Range: [0, ) where lower values = more similar</span>
<span class="sd">          * Best for: Absolute differences, magnitude-sensitive comparisons</span>
<span class="sd">          * Interpretation: 0.0=identical, higher values=more different</span>

<span class="sd">        Args:</span>
<span class="sd">            embedding1: First embedding vector</span>
<span class="sd">            embedding2: Second embedding vector</span>
<span class="sd">            method: Similarity method to use (&quot;cosine&quot; or &quot;euclidean&quot;)</span>

<span class="sd">        Returns:</span>
<span class="sd">            float: Similarity score</span>
<span class="sd">            - For cosine: score between -1 and 1 (higher = more similar)</span>
<span class="sd">            - For euclidean: distance between 0 and  (lower = more similar)</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If embeddings have different dimensions or invalid</span>
<span class="sd">                method</span>

<span class="sd">        Examples:</span>
<span class="sd">            &gt;&gt;&gt; engine = EmbeddingEngine()</span>
<span class="sd">            &gt;&gt;&gt; vec1 = np.array([1.0, 0.0, 0.0])</span>
<span class="sd">            &gt;&gt;&gt; vec2 = np.array([0.0, 1.0, 0.0])</span>
<span class="sd">            &gt;&gt;&gt;</span>
<span class="sd">            &gt;&gt;&gt; # Cosine similarity (default)</span>
<span class="sd">            &gt;&gt;&gt; engine.similarity(vec1, vec2)  # Returns 0.0 (orthogonal)</span>
<span class="sd">            &gt;&gt;&gt;</span>
<span class="sd">            &gt;&gt;&gt; # Euclidean distance</span>
<span class="sd">            &gt;&gt;&gt; engine.similarity(vec1, vec2, method=&quot;euclidean&quot;)</span>
<span class="sd">            &gt;&gt;&gt; # Returns 1.414</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">embedding1</span><span class="o">.</span><span class="n">shape</span> <span class="o">!=</span> <span class="n">embedding2</span><span class="o">.</span><span class="n">shape</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Embeddings must have the same dimension&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">method</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;cosine&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cosine_similarity</span><span class="p">(</span><span class="n">embedding1</span><span class="p">,</span> <span class="n">embedding2</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">method</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;euclidean&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_euclidean_distance</span><span class="p">(</span><span class="n">embedding1</span><span class="p">,</span> <span class="n">embedding2</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Invalid similarity method &#39;</span><span class="si">{</span><span class="n">method</span><span class="si">}</span><span class="s2">&#39;. &quot;</span>
                <span class="s2">&quot;Supported methods: &#39;cosine&#39;, &#39;euclidean&#39;&quot;</span>
            <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_cosine_similarity</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">embedding1</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">embedding2</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculate cosine similarity between two embeddings.</span>

<span class="sd">        Cosine similarity measures the cosine of the angle between two vectors,</span>
<span class="sd">        providing a measure of semantic similarity regardless of vector</span>
<span class="sd">        magnitude.</span>

<span class="sd">        Value Interpretation:</span>
<span class="sd">        - +1.0: Identical vectors (0 angle) - maximally similar</span>
<span class="sd">        -  0.0: Orthogonal vectors (90 angle) - completely unrelated</span>
<span class="sd">        - -1.0: Opposite vectors (180 angle) - maximally dissimilar/</span>
<span class="sd">          contradictory</span>

<span class="sd">        Examples:</span>
<span class="sd">        - [1,0,0] vs [1,0,0]  1.0 (identical)</span>
<span class="sd">        - [1,0,0] vs [0,1,0]  0.0 (orthogonal/unrelated)</span>
<span class="sd">        - [1,0,0] vs [-1,0,0]  -1.0 (opposite/contradictory)</span>

<span class="sd">        Args:</span>
<span class="sd">            embedding1: First embedding vector</span>
<span class="sd">            embedding2: Second embedding vector</span>

<span class="sd">        Returns:</span>
<span class="sd">            float: Cosine similarity score between -1 and 1</span>
<span class="sd">                (higher values = more similar)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Calculate cosine similarity</span>
        <span class="n">dot_product</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">embedding1</span><span class="p">,</span> <span class="n">embedding2</span><span class="p">)</span>
        <span class="n">norm1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">embedding1</span><span class="p">)</span>
        <span class="n">norm2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">embedding2</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">norm1</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">norm2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="mf">0.0</span>

        <span class="n">similarity</span> <span class="o">=</span> <span class="n">dot_product</span> <span class="o">/</span> <span class="p">(</span><span class="n">norm1</span> <span class="o">*</span> <span class="n">norm2</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">similarity</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_euclidean_distance</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">embedding1</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">embedding2</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculate Euclidean distance between two embeddings.</span>

<span class="sd">        Euclidean distance measures the straight-line distance between two</span>
<span class="sd">        points in the embedding space, providing a measure of absolute</span>
<span class="sd">        difference.</span>

<span class="sd">        Value Interpretation:</span>
<span class="sd">        - 0.0: Identical vectors - maximally similar</span>
<span class="sd">        - &gt;0.0: Distance between vectors - lower values = more similar</span>
<span class="sd">        - Higher values indicate greater dissimilarity</span>

<span class="sd">        Examples:</span>
<span class="sd">        - [1,0,0] vs [1,0,0]  0.0 (identical)</span>
<span class="sd">        - [1,0,0] vs [0,1,0]  1.414 (orthogonal)</span>
<span class="sd">        - [1,0,0] vs [-1,0,0]  2.0 (opposite)</span>

<span class="sd">        Note: Unlike cosine similarity, euclidean distance is sensitive to</span>
<span class="sd">        vector magnitude and measures absolute differences rather than</span>
<span class="sd">        directional similarity.</span>

<span class="sd">        Args:</span>
<span class="sd">            embedding1: First embedding vector</span>
<span class="sd">            embedding2: Second embedding vector</span>

<span class="sd">        Returns:</span>
<span class="sd">            float: Euclidean distance (lower values = more similar)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">distance</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">embedding1</span> <span class="o">-</span> <span class="n">embedding2</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">distance</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h5 id="ragora.core.embedding_engine.EmbeddingEngine._cosine_similarity" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">_cosine_similarity</span><span class="p">(</span><span class="n">embedding1</span><span class="p">,</span> <span class="n">embedding2</span><span class="p">)</span></code>

<a href="#ragora.core.embedding_engine.EmbeddingEngine._cosine_similarity" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Calculate cosine similarity between two embeddings.</p>
<p>Cosine similarity measures the cosine of the angle between two vectors,
providing a measure of semantic similarity regardless of vector
magnitude.</p>
<p>Value Interpretation:
- +1.0: Identical vectors (0 angle) - maximally similar
-  0.0: Orthogonal vectors (90 angle) - completely unrelated
- -1.0: Opposite vectors (180 angle) - maximally dissimilar/
  contradictory</p>
<p>Examples:
- [1,0,0] vs [1,0,0]  1.0 (identical)
- [1,0,0] vs [0,1,0]  0.0 (orthogonal/unrelated)
- [1,0,0] vs [-1,0,0]  -1.0 (opposite/contradictory)</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>embedding1</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>First embedding vector</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>embedding2</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Second embedding vector</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>float</code></td>            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Cosine similarity score between -1 and 1
(higher values = more similar)</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/core/embedding_engine.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">_cosine_similarity</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">embedding1</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">embedding2</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate cosine similarity between two embeddings.</span>

<span class="sd">    Cosine similarity measures the cosine of the angle between two vectors,</span>
<span class="sd">    providing a measure of semantic similarity regardless of vector</span>
<span class="sd">    magnitude.</span>

<span class="sd">    Value Interpretation:</span>
<span class="sd">    - +1.0: Identical vectors (0 angle) - maximally similar</span>
<span class="sd">    -  0.0: Orthogonal vectors (90 angle) - completely unrelated</span>
<span class="sd">    - -1.0: Opposite vectors (180 angle) - maximally dissimilar/</span>
<span class="sd">      contradictory</span>

<span class="sd">    Examples:</span>
<span class="sd">    - [1,0,0] vs [1,0,0]  1.0 (identical)</span>
<span class="sd">    - [1,0,0] vs [0,1,0]  0.0 (orthogonal/unrelated)</span>
<span class="sd">    - [1,0,0] vs [-1,0,0]  -1.0 (opposite/contradictory)</span>

<span class="sd">    Args:</span>
<span class="sd">        embedding1: First embedding vector</span>
<span class="sd">        embedding2: Second embedding vector</span>

<span class="sd">    Returns:</span>
<span class="sd">        float: Cosine similarity score between -1 and 1</span>
<span class="sd">            (higher values = more similar)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Calculate cosine similarity</span>
    <span class="n">dot_product</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">embedding1</span><span class="p">,</span> <span class="n">embedding2</span><span class="p">)</span>
    <span class="n">norm1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">embedding1</span><span class="p">)</span>
    <span class="n">norm2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">embedding2</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">norm1</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">norm2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="mf">0.0</span>

    <span class="n">similarity</span> <span class="o">=</span> <span class="n">dot_product</span> <span class="o">/</span> <span class="p">(</span><span class="n">norm1</span> <span class="o">*</span> <span class="n">norm2</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">similarity</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="ragora.core.embedding_engine.EmbeddingEngine._euclidean_distance" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">_euclidean_distance</span><span class="p">(</span><span class="n">embedding1</span><span class="p">,</span> <span class="n">embedding2</span><span class="p">)</span></code>

<a href="#ragora.core.embedding_engine.EmbeddingEngine._euclidean_distance" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Calculate Euclidean distance between two embeddings.</p>
<p>Euclidean distance measures the straight-line distance between two
points in the embedding space, providing a measure of absolute
difference.</p>
<p>Value Interpretation:
- 0.0: Identical vectors - maximally similar
- &gt;0.0: Distance between vectors - lower values = more similar
- Higher values indicate greater dissimilarity</p>
<p>Examples:
- [1,0,0] vs [1,0,0]  0.0 (identical)
- [1,0,0] vs [0,1,0]  1.414 (orthogonal)
- [1,0,0] vs [-1,0,0]  2.0 (opposite)</p>
<p>Note: Unlike cosine similarity, euclidean distance is sensitive to
vector magnitude and measures absolute differences rather than
directional similarity.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>embedding1</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>First embedding vector</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>embedding2</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Second embedding vector</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>float</code></td>            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Euclidean distance (lower values = more similar)</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/core/embedding_engine.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">_euclidean_distance</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">embedding1</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">embedding2</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate Euclidean distance between two embeddings.</span>

<span class="sd">    Euclidean distance measures the straight-line distance between two</span>
<span class="sd">    points in the embedding space, providing a measure of absolute</span>
<span class="sd">    difference.</span>

<span class="sd">    Value Interpretation:</span>
<span class="sd">    - 0.0: Identical vectors - maximally similar</span>
<span class="sd">    - &gt;0.0: Distance between vectors - lower values = more similar</span>
<span class="sd">    - Higher values indicate greater dissimilarity</span>

<span class="sd">    Examples:</span>
<span class="sd">    - [1,0,0] vs [1,0,0]  0.0 (identical)</span>
<span class="sd">    - [1,0,0] vs [0,1,0]  1.414 (orthogonal)</span>
<span class="sd">    - [1,0,0] vs [-1,0,0]  2.0 (opposite)</span>

<span class="sd">    Note: Unlike cosine similarity, euclidean distance is sensitive to</span>
<span class="sd">    vector magnitude and measures absolute differences rather than</span>
<span class="sd">    directional similarity.</span>

<span class="sd">    Args:</span>
<span class="sd">        embedding1: First embedding vector</span>
<span class="sd">        embedding2: Second embedding vector</span>

<span class="sd">    Returns:</span>
<span class="sd">        float: Euclidean distance (lower values = more similar)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">distance</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">embedding1</span> <span class="o">-</span> <span class="n">embedding2</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">distance</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="ragora.core.embedding_engine.EmbeddingEngine.embed_chunk" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">embed_chunk</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span></code>

<a href="#ragora.core.embedding_engine.EmbeddingEngine.embed_chunk" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Generate embedding for a DataChunk object.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>chunk</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="DataChunk


  
      dataclass
   (ragora.core.chunking.DataChunk)" href="#ragora.core.chunking.DataChunk">DataChunk</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>DataChunk object containing text and metadata</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>np.ndarray: Vector embedding of the chunk text</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If chunk is None or has empty text</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/core/embedding_engine.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">embed_chunk</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">chunk</span><span class="p">:</span> <span class="n">DataChunk</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate embedding for a DataChunk object.</span>

<span class="sd">    Args:</span>
<span class="sd">        chunk: DataChunk object containing text and metadata</span>

<span class="sd">    Returns:</span>
<span class="sd">        np.ndarray: Vector embedding of the chunk text</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If chunk is None or has empty text</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">chunk</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Chunk cannot be None&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">embed_text</span><span class="p">(</span><span class="n">chunk</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="ragora.core.embedding_engine.EmbeddingEngine.embed_chunks" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">embed_chunks</span><span class="p">(</span><span class="n">chunks</span><span class="p">)</span></code>

<a href="#ragora.core.embedding_engine.EmbeddingEngine.embed_chunks" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Generate embeddings for multiple DataChunk objects.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>chunks</code>
            </td>
            <td>
                  <code><span title="typing.List">List</span>[<a class="autorefs autorefs-internal" title="DataChunk


  
      dataclass
   (ragora.core.chunking.DataChunk)" href="#ragora.core.chunking.DataChunk">DataChunk</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of DataChunk objects</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.List">List</span>[<span title="numpy.ndarray">ndarray</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List[np.ndarray]: List of vector embeddings</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If chunks list is empty or contains invalid chunks</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/core/embedding_engine.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">embed_chunks</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">chunks</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">DataChunk</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate embeddings for multiple DataChunk objects.</span>

<span class="sd">    Args:</span>
<span class="sd">        chunks: List of DataChunk objects</span>

<span class="sd">    Returns:</span>
<span class="sd">        List[np.ndarray]: List of vector embeddings</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If chunks list is empty or contains invalid chunks</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">chunks</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Chunks list cannot be empty&quot;</span><span class="p">)</span>

    <span class="c1"># Extract text from chunks</span>
    <span class="n">texts</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">chunks</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">chunk</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">chunk</span><span class="o">.</span><span class="n">text</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">chunk</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Skipping invalid chunk at index </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">continue</span>
        <span class="n">texts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chunk</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">texts</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No valid text found in chunks&quot;</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Generating embeddings for </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">texts</span><span class="p">)</span><span class="si">}</span><span class="s2"> chunks&quot;</span><span class="p">)</span>
        <span class="n">embeddings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
            <span class="n">texts</span><span class="p">,</span> <span class="n">convert_to_numpy</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">show_progress_bar</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>

        <span class="c1"># Convert to list of numpy arrays</span>
        <span class="n">embedding_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">embeddings</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">embeddings</span><span class="p">))]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Successfully generated </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">embedding_list</span><span class="p">)</span><span class="si">}</span><span class="s2"> embeddings&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">embedding_list</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to generate embeddings for chunks: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">raise</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="ragora.core.embedding_engine.EmbeddingEngine.embed_text" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">embed_text</span><span class="p">(</span><span class="n">text</span><span class="p">)</span></code>

<a href="#ragora.core.embedding_engine.EmbeddingEngine.embed_text" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Generate embedding for a single text string.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>text</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Text to embed</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>np.ndarray: Vector embedding of the text</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If text is empty or None</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/core/embedding_engine.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">embed_text</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate embedding for a single text string.</span>

<span class="sd">    Args:</span>
<span class="sd">        text: Text to embed</span>

<span class="sd">    Returns:</span>
<span class="sd">        np.ndarray: Vector embedding of the text</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If text is empty or None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">text</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">text</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Text cannot be empty or None&quot;</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">embedding</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">convert_to_numpy</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">embedding</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to generate embedding for text: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">raise</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="ragora.core.embedding_engine.EmbeddingEngine.embed_texts" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">embed_texts</span><span class="p">(</span><span class="n">texts</span><span class="p">)</span></code>

<a href="#ragora.core.embedding_engine.EmbeddingEngine.embed_texts" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Generate embeddings for a list of text strings.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>texts</code>
            </td>
            <td>
                  <code><span title="typing.List">List</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of text strings to embed</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.List">List</span>[<span title="numpy.ndarray">ndarray</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List[np.ndarray]: List of vector embeddings</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If texts list is empty or contains invalid strings</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/core/embedding_engine.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">embed_texts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">texts</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate embeddings for a list of text strings.</span>

<span class="sd">    Args:</span>
<span class="sd">        texts: List of text strings to embed</span>

<span class="sd">    Returns:</span>
<span class="sd">        List[np.ndarray]: List of vector embeddings</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If texts list is empty or contains invalid strings</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">texts</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Texts list cannot be empty&quot;</span><span class="p">)</span>

    <span class="c1"># Filter out empty texts</span>
    <span class="n">valid_texts</span> <span class="o">=</span> <span class="p">[</span><span class="n">text</span> <span class="k">for</span> <span class="n">text</span> <span class="ow">in</span> <span class="n">texts</span> <span class="k">if</span> <span class="n">text</span> <span class="ow">and</span> <span class="n">text</span><span class="o">.</span><span class="n">strip</span><span class="p">()]</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">valid_texts</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No valid text found in texts list&quot;</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Generating embeddings for </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">valid_texts</span><span class="p">)</span><span class="si">}</span><span class="s2"> texts&quot;</span><span class="p">)</span>
        <span class="n">embeddings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
            <span class="n">valid_texts</span><span class="p">,</span> <span class="n">convert_to_numpy</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">show_progress_bar</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>

        <span class="c1"># Convert to list of numpy arrays</span>
        <span class="n">embedding_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">embeddings</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">embeddings</span><span class="p">))]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Successfully generated </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">embedding_list</span><span class="p">)</span><span class="si">}</span><span class="s2"> embeddings&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">embedding_list</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to generate embeddings for texts: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">raise</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="ragora.core.embedding_engine.EmbeddingEngine.get_embedding_dimension" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_embedding_dimension</span><span class="p">()</span></code>

<a href="#ragora.core.embedding_engine.EmbeddingEngine.get_embedding_dimension" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Get the dimension of embeddings produced by this engine.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>int</code></td>            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dimension of the embeddings</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/core/embedding_engine.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_embedding_dimension</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the dimension of embeddings produced by this engine.</span>

<span class="sd">    Returns:</span>
<span class="sd">        int: Dimension of the embeddings</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">embedding_dimension</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="ragora.core.embedding_engine.EmbeddingEngine.get_model_info" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_model_info</span><span class="p">()</span></code>

<a href="#ragora.core.embedding_engine.EmbeddingEngine.get_model_info" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Get information about the current model.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>dict</code></td>            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Model information including name, dimension, and
description</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/core/embedding_engine.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_model_info</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get information about the current model.</span>

<span class="sd">    Returns:</span>
<span class="sd">        dict: Model information including name, dimension, and</span>
<span class="sd">            description</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="s2">&quot;model_name&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_name</span><span class="p">,</span>
        <span class="s2">&quot;dimension&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">embedding_dimension</span><span class="p">,</span>
        <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">SUPPORTED_MODELS</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">model_name</span><span class="p">][</span><span class="s2">&quot;description&quot;</span><span class="p">],</span>
        <span class="s2">&quot;pooling_strategy&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">SUPPORTED_MODELS</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">model_name</span><span class="p">][</span>
            <span class="s2">&quot;pooling_strategy&quot;</span>
        <span class="p">],</span>
    <span class="p">}</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="ragora.core.embedding_engine.EmbeddingEngine.similarity" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">similarity</span><span class="p">(</span><span class="n">embedding1</span><span class="p">,</span> <span class="n">embedding2</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;cosine&#39;</span><span class="p">)</span></code>

<a href="#ragora.core.embedding_engine.EmbeddingEngine.similarity" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Calculate similarity between two embeddings using specified method.</p>
<p>This function provides a unified interface for different similarity
measures, allowing you to choose the most appropriate method for your
use case.</p>
<p>Method Comparison:
- "cosine": Measures angular similarity (direction-based)
  * Range: [-1, 1] where higher values = more similar
  * Best for: Semantic similarity, normalized vectors
  * Interpretation: 1.0=identical, 0.0=unrelated, -1.0=opposite</p>
<ul>
<li>"euclidean": Measures geometric distance (magnitude-based)</li>
<li>Range: [0, ) where lower values = more similar</li>
<li>Best for: Absolute differences, magnitude-sensitive comparisons</li>
<li>Interpretation: 0.0=identical, higher values=more different</li>
</ul>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>embedding1</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>First embedding vector</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>embedding2</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Second embedding vector</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>method</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Similarity method to use ("cosine" or "euclidean")</p>
              </div>
            </td>
            <td>
                  <code>&#39;cosine&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>float</code></td>            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Similarity score</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td></td>            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <ul>
<li>For cosine: score between -1 and 1 (higher = more similar)</li>
</ul>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td></td>            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <ul>
<li>For euclidean: distance between 0 and  (lower = more similar)</li>
</ul>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If embeddings have different dimensions or invalid
method</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">engine</span> <span class="o">=</span> <span class="n">EmbeddingEngine</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">vec1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">vec2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Cosine similarity (default)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">engine</span><span class="o">.</span><span class="n">similarity</span><span class="p">(</span><span class="n">vec1</span><span class="p">,</span> <span class="n">vec2</span><span class="p">)</span>  <span class="c1"># Returns 0.0 (orthogonal)</span>
<span class="gp">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Euclidean distance</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">engine</span><span class="o">.</span><span class="n">similarity</span><span class="p">(</span><span class="n">vec1</span><span class="p">,</span> <span class="n">vec2</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;euclidean&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Returns 1.414</span>
</code></pre></div>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/core/embedding_engine.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">similarity</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">embedding1</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">embedding2</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">method</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;cosine&quot;</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate similarity between two embeddings using specified method.</span>

<span class="sd">    This function provides a unified interface for different similarity</span>
<span class="sd">    measures, allowing you to choose the most appropriate method for your</span>
<span class="sd">    use case.</span>

<span class="sd">    Method Comparison:</span>
<span class="sd">    - &quot;cosine&quot;: Measures angular similarity (direction-based)</span>
<span class="sd">      * Range: [-1, 1] where higher values = more similar</span>
<span class="sd">      * Best for: Semantic similarity, normalized vectors</span>
<span class="sd">      * Interpretation: 1.0=identical, 0.0=unrelated, -1.0=opposite</span>

<span class="sd">    - &quot;euclidean&quot;: Measures geometric distance (magnitude-based)</span>
<span class="sd">      * Range: [0, ) where lower values = more similar</span>
<span class="sd">      * Best for: Absolute differences, magnitude-sensitive comparisons</span>
<span class="sd">      * Interpretation: 0.0=identical, higher values=more different</span>

<span class="sd">    Args:</span>
<span class="sd">        embedding1: First embedding vector</span>
<span class="sd">        embedding2: Second embedding vector</span>
<span class="sd">        method: Similarity method to use (&quot;cosine&quot; or &quot;euclidean&quot;)</span>

<span class="sd">    Returns:</span>
<span class="sd">        float: Similarity score</span>
<span class="sd">        - For cosine: score between -1 and 1 (higher = more similar)</span>
<span class="sd">        - For euclidean: distance between 0 and  (lower = more similar)</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If embeddings have different dimensions or invalid</span>
<span class="sd">            method</span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; engine = EmbeddingEngine()</span>
<span class="sd">        &gt;&gt;&gt; vec1 = np.array([1.0, 0.0, 0.0])</span>
<span class="sd">        &gt;&gt;&gt; vec2 = np.array([0.0, 1.0, 0.0])</span>
<span class="sd">        &gt;&gt;&gt;</span>
<span class="sd">        &gt;&gt;&gt; # Cosine similarity (default)</span>
<span class="sd">        &gt;&gt;&gt; engine.similarity(vec1, vec2)  # Returns 0.0 (orthogonal)</span>
<span class="sd">        &gt;&gt;&gt;</span>
<span class="sd">        &gt;&gt;&gt; # Euclidean distance</span>
<span class="sd">        &gt;&gt;&gt; engine.similarity(vec1, vec2, method=&quot;euclidean&quot;)</span>
<span class="sd">        &gt;&gt;&gt; # Returns 1.414</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">embedding1</span><span class="o">.</span><span class="n">shape</span> <span class="o">!=</span> <span class="n">embedding2</span><span class="o">.</span><span class="n">shape</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Embeddings must have the same dimension&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">method</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;cosine&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cosine_similarity</span><span class="p">(</span><span class="n">embedding1</span><span class="p">,</span> <span class="n">embedding2</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">method</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;euclidean&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_euclidean_distance</span><span class="p">(</span><span class="n">embedding1</span><span class="p">,</span> <span class="n">embedding2</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Invalid similarity method &#39;</span><span class="si">{</span><span class="n">method</span><span class="si">}</span><span class="s2">&#39;. &quot;</span>
            <span class="s2">&quot;Supported methods: &#39;cosine&#39;, &#39;euclidean&#39;&quot;</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div><h3 id="filters">Filters<a class="headerlink" href="#filters" title="Permanent link">&para;</a></h3>


<div class="doc doc-object doc-module">



<a id="ragora.core.filters"></a>
    <div class="doc doc-contents first">

        <p>Filter utilities for Weaviate queries.</p>
<p>This module provides helper functions and builders for constructing
Weaviate Filter objects using domain model semantics, making it easier
to filter search results without needing to know exact Weaviate property names.</p>
<p>The FilterBuilder class maps domain model field names to Weaviate property
names, providing a consistent interface aligned with RetrievalMetadata and
DataChunk models.</p>










  <div class="doc doc-children">









<div class="doc doc-object doc-class">



<h4 id="ragora.core.filters.FilterBuilder" class="doc doc-heading">
            <code>FilterBuilder</code>


<a href="#ragora.core.filters.FilterBuilder" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">


        <p>Helper for building Weaviate filters using domain model semantics.</p>
<p>This class provides convenience methods for constructing Weaviate Filter
objects using domain model field names, abstracting away the underlying
Weaviate property names. This makes filtering more intuitive and reduces
the chance of errors from using incorrect property names.</p>


<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><span class="n">FilterBuilder</span><span class="o">.</span><span class="n">by_chunk_type</span><span class="p">(</span><span class="s2">&quot;text&quot;</span><span class="p">)</span>
<span class="n">FilterBuilder</span><span class="o">.</span><span class="n">by_date_range</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="s2">&quot;2024-01-01&quot;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot;2024-12-31&quot;</span><span class="p">)</span>
<span class="n">FilterBuilder</span><span class="o">.</span><span class="n">combine_and</span><span class="p">(</span>
    <span class="n">FilterBuilder</span><span class="o">.</span><span class="n">by_chunk_type</span><span class="p">(</span><span class="s2">&quot;text&quot;</span><span class="p">),</span>
    <span class="n">FilterBuilder</span><span class="o">.</span><span class="n">by_source_document</span><span class="p">(</span><span class="s2">&quot;document.pdf&quot;</span><span class="p">),</span>
<span class="p">)</span>
</code></pre></div>








              <details class="quote">
                <summary>Source code in <code>ragora/ragora/core/filters.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">FilterBuilder</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Helper for building Weaviate filters using domain model semantics.</span>

<span class="sd">    This class provides convenience methods for constructing Weaviate Filter</span>
<span class="sd">    objects using domain model field names, abstracting away the underlying</span>
<span class="sd">    Weaviate property names. This makes filtering more intuitive and reduces</span>
<span class="sd">    the chance of errors from using incorrect property names.</span>

<span class="sd">    Examples:</span>
<span class="sd">        ```python</span>
<span class="sd">        FilterBuilder.by_chunk_type(&quot;text&quot;)</span>
<span class="sd">        FilterBuilder.by_date_range(start=&quot;2024-01-01&quot;, end=&quot;2024-12-31&quot;)</span>
<span class="sd">        FilterBuilder.combine_and(</span>
<span class="sd">            FilterBuilder.by_chunk_type(&quot;text&quot;),</span>
<span class="sd">            FilterBuilder.by_source_document(&quot;document.pdf&quot;),</span>
<span class="sd">        )</span>
<span class="sd">        ```</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">by_chunk_type</span><span class="p">(</span><span class="n">value</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Filter</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Filter by chunk type (e.g., &quot;text&quot;, &quot;equation&quot;, &quot;citation&quot;).</span>

<span class="sd">        Args:</span>
<span class="sd">            value: Chunk type value to filter by</span>

<span class="sd">        Returns:</span>
<span class="sd">            Filter: Weaviate Filter object for chunk type</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">Filter</span><span class="o">.</span><span class="n">by_property</span><span class="p">(</span><span class="s2">&quot;chunk_type&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">equal</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">by_source_document</span><span class="p">(</span><span class="n">value</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Filter</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Filter by source document filename.</span>

<span class="sd">        Args:</span>
<span class="sd">            value: Source document filename to filter by</span>

<span class="sd">        Returns:</span>
<span class="sd">            Filter: Weaviate Filter object for source document</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">Filter</span><span class="o">.</span><span class="n">by_property</span><span class="p">(</span><span class="s2">&quot;source_document&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">equal</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">by_email_sender</span><span class="p">(</span><span class="n">value</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Filter</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Filter by email sender address.</span>

<span class="sd">        Args:</span>
<span class="sd">            value: Email sender address to filter by</span>

<span class="sd">        Returns:</span>
<span class="sd">            Filter: Weaviate Filter object for email sender</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">Filter</span><span class="o">.</span><span class="n">by_property</span><span class="p">(</span><span class="s2">&quot;email_sender&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">equal</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">by_email_subject</span><span class="p">(</span><span class="n">value</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Filter</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Filter by email subject line.</span>

<span class="sd">        Args:</span>
<span class="sd">            value: Email subject line to filter by (supports partial matches)</span>

<span class="sd">        Returns:</span>
<span class="sd">            Filter: Weaviate Filter object for email subject</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">Filter</span><span class="o">.</span><span class="n">by_property</span><span class="p">(</span><span class="s2">&quot;email_subject&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">equal</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">by_email_folder</span><span class="p">(</span><span class="n">value</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Filter</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Filter by email folder/path.</span>

<span class="sd">        Args:</span>
<span class="sd">            value: Email folder path to filter by</span>

<span class="sd">        Returns:</span>
<span class="sd">            Filter: Weaviate Filter object for email folder</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">Filter</span><span class="o">.</span><span class="n">by_property</span><span class="p">(</span><span class="s2">&quot;email_folder&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">equal</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">by_email_recipient</span><span class="p">(</span><span class="n">value</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Filter</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Filter by email recipient address.</span>

<span class="sd">        Args:</span>
<span class="sd">            value: Email recipient address to filter by</span>

<span class="sd">        Returns:</span>
<span class="sd">            Filter: Weaviate Filter object for email recipient</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">Filter</span><span class="o">.</span><span class="n">by_property</span><span class="p">(</span><span class="s2">&quot;email_recipient&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">equal</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">by_date_range</span><span class="p">(</span>
        <span class="n">start</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">end</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Filter</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Filter by date range using created_at timestamp.</span>

<span class="sd">        Args:</span>
<span class="sd">            start: Start date (ISO format string, e.g., &quot;2024-01-01&quot;)</span>
<span class="sd">            end: End date (ISO format string, e.g., &quot;2024-12-31&quot;)</span>

<span class="sd">        Returns:</span>
<span class="sd">            Filter: Weaviate Filter object for date range, or None if both</span>
<span class="sd">                start and end are None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">start</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">end</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="n">filters</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">start</span><span class="p">:</span>
            <span class="n">filters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Filter</span><span class="o">.</span><span class="n">by_property</span><span class="p">(</span><span class="s2">&quot;created_at&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">greater_or_equal</span><span class="p">(</span><span class="n">start</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">end</span><span class="p">:</span>
            <span class="n">filters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Filter</span><span class="o">.</span><span class="n">by_property</span><span class="p">(</span><span class="s2">&quot;created_at&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">less_or_equal</span><span class="p">(</span><span class="n">end</span><span class="p">))</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">filters</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">filters</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">Filter</span><span class="o">.</span><span class="n">all_of</span><span class="p">(</span><span class="n">filters</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">by_email_date_range</span><span class="p">(</span>
        <span class="n">start</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">end</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Filter</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Filter by email date range using email_date timestamp.</span>

<span class="sd">        Args:</span>
<span class="sd">            start: Start date (ISO format string, e.g., &quot;2024-01-01&quot;)</span>
<span class="sd">            end: End date (ISO format string, e.g., &quot;2024-12-31&quot;)</span>

<span class="sd">        Returns:</span>
<span class="sd">            Filter: Weaviate Filter object for email date range, or None if</span>
<span class="sd">                both start and end are None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">start</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">end</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="n">filters</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">start</span><span class="p">:</span>
            <span class="n">filters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Filter</span><span class="o">.</span><span class="n">by_property</span><span class="p">(</span><span class="s2">&quot;email_date&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">greater_or_equal</span><span class="p">(</span><span class="n">start</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">end</span><span class="p">:</span>
            <span class="n">filters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Filter</span><span class="o">.</span><span class="n">by_property</span><span class="p">(</span><span class="s2">&quot;email_date&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">less_or_equal</span><span class="p">(</span><span class="n">end</span><span class="p">))</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">filters</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">filters</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">Filter</span><span class="o">.</span><span class="n">all_of</span><span class="p">(</span><span class="n">filters</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">by_page_number</span><span class="p">(</span><span class="n">value</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Filter</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Filter by page number in source document.</span>

<span class="sd">        Args:</span>
<span class="sd">            value: Page number to filter by</span>

<span class="sd">        Returns:</span>
<span class="sd">            Filter: Weaviate Filter object for page number</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">Filter</span><span class="o">.</span><span class="n">by_property</span><span class="p">(</span><span class="s2">&quot;page_number&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">equal</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">by_section_title</span><span class="p">(</span><span class="n">value</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Filter</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Filter by section or chapter title.</span>

<span class="sd">        Args:</span>
<span class="sd">            value: Section title to filter by</span>

<span class="sd">        Returns:</span>
<span class="sd">            Filter: Weaviate Filter object for section title</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">Filter</span><span class="o">.</span><span class="n">by_property</span><span class="p">(</span><span class="s2">&quot;section_title&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">equal</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">by_chunk_idx</span><span class="p">(</span><span class="n">value</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Filter</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Filter by chunk index.</span>

<span class="sd">        Args:</span>
<span class="sd">            value: Chunk index to filter by</span>

<span class="sd">        Returns:</span>
<span class="sd">            Filter: Weaviate Filter object for chunk index</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">Filter</span><span class="o">.</span><span class="n">by_property</span><span class="p">(</span><span class="s2">&quot;metadata_chunk_idx&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">equal</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">combine_and</span><span class="p">(</span><span class="o">*</span><span class="n">filters</span><span class="p">:</span> <span class="n">Filter</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Filter</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Combine multiple filters with AND logic.</span>

<span class="sd">        All filters must match for a result to be included.</span>

<span class="sd">        Args:</span>
<span class="sd">            *filters: Variable number of Filter objects to combine</span>

<span class="sd">        Returns:</span>
<span class="sd">            Filter: Combined filter using AND logic</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If no filters are provided</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">filters</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;At least one filter must be provided&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">filters</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">filters</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">Filter</span><span class="o">.</span><span class="n">all_of</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">filters</span><span class="p">))</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">combine_or</span><span class="p">(</span><span class="o">*</span><span class="n">filters</span><span class="p">:</span> <span class="n">Filter</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Filter</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Combine multiple filters with OR logic.</span>

<span class="sd">        Any filter matching will include the result.</span>

<span class="sd">        Args:</span>
<span class="sd">            *filters: Variable number of Filter objects to combine</span>

<span class="sd">        Returns:</span>
<span class="sd">            Filter: Combined filter using OR logic</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If no filters are provided</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">filters</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;At least one filter must be provided&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">filters</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">filters</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">Filter</span><span class="o">.</span><span class="n">any_of</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">filters</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h5 id="ragora.core.filters.FilterBuilder.by_chunk_idx" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">by_chunk_idx</span><span class="p">(</span><span class="n">value</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#ragora.core.filters.FilterBuilder.by_chunk_idx" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Filter by chunk index.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>value</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Chunk index to filter by</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>Filter</code></td>            <td>
                  <code><span title="weaviate.classes.query.Filter">Filter</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Weaviate Filter object for chunk index</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/core/filters.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">by_chunk_idx</span><span class="p">(</span><span class="n">value</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Filter</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Filter by chunk index.</span>

<span class="sd">    Args:</span>
<span class="sd">        value: Chunk index to filter by</span>

<span class="sd">    Returns:</span>
<span class="sd">        Filter: Weaviate Filter object for chunk index</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">Filter</span><span class="o">.</span><span class="n">by_property</span><span class="p">(</span><span class="s2">&quot;metadata_chunk_idx&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">equal</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="ragora.core.filters.FilterBuilder.by_chunk_type" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">by_chunk_type</span><span class="p">(</span><span class="n">value</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#ragora.core.filters.FilterBuilder.by_chunk_type" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Filter by chunk type (e.g., "text", "equation", "citation").</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>value</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Chunk type value to filter by</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>Filter</code></td>            <td>
                  <code><span title="weaviate.classes.query.Filter">Filter</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Weaviate Filter object for chunk type</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/core/filters.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">by_chunk_type</span><span class="p">(</span><span class="n">value</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Filter</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Filter by chunk type (e.g., &quot;text&quot;, &quot;equation&quot;, &quot;citation&quot;).</span>

<span class="sd">    Args:</span>
<span class="sd">        value: Chunk type value to filter by</span>

<span class="sd">    Returns:</span>
<span class="sd">        Filter: Weaviate Filter object for chunk type</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">Filter</span><span class="o">.</span><span class="n">by_property</span><span class="p">(</span><span class="s2">&quot;chunk_type&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">equal</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="ragora.core.filters.FilterBuilder.by_date_range" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">by_date_range</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#ragora.core.filters.FilterBuilder.by_date_range" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Filter by date range using created_at timestamp.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>start</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Start date (ISO format string, e.g., "2024-01-01")</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>end</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>End date (ISO format string, e.g., "2024-12-31")</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>Filter</code></td>            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="weaviate.classes.query.Filter">Filter</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Weaviate Filter object for date range, or None if both
start and end are None</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/core/filters.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">by_date_range</span><span class="p">(</span>
    <span class="n">start</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">end</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Filter</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Filter by date range using created_at timestamp.</span>

<span class="sd">    Args:</span>
<span class="sd">        start: Start date (ISO format string, e.g., &quot;2024-01-01&quot;)</span>
<span class="sd">        end: End date (ISO format string, e.g., &quot;2024-12-31&quot;)</span>

<span class="sd">    Returns:</span>
<span class="sd">        Filter: Weaviate Filter object for date range, or None if both</span>
<span class="sd">            start and end are None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">start</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">end</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="n">filters</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="n">start</span><span class="p">:</span>
        <span class="n">filters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Filter</span><span class="o">.</span><span class="n">by_property</span><span class="p">(</span><span class="s2">&quot;created_at&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">greater_or_equal</span><span class="p">(</span><span class="n">start</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">end</span><span class="p">:</span>
        <span class="n">filters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Filter</span><span class="o">.</span><span class="n">by_property</span><span class="p">(</span><span class="s2">&quot;created_at&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">less_or_equal</span><span class="p">(</span><span class="n">end</span><span class="p">))</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">filters</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">filters</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">Filter</span><span class="o">.</span><span class="n">all_of</span><span class="p">(</span><span class="n">filters</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="ragora.core.filters.FilterBuilder.by_email_date_range" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">by_email_date_range</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#ragora.core.filters.FilterBuilder.by_email_date_range" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Filter by email date range using email_date timestamp.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>start</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Start date (ISO format string, e.g., "2024-01-01")</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>end</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>End date (ISO format string, e.g., "2024-12-31")</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>Filter</code></td>            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="weaviate.classes.query.Filter">Filter</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Weaviate Filter object for email date range, or None if
both start and end are None</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/core/filters.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">by_email_date_range</span><span class="p">(</span>
    <span class="n">start</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">end</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Filter</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Filter by email date range using email_date timestamp.</span>

<span class="sd">    Args:</span>
<span class="sd">        start: Start date (ISO format string, e.g., &quot;2024-01-01&quot;)</span>
<span class="sd">        end: End date (ISO format string, e.g., &quot;2024-12-31&quot;)</span>

<span class="sd">    Returns:</span>
<span class="sd">        Filter: Weaviate Filter object for email date range, or None if</span>
<span class="sd">            both start and end are None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">start</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">end</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="n">filters</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="n">start</span><span class="p">:</span>
        <span class="n">filters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Filter</span><span class="o">.</span><span class="n">by_property</span><span class="p">(</span><span class="s2">&quot;email_date&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">greater_or_equal</span><span class="p">(</span><span class="n">start</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">end</span><span class="p">:</span>
        <span class="n">filters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Filter</span><span class="o">.</span><span class="n">by_property</span><span class="p">(</span><span class="s2">&quot;email_date&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">less_or_equal</span><span class="p">(</span><span class="n">end</span><span class="p">))</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">filters</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">filters</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">Filter</span><span class="o">.</span><span class="n">all_of</span><span class="p">(</span><span class="n">filters</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="ragora.core.filters.FilterBuilder.by_email_folder" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">by_email_folder</span><span class="p">(</span><span class="n">value</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#ragora.core.filters.FilterBuilder.by_email_folder" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Filter by email folder/path.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>value</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Email folder path to filter by</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>Filter</code></td>            <td>
                  <code><span title="weaviate.classes.query.Filter">Filter</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Weaviate Filter object for email folder</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/core/filters.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span>
<span class="normal">93</span>
<span class="normal">94</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">by_email_folder</span><span class="p">(</span><span class="n">value</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Filter</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Filter by email folder/path.</span>

<span class="sd">    Args:</span>
<span class="sd">        value: Email folder path to filter by</span>

<span class="sd">    Returns:</span>
<span class="sd">        Filter: Weaviate Filter object for email folder</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">Filter</span><span class="o">.</span><span class="n">by_property</span><span class="p">(</span><span class="s2">&quot;email_folder&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">equal</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="ragora.core.filters.FilterBuilder.by_email_recipient" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">by_email_recipient</span><span class="p">(</span><span class="n">value</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#ragora.core.filters.FilterBuilder.by_email_recipient" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Filter by email recipient address.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>value</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Email recipient address to filter by</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>Filter</code></td>            <td>
                  <code><span title="weaviate.classes.query.Filter">Filter</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Weaviate Filter object for email recipient</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/core/filters.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">by_email_recipient</span><span class="p">(</span><span class="n">value</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Filter</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Filter by email recipient address.</span>

<span class="sd">    Args:</span>
<span class="sd">        value: Email recipient address to filter by</span>

<span class="sd">    Returns:</span>
<span class="sd">        Filter: Weaviate Filter object for email recipient</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">Filter</span><span class="o">.</span><span class="n">by_property</span><span class="p">(</span><span class="s2">&quot;email_recipient&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">equal</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="ragora.core.filters.FilterBuilder.by_email_sender" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">by_email_sender</span><span class="p">(</span><span class="n">value</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#ragora.core.filters.FilterBuilder.by_email_sender" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Filter by email sender address.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>value</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Email sender address to filter by</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>Filter</code></td>            <td>
                  <code><span title="weaviate.classes.query.Filter">Filter</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Weaviate Filter object for email sender</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/core/filters.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">by_email_sender</span><span class="p">(</span><span class="n">value</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Filter</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Filter by email sender address.</span>

<span class="sd">    Args:</span>
<span class="sd">        value: Email sender address to filter by</span>

<span class="sd">    Returns:</span>
<span class="sd">        Filter: Weaviate Filter object for email sender</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">Filter</span><span class="o">.</span><span class="n">by_property</span><span class="p">(</span><span class="s2">&quot;email_sender&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">equal</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="ragora.core.filters.FilterBuilder.by_email_subject" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">by_email_subject</span><span class="p">(</span><span class="n">value</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#ragora.core.filters.FilterBuilder.by_email_subject" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Filter by email subject line.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>value</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Email subject line to filter by (supports partial matches)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>Filter</code></td>            <td>
                  <code><span title="weaviate.classes.query.Filter">Filter</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Weaviate Filter object for email subject</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/core/filters.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">by_email_subject</span><span class="p">(</span><span class="n">value</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Filter</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Filter by email subject line.</span>

<span class="sd">    Args:</span>
<span class="sd">        value: Email subject line to filter by (supports partial matches)</span>

<span class="sd">    Returns:</span>
<span class="sd">        Filter: Weaviate Filter object for email subject</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">Filter</span><span class="o">.</span><span class="n">by_property</span><span class="p">(</span><span class="s2">&quot;email_subject&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">equal</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="ragora.core.filters.FilterBuilder.by_page_number" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">by_page_number</span><span class="p">(</span><span class="n">value</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#ragora.core.filters.FilterBuilder.by_page_number" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Filter by page number in source document.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>value</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Page number to filter by</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>Filter</code></td>            <td>
                  <code><span title="weaviate.classes.query.Filter">Filter</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Weaviate Filter object for page number</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/core/filters.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">by_page_number</span><span class="p">(</span><span class="n">value</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Filter</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Filter by page number in source document.</span>

<span class="sd">    Args:</span>
<span class="sd">        value: Page number to filter by</span>

<span class="sd">    Returns:</span>
<span class="sd">        Filter: Weaviate Filter object for page number</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">Filter</span><span class="o">.</span><span class="n">by_property</span><span class="p">(</span><span class="s2">&quot;page_number&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">equal</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="ragora.core.filters.FilterBuilder.by_section_title" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">by_section_title</span><span class="p">(</span><span class="n">value</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#ragora.core.filters.FilterBuilder.by_section_title" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Filter by section or chapter title.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>value</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Section title to filter by</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>Filter</code></td>            <td>
                  <code><span title="weaviate.classes.query.Filter">Filter</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Weaviate Filter object for section title</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/core/filters.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">by_section_title</span><span class="p">(</span><span class="n">value</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Filter</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Filter by section or chapter title.</span>

<span class="sd">    Args:</span>
<span class="sd">        value: Section title to filter by</span>

<span class="sd">    Returns:</span>
<span class="sd">        Filter: Weaviate Filter object for section title</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">Filter</span><span class="o">.</span><span class="n">by_property</span><span class="p">(</span><span class="s2">&quot;section_title&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">equal</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="ragora.core.filters.FilterBuilder.by_source_document" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">by_source_document</span><span class="p">(</span><span class="n">value</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#ragora.core.filters.FilterBuilder.by_source_document" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Filter by source document filename.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>value</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Source document filename to filter by</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>Filter</code></td>            <td>
                  <code><span title="weaviate.classes.query.Filter">Filter</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Weaviate Filter object for source document</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/core/filters.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">by_source_document</span><span class="p">(</span><span class="n">value</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Filter</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Filter by source document filename.</span>

<span class="sd">    Args:</span>
<span class="sd">        value: Source document filename to filter by</span>

<span class="sd">    Returns:</span>
<span class="sd">        Filter: Weaviate Filter object for source document</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">Filter</span><span class="o">.</span><span class="n">by_property</span><span class="p">(</span><span class="s2">&quot;source_document&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">equal</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="ragora.core.filters.FilterBuilder.combine_and" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">combine_and</span><span class="p">(</span><span class="o">*</span><span class="n">filters</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#ragora.core.filters.FilterBuilder.combine_and" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Combine multiple filters with AND logic.</p>
<p>All filters must match for a result to be included.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>*filters</code>
            </td>
            <td>
                  <code><span title="weaviate.classes.query.Filter">Filter</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Variable number of Filter objects to combine</p>
              </div>
            </td>
            <td>
                  <code>()</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>Filter</code></td>            <td>
                  <code><span title="weaviate.classes.query.Filter">Filter</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Combined filter using AND logic</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If no filters are provided</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/core/filters.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">combine_and</span><span class="p">(</span><span class="o">*</span><span class="n">filters</span><span class="p">:</span> <span class="n">Filter</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Filter</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Combine multiple filters with AND logic.</span>

<span class="sd">    All filters must match for a result to be included.</span>

<span class="sd">    Args:</span>
<span class="sd">        *filters: Variable number of Filter objects to combine</span>

<span class="sd">    Returns:</span>
<span class="sd">        Filter: Combined filter using AND logic</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If no filters are provided</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">filters</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;At least one filter must be provided&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">filters</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">filters</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">Filter</span><span class="o">.</span><span class="n">all_of</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">filters</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="ragora.core.filters.FilterBuilder.combine_or" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">combine_or</span><span class="p">(</span><span class="o">*</span><span class="n">filters</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#ragora.core.filters.FilterBuilder.combine_or" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Combine multiple filters with OR logic.</p>
<p>Any filter matching will include the result.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>*filters</code>
            </td>
            <td>
                  <code><span title="weaviate.classes.query.Filter">Filter</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Variable number of Filter objects to combine</p>
              </div>
            </td>
            <td>
                  <code>()</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>Filter</code></td>            <td>
                  <code><span title="weaviate.classes.query.Filter">Filter</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Combined filter using OR logic</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If no filters are provided</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/core/filters.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">combine_or</span><span class="p">(</span><span class="o">*</span><span class="n">filters</span><span class="p">:</span> <span class="n">Filter</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Filter</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Combine multiple filters with OR logic.</span>

<span class="sd">    Any filter matching will include the result.</span>

<span class="sd">    Args:</span>
<span class="sd">        *filters: Variable number of Filter objects to combine</span>

<span class="sd">    Returns:</span>
<span class="sd">        Filter: Combined filter using OR logic</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If no filters are provided</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">filters</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;At least one filter must be provided&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">filters</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">filters</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">Filter</span><span class="o">.</span><span class="n">any_of</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">filters</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div><h2 id="exceptions">Exceptions<a class="headerlink" href="#exceptions" title="Permanent link">&para;</a></h2>


<div class="doc doc-object doc-module">



<a id="ragora.exceptions"></a>
    <div class="doc doc-contents first">

        <p>Custom exceptions for the knowledge base manager system.</p>










  <div class="doc doc-children">









<div class="doc doc-object doc-class">



<h3 id="ragora.exceptions.ConfigurationError" class="doc doc-heading">
            <code>ConfigurationError</code>


<a href="#ragora.exceptions.ConfigurationError" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="KnowledgeBaseManagerError (ragora.exceptions.KnowledgeBaseManagerError)" href="#ragora.exceptions.KnowledgeBaseManagerError">KnowledgeBaseManagerError</a></code></p>


        <p>Raised when there's a configuration error.</p>








              <details class="quote">
                <summary>Source code in <code>ragora/ragora/exceptions.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">ConfigurationError</span><span class="p">(</span><span class="n">KnowledgeBaseManagerError</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Raised when there&#39;s a configuration error.&quot;&quot;&quot;</span>

    <span class="k">pass</span>
</code></pre></div></td></tr></table></div>
              </details>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="ragora.exceptions.DocumentProcessingError" class="doc doc-heading">
            <code>DocumentProcessingError</code>


<a href="#ragora.exceptions.DocumentProcessingError" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="KnowledgeBaseManagerError (ragora.exceptions.KnowledgeBaseManagerError)" href="#ragora.exceptions.KnowledgeBaseManagerError">KnowledgeBaseManagerError</a></code></p>


        <p>Raised when document processing fails.</p>








              <details class="quote">
                <summary>Source code in <code>ragora/ragora/exceptions.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">DocumentProcessingError</span><span class="p">(</span><span class="n">KnowledgeBaseManagerError</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Raised when document processing fails.&quot;&quot;&quot;</span>

    <span class="k">pass</span>
</code></pre></div></td></tr></table></div>
              </details>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="ragora.exceptions.EmbeddingError" class="doc doc-heading">
            <code>EmbeddingError</code>


<a href="#ragora.exceptions.EmbeddingError" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="KnowledgeBaseManagerError (ragora.exceptions.KnowledgeBaseManagerError)" href="#ragora.exceptions.KnowledgeBaseManagerError">KnowledgeBaseManagerError</a></code></p>


        <p>Raised when embedding operations fail.</p>








              <details class="quote">
                <summary>Source code in <code>ragora/ragora/exceptions.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">EmbeddingError</span><span class="p">(</span><span class="n">KnowledgeBaseManagerError</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Raised when embedding operations fail.&quot;&quot;&quot;</span>

    <span class="k">pass</span>
</code></pre></div></td></tr></table></div>
              </details>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="ragora.exceptions.KnowledgeBaseManagerError" class="doc doc-heading">
            <code>KnowledgeBaseManagerError</code>


<a href="#ragora.exceptions.KnowledgeBaseManagerError" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="Exception">Exception</span></code></p>


        <p>Base exception for knowledge base manager errors.</p>








              <details class="quote">
                <summary>Source code in <code>ragora/ragora/exceptions.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">KnowledgeBaseManagerError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Base exception for knowledge base manager errors.&quot;&quot;&quot;</span>

    <span class="k">pass</span>
</code></pre></div></td></tr></table></div>
              </details>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="ragora.exceptions.RetrievalError" class="doc doc-heading">
            <code>RetrievalError</code>


<a href="#ragora.exceptions.RetrievalError" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="KnowledgeBaseManagerError (ragora.exceptions.KnowledgeBaseManagerError)" href="#ragora.exceptions.KnowledgeBaseManagerError">KnowledgeBaseManagerError</a></code></p>


        <p>Raised when retrieval operations fail.</p>








              <details class="quote">
                <summary>Source code in <code>ragora/ragora/exceptions.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">RetrievalError</span><span class="p">(</span><span class="n">KnowledgeBaseManagerError</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Raised when retrieval operations fail.&quot;&quot;&quot;</span>

    <span class="k">pass</span>
</code></pre></div></td></tr></table></div>
              </details>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="ragora.exceptions.VectorStoreError" class="doc doc-heading">
            <code>VectorStoreError</code>


<a href="#ragora.exceptions.VectorStoreError" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="KnowledgeBaseManagerError (ragora.exceptions.KnowledgeBaseManagerError)" href="#ragora.exceptions.KnowledgeBaseManagerError">KnowledgeBaseManagerError</a></code></p>


        <p>Raised when vector store operations fail.</p>








              <details class="quote">
                <summary>Source code in <code>ragora/ragora/exceptions.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">VectorStoreError</span><span class="p">(</span><span class="n">KnowledgeBaseManagerError</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Raised when vector store operations fail.&quot;&quot;&quot;</span>

    <span class="k">pass</span>
</code></pre></div></td></tr></table></div>
              </details>

    </div>

</div>




  </div>

    </div>

</div><h2 id="utilities">Utilities<a class="headerlink" href="#utilities" title="Permanent link">&para;</a></h2>
<h3 id="device-utilities">Device Utilities<a class="headerlink" href="#device-utilities" title="Permanent link">&para;</a></h3>


<div class="doc doc-object doc-module">



<a id="ragora.utils.device_utils"></a>
    <div class="doc doc-contents first">

        <p>Cross-platform device utilities for PyTorch applications.</p>
<p>This module provides transparent device selection for PyTorch applications
across different platforms, automatically handling:
1. macOS: Forces CPU-only usage
2. Windows/Linux without GPUs: Forces CPU-only usage
3. Windows/Linux with GPUs but without CUDA: Forces CPU-only usage
4. Windows/Linux with GPUs and CUDA: Uses GPU acceleration</p>
<p>The module is designed to work seamlessly with pytest and other testing frameworks
without requiring any special configuration or user intervention.</p>










  <div class="doc doc-children">









<div class="doc doc-object doc-class">



<h4 id="ragora.utils.device_utils.DeviceManager" class="doc doc-heading">
            <code>DeviceManager</code>


<a href="#ragora.utils.device_utils.DeviceManager" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">


        <p>Manages PyTorch device selection across different platforms.</p>
<p>This class automatically detects the platform and available hardware,
then selects the appropriate PyTorch device for optimal performance
while ensuring compatibility across all supported platforms.</p>








              <details class="quote">
                <summary>Source code in <code>ragora/ragora/utils/device_utils.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">DeviceManager</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Manages PyTorch device selection across different platforms.</span>

<span class="sd">    This class automatically detects the platform and available hardware,</span>
<span class="sd">    then selects the appropriate PyTorch device for optimal performance</span>
<span class="sd">    while ensuring compatibility across all supported platforms.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the device manager and detect platform capabilities.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">platform_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_detect_platform</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gpu_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_detect_gpu_capabilities</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">recommended_device</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_select_optimal_device</span><span class="p">()</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Platform: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">platform_info</span><span class="p">[</span><span class="s1">&#39;system&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">platform_info</span><span class="p">[</span><span class="s1">&#39;version&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;GPU Available: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">gpu_info</span><span class="p">[</span><span class="s1">&#39;gpu_available&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;CUDA Available: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">gpu_info</span><span class="p">[</span><span class="s1">&#39;cuda_available&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Recommended Device: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">recommended_device</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_detect_platform</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Detect the current platform and system information.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Dict containing platform information including system, version, and architecture.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">system</span> <span class="o">=</span> <span class="n">platform</span><span class="o">.</span><span class="n">system</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="n">version</span> <span class="o">=</span> <span class="n">platform</span><span class="o">.</span><span class="n">version</span><span class="p">()</span>
        <span class="n">architecture</span> <span class="o">=</span> <span class="n">platform</span><span class="o">.</span><span class="n">machine</span><span class="p">()</span>

        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;system&quot;</span><span class="p">:</span> <span class="n">system</span><span class="p">,</span>
            <span class="s2">&quot;version&quot;</span><span class="p">:</span> <span class="n">version</span><span class="p">,</span>
            <span class="s2">&quot;architecture&quot;</span><span class="p">:</span> <span class="n">architecture</span><span class="p">,</span>
            <span class="s2">&quot;is_macos&quot;</span><span class="p">:</span> <span class="n">system</span> <span class="o">==</span> <span class="s2">&quot;darwin&quot;</span><span class="p">,</span>
            <span class="s2">&quot;is_windows&quot;</span><span class="p">:</span> <span class="n">system</span> <span class="o">==</span> <span class="s2">&quot;windows&quot;</span><span class="p">,</span>
            <span class="s2">&quot;is_linux&quot;</span><span class="p">:</span> <span class="n">system</span> <span class="o">==</span> <span class="s2">&quot;linux&quot;</span><span class="p">,</span>
        <span class="p">}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_detect_gpu_capabilities</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Detect GPU and CUDA capabilities on the current system.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Dict containing GPU availability and CUDA support information.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">gpu_available</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">cuda_available</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">gpu_count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">gpu_names</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Try to import torch to check for GPU availability</span>
            <span class="kn">import</span><span class="w"> </span><span class="nn">torch</span>

            <span class="n">gpu_available</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">is_available</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">gpu_available</span><span class="p">:</span>
                <span class="n">gpu_count</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">device_count</span><span class="p">()</span>
                <span class="n">gpu_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">get_device_name</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">gpu_count</span><span class="p">)]</span>
                <span class="n">cuda_available</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;PyTorch not available for GPU detection&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error detecting GPU capabilities: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Additional CUDA detection using nvidia-smi if available</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">cuda_available</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">platform_info</span><span class="p">[</span><span class="s2">&quot;is_macos&quot;</span><span class="p">]:</span>
            <span class="n">cuda_available</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_cuda_via_nvidia_smi</span><span class="p">()</span>

        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;gpu_available&quot;</span><span class="p">:</span> <span class="n">gpu_available</span><span class="p">,</span>
            <span class="s2">&quot;cuda_available&quot;</span><span class="p">:</span> <span class="n">cuda_available</span><span class="p">,</span>
            <span class="s2">&quot;gpu_count&quot;</span><span class="p">:</span> <span class="n">gpu_count</span><span class="p">,</span>
            <span class="s2">&quot;gpu_names&quot;</span><span class="p">:</span> <span class="n">gpu_names</span><span class="p">,</span>
        <span class="p">}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_check_cuda_via_nvidia_smi</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check for CUDA availability using nvidia-smi command.</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool: True if CUDA is available via nvidia-smi, False otherwise.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
                <span class="p">[</span><span class="s2">&quot;nvidia-smi&quot;</span><span class="p">],</span> <span class="n">capture_output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">5</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="n">result</span><span class="o">.</span><span class="n">returncode</span> <span class="o">==</span> <span class="mi">0</span>
        <span class="k">except</span> <span class="p">(</span>
            <span class="n">subprocess</span><span class="o">.</span><span class="n">TimeoutExpired</span><span class="p">,</span>
            <span class="ne">FileNotFoundError</span><span class="p">,</span>
            <span class="n">subprocess</span><span class="o">.</span><span class="n">SubprocessError</span><span class="p">,</span>
        <span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_select_optimal_device</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Select the optimal PyTorch device based on platform and hardware.</span>

<span class="sd">        Device selection logic:</span>
<span class="sd">        1. macOS: Always use CPU (MPS support is experimental)</span>
<span class="sd">        2. Windows/Linux without GPUs: Use CPU</span>
<span class="sd">        3. Windows/Linux with GPUs but without CUDA: Use CPU</span>
<span class="sd">        4. Windows/Linux with GPUs and CUDA: Use GPU (cuda:0)</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: The recommended PyTorch device string.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Rule 1: macOS always uses CPU</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">platform_info</span><span class="p">[</span><span class="s2">&quot;is_macos&quot;</span><span class="p">]:</span>
            <span class="k">return</span> <span class="s2">&quot;cpu&quot;</span>

        <span class="c1"># Rule 2: No GPU available, use CPU</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">gpu_info</span><span class="p">[</span><span class="s2">&quot;gpu_available&quot;</span><span class="p">]:</span>
            <span class="k">return</span> <span class="s2">&quot;cpu&quot;</span>

        <span class="c1"># Rule 3: GPU available but no CUDA, use CPU</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">gpu_info</span><span class="p">[</span><span class="s2">&quot;cuda_available&quot;</span><span class="p">]:</span>
            <span class="k">return</span> <span class="s2">&quot;cpu&quot;</span>

        <span class="c1"># Rule 4: GPU and CUDA available, use GPU</span>
        <span class="k">return</span> <span class="s2">&quot;cuda:0&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_recommended_device</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the recommended PyTorch device for the current platform.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: The recommended device string (e.g., &#39;cpu&#39;, &#39;cuda:0&#39;).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">recommended_device</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_device_info</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get comprehensive device information.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Dict containing all device and platform information.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;platform&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">platform_info</span><span class="p">,</span>
            <span class="s2">&quot;gpu&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">gpu_info</span><span class="p">,</span>
            <span class="s2">&quot;recommended_device&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">recommended_device</span><span class="p">,</span>
        <span class="p">}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">configure_pytorch_device</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">force_device</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Configure PyTorch device and optionally move a model to the device.</span>

<span class="sd">        Args:</span>
<span class="sd">            model: Optional PyTorch model to move to the recommended device.</span>
<span class="sd">            force_device: Optional device string to force a specific device.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: The device string that was configured.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">device</span> <span class="o">=</span> <span class="n">force_device</span> <span class="k">if</span> <span class="n">force_device</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">recommended_device</span>

        <span class="k">if</span> <span class="n">model</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="kn">import</span><span class="w"> </span><span class="nn">torch</span>

                <span class="n">model</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Model moved to device: </span><span class="si">{</span><span class="n">device</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to move model to device </span><span class="si">{</span><span class="n">device</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="c1"># Fallback to CPU if device move fails</span>
                <span class="k">if</span> <span class="n">device</span> <span class="o">!=</span> <span class="s2">&quot;cpu&quot;</span><span class="p">:</span>
                    <span class="n">device</span> <span class="o">=</span> <span class="s2">&quot;cpu&quot;</span>
                    <span class="n">model</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Fallback: Model moved to CPU&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">device</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h5 id="ragora.utils.device_utils.DeviceManager._check_cuda_via_nvidia_smi" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">_check_cuda_via_nvidia_smi</span><span class="p">()</span></code>

<a href="#ragora.utils.device_utils.DeviceManager._check_cuda_via_nvidia_smi" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Check for CUDA availability using nvidia-smi command.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>bool</code></td>            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>True if CUDA is available via nvidia-smi, False otherwise.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/utils/device_utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">_check_cuda_via_nvidia_smi</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Check for CUDA availability using nvidia-smi command.</span>

<span class="sd">    Returns:</span>
<span class="sd">        bool: True if CUDA is available via nvidia-smi, False otherwise.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
            <span class="p">[</span><span class="s2">&quot;nvidia-smi&quot;</span><span class="p">],</span> <span class="n">capture_output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">5</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span><span class="o">.</span><span class="n">returncode</span> <span class="o">==</span> <span class="mi">0</span>
    <span class="k">except</span> <span class="p">(</span>
        <span class="n">subprocess</span><span class="o">.</span><span class="n">TimeoutExpired</span><span class="p">,</span>
        <span class="ne">FileNotFoundError</span><span class="p">,</span>
        <span class="n">subprocess</span><span class="o">.</span><span class="n">SubprocessError</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="k">return</span> <span class="kc">False</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="ragora.utils.device_utils.DeviceManager._detect_gpu_capabilities" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">_detect_gpu_capabilities</span><span class="p">()</span></code>

<a href="#ragora.utils.device_utils.DeviceManager._detect_gpu_capabilities" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Detect GPU and CUDA capabilities on the current system.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dict containing GPU availability and CUDA support information.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/utils/device_utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span>
<span class="normal">93</span>
<span class="normal">94</span>
<span class="normal">95</span>
<span class="normal">96</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">_detect_gpu_capabilities</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Detect GPU and CUDA capabilities on the current system.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Dict containing GPU availability and CUDA support information.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">gpu_available</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">cuda_available</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">gpu_count</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">gpu_names</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Try to import torch to check for GPU availability</span>
        <span class="kn">import</span><span class="w"> </span><span class="nn">torch</span>

        <span class="n">gpu_available</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">is_available</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">gpu_available</span><span class="p">:</span>
            <span class="n">gpu_count</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">device_count</span><span class="p">()</span>
            <span class="n">gpu_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">get_device_name</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">gpu_count</span><span class="p">)]</span>
            <span class="n">cuda_available</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;PyTorch not available for GPU detection&quot;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error detecting GPU capabilities: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Additional CUDA detection using nvidia-smi if available</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">cuda_available</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">platform_info</span><span class="p">[</span><span class="s2">&quot;is_macos&quot;</span><span class="p">]:</span>
        <span class="n">cuda_available</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_cuda_via_nvidia_smi</span><span class="p">()</span>

    <span class="k">return</span> <span class="p">{</span>
        <span class="s2">&quot;gpu_available&quot;</span><span class="p">:</span> <span class="n">gpu_available</span><span class="p">,</span>
        <span class="s2">&quot;cuda_available&quot;</span><span class="p">:</span> <span class="n">cuda_available</span><span class="p">,</span>
        <span class="s2">&quot;gpu_count&quot;</span><span class="p">:</span> <span class="n">gpu_count</span><span class="p">,</span>
        <span class="s2">&quot;gpu_names&quot;</span><span class="p">:</span> <span class="n">gpu_names</span><span class="p">,</span>
    <span class="p">}</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="ragora.utils.device_utils.DeviceManager._detect_platform" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">_detect_platform</span><span class="p">()</span></code>

<a href="#ragora.utils.device_utils.DeviceManager._detect_platform" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Detect the current platform and system information.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dict containing platform information including system, version, and architecture.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/utils/device_utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">_detect_platform</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Detect the current platform and system information.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Dict containing platform information including system, version, and architecture.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">system</span> <span class="o">=</span> <span class="n">platform</span><span class="o">.</span><span class="n">system</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    <span class="n">version</span> <span class="o">=</span> <span class="n">platform</span><span class="o">.</span><span class="n">version</span><span class="p">()</span>
    <span class="n">architecture</span> <span class="o">=</span> <span class="n">platform</span><span class="o">.</span><span class="n">machine</span><span class="p">()</span>

    <span class="k">return</span> <span class="p">{</span>
        <span class="s2">&quot;system&quot;</span><span class="p">:</span> <span class="n">system</span><span class="p">,</span>
        <span class="s2">&quot;version&quot;</span><span class="p">:</span> <span class="n">version</span><span class="p">,</span>
        <span class="s2">&quot;architecture&quot;</span><span class="p">:</span> <span class="n">architecture</span><span class="p">,</span>
        <span class="s2">&quot;is_macos&quot;</span><span class="p">:</span> <span class="n">system</span> <span class="o">==</span> <span class="s2">&quot;darwin&quot;</span><span class="p">,</span>
        <span class="s2">&quot;is_windows&quot;</span><span class="p">:</span> <span class="n">system</span> <span class="o">==</span> <span class="s2">&quot;windows&quot;</span><span class="p">,</span>
        <span class="s2">&quot;is_linux&quot;</span><span class="p">:</span> <span class="n">system</span> <span class="o">==</span> <span class="s2">&quot;linux&quot;</span><span class="p">,</span>
    <span class="p">}</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="ragora.utils.device_utils.DeviceManager._select_optimal_device" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">_select_optimal_device</span><span class="p">()</span></code>

<a href="#ragora.utils.device_utils.DeviceManager._select_optimal_device" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Select the optimal PyTorch device based on platform and hardware.</p>
<p>Device selection logic:
1. macOS: Always use CPU (MPS support is experimental)
2. Windows/Linux without GPUs: Use CPU
3. Windows/Linux with GPUs but without CUDA: Use CPU
4. Windows/Linux with GPUs and CUDA: Use GPU (cuda:0)</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>str</code></td>            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The recommended PyTorch device string.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/utils/device_utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">_select_optimal_device</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Select the optimal PyTorch device based on platform and hardware.</span>

<span class="sd">    Device selection logic:</span>
<span class="sd">    1. macOS: Always use CPU (MPS support is experimental)</span>
<span class="sd">    2. Windows/Linux without GPUs: Use CPU</span>
<span class="sd">    3. Windows/Linux with GPUs but without CUDA: Use CPU</span>
<span class="sd">    4. Windows/Linux with GPUs and CUDA: Use GPU (cuda:0)</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: The recommended PyTorch device string.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Rule 1: macOS always uses CPU</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">platform_info</span><span class="p">[</span><span class="s2">&quot;is_macos&quot;</span><span class="p">]:</span>
        <span class="k">return</span> <span class="s2">&quot;cpu&quot;</span>

    <span class="c1"># Rule 2: No GPU available, use CPU</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">gpu_info</span><span class="p">[</span><span class="s2">&quot;gpu_available&quot;</span><span class="p">]:</span>
        <span class="k">return</span> <span class="s2">&quot;cpu&quot;</span>

    <span class="c1"># Rule 3: GPU available but no CUDA, use CPU</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">gpu_info</span><span class="p">[</span><span class="s2">&quot;cuda_available&quot;</span><span class="p">]:</span>
        <span class="k">return</span> <span class="s2">&quot;cpu&quot;</span>

    <span class="c1"># Rule 4: GPU and CUDA available, use GPU</span>
    <span class="k">return</span> <span class="s2">&quot;cuda:0&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="ragora.utils.device_utils.DeviceManager.configure_pytorch_device" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">configure_pytorch_device</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">force_device</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#ragora.utils.device_utils.DeviceManager.configure_pytorch_device" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Configure PyTorch device and optionally move a model to the device.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>model</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional PyTorch model to move to the recommended device.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>force_device</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional device string to force a specific device.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>str</code></td>            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The device string that was configured.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/utils/device_utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">configure_pytorch_device</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">force_device</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Configure PyTorch device and optionally move a model to the device.</span>

<span class="sd">    Args:</span>
<span class="sd">        model: Optional PyTorch model to move to the recommended device.</span>
<span class="sd">        force_device: Optional device string to force a specific device.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: The device string that was configured.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">device</span> <span class="o">=</span> <span class="n">force_device</span> <span class="k">if</span> <span class="n">force_device</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">recommended_device</span>

    <span class="k">if</span> <span class="n">model</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="kn">import</span><span class="w"> </span><span class="nn">torch</span>

            <span class="n">model</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Model moved to device: </span><span class="si">{</span><span class="n">device</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to move model to device </span><span class="si">{</span><span class="n">device</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="c1"># Fallback to CPU if device move fails</span>
            <span class="k">if</span> <span class="n">device</span> <span class="o">!=</span> <span class="s2">&quot;cpu&quot;</span><span class="p">:</span>
                <span class="n">device</span> <span class="o">=</span> <span class="s2">&quot;cpu&quot;</span>
                <span class="n">model</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Fallback: Model moved to CPU&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">device</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="ragora.utils.device_utils.DeviceManager.get_device_info" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_device_info</span><span class="p">()</span></code>

<a href="#ragora.utils.device_utils.DeviceManager.get_device_info" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Get comprehensive device information.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dict containing all device and platform information.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/utils/device_utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_device_info</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get comprehensive device information.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Dict containing all device and platform information.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="s2">&quot;platform&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">platform_info</span><span class="p">,</span>
        <span class="s2">&quot;gpu&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">gpu_info</span><span class="p">,</span>
        <span class="s2">&quot;recommended_device&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">recommended_device</span><span class="p">,</span>
    <span class="p">}</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="ragora.utils.device_utils.DeviceManager.get_recommended_device" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_recommended_device</span><span class="p">()</span></code>

<a href="#ragora.utils.device_utils.DeviceManager.get_recommended_device" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Get the recommended PyTorch device for the current platform.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>str</code></td>            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The recommended device string (e.g., 'cpu', 'cuda:0').</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/utils/device_utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_recommended_device</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the recommended PyTorch device for the current platform.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: The recommended device string (e.g., &#39;cpu&#39;, &#39;cuda:0&#39;).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">recommended_device</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>


<div class="doc doc-object doc-function">


<h4 id="ragora.utils.device_utils.configure_pytorch_for_platform" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">configure_pytorch_for_platform</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">force_device</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#ragora.utils.device_utils.configure_pytorch_for_platform" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Configure PyTorch for the current platform.</p>
<p>This function automatically detects the platform and configures PyTorch
to use the optimal device. It's designed to be called once at the
beginning of your application or test setup.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>model</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional PyTorch model to move to the recommended device.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>force_device</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional device string to force a specific device.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>str</code></td>            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The device string that was configured.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="c1"># Basic usage - just get the recommended device</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">device</span> <span class="o">=</span> <span class="n">configure_pytorch_for_platform</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Using device: </span><span class="si">{</span><span class="n">device</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="c1"># With a model</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span><span class="w"> </span><span class="nn">torch</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">model</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">device</span> <span class="o">=</span> <span class="n">configure_pytorch_for_platform</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Model is on device: </span><span class="si">{</span><span class="n">device</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="c1"># Force a specific device (for testing)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">device</span> <span class="o">=</span> <span class="n">configure_pytorch_for_platform</span><span class="p">(</span><span class="n">force_device</span><span class="o">=</span><span class="s1">&#39;cpu&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Forced to device: </span><span class="si">{</span><span class="n">device</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/utils/device_utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">configure_pytorch_for_platform</span><span class="p">(</span>
    <span class="n">model</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">force_device</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Configure PyTorch for the current platform.</span>

<span class="sd">    This function automatically detects the platform and configures PyTorch</span>
<span class="sd">    to use the optimal device. It&#39;s designed to be called once at the</span>
<span class="sd">    beginning of your application or test setup.</span>

<span class="sd">    Args:</span>
<span class="sd">        model: Optional PyTorch model to move to the recommended device.</span>
<span class="sd">        force_device: Optional device string to force a specific device.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: The device string that was configured.</span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; # Basic usage - just get the recommended device</span>
<span class="sd">        &gt;&gt;&gt; device = configure_pytorch_for_platform()</span>
<span class="sd">        &gt;&gt;&gt; print(f&quot;Using device: {device}&quot;)</span>

<span class="sd">        &gt;&gt;&gt; # With a model</span>
<span class="sd">        &gt;&gt;&gt; import torch</span>
<span class="sd">        &gt;&gt;&gt; model = torch.nn.Linear(10, 1)</span>
<span class="sd">        &gt;&gt;&gt; device = configure_pytorch_for_platform(model)</span>
<span class="sd">        &gt;&gt;&gt; print(f&quot;Model is on device: {device}&quot;)</span>

<span class="sd">        &gt;&gt;&gt; # Force a specific device (for testing)</span>
<span class="sd">        &gt;&gt;&gt; device = configure_pytorch_for_platform(force_device=&#39;cpu&#39;)</span>
<span class="sd">        &gt;&gt;&gt; print(f&quot;Forced to device: {device}&quot;)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">get_device_manager</span><span class="p">()</span><span class="o">.</span><span class="n">configure_pytorch_device</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">force_device</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="ragora.utils.device_utils.get_device_info" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_device_info</span><span class="p">()</span></code>

<a href="#ragora.utils.device_utils.get_device_info" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Get comprehensive device and platform information.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dict containing platform, GPU, and device information.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="example" open>
  <summary>Example</summary>
  <blockquote>
<blockquote>
<blockquote>
<p>info = get_device_info()
print(f"Platform: {info['platform']['system']}")
print(f"GPU Available: {info['gpu']['gpu_available']}")
print(f"Recommended Device: {info['recommended_device']}")</p>
</blockquote>
</blockquote>
</blockquote>
</details>

            <details class="quote">
              <summary>Source code in <code>ragora/ragora/utils/device_utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_device_info</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get comprehensive device and platform information.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Dict containing platform, GPU, and device information.</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; info = get_device_info()</span>
<span class="sd">        &gt;&gt;&gt; print(f&quot;Platform: {info[&#39;platform&#39;][&#39;system&#39;]}&quot;)</span>
<span class="sd">        &gt;&gt;&gt; print(f&quot;GPU Available: {info[&#39;gpu&#39;][&#39;gpu_available&#39;]}&quot;)</span>
<span class="sd">        &gt;&gt;&gt; print(f&quot;Recommended Device: {info[&#39;recommended_device&#39;]}&quot;)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">get_device_manager</span><span class="p">()</span><span class="o">.</span><span class="n">get_device_info</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="ragora.utils.device_utils.get_device_manager" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_device_manager</span><span class="p">()</span></code>

<a href="#ragora.utils.device_utils.get_device_manager" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Get the global device manager instance.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>DeviceManager</code></td>            <td>
                  <code><a class="autorefs autorefs-internal" title="DeviceManager (ragora.utils.device_utils.DeviceManager)" href="#ragora.utils.device_utils.DeviceManager">DeviceManager</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The global device manager instance.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/utils/device_utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_device_manager</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">DeviceManager</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the global device manager instance.</span>

<span class="sd">    Returns:</span>
<span class="sd">        DeviceManager: The global device manager instance.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">global</span> <span class="n">_device_manager</span>
    <span class="k">if</span> <span class="n">_device_manager</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">_device_manager</span> <span class="o">=</span> <span class="n">DeviceManager</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">_device_manager</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="ragora.utils.device_utils.get_recommended_device" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_recommended_device</span><span class="p">()</span></code>

<a href="#ragora.utils.device_utils.get_recommended_device" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Get the recommended PyTorch device for the current platform.</p>
<p>This is a convenience function that returns the recommended device
without needing to instantiate the DeviceManager directly.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>str</code></td>            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The recommended device string.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/utils/device_utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_recommended_device</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the recommended PyTorch device for the current platform.</span>

<span class="sd">    This is a convenience function that returns the recommended device</span>
<span class="sd">    without needing to instantiate the DeviceManager directly.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: The recommended device string.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">get_device_manager</span><span class="p">()</span><span class="o">.</span><span class="n">get_recommended_device</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="ragora.utils.device_utils.get_sentence_transformer_device" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_sentence_transformer_device</span><span class="p">()</span></code>

<a href="#ragora.utils.device_utils.get_sentence_transformer_device" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Get the recommended device for sentence-transformers models.</p>
<p>This function is specifically designed for use with sentence-transformers
and handles the device string format expected by that library.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>str</code></td>            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The recommended device string for sentence-transformers.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/utils/device_utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_sentence_transformer_device</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the recommended device for sentence-transformers models.</span>

<span class="sd">    This function is specifically designed for use with sentence-transformers</span>
<span class="sd">    and handles the device string format expected by that library.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: The recommended device string for sentence-transformers.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">device</span> <span class="o">=</span> <span class="n">get_recommended_device</span><span class="p">()</span>

    <span class="c1"># sentence-transformers uses &#39;cuda&#39; instead of &#39;cuda:0&#39;</span>
    <span class="k">if</span> <span class="n">device</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;cuda&quot;</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;cuda&quot;</span>

    <span class="k">return</span> <span class="n">device</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="ragora.utils.device_utils.is_cuda_available" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">is_cuda_available</span><span class="p">()</span></code>

<a href="#ragora.utils.device_utils.is_cuda_available" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Check if CUDA is available on the current system.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>bool</code></td>            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>True if CUDA is available, False otherwise.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/utils/device_utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">is_cuda_available</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Check if CUDA is available on the current system.</span>

<span class="sd">    Returns:</span>
<span class="sd">        bool: True if CUDA is available, False otherwise.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">get_device_manager</span><span class="p">()</span><span class="o">.</span><span class="n">gpu_info</span><span class="p">[</span><span class="s2">&quot;cuda_available&quot;</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="ragora.utils.device_utils.is_gpu_available" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">is_gpu_available</span><span class="p">()</span></code>

<a href="#ragora.utils.device_utils.is_gpu_available" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Check if GPU is available on the current system.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>bool</code></td>            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>True if GPU is available, False otherwise.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/utils/device_utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">is_gpu_available</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Check if GPU is available on the current system.</span>

<span class="sd">    Returns:</span>
<span class="sd">        bool: True if GPU is available, False otherwise.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">get_device_manager</span><span class="p">()</span><span class="o">.</span><span class="n">gpu_info</span><span class="p">[</span><span class="s2">&quot;gpu_available&quot;</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="ragora.utils.device_utils.is_linux" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">is_linux</span><span class="p">()</span></code>

<a href="#ragora.utils.device_utils.is_linux" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Check if the current platform is Linux.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>bool</code></td>            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>True if running on Linux, False otherwise.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/utils/device_utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">is_linux</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Check if the current platform is Linux.</span>

<span class="sd">    Returns:</span>
<span class="sd">        bool: True if running on Linux, False otherwise.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">get_device_manager</span><span class="p">()</span><span class="o">.</span><span class="n">platform_info</span><span class="p">[</span><span class="s2">&quot;is_linux&quot;</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="ragora.utils.device_utils.is_macos" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">is_macos</span><span class="p">()</span></code>

<a href="#ragora.utils.device_utils.is_macos" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Check if the current platform is macOS.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>bool</code></td>            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>True if running on macOS, False otherwise.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/utils/device_utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">is_macos</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Check if the current platform is macOS.</span>

<span class="sd">    Returns:</span>
<span class="sd">        bool: True if running on macOS, False otherwise.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">get_device_manager</span><span class="p">()</span><span class="o">.</span><span class="n">platform_info</span><span class="p">[</span><span class="s2">&quot;is_macos&quot;</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="ragora.utils.device_utils.is_windows" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">is_windows</span><span class="p">()</span></code>

<a href="#ragora.utils.device_utils.is_windows" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Check if the current platform is Windows.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>bool</code></td>            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>True if running on Windows, False otherwise.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/utils/device_utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">is_windows</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Check if the current platform is Windows.</span>

<span class="sd">    Returns:</span>
<span class="sd">        bool: True if running on Windows, False otherwise.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">get_device_manager</span><span class="p">()</span><span class="o">.</span><span class="n">platform_info</span><span class="p">[</span><span class="s2">&quot;is_windows&quot;</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="ragora.utils.device_utils.mock_platform_info" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">mock_platform_info</span><span class="p">(</span><span class="n">platform_info</span><span class="p">,</span> <span class="n">gpu_info</span><span class="p">)</span></code>

<a href="#ragora.utils.device_utils.mock_platform_info" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Mock platform and GPU information for testing.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>platform_info</code>
            </td>
            <td>
                  <code><span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Mock platform information.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>gpu_info</code>
            </td>
            <td>
                  <code><span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Mock GPU information.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>
        <p>This function is intended for testing scenarios where you need to
simulate different platform configurations.</p>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/utils/device_utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">mock_platform_info</span><span class="p">(</span><span class="n">platform_info</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">gpu_info</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Mock platform and GPU information for testing.</span>

<span class="sd">    Args:</span>
<span class="sd">        platform_info: Mock platform information.</span>
<span class="sd">        gpu_info: Mock GPU information.</span>

<span class="sd">    This function is intended for testing scenarios where you need to</span>
<span class="sd">    simulate different platform configurations.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">global</span> <span class="n">_device_manager</span>
    <span class="n">_device_manager</span> <span class="o">=</span> <span class="n">DeviceManager</span><span class="p">()</span>
    <span class="n">_device_manager</span><span class="o">.</span><span class="n">platform_info</span> <span class="o">=</span> <span class="n">platform_info</span>
    <span class="n">_device_manager</span><span class="o">.</span><span class="n">gpu_info</span> <span class="o">=</span> <span class="n">gpu_info</span>
    <span class="n">_device_manager</span><span class="o">.</span><span class="n">recommended_device</span> <span class="o">=</span> <span class="n">_device_manager</span><span class="o">.</span><span class="n">_select_optimal_device</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="ragora.utils.device_utils.reset_device_manager" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">reset_device_manager</span><span class="p">()</span></code>

<a href="#ragora.utils.device_utils.reset_device_manager" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Reset the global device manager (useful for testing).</p>
<p>This function is primarily intended for testing scenarios where you
need to reset the device detection state.</p>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/utils/device_utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">reset_device_manager</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Reset the global device manager (useful for testing).</span>

<span class="sd">    This function is primarily intended for testing scenarios where you</span>
<span class="sd">    need to reset the device detection state.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">global</span> <span class="n">_device_manager</span>
    <span class="n">_device_manager</span> <span class="o">=</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div><h3 id="email-provider-factory">Email Provider Factory<a class="headerlink" href="#email-provider-factory" title="Permanent link">&para;</a></h3>


<div class="doc doc-object doc-module">



<a id="ragora.utils.email_provider_factory"></a>
    <div class="doc doc-contents first">

        <p>Factory helpers for creating email provider implementations.</p>










  <div class="doc doc-children">









<div class="doc doc-object doc-class">



<h4 id="ragora.utils.email_provider_factory.EmailProviderFactory" class="doc doc-heading">
            <code>EmailProviderFactory</code>


<a href="#ragora.utils.email_provider_factory.EmailProviderFactory" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">


        <p>Factory for constructing concrete email providers.</p>


<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><span class="n">provider</span> <span class="o">=</span> <span class="n">EmailProviderFactory</span><span class="o">.</span><span class="n">create_provider</span><span class="p">(</span>
    <span class="n">ProviderType</span><span class="o">.</span><span class="n">IMAP</span><span class="p">,</span>
    <span class="n">IMAPCredentials</span><span class="p">(</span>
        <span class="n">imap_server</span><span class="o">=</span><span class="s2">&quot;imap.example.com&quot;</span><span class="p">,</span>
        <span class="n">imap_port</span><span class="o">=</span><span class="mi">993</span><span class="p">,</span>
        <span class="n">smtp_server</span><span class="o">=</span><span class="s2">&quot;smtp.example.com&quot;</span><span class="p">,</span>
        <span class="n">smtp_port</span><span class="o">=</span><span class="mi">587</span><span class="p">,</span>
        <span class="n">username</span><span class="o">=</span><span class="s2">&quot;user&quot;</span><span class="p">,</span>
        <span class="n">password</span><span class="o">=</span><span class="s2">&quot;pass&quot;</span><span class="p">,</span>
    <span class="p">),</span>
<span class="p">)</span>
<span class="n">provider</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span>
</code></pre></div>








              <details class="quote">
                <summary>Source code in <code>ragora/ragora/utils/email_provider_factory.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">EmailProviderFactory</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Factory for constructing concrete email providers.</span>

<span class="sd">    Examples:</span>
<span class="sd">        ```python</span>
<span class="sd">        provider = EmailProviderFactory.create_provider(</span>
<span class="sd">            ProviderType.IMAP,</span>
<span class="sd">            IMAPCredentials(</span>
<span class="sd">                imap_server=&quot;imap.example.com&quot;,</span>
<span class="sd">                imap_port=993,</span>
<span class="sd">                smtp_server=&quot;smtp.example.com&quot;,</span>
<span class="sd">                smtp_port=587,</span>
<span class="sd">                username=&quot;user&quot;,</span>
<span class="sd">                password=&quot;pass&quot;,</span>
<span class="sd">            ),</span>
<span class="sd">        )</span>
<span class="sd">        provider.connect()</span>
<span class="sd">        ```</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">create_provider</span><span class="p">(</span>
        <span class="n">provider_type</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">ProviderType</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
        <span class="n">credentials</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">IMAPCredentials</span><span class="p">,</span> <span class="n">GraphCredentials</span><span class="p">],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">EmailProvider</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create an email provider instance.</span>

<span class="sd">        Args:</span>
<span class="sd">            provider_type: Type of provider to create (ProviderType enum or string)</span>
<span class="sd">            credentials: Provider-specific credentials</span>

<span class="sd">        Returns:</span>
<span class="sd">            EmailProvider: Concrete provider instance.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If the provider type is unsupported.</span>
<span class="sd">            TypeError: If the provided credentials do not match the provider type.</span>

<span class="sd">        Examples:</span>
<span class="sd">            ```python</span>
<span class="sd">            provider = EmailProviderFactory.create_provider(</span>
<span class="sd">                ProviderType.IMAP,</span>
<span class="sd">                IMAPCredentials(</span>
<span class="sd">                    imap_server=&quot;imap.example.com&quot;,</span>
<span class="sd">                    imap_port=993,</span>
<span class="sd">                    smtp_server=&quot;smtp.example.com&quot;,</span>
<span class="sd">                    smtp_port=587,</span>
<span class="sd">                    username=&quot;user&quot;,</span>
<span class="sd">                    password=&quot;pass&quot;,</span>
<span class="sd">                ),</span>
<span class="sd">            )</span>
<span class="sd">            ```</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Normalize provider type</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">provider_type</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">provider_type</span> <span class="o">=</span> <span class="n">ProviderType</span><span class="p">(</span><span class="n">provider_type</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unsupported provider type: </span><span class="si">{</span><span class="n">provider_type</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Validate credentials match provider type</span>
        <span class="k">if</span> <span class="n">provider_type</span> <span class="o">==</span> <span class="n">ProviderType</span><span class="o">.</span><span class="n">IMAP</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">credentials</span><span class="p">,</span> <span class="n">IMAPCredentials</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;IMAP provider requires IMAPCredentials&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">IMAPProvider</span><span class="p">(</span><span class="n">credentials</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">provider_type</span> <span class="o">==</span> <span class="n">ProviderType</span><span class="o">.</span><span class="n">GRAPH</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">credentials</span><span class="p">,</span> <span class="n">GraphCredentials</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Graph provider requires GraphCredentials&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">GraphProvider</span><span class="p">(</span><span class="n">credentials</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unsupported provider type: </span><span class="si">{</span><span class="n">provider_type</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">create_imap_provider</span><span class="p">(</span>
        <span class="n">imap_server</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">imap_port</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">smtp_server</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">smtp_port</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">username</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">password</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">use_ssl</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">use_tls</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">IMAPProvider</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create an IMAP provider with the given configuration.</span>

<span class="sd">        Args:</span>
<span class="sd">            imap_server: IMAP server hostname</span>
<span class="sd">            imap_port: IMAP server port</span>
<span class="sd">            smtp_server: SMTP server hostname</span>
<span class="sd">            smtp_port: SMTP server port</span>
<span class="sd">            username: Email username</span>
<span class="sd">            password: Email password</span>
<span class="sd">            use_ssl: Whether to use SSL for IMAP connection</span>
<span class="sd">            use_tls: Whether to use TLS for IMAP connection</span>

<span class="sd">        Returns:</span>
<span class="sd">            IMAPProvider: Configured provider instance.</span>

<span class="sd">        Examples:</span>
<span class="sd">            ```python</span>
<span class="sd">            provider = EmailProviderFactory.create_imap_provider(</span>
<span class="sd">                imap_server=&quot;imap.example.com&quot;,</span>
<span class="sd">                imap_port=993,</span>
<span class="sd">                smtp_server=&quot;smtp.example.com&quot;,</span>
<span class="sd">                smtp_port=587,</span>
<span class="sd">                username=&quot;user&quot;,</span>
<span class="sd">                password=&quot;pass&quot;,</span>
<span class="sd">            )</span>
<span class="sd">            ```</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">credentials</span> <span class="o">=</span> <span class="n">IMAPCredentials</span><span class="p">(</span>
            <span class="n">imap_server</span><span class="o">=</span><span class="n">imap_server</span><span class="p">,</span>
            <span class="n">imap_port</span><span class="o">=</span><span class="n">imap_port</span><span class="p">,</span>
            <span class="n">smtp_server</span><span class="o">=</span><span class="n">smtp_server</span><span class="p">,</span>
            <span class="n">smtp_port</span><span class="o">=</span><span class="n">smtp_port</span><span class="p">,</span>
            <span class="n">username</span><span class="o">=</span><span class="n">username</span><span class="p">,</span>
            <span class="n">password</span><span class="o">=</span><span class="n">password</span><span class="p">,</span>
            <span class="n">use_ssl</span><span class="o">=</span><span class="n">use_ssl</span><span class="p">,</span>
            <span class="n">use_tls</span><span class="o">=</span><span class="n">use_tls</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">IMAPProvider</span><span class="p">(</span><span class="n">credentials</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">create_graph_provider</span><span class="p">(</span>
        <span class="n">client_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">client_secret</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">tenant_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">access_token</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">refresh_token</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">GraphProvider</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a Microsoft Graph provider with the given configuration.</span>

<span class="sd">        Args:</span>
<span class="sd">            client_id: Azure application client ID</span>
<span class="sd">            client_secret: Azure application client secret</span>
<span class="sd">            tenant_id: Azure tenant ID</span>
<span class="sd">            access_token: Optional access token (if not provided, will use client credentials)</span>
<span class="sd">            refresh_token: Optional refresh token</span>

<span class="sd">        Returns:</span>
<span class="sd">            GraphProvider: Configured provider instance.</span>

<span class="sd">        Examples:</span>
<span class="sd">            ```python</span>
<span class="sd">            provider = EmailProviderFactory.create_graph_provider(</span>
<span class="sd">                client_id=&quot;app-id&quot;,</span>
<span class="sd">                client_secret=&quot;secret&quot;,</span>
<span class="sd">                tenant_id=&quot;tenant&quot;,</span>
<span class="sd">            )</span>
<span class="sd">            ```</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">credentials</span> <span class="o">=</span> <span class="n">GraphCredentials</span><span class="p">(</span>
            <span class="n">client_id</span><span class="o">=</span><span class="n">client_id</span><span class="p">,</span>
            <span class="n">client_secret</span><span class="o">=</span><span class="n">client_secret</span><span class="p">,</span>
            <span class="n">tenant_id</span><span class="o">=</span><span class="n">tenant_id</span><span class="p">,</span>
            <span class="n">access_token</span><span class="o">=</span><span class="n">access_token</span><span class="p">,</span>
            <span class="n">refresh_token</span><span class="o">=</span><span class="n">refresh_token</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">GraphProvider</span><span class="p">(</span><span class="n">credentials</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_supported_providers</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get list of supported provider types.</span>

<span class="sd">        Returns:</span>
<span class="sd">            List of supported provider type names</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">provider</span><span class="o">.</span><span class="n">value</span> <span class="k">for</span> <span class="n">provider</span> <span class="ow">in</span> <span class="n">ProviderType</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h5 id="ragora.utils.email_provider_factory.EmailProviderFactory.create_graph_provider" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">create_graph_provider</span><span class="p">(</span><span class="n">client_id</span><span class="p">,</span> <span class="n">client_secret</span><span class="p">,</span> <span class="n">tenant_id</span><span class="p">,</span> <span class="n">access_token</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">refresh_token</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#ragora.utils.email_provider_factory.EmailProviderFactory.create_graph_provider" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Create a Microsoft Graph provider with the given configuration.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>client_id</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Azure application client ID</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>client_secret</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Azure application client secret</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>tenant_id</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Azure tenant ID</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>access_token</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional access token (if not provided, will use client credentials)</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>refresh_token</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional refresh token</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>GraphProvider</code></td>            <td>
                  <code><a class="autorefs autorefs-internal" title="GraphProvider (ragora.utils.email_utils.graph_provider.GraphProvider)" href="#ragora.utils.email_utils.graph_provider.GraphProvider">GraphProvider</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Configured provider instance.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><span class="n">provider</span> <span class="o">=</span> <span class="n">EmailProviderFactory</span><span class="o">.</span><span class="n">create_graph_provider</span><span class="p">(</span>
    <span class="n">client_id</span><span class="o">=</span><span class="s2">&quot;app-id&quot;</span><span class="p">,</span>
    <span class="n">client_secret</span><span class="o">=</span><span class="s2">&quot;secret&quot;</span><span class="p">,</span>
    <span class="n">tenant_id</span><span class="o">=</span><span class="s2">&quot;tenant&quot;</span><span class="p">,</span>
<span class="p">)</span>
</code></pre></div>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/utils/email_provider_factory.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">create_graph_provider</span><span class="p">(</span>
    <span class="n">client_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">client_secret</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">tenant_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">access_token</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">refresh_token</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">GraphProvider</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create a Microsoft Graph provider with the given configuration.</span>

<span class="sd">    Args:</span>
<span class="sd">        client_id: Azure application client ID</span>
<span class="sd">        client_secret: Azure application client secret</span>
<span class="sd">        tenant_id: Azure tenant ID</span>
<span class="sd">        access_token: Optional access token (if not provided, will use client credentials)</span>
<span class="sd">        refresh_token: Optional refresh token</span>

<span class="sd">    Returns:</span>
<span class="sd">        GraphProvider: Configured provider instance.</span>

<span class="sd">    Examples:</span>
<span class="sd">        ```python</span>
<span class="sd">        provider = EmailProviderFactory.create_graph_provider(</span>
<span class="sd">            client_id=&quot;app-id&quot;,</span>
<span class="sd">            client_secret=&quot;secret&quot;,</span>
<span class="sd">            tenant_id=&quot;tenant&quot;,</span>
<span class="sd">        )</span>
<span class="sd">        ```</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">credentials</span> <span class="o">=</span> <span class="n">GraphCredentials</span><span class="p">(</span>
        <span class="n">client_id</span><span class="o">=</span><span class="n">client_id</span><span class="p">,</span>
        <span class="n">client_secret</span><span class="o">=</span><span class="n">client_secret</span><span class="p">,</span>
        <span class="n">tenant_id</span><span class="o">=</span><span class="n">tenant_id</span><span class="p">,</span>
        <span class="n">access_token</span><span class="o">=</span><span class="n">access_token</span><span class="p">,</span>
        <span class="n">refresh_token</span><span class="o">=</span><span class="n">refresh_token</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">GraphProvider</span><span class="p">(</span><span class="n">credentials</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="ragora.utils.email_provider_factory.EmailProviderFactory.create_imap_provider" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">create_imap_provider</span><span class="p">(</span><span class="n">imap_server</span><span class="p">,</span> <span class="n">imap_port</span><span class="p">,</span> <span class="n">smtp_server</span><span class="p">,</span> <span class="n">smtp_port</span><span class="p">,</span> <span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">,</span> <span class="n">use_ssl</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">use_tls</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#ragora.utils.email_provider_factory.EmailProviderFactory.create_imap_provider" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Create an IMAP provider with the given configuration.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>imap_server</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>IMAP server hostname</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>imap_port</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>IMAP server port</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>smtp_server</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>SMTP server hostname</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>smtp_port</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>SMTP server port</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>username</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Email username</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>password</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Email password</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>use_ssl</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to use SSL for IMAP connection</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>use_tls</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to use TLS for IMAP connection</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>IMAPProvider</code></td>            <td>
                  <code><a class="autorefs autorefs-internal" title="IMAPProvider (ragora.utils.email_utils.imap_provider.IMAPProvider)" href="#ragora.utils.email_utils.imap_provider.IMAPProvider">IMAPProvider</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Configured provider instance.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><span class="n">provider</span> <span class="o">=</span> <span class="n">EmailProviderFactory</span><span class="o">.</span><span class="n">create_imap_provider</span><span class="p">(</span>
    <span class="n">imap_server</span><span class="o">=</span><span class="s2">&quot;imap.example.com&quot;</span><span class="p">,</span>
    <span class="n">imap_port</span><span class="o">=</span><span class="mi">993</span><span class="p">,</span>
    <span class="n">smtp_server</span><span class="o">=</span><span class="s2">&quot;smtp.example.com&quot;</span><span class="p">,</span>
    <span class="n">smtp_port</span><span class="o">=</span><span class="mi">587</span><span class="p">,</span>
    <span class="n">username</span><span class="o">=</span><span class="s2">&quot;user&quot;</span><span class="p">,</span>
    <span class="n">password</span><span class="o">=</span><span class="s2">&quot;pass&quot;</span><span class="p">,</span>
<span class="p">)</span>
</code></pre></div>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/utils/email_provider_factory.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">create_imap_provider</span><span class="p">(</span>
    <span class="n">imap_server</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">imap_port</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">smtp_server</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">smtp_port</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">username</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">password</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">use_ssl</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">use_tls</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">IMAPProvider</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create an IMAP provider with the given configuration.</span>

<span class="sd">    Args:</span>
<span class="sd">        imap_server: IMAP server hostname</span>
<span class="sd">        imap_port: IMAP server port</span>
<span class="sd">        smtp_server: SMTP server hostname</span>
<span class="sd">        smtp_port: SMTP server port</span>
<span class="sd">        username: Email username</span>
<span class="sd">        password: Email password</span>
<span class="sd">        use_ssl: Whether to use SSL for IMAP connection</span>
<span class="sd">        use_tls: Whether to use TLS for IMAP connection</span>

<span class="sd">    Returns:</span>
<span class="sd">        IMAPProvider: Configured provider instance.</span>

<span class="sd">    Examples:</span>
<span class="sd">        ```python</span>
<span class="sd">        provider = EmailProviderFactory.create_imap_provider(</span>
<span class="sd">            imap_server=&quot;imap.example.com&quot;,</span>
<span class="sd">            imap_port=993,</span>
<span class="sd">            smtp_server=&quot;smtp.example.com&quot;,</span>
<span class="sd">            smtp_port=587,</span>
<span class="sd">            username=&quot;user&quot;,</span>
<span class="sd">            password=&quot;pass&quot;,</span>
<span class="sd">        )</span>
<span class="sd">        ```</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">credentials</span> <span class="o">=</span> <span class="n">IMAPCredentials</span><span class="p">(</span>
        <span class="n">imap_server</span><span class="o">=</span><span class="n">imap_server</span><span class="p">,</span>
        <span class="n">imap_port</span><span class="o">=</span><span class="n">imap_port</span><span class="p">,</span>
        <span class="n">smtp_server</span><span class="o">=</span><span class="n">smtp_server</span><span class="p">,</span>
        <span class="n">smtp_port</span><span class="o">=</span><span class="n">smtp_port</span><span class="p">,</span>
        <span class="n">username</span><span class="o">=</span><span class="n">username</span><span class="p">,</span>
        <span class="n">password</span><span class="o">=</span><span class="n">password</span><span class="p">,</span>
        <span class="n">use_ssl</span><span class="o">=</span><span class="n">use_ssl</span><span class="p">,</span>
        <span class="n">use_tls</span><span class="o">=</span><span class="n">use_tls</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">IMAPProvider</span><span class="p">(</span><span class="n">credentials</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="ragora.utils.email_provider_factory.EmailProviderFactory.create_provider" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">create_provider</span><span class="p">(</span><span class="n">provider_type</span><span class="p">,</span> <span class="n">credentials</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#ragora.utils.email_provider_factory.EmailProviderFactory.create_provider" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Create an email provider instance.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>provider_type</code>
            </td>
            <td>
                  <code><span title="typing.Union">Union</span>[<a class="autorefs autorefs-internal" title="ProviderType (ragora.utils.email_provider_factory.ProviderType)" href="#ragora.utils.email_provider_factory.ProviderType">ProviderType</a>, <span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Type of provider to create (ProviderType enum or string)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>credentials</code>
            </td>
            <td>
                  <code><span title="typing.Union">Union</span>[<a class="autorefs autorefs-internal" title="IMAPCredentials


  
      dataclass
   (ragora.utils.email_utils.models.IMAPCredentials)" href="#ragora.utils.email_utils.models.IMAPCredentials">IMAPCredentials</a>, <a class="autorefs autorefs-internal" title="GraphCredentials


  
      dataclass
   (ragora.utils.email_utils.models.GraphCredentials)" href="#ragora.utils.email_utils.models.GraphCredentials">GraphCredentials</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Provider-specific credentials</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>EmailProvider</code></td>            <td>
                  <code><a class="autorefs autorefs-internal" title="EmailProvider (ragora.utils.email_utils.base.EmailProvider)" href="#ragora.utils.email_utils.base.EmailProvider">EmailProvider</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Concrete provider instance.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If the provider type is unsupported.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="TypeError">TypeError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If the provided credentials do not match the provider type.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><span class="n">provider</span> <span class="o">=</span> <span class="n">EmailProviderFactory</span><span class="o">.</span><span class="n">create_provider</span><span class="p">(</span>
    <span class="n">ProviderType</span><span class="o">.</span><span class="n">IMAP</span><span class="p">,</span>
    <span class="n">IMAPCredentials</span><span class="p">(</span>
        <span class="n">imap_server</span><span class="o">=</span><span class="s2">&quot;imap.example.com&quot;</span><span class="p">,</span>
        <span class="n">imap_port</span><span class="o">=</span><span class="mi">993</span><span class="p">,</span>
        <span class="n">smtp_server</span><span class="o">=</span><span class="s2">&quot;smtp.example.com&quot;</span><span class="p">,</span>
        <span class="n">smtp_port</span><span class="o">=</span><span class="mi">587</span><span class="p">,</span>
        <span class="n">username</span><span class="o">=</span><span class="s2">&quot;user&quot;</span><span class="p">,</span>
        <span class="n">password</span><span class="o">=</span><span class="s2">&quot;pass&quot;</span><span class="p">,</span>
    <span class="p">),</span>
<span class="p">)</span>
</code></pre></div>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/utils/email_provider_factory.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">create_provider</span><span class="p">(</span>
    <span class="n">provider_type</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">ProviderType</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
    <span class="n">credentials</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">IMAPCredentials</span><span class="p">,</span> <span class="n">GraphCredentials</span><span class="p">],</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">EmailProvider</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create an email provider instance.</span>

<span class="sd">    Args:</span>
<span class="sd">        provider_type: Type of provider to create (ProviderType enum or string)</span>
<span class="sd">        credentials: Provider-specific credentials</span>

<span class="sd">    Returns:</span>
<span class="sd">        EmailProvider: Concrete provider instance.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If the provider type is unsupported.</span>
<span class="sd">        TypeError: If the provided credentials do not match the provider type.</span>

<span class="sd">    Examples:</span>
<span class="sd">        ```python</span>
<span class="sd">        provider = EmailProviderFactory.create_provider(</span>
<span class="sd">            ProviderType.IMAP,</span>
<span class="sd">            IMAPCredentials(</span>
<span class="sd">                imap_server=&quot;imap.example.com&quot;,</span>
<span class="sd">                imap_port=993,</span>
<span class="sd">                smtp_server=&quot;smtp.example.com&quot;,</span>
<span class="sd">                smtp_port=587,</span>
<span class="sd">                username=&quot;user&quot;,</span>
<span class="sd">                password=&quot;pass&quot;,</span>
<span class="sd">            ),</span>
<span class="sd">        )</span>
<span class="sd">        ```</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Normalize provider type</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">provider_type</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">provider_type</span> <span class="o">=</span> <span class="n">ProviderType</span><span class="p">(</span><span class="n">provider_type</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unsupported provider type: </span><span class="si">{</span><span class="n">provider_type</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Validate credentials match provider type</span>
    <span class="k">if</span> <span class="n">provider_type</span> <span class="o">==</span> <span class="n">ProviderType</span><span class="o">.</span><span class="n">IMAP</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">credentials</span><span class="p">,</span> <span class="n">IMAPCredentials</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;IMAP provider requires IMAPCredentials&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">IMAPProvider</span><span class="p">(</span><span class="n">credentials</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">provider_type</span> <span class="o">==</span> <span class="n">ProviderType</span><span class="o">.</span><span class="n">GRAPH</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">credentials</span><span class="p">,</span> <span class="n">GraphCredentials</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Graph provider requires GraphCredentials&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">GraphProvider</span><span class="p">(</span><span class="n">credentials</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unsupported provider type: </span><span class="si">{</span><span class="n">provider_type</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="ragora.utils.email_provider_factory.EmailProviderFactory.get_supported_providers" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_supported_providers</span><span class="p">()</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#ragora.utils.email_provider_factory.EmailProviderFactory.get_supported_providers" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Get list of supported provider types.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="list">list</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of supported provider type names</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/utils/email_provider_factory.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">get_supported_providers</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get list of supported provider types.</span>

<span class="sd">    Returns:</span>
<span class="sd">        List of supported provider type names</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">provider</span><span class="o">.</span><span class="n">value</span> <span class="k">for</span> <span class="n">provider</span> <span class="ow">in</span> <span class="n">ProviderType</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="ragora.utils.email_provider_factory.ProviderType" class="doc doc-heading">
            <code>ProviderType</code>


<a href="#ragora.utils.email_provider_factory.ProviderType" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="enum.Enum">Enum</span></code></p>


        <p>Supported email provider types.</p>








              <details class="quote">
                <summary>Source code in <code>ragora/ragora/utils/email_provider_factory.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">ProviderType</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Supported email provider types.&quot;&quot;&quot;</span>

    <span class="n">IMAP</span> <span class="o">=</span> <span class="s2">&quot;imap&quot;</span>
    <span class="n">GRAPH</span> <span class="o">=</span> <span class="s2">&quot;graph&quot;</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">












  </div>

    </div>

</div>




  </div>

    </div>

</div><h3 id="email-utils">Email Utils<a class="headerlink" href="#email-utils" title="Permanent link">&para;</a></h3>


<div class="doc doc-object doc-module">



<a id="ragora.utils.email_utils.base"></a>
    <div class="doc doc-contents first">

        <p>Base email provider interface.</p>










  <div class="doc doc-children">









<div class="doc doc-object doc-class">



<h4 id="ragora.utils.email_utils.base.EmailProvider" class="doc doc-heading">
            <code>EmailProvider</code>


<a href="#ragora.utils.email_utils.base.EmailProvider" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="abc.ABC">ABC</span></code></p>


        <p>Abstract base class for email providers.</p>
<p>This interface defines the contract that all email providers must implement,
allowing the RAG system to work with different email backends seamlessly.</p>








              <details class="quote">
                <summary>Source code in <code>ragora/ragora/utils/email_utils/base.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">  9</span>
<span class="normal"> 10</span>
<span class="normal"> 11</span>
<span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">EmailProvider</span><span class="p">(</span><span class="n">ABC</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Abstract base class for email providers.</span>

<span class="sd">    This interface defines the contract that all email providers must implement,</span>
<span class="sd">    allowing the RAG system to work with different email backends seamlessly.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">credentials</span><span class="p">:</span> <span class="n">EmailCredentials</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the email provider with credentials.</span>

<span class="sd">        Args:</span>
<span class="sd">            credentials: Provider-specific credentials for authentication</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">credentials</span> <span class="o">=</span> <span class="n">credentials</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">connect</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Establish connection to the email service.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ConnectionError: If connection fails</span>
<span class="sd">            AuthenticationError: If authentication fails</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">disconnect</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Close connection to the email service.&quot;&quot;&quot;</span>
        <span class="k">pass</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">fetch_messages</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span> <span class="n">folder</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">unread_only</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">EmailMessage</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Fetch messages from the email service.</span>

<span class="sd">        Args:</span>
<span class="sd">            limit: Maximum number of messages to fetch</span>
<span class="sd">            folder: Specific folder to fetch from (None for inbox)</span>
<span class="sd">            unread_only: If True, only fetch unread messages</span>

<span class="sd">        Returns:</span>
<span class="sd">            List of EmailMessage objects</span>

<span class="sd">        Raises:</span>
<span class="sd">            ConnectionError: If not connected</span>
<span class="sd">            FetchError: If message fetching fails</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">fetch_message_by_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">EmailMessage</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Fetch a specific message by its ID.</span>

<span class="sd">        Args:</span>
<span class="sd">            message_id: Unique identifier for the message</span>

<span class="sd">        Returns:</span>
<span class="sd">            EmailMessage object or None if not found</span>

<span class="sd">        Raises:</span>
<span class="sd">            ConnectionError: If not connected</span>
<span class="sd">            FetchError: If message fetching fails</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">create_draft</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">to</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
        <span class="n">subject</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">body</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">cc</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">bcc</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">attachments</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">folder</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;Drafts&quot;</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">EmailDraft</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a draft message.</span>

<span class="sd">        Args:</span>
<span class="sd">            to: List of recipient email addresses</span>
<span class="sd">            subject: Email subject line</span>
<span class="sd">            body: Email body content (HTML or plain text)</span>
<span class="sd">            cc: Optional list of CC recipient email addresses</span>
<span class="sd">            bcc: Optional list of BCC recipient email addresses</span>
<span class="sd">            attachments: Optional list of file paths to attach</span>
<span class="sd">            folder: Folder to store the draft in (default: &quot;Drafts&quot;)</span>

<span class="sd">        Returns:</span>
<span class="sd">            EmailDraft object with the created draft</span>

<span class="sd">        Raises:</span>
<span class="sd">            ConnectionError: If not connected</span>
<span class="sd">            DraftError: If draft creation fails</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">send_message</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">draft_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">folder</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;Drafts&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Send a draft message.</span>

<span class="sd">        Args:</span>
<span class="sd">            draft_id: ID of the draft to send</span>
<span class="sd">            folder: Folder where the draft is stored (default: &quot;Drafts&quot;)</span>

<span class="sd">        Returns:</span>
<span class="sd">            True if message was sent successfully</span>

<span class="sd">        Raises:</span>
<span class="sd">            ConnectionError: If not connected</span>
<span class="sd">            SendError: If message sending fails</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">send_message_direct</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">to</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
        <span class="n">subject</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">body</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">cc</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">bcc</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">attachments</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Send a message directly without creating a draft.</span>

<span class="sd">        Args:</span>
<span class="sd">            to: List of recipient email addresses</span>
<span class="sd">            subject: Email subject line</span>
<span class="sd">            body: Email body content (HTML or plain text)</span>
<span class="sd">            cc: Optional list of CC recipient email addresses</span>
<span class="sd">            bcc: Optional list of BCC recipient email addresses</span>
<span class="sd">            attachments: Optional list of file paths to attach</span>

<span class="sd">        Returns:</span>
<span class="sd">            True if message was sent successfully</span>

<span class="sd">        Raises:</span>
<span class="sd">            ConnectionError: If not connected</span>
<span class="sd">            SendError: If message sending fails</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">mark_as_read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Mark a message as read.</span>

<span class="sd">        Args:</span>
<span class="sd">            message_id: ID of the message to mark as read</span>

<span class="sd">        Returns:</span>
<span class="sd">            True if message was marked as read successfully</span>

<span class="sd">        Raises:</span>
<span class="sd">            ConnectionError: If not connected</span>
<span class="sd">            UpdateError: If marking fails</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_folders</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get list of available folders.</span>

<span class="sd">        Returns:</span>
<span class="sd">            List of folder names</span>

<span class="sd">        Raises:</span>
<span class="sd">            ConnectionError: If not connected</span>
<span class="sd">            FetchError: If folder fetching fails</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span>

    <span class="nd">@property</span>
    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">is_connected</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if the provider is connected to the email service.</span>

<span class="sd">        Returns:</span>
<span class="sd">            True if connected, False otherwise</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h5 id="ragora.utils.email_utils.base.EmailProvider.is_connected" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">is_connected</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-abstractmethod"><code>abstractmethod</code></small>
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#ragora.utils.email_utils.base.EmailProvider.is_connected" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Check if the provider is connected to the email service.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>True if connected, False otherwise</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

    </div>

</div>




<div class="doc doc-object doc-function">


<h5 id="ragora.utils.email_utils.base.EmailProvider.connect" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">connect</span><span class="p">()</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-abstractmethod"><code>abstractmethod</code></small>
  </span>

<a href="#ragora.utils.email_utils.base.EmailProvider.connect" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Establish connection to the email service.</p>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ConnectionError">ConnectionError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If connection fails</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="AuthenticationError">AuthenticationError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If authentication fails</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/utils/email_utils/base.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@abstractmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">connect</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Establish connection to the email service.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ConnectionError: If connection fails</span>
<span class="sd">        AuthenticationError: If authentication fails</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">pass</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="ragora.utils.email_utils.base.EmailProvider.create_draft" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">create_draft</span><span class="p">(</span><span class="n">to</span><span class="p">,</span> <span class="n">subject</span><span class="p">,</span> <span class="n">body</span><span class="p">,</span> <span class="n">cc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">bcc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">attachments</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">folder</span><span class="o">=</span><span class="s1">&#39;Drafts&#39;</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-abstractmethod"><code>abstractmethod</code></small>
  </span>

<a href="#ragora.utils.email_utils.base.EmailProvider.create_draft" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Create a draft message.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>to</code>
            </td>
            <td>
                  <code><span title="typing.List">List</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of recipient email addresses</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>subject</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Email subject line</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>body</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Email body content (HTML or plain text)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>cc</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.List">List</span>[<span title="str">str</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional list of CC recipient email addresses</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>bcc</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.List">List</span>[<span title="str">str</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional list of BCC recipient email addresses</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>attachments</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.List">List</span>[<span title="str">str</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional list of file paths to attach</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>folder</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Folder to store the draft in (default: "Drafts")</p>
              </div>
            </td>
            <td>
                  <code>&#39;Drafts&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="EmailDraft


  
      dataclass
   (ragora.utils.email_utils.models.EmailDraft)" href="#ragora.utils.email_utils.models.EmailDraft">EmailDraft</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>EmailDraft object with the created draft</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ConnectionError">ConnectionError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If not connected</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="DraftError">DraftError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If draft creation fails</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/utils/email_utils/base.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@abstractmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">create_draft</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">to</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
    <span class="n">subject</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">body</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">cc</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">bcc</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">attachments</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">folder</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;Drafts&quot;</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">EmailDraft</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create a draft message.</span>

<span class="sd">    Args:</span>
<span class="sd">        to: List of recipient email addresses</span>
<span class="sd">        subject: Email subject line</span>
<span class="sd">        body: Email body content (HTML or plain text)</span>
<span class="sd">        cc: Optional list of CC recipient email addresses</span>
<span class="sd">        bcc: Optional list of BCC recipient email addresses</span>
<span class="sd">        attachments: Optional list of file paths to attach</span>
<span class="sd">        folder: Folder to store the draft in (default: &quot;Drafts&quot;)</span>

<span class="sd">    Returns:</span>
<span class="sd">        EmailDraft object with the created draft</span>

<span class="sd">    Raises:</span>
<span class="sd">        ConnectionError: If not connected</span>
<span class="sd">        DraftError: If draft creation fails</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">pass</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="ragora.utils.email_utils.base.EmailProvider.disconnect" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">disconnect</span><span class="p">()</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-abstractmethod"><code>abstractmethod</code></small>
  </span>

<a href="#ragora.utils.email_utils.base.EmailProvider.disconnect" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Close connection to the email service.</p>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/utils/email_utils/base.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@abstractmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">disconnect</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Close connection to the email service.&quot;&quot;&quot;</span>
    <span class="k">pass</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="ragora.utils.email_utils.base.EmailProvider.fetch_message_by_id" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">fetch_message_by_id</span><span class="p">(</span><span class="n">message_id</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-abstractmethod"><code>abstractmethod</code></small>
  </span>

<a href="#ragora.utils.email_utils.base.EmailProvider.fetch_message_by_id" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Fetch a specific message by its ID.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>message_id</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Unique identifier for the message</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Optional">Optional</span>[<a class="autorefs autorefs-internal" title="EmailMessage


  
      dataclass
   (ragora.utils.email_utils.models.EmailMessage)" href="#ragora.utils.email_utils.models.EmailMessage">EmailMessage</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>EmailMessage object or None if not found</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ConnectionError">ConnectionError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If not connected</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="FetchError">FetchError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If message fetching fails</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/utils/email_utils/base.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@abstractmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">fetch_message_by_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">EmailMessage</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Fetch a specific message by its ID.</span>

<span class="sd">    Args:</span>
<span class="sd">        message_id: Unique identifier for the message</span>

<span class="sd">    Returns:</span>
<span class="sd">        EmailMessage object or None if not found</span>

<span class="sd">    Raises:</span>
<span class="sd">        ConnectionError: If not connected</span>
<span class="sd">        FetchError: If message fetching fails</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">pass</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="ragora.utils.email_utils.base.EmailProvider.fetch_messages" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">fetch_messages</span><span class="p">(</span><span class="n">limit</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">folder</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">unread_only</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-abstractmethod"><code>abstractmethod</code></small>
  </span>

<a href="#ragora.utils.email_utils.base.EmailProvider.fetch_messages" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Fetch messages from the email service.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>limit</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Maximum number of messages to fetch</p>
              </div>
            </td>
            <td>
                  <code>50</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>folder</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Specific folder to fetch from (None for inbox)</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>unread_only</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, only fetch unread messages</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.List">List</span>[<a class="autorefs autorefs-internal" title="EmailMessage


  
      dataclass
   (ragora.utils.email_utils.models.EmailMessage)" href="#ragora.utils.email_utils.models.EmailMessage">EmailMessage</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of EmailMessage objects</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ConnectionError">ConnectionError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If not connected</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="FetchError">FetchError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If message fetching fails</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/utils/email_utils/base.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@abstractmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">fetch_messages</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span> <span class="n">folder</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">unread_only</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">EmailMessage</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Fetch messages from the email service.</span>

<span class="sd">    Args:</span>
<span class="sd">        limit: Maximum number of messages to fetch</span>
<span class="sd">        folder: Specific folder to fetch from (None for inbox)</span>
<span class="sd">        unread_only: If True, only fetch unread messages</span>

<span class="sd">    Returns:</span>
<span class="sd">        List of EmailMessage objects</span>

<span class="sd">    Raises:</span>
<span class="sd">        ConnectionError: If not connected</span>
<span class="sd">        FetchError: If message fetching fails</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">pass</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="ragora.utils.email_utils.base.EmailProvider.get_folders" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_folders</span><span class="p">()</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-abstractmethod"><code>abstractmethod</code></small>
  </span>

<a href="#ragora.utils.email_utils.base.EmailProvider.get_folders" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Get list of available folders.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.List">List</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of folder names</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ConnectionError">ConnectionError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If not connected</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="FetchError">FetchError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If folder fetching fails</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/utils/email_utils/base.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@abstractmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">get_folders</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get list of available folders.</span>

<span class="sd">    Returns:</span>
<span class="sd">        List of folder names</span>

<span class="sd">    Raises:</span>
<span class="sd">        ConnectionError: If not connected</span>
<span class="sd">        FetchError: If folder fetching fails</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">pass</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="ragora.utils.email_utils.base.EmailProvider.mark_as_read" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">mark_as_read</span><span class="p">(</span><span class="n">message_id</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-abstractmethod"><code>abstractmethod</code></small>
  </span>

<a href="#ragora.utils.email_utils.base.EmailProvider.mark_as_read" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Mark a message as read.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>message_id</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>ID of the message to mark as read</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>True if message was marked as read successfully</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ConnectionError">ConnectionError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If not connected</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="UpdateError">UpdateError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If marking fails</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/utils/email_utils/base.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@abstractmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">mark_as_read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Mark a message as read.</span>

<span class="sd">    Args:</span>
<span class="sd">        message_id: ID of the message to mark as read</span>

<span class="sd">    Returns:</span>
<span class="sd">        True if message was marked as read successfully</span>

<span class="sd">    Raises:</span>
<span class="sd">        ConnectionError: If not connected</span>
<span class="sd">        UpdateError: If marking fails</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">pass</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="ragora.utils.email_utils.base.EmailProvider.send_message" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">send_message</span><span class="p">(</span><span class="n">draft_id</span><span class="p">,</span> <span class="n">folder</span><span class="o">=</span><span class="s1">&#39;Drafts&#39;</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-abstractmethod"><code>abstractmethod</code></small>
  </span>

<a href="#ragora.utils.email_utils.base.EmailProvider.send_message" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Send a draft message.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>draft_id</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>ID of the draft to send</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>folder</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Folder where the draft is stored (default: "Drafts")</p>
              </div>
            </td>
            <td>
                  <code>&#39;Drafts&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>True if message was sent successfully</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ConnectionError">ConnectionError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If not connected</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="SendError">SendError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If message sending fails</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/utils/email_utils/base.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@abstractmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">send_message</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">draft_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">folder</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;Drafts&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Send a draft message.</span>

<span class="sd">    Args:</span>
<span class="sd">        draft_id: ID of the draft to send</span>
<span class="sd">        folder: Folder where the draft is stored (default: &quot;Drafts&quot;)</span>

<span class="sd">    Returns:</span>
<span class="sd">        True if message was sent successfully</span>

<span class="sd">    Raises:</span>
<span class="sd">        ConnectionError: If not connected</span>
<span class="sd">        SendError: If message sending fails</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">pass</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="ragora.utils.email_utils.base.EmailProvider.send_message_direct" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">send_message_direct</span><span class="p">(</span><span class="n">to</span><span class="p">,</span> <span class="n">subject</span><span class="p">,</span> <span class="n">body</span><span class="p">,</span> <span class="n">cc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">bcc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">attachments</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-abstractmethod"><code>abstractmethod</code></small>
  </span>

<a href="#ragora.utils.email_utils.base.EmailProvider.send_message_direct" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Send a message directly without creating a draft.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>to</code>
            </td>
            <td>
                  <code><span title="typing.List">List</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of recipient email addresses</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>subject</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Email subject line</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>body</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Email body content (HTML or plain text)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>cc</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.List">List</span>[<span title="str">str</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional list of CC recipient email addresses</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>bcc</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.List">List</span>[<span title="str">str</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional list of BCC recipient email addresses</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>attachments</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.List">List</span>[<span title="str">str</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional list of file paths to attach</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>True if message was sent successfully</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ConnectionError">ConnectionError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If not connected</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="SendError">SendError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If message sending fails</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/utils/email_utils/base.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@abstractmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">send_message_direct</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">to</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
    <span class="n">subject</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">body</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">cc</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">bcc</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">attachments</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Send a message directly without creating a draft.</span>

<span class="sd">    Args:</span>
<span class="sd">        to: List of recipient email addresses</span>
<span class="sd">        subject: Email subject line</span>
<span class="sd">        body: Email body content (HTML or plain text)</span>
<span class="sd">        cc: Optional list of CC recipient email addresses</span>
<span class="sd">        bcc: Optional list of BCC recipient email addresses</span>
<span class="sd">        attachments: Optional list of file paths to attach</span>

<span class="sd">    Returns:</span>
<span class="sd">        True if message was sent successfully</span>

<span class="sd">    Raises:</span>
<span class="sd">        ConnectionError: If not connected</span>
<span class="sd">        SendError: If message sending fails</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">pass</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<a id="ragora.utils.email_utils.graph_provider"></a>
    <div class="doc doc-contents first">

        <p>Microsoft Graph API email provider implementation.</p>










  <div class="doc doc-children">









<div class="doc doc-object doc-class">



<h4 id="ragora.utils.email_utils.graph_provider.AuthenticationError" class="doc doc-heading">
            <code>AuthenticationError</code>


<a href="#ragora.utils.email_utils.graph_provider.AuthenticationError" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="Exception">Exception</span></code></p>


        <p>Raised when authentication fails.
Args:
    message: The error message</p>








              <details class="quote">
                <summary>Source code in <code>ragora/ragora/utils/email_utils/graph_provider.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">AuthenticationError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Raised when authentication fails.</span>
<span class="sd">    Args:</span>
<span class="sd">        message: The error message</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">pass</span>
</code></pre></div></td></tr></table></div>
              </details>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="ragora.utils.email_utils.graph_provider.GraphProvider" class="doc doc-heading">
            <code>GraphProvider</code>


<a href="#ragora.utils.email_utils.graph_provider.GraphProvider" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="EmailProvider (ragora.utils.email_utils.base.EmailProvider)" href="#ragora.utils.email_utils.base.EmailProvider">EmailProvider</a></code></p>


        <p>Microsoft Graph API email provider for Outlook/Office 365.</p>








              <details class="quote">
                <summary>Source code in <code>ragora/ragora/utils/email_utils/graph_provider.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">GraphProvider</span><span class="p">(</span><span class="n">EmailProvider</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Microsoft Graph API email provider for Outlook/Office 365.&quot;&quot;&quot;</span>

    <span class="n">BASE_URL</span> <span class="o">=</span> <span class="s2">&quot;https://graph.microsoft.com/v1.0&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">credentials</span><span class="p">:</span> <span class="n">GraphCredentials</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize Graph provider with credentials.</span>

<span class="sd">        Args:</span>
<span class="sd">            credentials: Microsoft Graph API credentials</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">credentials</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_access_token</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_connected</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">connect</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Establish connection to Microsoft Graph API.&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">credentials</span><span class="o">.</span><span class="n">access_token</span><span class="p">:</span>
                <span class="c1"># Use provided access token</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_access_token</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">credentials</span><span class="o">.</span><span class="n">access_token</span>
                <span class="c1"># Verify token is valid</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_verify_token</span><span class="p">():</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_connected</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="k">return</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">AuthenticationError</span><span class="p">(</span><span class="s2">&quot;Invalid access token&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Get access token using client credentials flow</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_get_access_token</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_connected</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_connected</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">raise</span> <span class="ne">ConnectionError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to connect to Microsoft Graph: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">disconnect</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Close connection to Microsoft Graph API.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_access_token</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_connected</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_get_access_token</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get access token using client credentials flow.&quot;&quot;&quot;</span>
        <span class="n">token_url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;https://login.microsoftonline.com/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">credentials</span><span class="o">.</span><span class="n">tenant_id</span><span class="si">}</span><span class="s2">/oauth2/v2.0/token&quot;</span>

        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;client_id&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">credentials</span><span class="o">.</span><span class="n">client_id</span><span class="p">,</span>
            <span class="s2">&quot;client_secret&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">credentials</span><span class="o">.</span><span class="n">client_secret</span><span class="p">,</span>
            <span class="s2">&quot;scope&quot;</span><span class="p">:</span> <span class="s2">&quot;https://graph.microsoft.com/.default&quot;</span><span class="p">,</span>
            <span class="s2">&quot;grant_type&quot;</span><span class="p">:</span> <span class="s2">&quot;client_credentials&quot;</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">token_url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
        <span class="n">response</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>

        <span class="n">token_data</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_access_token</span> <span class="o">=</span> <span class="n">token_data</span><span class="p">[</span><span class="s2">&quot;access_token&quot;</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_verify_token</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Verify if the access token is valid.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_access_token</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Authorization&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Bearer </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_access_token</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">}</span>
            <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">BASE_URL</span><span class="si">}</span><span class="s2">/me&quot;</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_make_request</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">method</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">endpoint</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Make authenticated request to Microsoft Graph API.</span>
<span class="sd">        Args:</span>
<span class="sd">            method: The HTTP method to use</span>
<span class="sd">            endpoint: The endpoint to request</span>
<span class="sd">            data: The data to send with the request</span>
<span class="sd">        Returns:</span>
<span class="sd">            Dictionary containing the response data</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_connected</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ConnectionError</span><span class="p">(</span><span class="s2">&quot;Not connected to Microsoft Graph&quot;</span><span class="p">)</span>

        <span class="n">url</span> <span class="o">=</span> <span class="n">urljoin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">BASE_URL</span><span class="p">,</span> <span class="n">endpoint</span><span class="p">)</span>
        <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;Authorization&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Bearer </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_access_token</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Content-Type&quot;</span><span class="p">:</span> <span class="s2">&quot;application/json&quot;</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">method</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;GET&quot;</span><span class="p">:</span>
                <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">method</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;POST&quot;</span><span class="p">:</span>
                <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">method</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;PATCH&quot;</span><span class="p">:</span>
                <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">patch</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">method</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;DELETE&quot;</span><span class="p">:</span>
                <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unsupported HTTP method: </span><span class="si">{</span><span class="n">method</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="n">response</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>

            <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
            <span class="k">return</span> <span class="p">{}</span>

        <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">RequestException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Graph API request failed: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">fetch_messages</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span> <span class="n">folder</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">unread_only</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">EmailMessage</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Fetch messages from Microsoft Graph API.</span>
<span class="sd">        Args:</span>
<span class="sd">            limit: The maximum number of messages to fetch</span>
<span class="sd">            folder: The folder to search for messages</span>
<span class="sd">            unread_only: Whether to only fetch unread messages</span>
<span class="sd">        Returns:</span>
<span class="sd">            List of EmailMessage objects</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Build endpoint</span>
            <span class="k">if</span> <span class="n">folder</span><span class="p">:</span>
                <span class="n">endpoint</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;/me/mailFolders/</span><span class="si">{</span><span class="n">folder</span><span class="si">}</span><span class="s2">/messages&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">endpoint</span> <span class="o">=</span> <span class="s2">&quot;/me/messages&quot;</span>

            <span class="c1"># Add query parameters</span>
            <span class="n">params</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">if</span> <span class="n">limit</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">params</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;$top=</span><span class="si">{</span><span class="n">limit</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">unread_only</span><span class="p">:</span>
                <span class="n">params</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;$filter=isRead eq false&quot;</span><span class="p">)</span>

            <span class="c1"># Add ordering</span>
            <span class="n">params</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;$orderby=receivedDateTime desc&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">params</span><span class="p">:</span>
                <span class="n">endpoint</span> <span class="o">+=</span> <span class="s2">&quot;?&quot;</span> <span class="o">+</span> <span class="s2">&quot;&amp;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>

            <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_request</span><span class="p">(</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span> <span class="n">endpoint</span><span class="p">)</span>
            <span class="n">messages_data</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">,</span> <span class="p">[])</span>

            <span class="n">email_messages</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">msg_data</span> <span class="ow">in</span> <span class="n">messages_data</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">email_msg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_graph_message</span><span class="p">(</span><span class="n">msg_data</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">email_msg</span><span class="p">:</span>
                        <span class="n">email_messages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">email_msg</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                    <span class="c1"># Skip problematic messages</span>
                    <span class="k">continue</span>

            <span class="k">return</span> <span class="n">email_messages</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to fetch messages: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">fetch_message_by_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">EmailMessage</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Fetch a specific message by its ID.</span>
<span class="sd">        Args:</span>
<span class="sd">            message_id: The ID of the message to fetch</span>
<span class="sd">        Returns:</span>
<span class="sd">            EmailMessage object if the message was found, None otherwise</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">endpoint</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;/me/messages/</span><span class="si">{</span><span class="n">message_id</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_request</span><span class="p">(</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span> <span class="n">endpoint</span><span class="p">)</span>

            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_graph_message</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">&quot;404&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">):</span>
                <span class="k">return</span> <span class="kc">None</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to fetch message </span><span class="si">{</span><span class="n">message_id</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_parse_graph_message</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg_data</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">EmailMessage</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Parse Microsoft Graph message data into EmailMessage object.</span>
<span class="sd">        Args:</span>
<span class="sd">            msg_data: The message data to parse</span>
<span class="sd">        Returns:</span>
<span class="sd">            EmailMessage object if the message was found, None otherwise</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Extract basic fields</span>
            <span class="n">message_id</span> <span class="o">=</span> <span class="n">msg_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="n">subject</span> <span class="o">=</span> <span class="n">msg_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;subject&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>

            <span class="c1"># Parse sender</span>
            <span class="n">sender_info</span> <span class="o">=</span> <span class="n">msg_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;from&quot;</span><span class="p">,</span> <span class="p">{})</span>
            <span class="n">sender</span> <span class="o">=</span> <span class="n">EmailAddress</span><span class="p">(</span>
                <span class="n">email</span><span class="o">=</span><span class="n">sender_info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;emailAddress&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;address&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
                <span class="n">name</span><span class="o">=</span><span class="n">sender_info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;emailAddress&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
            <span class="p">)</span>

            <span class="c1"># Parse recipients</span>
            <span class="n">to_recipients</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">recipient</span> <span class="ow">in</span> <span class="n">msg_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;toRecipients&quot;</span><span class="p">,</span> <span class="p">[]):</span>
                <span class="n">to_recipients</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="n">EmailAddress</span><span class="p">(</span>
                        <span class="n">email</span><span class="o">=</span><span class="n">recipient</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;emailAddress&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;address&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
                        <span class="n">name</span><span class="o">=</span><span class="n">recipient</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;emailAddress&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
                    <span class="p">)</span>
                <span class="p">)</span>

            <span class="n">cc_recipients</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">recipient</span> <span class="ow">in</span> <span class="n">msg_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;ccRecipients&quot;</span><span class="p">,</span> <span class="p">[]):</span>
                <span class="n">cc_recipients</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="n">EmailAddress</span><span class="p">(</span>
                        <span class="n">email</span><span class="o">=</span><span class="n">recipient</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;emailAddress&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;address&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
                        <span class="n">name</span><span class="o">=</span><span class="n">recipient</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;emailAddress&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
                    <span class="p">)</span>
                <span class="p">)</span>

            <span class="n">bcc_recipients</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">recipient</span> <span class="ow">in</span> <span class="n">msg_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;bccRecipients&quot;</span><span class="p">,</span> <span class="p">[]):</span>
                <span class="n">bcc_recipients</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="n">EmailAddress</span><span class="p">(</span>
                        <span class="n">email</span><span class="o">=</span><span class="n">recipient</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;emailAddress&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;address&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
                        <span class="n">name</span><span class="o">=</span><span class="n">recipient</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;emailAddress&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
                    <span class="p">)</span>
                <span class="p">)</span>

            <span class="c1"># Parse dates</span>
            <span class="n">date_sent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_graph_date</span><span class="p">(</span><span class="n">msg_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;sentDateTime&quot;</span><span class="p">))</span>
            <span class="n">date_received</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_graph_date</span><span class="p">(</span><span class="n">msg_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;receivedDateTime&quot;</span><span class="p">))</span>

            <span class="c1"># Extract body</span>
            <span class="n">body</span> <span class="o">=</span> <span class="n">msg_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;body&quot;</span><span class="p">,</span> <span class="p">{})</span>
            <span class="n">body_text</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">body</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;content&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">body</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;contentType&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;text&quot;</span> <span class="k">else</span> <span class="kc">None</span>
            <span class="p">)</span>
            <span class="n">body_html</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">body</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;content&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">body</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;contentType&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;html&quot;</span> <span class="k">else</span> <span class="kc">None</span>
            <span class="p">)</span>

            <span class="c1"># Parse status</span>
            <span class="n">status</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">MessageStatus</span><span class="o">.</span><span class="n">READ</span>
                <span class="k">if</span> <span class="n">msg_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;isRead&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
                <span class="k">else</span> <span class="n">MessageStatus</span><span class="o">.</span><span class="n">UNREAD</span>
            <span class="p">)</span>

            <span class="c1"># Parse attachments</span>
            <span class="n">attachments</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_graph_attachments</span><span class="p">(</span><span class="n">msg_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;attachments&quot;</span><span class="p">,</span> <span class="p">[]))</span>

            <span class="c1"># Get folder information</span>
            <span class="n">parent_folder_id</span> <span class="o">=</span> <span class="n">msg_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;parentFolderId&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">EmailMessage</span><span class="p">(</span>
                <span class="n">message_id</span><span class="o">=</span><span class="n">message_id</span><span class="p">,</span>
                <span class="n">subject</span><span class="o">=</span><span class="n">subject</span><span class="p">,</span>
                <span class="n">sender</span><span class="o">=</span><span class="n">sender</span><span class="p">,</span>
                <span class="n">recipients</span><span class="o">=</span><span class="n">to_recipients</span><span class="p">,</span>
                <span class="n">cc_recipients</span><span class="o">=</span><span class="n">cc_recipients</span><span class="p">,</span>
                <span class="n">bcc_recipients</span><span class="o">=</span><span class="n">bcc_recipients</span><span class="p">,</span>
                <span class="n">body_text</span><span class="o">=</span><span class="n">body_text</span><span class="p">,</span>
                <span class="n">body_html</span><span class="o">=</span><span class="n">body_html</span><span class="p">,</span>
                <span class="n">date_sent</span><span class="o">=</span><span class="n">date_sent</span><span class="p">,</span>
                <span class="n">date_received</span><span class="o">=</span><span class="n">date_received</span><span class="p">,</span>
                <span class="n">status</span><span class="o">=</span><span class="n">status</span><span class="p">,</span>
                <span class="n">attachments</span><span class="o">=</span><span class="n">attachments</span><span class="p">,</span>
                <span class="n">folder</span><span class="o">=</span><span class="n">parent_folder_id</span><span class="p">,</span>
                <span class="n">metadata</span><span class="o">=</span><span class="n">msg_data</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_parse_graph_date</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">date_str</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">datetime</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Parse Microsoft Graph date string.</span>
<span class="sd">        Args:</span>
<span class="sd">            date_str: The date string to parse</span>
<span class="sd">        Returns:</span>
<span class="sd">            datetime object if the date was parsed successfully, None otherwise</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">date_str</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Graph API returns ISO 8601 format</span>
            <span class="k">return</span> <span class="n">datetime</span><span class="o">.</span><span class="n">fromisoformat</span><span class="p">(</span><span class="n">date_str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;Z&quot;</span><span class="p">,</span> <span class="s2">&quot;+00:00&quot;</span><span class="p">))</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_parse_graph_attachments</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">attachments_data</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">EmailAttachment</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Parse Microsoft Graph attachments.</span>
<span class="sd">        Args:</span>
<span class="sd">            attachments_data: The attachments data to parse</span>
<span class="sd">        Returns:</span>
<span class="sd">            List of EmailAttachment objects</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">attachments</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">attachment_data</span> <span class="ow">in</span> <span class="n">attachments_data</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">filename</span> <span class="o">=</span> <span class="n">attachment_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
                <span class="n">content_type</span> <span class="o">=</span> <span class="n">attachment_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                    <span class="s2">&quot;contentType&quot;</span><span class="p">,</span> <span class="s2">&quot;application/octet-stream&quot;</span>
                <span class="p">)</span>
                <span class="n">size</span> <span class="o">=</span> <span class="n">attachment_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;size&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

                <span class="c1"># Get attachment content if available</span>
                <span class="n">content</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">if</span> <span class="s2">&quot;contentBytes&quot;</span> <span class="ow">in</span> <span class="n">attachment_data</span><span class="p">:</span>
                    <span class="n">content</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64decode</span><span class="p">(</span><span class="n">attachment_data</span><span class="p">[</span><span class="s2">&quot;contentBytes&quot;</span><span class="p">])</span>

                <span class="n">attachments</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="n">EmailAttachment</span><span class="p">(</span>
                        <span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">,</span>
                        <span class="n">content_type</span><span class="o">=</span><span class="n">content_type</span><span class="p">,</span>
                        <span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">,</span>
                        <span class="n">content</span><span class="o">=</span><span class="n">content</span><span class="p">,</span>
                        <span class="n">content_id</span><span class="o">=</span><span class="n">attachment_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;contentId&quot;</span><span class="p">),</span>
                    <span class="p">)</span>
                <span class="p">)</span>

            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="c1"># Skip problematic attachments</span>
                <span class="k">continue</span>

        <span class="k">return</span> <span class="n">attachments</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">create_draft</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">to</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
        <span class="n">subject</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">body</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">cc</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">bcc</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">attachments</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">folder</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;Drafts&quot;</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">EmailDraft</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a draft message using Microsoft Graph API.</span>
<span class="sd">        Args:</span>
<span class="sd">            to: List of recipient email addresses</span>
<span class="sd">            subject: Email subject line</span>
<span class="sd">            body: Email body content (HTML or plain text)</span>
<span class="sd">            cc: Optional list of CC recipient email addresses</span>
<span class="sd">            bcc: Optional list of BCC recipient email addresses</span>
<span class="sd">            attachments: Optional list of attachment file paths</span>
<span class="sd">            folder: The folder to save the draft message</span>
<span class="sd">        Returns:</span>
<span class="sd">            EmailDraft object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Prepare message data</span>
            <span class="n">message_data</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;subject&quot;</span><span class="p">:</span> <span class="n">subject</span><span class="p">,</span>
                <span class="s2">&quot;body&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s2">&quot;contentType&quot;</span><span class="p">:</span> <span class="s2">&quot;text&quot;</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">body</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;&lt;&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="s2">&quot;html&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="n">body</span><span class="p">,</span>
                <span class="p">},</span>
                <span class="s2">&quot;toRecipients&quot;</span><span class="p">:</span> <span class="p">[{</span><span class="s2">&quot;emailAddress&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;address&quot;</span><span class="p">:</span> <span class="n">addr</span><span class="p">}}</span> <span class="k">for</span> <span class="n">addr</span> <span class="ow">in</span> <span class="n">to</span><span class="p">],</span>
            <span class="p">}</span>

            <span class="k">if</span> <span class="n">cc</span><span class="p">:</span>
                <span class="n">message_data</span><span class="p">[</span><span class="s2">&quot;ccRecipients&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="p">{</span><span class="s2">&quot;emailAddress&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;address&quot;</span><span class="p">:</span> <span class="n">addr</span><span class="p">}}</span> <span class="k">for</span> <span class="n">addr</span> <span class="ow">in</span> <span class="n">cc</span>
                <span class="p">]</span>

            <span class="k">if</span> <span class="n">bcc</span><span class="p">:</span>
                <span class="n">message_data</span><span class="p">[</span><span class="s2">&quot;bccRecipients&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="p">{</span><span class="s2">&quot;emailAddress&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;address&quot;</span><span class="p">:</span> <span class="n">addr</span><span class="p">}}</span> <span class="k">for</span> <span class="n">addr</span> <span class="ow">in</span> <span class="n">bcc</span>
                <span class="p">]</span>

            <span class="c1"># Create draft</span>
            <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_request</span><span class="p">(</span><span class="s2">&quot;POST&quot;</span><span class="p">,</span> <span class="s2">&quot;/me/messages&quot;</span><span class="p">,</span> <span class="n">message_data</span><span class="p">)</span>

            <span class="c1"># Save as draft</span>
            <span class="n">draft_response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_request</span><span class="p">(</span>
                <span class="s2">&quot;POST&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;/me/messages/</span><span class="si">{</span><span class="n">response</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">/save&quot;</span><span class="p">,</span> <span class="p">{}</span>
            <span class="p">)</span>

            <span class="n">draft_id</span> <span class="o">=</span> <span class="n">response</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span>

            <span class="c1"># Parse recipients</span>
            <span class="n">to_addresses</span> <span class="o">=</span> <span class="p">[</span><span class="n">EmailAddress</span><span class="p">(</span><span class="n">addr</span><span class="p">)</span> <span class="k">for</span> <span class="n">addr</span> <span class="ow">in</span> <span class="n">to</span><span class="p">]</span>
            <span class="n">cc_addresses</span> <span class="o">=</span> <span class="p">[</span><span class="n">EmailAddress</span><span class="p">(</span><span class="n">addr</span><span class="p">)</span> <span class="k">for</span> <span class="n">addr</span> <span class="ow">in</span> <span class="p">(</span><span class="n">cc</span> <span class="ow">or</span> <span class="p">[])]</span>
            <span class="n">bcc_addresses</span> <span class="o">=</span> <span class="p">[</span><span class="n">EmailAddress</span><span class="p">(</span><span class="n">addr</span><span class="p">)</span> <span class="k">for</span> <span class="n">addr</span> <span class="ow">in</span> <span class="p">(</span><span class="n">bcc</span> <span class="ow">or</span> <span class="p">[])]</span>

            <span class="c1"># Process attachments</span>
            <span class="n">email_attachments</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">if</span> <span class="n">attachments</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">file_path</span> <span class="ow">in</span> <span class="n">attachments</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                            <span class="n">content</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

                        <span class="n">attachment_data</span> <span class="o">=</span> <span class="p">{</span>
                            <span class="s2">&quot;@odata.type&quot;</span><span class="p">:</span> <span class="s2">&quot;#microsoft.graph.fileAttachment&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">file_path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
                            <span class="s2">&quot;contentType&quot;</span><span class="p">:</span> <span class="s2">&quot;application/octet-stream&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;contentBytes&quot;</span><span class="p">:</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64encode</span><span class="p">(</span><span class="n">content</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">),</span>
                        <span class="p">}</span>

                        <span class="c1"># Add attachment to draft</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_make_request</span><span class="p">(</span>
                            <span class="s2">&quot;POST&quot;</span><span class="p">,</span>
                            <span class="sa">f</span><span class="s2">&quot;/me/messages/</span><span class="si">{</span><span class="n">draft_id</span><span class="si">}</span><span class="s2">/attachments&quot;</span><span class="p">,</span>
                            <span class="n">attachment_data</span><span class="p">,</span>
                        <span class="p">)</span>

                        <span class="n">email_attachments</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                            <span class="n">EmailAttachment</span><span class="p">(</span>
                                <span class="n">filename</span><span class="o">=</span><span class="n">file_path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
                                <span class="n">content_type</span><span class="o">=</span><span class="s2">&quot;application/octet-stream&quot;</span><span class="p">,</span>
                                <span class="n">size</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">content</span><span class="p">),</span>
                                <span class="n">content</span><span class="o">=</span><span class="n">content</span><span class="p">,</span>
                            <span class="p">)</span>
                        <span class="p">)</span>

                    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                        <span class="c1"># Skip problematic attachments</span>
                        <span class="k">continue</span>

            <span class="k">return</span> <span class="n">EmailDraft</span><span class="p">(</span>
                <span class="n">draft_id</span><span class="o">=</span><span class="n">draft_id</span><span class="p">,</span>
                <span class="n">subject</span><span class="o">=</span><span class="n">subject</span><span class="p">,</span>
                <span class="n">recipients</span><span class="o">=</span><span class="n">to_addresses</span><span class="p">,</span>
                <span class="n">cc_recipients</span><span class="o">=</span><span class="n">cc_addresses</span><span class="p">,</span>
                <span class="n">bcc_recipients</span><span class="o">=</span><span class="n">bcc_addresses</span><span class="p">,</span>
                <span class="n">body_text</span><span class="o">=</span><span class="n">body</span><span class="p">,</span>
                <span class="n">attachments</span><span class="o">=</span><span class="n">email_attachments</span><span class="p">,</span>
                <span class="n">created_date</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(),</span>
                <span class="n">modified_date</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(),</span>
                <span class="n">metadata</span><span class="o">=</span><span class="n">response</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to create draft: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">send_message</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">draft_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">folder</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;Drafts&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Send a draft message.</span>
<span class="sd">        Args:</span>
<span class="sd">            draft_id: The ID of the draft message to send</span>
<span class="sd">            folder: The folder to search for the draft message</span>
<span class="sd">        Returns:</span>
<span class="sd">            True if the draft message was sent successfully, False otherwise</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_make_request</span><span class="p">(</span><span class="s2">&quot;POST&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;/me/messages/</span><span class="si">{</span><span class="n">draft_id</span><span class="si">}</span><span class="s2">/send&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">True</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to send message: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">send_message_direct</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">to</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
        <span class="n">subject</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">body</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">cc</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">bcc</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">attachments</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Send a message directly via Microsoft Graph API.</span>
<span class="sd">        Args:</span>
<span class="sd">            to: List of recipient email addresses</span>
<span class="sd">            subject: Email subject line</span>
<span class="sd">            body: Email body content (HTML or plain text)</span>
<span class="sd">            cc: Optional list of CC recipient email addresses</span>
<span class="sd">            bcc: Optional list of BCC recipient email addresses</span>
<span class="sd">            attachments: Optional list of attachment file paths</span>
<span class="sd">        Returns:</span>
<span class="sd">            True if the message was sent successfully, False otherwise</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Create draft first</span>
            <span class="n">draft</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_draft</span><span class="p">(</span><span class="n">to</span><span class="p">,</span> <span class="n">subject</span><span class="p">,</span> <span class="n">body</span><span class="p">,</span> <span class="n">cc</span><span class="p">,</span> <span class="n">bcc</span><span class="p">,</span> <span class="n">attachments</span><span class="p">)</span>

            <span class="c1"># Send the draft</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">send_message</span><span class="p">(</span><span class="n">draft</span><span class="o">.</span><span class="n">draft_id</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to send message directly: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">mark_as_read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Mark a message as read.</span>
<span class="sd">        Args:</span>
<span class="sd">            message_id: The ID of the message to mark as read</span>
<span class="sd">        Returns:</span>
<span class="sd">            True if the message was marked as read successfully, False otherwise</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">update_data</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;isRead&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_make_request</span><span class="p">(</span><span class="s2">&quot;PATCH&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;/me/messages/</span><span class="si">{</span><span class="n">message_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">update_data</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">True</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">&quot;404&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">):</span>
                <span class="k">return</span> <span class="kc">False</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to mark message as read: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_folders</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get list of available folders.</span>
<span class="sd">        Returns:</span>
<span class="sd">            List of available folders</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_request</span><span class="p">(</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span> <span class="s2">&quot;/me/mailFolders&quot;</span><span class="p">)</span>
            <span class="n">folders_data</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">,</span> <span class="p">[])</span>

            <span class="n">folders</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">folder_data</span> <span class="ow">in</span> <span class="n">folders_data</span><span class="p">:</span>
                <span class="n">folders</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">folder_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;displayName&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>

            <span class="k">return</span> <span class="n">folders</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to get folders: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">is_connected</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if connected to Microsoft Graph API.</span>
<span class="sd">        Returns:</span>
<span class="sd">            True if connected to Microsoft Graph API, False otherwise</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_connected</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_access_token</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h5 id="ragora.utils.email_utils.graph_provider.GraphProvider.is_connected" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">is_connected</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#ragora.utils.email_utils.graph_provider.GraphProvider.is_connected" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Check if connected to Microsoft Graph API.
Returns:
    True if connected to Microsoft Graph API, False otherwise</p>

    </div>

</div>




<div class="doc doc-object doc-function">


<h5 id="ragora.utils.email_utils.graph_provider.GraphProvider._get_access_token" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">_get_access_token</span><span class="p">()</span></code>

<a href="#ragora.utils.email_utils.graph_provider.GraphProvider._get_access_token" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Get access token using client credentials flow.</p>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/utils/email_utils/graph_provider.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">_get_access_token</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get access token using client credentials flow.&quot;&quot;&quot;</span>
    <span class="n">token_url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;https://login.microsoftonline.com/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">credentials</span><span class="o">.</span><span class="n">tenant_id</span><span class="si">}</span><span class="s2">/oauth2/v2.0/token&quot;</span>

    <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;client_id&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">credentials</span><span class="o">.</span><span class="n">client_id</span><span class="p">,</span>
        <span class="s2">&quot;client_secret&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">credentials</span><span class="o">.</span><span class="n">client_secret</span><span class="p">,</span>
        <span class="s2">&quot;scope&quot;</span><span class="p">:</span> <span class="s2">&quot;https://graph.microsoft.com/.default&quot;</span><span class="p">,</span>
        <span class="s2">&quot;grant_type&quot;</span><span class="p">:</span> <span class="s2">&quot;client_credentials&quot;</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">token_url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
    <span class="n">response</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>

    <span class="n">token_data</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_access_token</span> <span class="o">=</span> <span class="n">token_data</span><span class="p">[</span><span class="s2">&quot;access_token&quot;</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="ragora.utils.email_utils.graph_provider.GraphProvider._make_request" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">_make_request</span><span class="p">(</span><span class="n">method</span><span class="p">,</span> <span class="n">endpoint</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#ragora.utils.email_utils.graph_provider.GraphProvider._make_request" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Make authenticated request to Microsoft Graph API.
Args:
    method: The HTTP method to use
    endpoint: The endpoint to request
    data: The data to send with the request
Returns:
    Dictionary containing the response data</p>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/utils/email_utils/graph_provider.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">_make_request</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">method</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">endpoint</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Make authenticated request to Microsoft Graph API.</span>
<span class="sd">    Args:</span>
<span class="sd">        method: The HTTP method to use</span>
<span class="sd">        endpoint: The endpoint to request</span>
<span class="sd">        data: The data to send with the request</span>
<span class="sd">    Returns:</span>
<span class="sd">        Dictionary containing the response data</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_connected</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ConnectionError</span><span class="p">(</span><span class="s2">&quot;Not connected to Microsoft Graph&quot;</span><span class="p">)</span>

    <span class="n">url</span> <span class="o">=</span> <span class="n">urljoin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">BASE_URL</span><span class="p">,</span> <span class="n">endpoint</span><span class="p">)</span>
    <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;Authorization&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Bearer </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_access_token</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Content-Type&quot;</span><span class="p">:</span> <span class="s2">&quot;application/json&quot;</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">method</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;GET&quot;</span><span class="p">:</span>
            <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">method</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;POST&quot;</span><span class="p">:</span>
            <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">method</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;PATCH&quot;</span><span class="p">:</span>
            <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">patch</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">method</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;DELETE&quot;</span><span class="p">:</span>
            <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unsupported HTTP method: </span><span class="si">{</span><span class="n">method</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">response</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
        <span class="k">return</span> <span class="p">{}</span>

    <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">RequestException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Graph API request failed: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="ragora.utils.email_utils.graph_provider.GraphProvider._parse_graph_attachments" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">_parse_graph_attachments</span><span class="p">(</span><span class="n">attachments_data</span><span class="p">)</span></code>

<a href="#ragora.utils.email_utils.graph_provider.GraphProvider._parse_graph_attachments" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Parse Microsoft Graph attachments.
Args:
    attachments_data: The attachments data to parse
Returns:
    List of EmailAttachment objects</p>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/utils/email_utils/graph_provider.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">_parse_graph_attachments</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">attachments_data</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">EmailAttachment</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Parse Microsoft Graph attachments.</span>
<span class="sd">    Args:</span>
<span class="sd">        attachments_data: The attachments data to parse</span>
<span class="sd">    Returns:</span>
<span class="sd">        List of EmailAttachment objects</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">attachments</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">attachment_data</span> <span class="ow">in</span> <span class="n">attachments_data</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="n">attachment_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="n">content_type</span> <span class="o">=</span> <span class="n">attachment_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                <span class="s2">&quot;contentType&quot;</span><span class="p">,</span> <span class="s2">&quot;application/octet-stream&quot;</span>
            <span class="p">)</span>
            <span class="n">size</span> <span class="o">=</span> <span class="n">attachment_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;size&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

            <span class="c1"># Get attachment content if available</span>
            <span class="n">content</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="s2">&quot;contentBytes&quot;</span> <span class="ow">in</span> <span class="n">attachment_data</span><span class="p">:</span>
                <span class="n">content</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64decode</span><span class="p">(</span><span class="n">attachment_data</span><span class="p">[</span><span class="s2">&quot;contentBytes&quot;</span><span class="p">])</span>

            <span class="n">attachments</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="n">EmailAttachment</span><span class="p">(</span>
                    <span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">,</span>
                    <span class="n">content_type</span><span class="o">=</span><span class="n">content_type</span><span class="p">,</span>
                    <span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">,</span>
                    <span class="n">content</span><span class="o">=</span><span class="n">content</span><span class="p">,</span>
                    <span class="n">content_id</span><span class="o">=</span><span class="n">attachment_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;contentId&quot;</span><span class="p">),</span>
                <span class="p">)</span>
            <span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="c1"># Skip problematic attachments</span>
            <span class="k">continue</span>

    <span class="k">return</span> <span class="n">attachments</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="ragora.utils.email_utils.graph_provider.GraphProvider._parse_graph_date" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">_parse_graph_date</span><span class="p">(</span><span class="n">date_str</span><span class="p">)</span></code>

<a href="#ragora.utils.email_utils.graph_provider.GraphProvider._parse_graph_date" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Parse Microsoft Graph date string.
Args:
    date_str: The date string to parse
Returns:
    datetime object if the date was parsed successfully, None otherwise</p>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/utils/email_utils/graph_provider.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">_parse_graph_date</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">date_str</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">datetime</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Parse Microsoft Graph date string.</span>
<span class="sd">    Args:</span>
<span class="sd">        date_str: The date string to parse</span>
<span class="sd">    Returns:</span>
<span class="sd">        datetime object if the date was parsed successfully, None otherwise</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">date_str</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Graph API returns ISO 8601 format</span>
        <span class="k">return</span> <span class="n">datetime</span><span class="o">.</span><span class="n">fromisoformat</span><span class="p">(</span><span class="n">date_str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;Z&quot;</span><span class="p">,</span> <span class="s2">&quot;+00:00&quot;</span><span class="p">))</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="ragora.utils.email_utils.graph_provider.GraphProvider._parse_graph_message" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">_parse_graph_message</span><span class="p">(</span><span class="n">msg_data</span><span class="p">)</span></code>

<a href="#ragora.utils.email_utils.graph_provider.GraphProvider._parse_graph_message" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Parse Microsoft Graph message data into EmailMessage object.
Args:
    msg_data: The message data to parse
Returns:
    EmailMessage object if the message was found, None otherwise</p>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/utils/email_utils/graph_provider.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">_parse_graph_message</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg_data</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">EmailMessage</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Parse Microsoft Graph message data into EmailMessage object.</span>
<span class="sd">    Args:</span>
<span class="sd">        msg_data: The message data to parse</span>
<span class="sd">    Returns:</span>
<span class="sd">        EmailMessage object if the message was found, None otherwise</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Extract basic fields</span>
        <span class="n">message_id</span> <span class="o">=</span> <span class="n">msg_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="n">subject</span> <span class="o">=</span> <span class="n">msg_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;subject&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>

        <span class="c1"># Parse sender</span>
        <span class="n">sender_info</span> <span class="o">=</span> <span class="n">msg_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;from&quot;</span><span class="p">,</span> <span class="p">{})</span>
        <span class="n">sender</span> <span class="o">=</span> <span class="n">EmailAddress</span><span class="p">(</span>
            <span class="n">email</span><span class="o">=</span><span class="n">sender_info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;emailAddress&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;address&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
            <span class="n">name</span><span class="o">=</span><span class="n">sender_info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;emailAddress&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
        <span class="p">)</span>

        <span class="c1"># Parse recipients</span>
        <span class="n">to_recipients</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">recipient</span> <span class="ow">in</span> <span class="n">msg_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;toRecipients&quot;</span><span class="p">,</span> <span class="p">[]):</span>
            <span class="n">to_recipients</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="n">EmailAddress</span><span class="p">(</span>
                    <span class="n">email</span><span class="o">=</span><span class="n">recipient</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;emailAddress&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;address&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
                    <span class="n">name</span><span class="o">=</span><span class="n">recipient</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;emailAddress&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
                <span class="p">)</span>
            <span class="p">)</span>

        <span class="n">cc_recipients</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">recipient</span> <span class="ow">in</span> <span class="n">msg_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;ccRecipients&quot;</span><span class="p">,</span> <span class="p">[]):</span>
            <span class="n">cc_recipients</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="n">EmailAddress</span><span class="p">(</span>
                    <span class="n">email</span><span class="o">=</span><span class="n">recipient</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;emailAddress&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;address&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
                    <span class="n">name</span><span class="o">=</span><span class="n">recipient</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;emailAddress&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
                <span class="p">)</span>
            <span class="p">)</span>

        <span class="n">bcc_recipients</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">recipient</span> <span class="ow">in</span> <span class="n">msg_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;bccRecipients&quot;</span><span class="p">,</span> <span class="p">[]):</span>
            <span class="n">bcc_recipients</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="n">EmailAddress</span><span class="p">(</span>
                    <span class="n">email</span><span class="o">=</span><span class="n">recipient</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;emailAddress&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;address&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
                    <span class="n">name</span><span class="o">=</span><span class="n">recipient</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;emailAddress&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
                <span class="p">)</span>
            <span class="p">)</span>

        <span class="c1"># Parse dates</span>
        <span class="n">date_sent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_graph_date</span><span class="p">(</span><span class="n">msg_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;sentDateTime&quot;</span><span class="p">))</span>
        <span class="n">date_received</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_graph_date</span><span class="p">(</span><span class="n">msg_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;receivedDateTime&quot;</span><span class="p">))</span>

        <span class="c1"># Extract body</span>
        <span class="n">body</span> <span class="o">=</span> <span class="n">msg_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;body&quot;</span><span class="p">,</span> <span class="p">{})</span>
        <span class="n">body_text</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">body</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;content&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">body</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;contentType&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;text&quot;</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="p">)</span>
        <span class="n">body_html</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">body</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;content&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">body</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;contentType&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;html&quot;</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="p">)</span>

        <span class="c1"># Parse status</span>
        <span class="n">status</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">MessageStatus</span><span class="o">.</span><span class="n">READ</span>
            <span class="k">if</span> <span class="n">msg_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;isRead&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
            <span class="k">else</span> <span class="n">MessageStatus</span><span class="o">.</span><span class="n">UNREAD</span>
        <span class="p">)</span>

        <span class="c1"># Parse attachments</span>
        <span class="n">attachments</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_graph_attachments</span><span class="p">(</span><span class="n">msg_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;attachments&quot;</span><span class="p">,</span> <span class="p">[]))</span>

        <span class="c1"># Get folder information</span>
        <span class="n">parent_folder_id</span> <span class="o">=</span> <span class="n">msg_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;parentFolderId&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">EmailMessage</span><span class="p">(</span>
            <span class="n">message_id</span><span class="o">=</span><span class="n">message_id</span><span class="p">,</span>
            <span class="n">subject</span><span class="o">=</span><span class="n">subject</span><span class="p">,</span>
            <span class="n">sender</span><span class="o">=</span><span class="n">sender</span><span class="p">,</span>
            <span class="n">recipients</span><span class="o">=</span><span class="n">to_recipients</span><span class="p">,</span>
            <span class="n">cc_recipients</span><span class="o">=</span><span class="n">cc_recipients</span><span class="p">,</span>
            <span class="n">bcc_recipients</span><span class="o">=</span><span class="n">bcc_recipients</span><span class="p">,</span>
            <span class="n">body_text</span><span class="o">=</span><span class="n">body_text</span><span class="p">,</span>
            <span class="n">body_html</span><span class="o">=</span><span class="n">body_html</span><span class="p">,</span>
            <span class="n">date_sent</span><span class="o">=</span><span class="n">date_sent</span><span class="p">,</span>
            <span class="n">date_received</span><span class="o">=</span><span class="n">date_received</span><span class="p">,</span>
            <span class="n">status</span><span class="o">=</span><span class="n">status</span><span class="p">,</span>
            <span class="n">attachments</span><span class="o">=</span><span class="n">attachments</span><span class="p">,</span>
            <span class="n">folder</span><span class="o">=</span><span class="n">parent_folder_id</span><span class="p">,</span>
            <span class="n">metadata</span><span class="o">=</span><span class="n">msg_data</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="ragora.utils.email_utils.graph_provider.GraphProvider._verify_token" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">_verify_token</span><span class="p">()</span></code>

<a href="#ragora.utils.email_utils.graph_provider.GraphProvider._verify_token" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Verify if the access token is valid.</p>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/utils/email_utils/graph_provider.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">_verify_token</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Verify if the access token is valid.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_access_token</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Authorization&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Bearer </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_access_token</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">}</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">BASE_URL</span><span class="si">}</span><span class="s2">/me&quot;</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="ragora.utils.email_utils.graph_provider.GraphProvider.connect" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">connect</span><span class="p">()</span></code>

<a href="#ragora.utils.email_utils.graph_provider.GraphProvider.connect" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Establish connection to Microsoft Graph API.</p>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/utils/email_utils/graph_provider.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">connect</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Establish connection to Microsoft Graph API.&quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">credentials</span><span class="o">.</span><span class="n">access_token</span><span class="p">:</span>
            <span class="c1"># Use provided access token</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_access_token</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">credentials</span><span class="o">.</span><span class="n">access_token</span>
            <span class="c1"># Verify token is valid</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_verify_token</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_connected</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">return</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">AuthenticationError</span><span class="p">(</span><span class="s2">&quot;Invalid access token&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Get access token using client credentials flow</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_get_access_token</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_connected</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_connected</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">raise</span> <span class="ne">ConnectionError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to connect to Microsoft Graph: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="ragora.utils.email_utils.graph_provider.GraphProvider.create_draft" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">create_draft</span><span class="p">(</span><span class="n">to</span><span class="p">,</span> <span class="n">subject</span><span class="p">,</span> <span class="n">body</span><span class="p">,</span> <span class="n">cc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">bcc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">attachments</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">folder</span><span class="o">=</span><span class="s1">&#39;Drafts&#39;</span><span class="p">)</span></code>

<a href="#ragora.utils.email_utils.graph_provider.GraphProvider.create_draft" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Create a draft message using Microsoft Graph API.
Args:
    to: List of recipient email addresses
    subject: Email subject line
    body: Email body content (HTML or plain text)
    cc: Optional list of CC recipient email addresses
    bcc: Optional list of BCC recipient email addresses
    attachments: Optional list of attachment file paths
    folder: The folder to save the draft message
Returns:
    EmailDraft object</p>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/utils/email_utils/graph_provider.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">create_draft</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">to</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
    <span class="n">subject</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">body</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">cc</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">bcc</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">attachments</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">folder</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;Drafts&quot;</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">EmailDraft</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create a draft message using Microsoft Graph API.</span>
<span class="sd">    Args:</span>
<span class="sd">        to: List of recipient email addresses</span>
<span class="sd">        subject: Email subject line</span>
<span class="sd">        body: Email body content (HTML or plain text)</span>
<span class="sd">        cc: Optional list of CC recipient email addresses</span>
<span class="sd">        bcc: Optional list of BCC recipient email addresses</span>
<span class="sd">        attachments: Optional list of attachment file paths</span>
<span class="sd">        folder: The folder to save the draft message</span>
<span class="sd">    Returns:</span>
<span class="sd">        EmailDraft object</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Prepare message data</span>
        <span class="n">message_data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;subject&quot;</span><span class="p">:</span> <span class="n">subject</span><span class="p">,</span>
            <span class="s2">&quot;body&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;contentType&quot;</span><span class="p">:</span> <span class="s2">&quot;text&quot;</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">body</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;&lt;&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="s2">&quot;html&quot;</span><span class="p">,</span>
                <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="n">body</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="s2">&quot;toRecipients&quot;</span><span class="p">:</span> <span class="p">[{</span><span class="s2">&quot;emailAddress&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;address&quot;</span><span class="p">:</span> <span class="n">addr</span><span class="p">}}</span> <span class="k">for</span> <span class="n">addr</span> <span class="ow">in</span> <span class="n">to</span><span class="p">],</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="n">cc</span><span class="p">:</span>
            <span class="n">message_data</span><span class="p">[</span><span class="s2">&quot;ccRecipients&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
                <span class="p">{</span><span class="s2">&quot;emailAddress&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;address&quot;</span><span class="p">:</span> <span class="n">addr</span><span class="p">}}</span> <span class="k">for</span> <span class="n">addr</span> <span class="ow">in</span> <span class="n">cc</span>
            <span class="p">]</span>

        <span class="k">if</span> <span class="n">bcc</span><span class="p">:</span>
            <span class="n">message_data</span><span class="p">[</span><span class="s2">&quot;bccRecipients&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
                <span class="p">{</span><span class="s2">&quot;emailAddress&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;address&quot;</span><span class="p">:</span> <span class="n">addr</span><span class="p">}}</span> <span class="k">for</span> <span class="n">addr</span> <span class="ow">in</span> <span class="n">bcc</span>
            <span class="p">]</span>

        <span class="c1"># Create draft</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_request</span><span class="p">(</span><span class="s2">&quot;POST&quot;</span><span class="p">,</span> <span class="s2">&quot;/me/messages&quot;</span><span class="p">,</span> <span class="n">message_data</span><span class="p">)</span>

        <span class="c1"># Save as draft</span>
        <span class="n">draft_response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_request</span><span class="p">(</span>
            <span class="s2">&quot;POST&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;/me/messages/</span><span class="si">{</span><span class="n">response</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">/save&quot;</span><span class="p">,</span> <span class="p">{}</span>
        <span class="p">)</span>

        <span class="n">draft_id</span> <span class="o">=</span> <span class="n">response</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span>

        <span class="c1"># Parse recipients</span>
        <span class="n">to_addresses</span> <span class="o">=</span> <span class="p">[</span><span class="n">EmailAddress</span><span class="p">(</span><span class="n">addr</span><span class="p">)</span> <span class="k">for</span> <span class="n">addr</span> <span class="ow">in</span> <span class="n">to</span><span class="p">]</span>
        <span class="n">cc_addresses</span> <span class="o">=</span> <span class="p">[</span><span class="n">EmailAddress</span><span class="p">(</span><span class="n">addr</span><span class="p">)</span> <span class="k">for</span> <span class="n">addr</span> <span class="ow">in</span> <span class="p">(</span><span class="n">cc</span> <span class="ow">or</span> <span class="p">[])]</span>
        <span class="n">bcc_addresses</span> <span class="o">=</span> <span class="p">[</span><span class="n">EmailAddress</span><span class="p">(</span><span class="n">addr</span><span class="p">)</span> <span class="k">for</span> <span class="n">addr</span> <span class="ow">in</span> <span class="p">(</span><span class="n">bcc</span> <span class="ow">or</span> <span class="p">[])]</span>

        <span class="c1"># Process attachments</span>
        <span class="n">email_attachments</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">attachments</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">file_path</span> <span class="ow">in</span> <span class="n">attachments</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                        <span class="n">content</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

                    <span class="n">attachment_data</span> <span class="o">=</span> <span class="p">{</span>
                        <span class="s2">&quot;@odata.type&quot;</span><span class="p">:</span> <span class="s2">&quot;#microsoft.graph.fileAttachment&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">file_path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
                        <span class="s2">&quot;contentType&quot;</span><span class="p">:</span> <span class="s2">&quot;application/octet-stream&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;contentBytes&quot;</span><span class="p">:</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64encode</span><span class="p">(</span><span class="n">content</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">),</span>
                    <span class="p">}</span>

                    <span class="c1"># Add attachment to draft</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_make_request</span><span class="p">(</span>
                        <span class="s2">&quot;POST&quot;</span><span class="p">,</span>
                        <span class="sa">f</span><span class="s2">&quot;/me/messages/</span><span class="si">{</span><span class="n">draft_id</span><span class="si">}</span><span class="s2">/attachments&quot;</span><span class="p">,</span>
                        <span class="n">attachment_data</span><span class="p">,</span>
                    <span class="p">)</span>

                    <span class="n">email_attachments</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="n">EmailAttachment</span><span class="p">(</span>
                            <span class="n">filename</span><span class="o">=</span><span class="n">file_path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
                            <span class="n">content_type</span><span class="o">=</span><span class="s2">&quot;application/octet-stream&quot;</span><span class="p">,</span>
                            <span class="n">size</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">content</span><span class="p">),</span>
                            <span class="n">content</span><span class="o">=</span><span class="n">content</span><span class="p">,</span>
                        <span class="p">)</span>
                    <span class="p">)</span>

                <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                    <span class="c1"># Skip problematic attachments</span>
                    <span class="k">continue</span>

        <span class="k">return</span> <span class="n">EmailDraft</span><span class="p">(</span>
            <span class="n">draft_id</span><span class="o">=</span><span class="n">draft_id</span><span class="p">,</span>
            <span class="n">subject</span><span class="o">=</span><span class="n">subject</span><span class="p">,</span>
            <span class="n">recipients</span><span class="o">=</span><span class="n">to_addresses</span><span class="p">,</span>
            <span class="n">cc_recipients</span><span class="o">=</span><span class="n">cc_addresses</span><span class="p">,</span>
            <span class="n">bcc_recipients</span><span class="o">=</span><span class="n">bcc_addresses</span><span class="p">,</span>
            <span class="n">body_text</span><span class="o">=</span><span class="n">body</span><span class="p">,</span>
            <span class="n">attachments</span><span class="o">=</span><span class="n">email_attachments</span><span class="p">,</span>
            <span class="n">created_date</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(),</span>
            <span class="n">modified_date</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(),</span>
            <span class="n">metadata</span><span class="o">=</span><span class="n">response</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to create draft: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="ragora.utils.email_utils.graph_provider.GraphProvider.disconnect" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">disconnect</span><span class="p">()</span></code>

<a href="#ragora.utils.email_utils.graph_provider.GraphProvider.disconnect" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Close connection to Microsoft Graph API.</p>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/utils/email_utils/graph_provider.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">disconnect</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Close connection to Microsoft Graph API.&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_access_token</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_connected</span> <span class="o">=</span> <span class="kc">False</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="ragora.utils.email_utils.graph_provider.GraphProvider.fetch_message_by_id" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">fetch_message_by_id</span><span class="p">(</span><span class="n">message_id</span><span class="p">)</span></code>

<a href="#ragora.utils.email_utils.graph_provider.GraphProvider.fetch_message_by_id" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Fetch a specific message by its ID.
Args:
    message_id: The ID of the message to fetch
Returns:
    EmailMessage object if the message was found, None otherwise</p>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/utils/email_utils/graph_provider.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">fetch_message_by_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">EmailMessage</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Fetch a specific message by its ID.</span>
<span class="sd">    Args:</span>
<span class="sd">        message_id: The ID of the message to fetch</span>
<span class="sd">    Returns:</span>
<span class="sd">        EmailMessage object if the message was found, None otherwise</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">endpoint</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;/me/messages/</span><span class="si">{</span><span class="n">message_id</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_request</span><span class="p">(</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span> <span class="n">endpoint</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_graph_message</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">if</span> <span class="s2">&quot;404&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to fetch message </span><span class="si">{</span><span class="n">message_id</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="ragora.utils.email_utils.graph_provider.GraphProvider.fetch_messages" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">fetch_messages</span><span class="p">(</span><span class="n">limit</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">folder</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">unread_only</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#ragora.utils.email_utils.graph_provider.GraphProvider.fetch_messages" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Fetch messages from Microsoft Graph API.
Args:
    limit: The maximum number of messages to fetch
    folder: The folder to search for messages
    unread_only: Whether to only fetch unread messages
Returns:
    List of EmailMessage objects</p>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/utils/email_utils/graph_provider.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">fetch_messages</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span> <span class="n">folder</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">unread_only</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">EmailMessage</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Fetch messages from Microsoft Graph API.</span>
<span class="sd">    Args:</span>
<span class="sd">        limit: The maximum number of messages to fetch</span>
<span class="sd">        folder: The folder to search for messages</span>
<span class="sd">        unread_only: Whether to only fetch unread messages</span>
<span class="sd">    Returns:</span>
<span class="sd">        List of EmailMessage objects</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Build endpoint</span>
        <span class="k">if</span> <span class="n">folder</span><span class="p">:</span>
            <span class="n">endpoint</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;/me/mailFolders/</span><span class="si">{</span><span class="n">folder</span><span class="si">}</span><span class="s2">/messages&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">endpoint</span> <span class="o">=</span> <span class="s2">&quot;/me/messages&quot;</span>

        <span class="c1"># Add query parameters</span>
        <span class="n">params</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">limit</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">params</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;$top=</span><span class="si">{</span><span class="n">limit</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">unread_only</span><span class="p">:</span>
            <span class="n">params</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;$filter=isRead eq false&quot;</span><span class="p">)</span>

        <span class="c1"># Add ordering</span>
        <span class="n">params</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;$orderby=receivedDateTime desc&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">params</span><span class="p">:</span>
            <span class="n">endpoint</span> <span class="o">+=</span> <span class="s2">&quot;?&quot;</span> <span class="o">+</span> <span class="s2">&quot;&amp;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>

        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_request</span><span class="p">(</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span> <span class="n">endpoint</span><span class="p">)</span>
        <span class="n">messages_data</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">,</span> <span class="p">[])</span>

        <span class="n">email_messages</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">msg_data</span> <span class="ow">in</span> <span class="n">messages_data</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">email_msg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_graph_message</span><span class="p">(</span><span class="n">msg_data</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">email_msg</span><span class="p">:</span>
                    <span class="n">email_messages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">email_msg</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="c1"># Skip problematic messages</span>
                <span class="k">continue</span>

        <span class="k">return</span> <span class="n">email_messages</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to fetch messages: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="ragora.utils.email_utils.graph_provider.GraphProvider.get_folders" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_folders</span><span class="p">()</span></code>

<a href="#ragora.utils.email_utils.graph_provider.GraphProvider.get_folders" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Get list of available folders.
Returns:
    List of available folders</p>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/utils/email_utils/graph_provider.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_folders</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get list of available folders.</span>
<span class="sd">    Returns:</span>
<span class="sd">        List of available folders</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_request</span><span class="p">(</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span> <span class="s2">&quot;/me/mailFolders&quot;</span><span class="p">)</span>
        <span class="n">folders_data</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">,</span> <span class="p">[])</span>

        <span class="n">folders</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">folder_data</span> <span class="ow">in</span> <span class="n">folders_data</span><span class="p">:</span>
            <span class="n">folders</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">folder_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;displayName&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">folders</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to get folders: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="ragora.utils.email_utils.graph_provider.GraphProvider.mark_as_read" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">mark_as_read</span><span class="p">(</span><span class="n">message_id</span><span class="p">)</span></code>

<a href="#ragora.utils.email_utils.graph_provider.GraphProvider.mark_as_read" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Mark a message as read.
Args:
    message_id: The ID of the message to mark as read
Returns:
    True if the message was marked as read successfully, False otherwise</p>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/utils/email_utils/graph_provider.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">mark_as_read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Mark a message as read.</span>
<span class="sd">    Args:</span>
<span class="sd">        message_id: The ID of the message to mark as read</span>
<span class="sd">    Returns:</span>
<span class="sd">        True if the message was marked as read successfully, False otherwise</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">update_data</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;isRead&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_make_request</span><span class="p">(</span><span class="s2">&quot;PATCH&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;/me/messages/</span><span class="si">{</span><span class="n">message_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">update_data</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">if</span> <span class="s2">&quot;404&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to mark message as read: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="ragora.utils.email_utils.graph_provider.GraphProvider.send_message" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">send_message</span><span class="p">(</span><span class="n">draft_id</span><span class="p">,</span> <span class="n">folder</span><span class="o">=</span><span class="s1">&#39;Drafts&#39;</span><span class="p">)</span></code>

<a href="#ragora.utils.email_utils.graph_provider.GraphProvider.send_message" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Send a draft message.
Args:
    draft_id: The ID of the draft message to send
    folder: The folder to search for the draft message
Returns:
    True if the draft message was sent successfully, False otherwise</p>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/utils/email_utils/graph_provider.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">send_message</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">draft_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">folder</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;Drafts&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Send a draft message.</span>
<span class="sd">    Args:</span>
<span class="sd">        draft_id: The ID of the draft message to send</span>
<span class="sd">        folder: The folder to search for the draft message</span>
<span class="sd">    Returns:</span>
<span class="sd">        True if the draft message was sent successfully, False otherwise</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_make_request</span><span class="p">(</span><span class="s2">&quot;POST&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;/me/messages/</span><span class="si">{</span><span class="n">draft_id</span><span class="si">}</span><span class="s2">/send&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to send message: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="ragora.utils.email_utils.graph_provider.GraphProvider.send_message_direct" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">send_message_direct</span><span class="p">(</span><span class="n">to</span><span class="p">,</span> <span class="n">subject</span><span class="p">,</span> <span class="n">body</span><span class="p">,</span> <span class="n">cc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">bcc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">attachments</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#ragora.utils.email_utils.graph_provider.GraphProvider.send_message_direct" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Send a message directly via Microsoft Graph API.
Args:
    to: List of recipient email addresses
    subject: Email subject line
    body: Email body content (HTML or plain text)
    cc: Optional list of CC recipient email addresses
    bcc: Optional list of BCC recipient email addresses
    attachments: Optional list of attachment file paths
Returns:
    True if the message was sent successfully, False otherwise</p>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/utils/email_utils/graph_provider.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">send_message_direct</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">to</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
    <span class="n">subject</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">body</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">cc</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">bcc</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">attachments</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Send a message directly via Microsoft Graph API.</span>
<span class="sd">    Args:</span>
<span class="sd">        to: List of recipient email addresses</span>
<span class="sd">        subject: Email subject line</span>
<span class="sd">        body: Email body content (HTML or plain text)</span>
<span class="sd">        cc: Optional list of CC recipient email addresses</span>
<span class="sd">        bcc: Optional list of BCC recipient email addresses</span>
<span class="sd">        attachments: Optional list of attachment file paths</span>
<span class="sd">    Returns:</span>
<span class="sd">        True if the message was sent successfully, False otherwise</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Create draft first</span>
        <span class="n">draft</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_draft</span><span class="p">(</span><span class="n">to</span><span class="p">,</span> <span class="n">subject</span><span class="p">,</span> <span class="n">body</span><span class="p">,</span> <span class="n">cc</span><span class="p">,</span> <span class="n">bcc</span><span class="p">,</span> <span class="n">attachments</span><span class="p">)</span>

        <span class="c1"># Send the draft</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">send_message</span><span class="p">(</span><span class="n">draft</span><span class="o">.</span><span class="n">draft_id</span><span class="p">)</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to send message directly: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<a id="ragora.utils.email_utils.imap_provider"></a>
    <div class="doc doc-contents first">

        <p>IMAP/SMTP email provider implementation.</p>










  <div class="doc doc-children">









<div class="doc doc-object doc-class">



<h4 id="ragora.utils.email_utils.imap_provider.IMAPProvider" class="doc doc-heading">
            <code>IMAPProvider</code>


<a href="#ragora.utils.email_utils.imap_provider.IMAPProvider" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="EmailProvider (ragora.utils.email_utils.base.EmailProvider)" href="#ragora.utils.email_utils.base.EmailProvider">EmailProvider</a></code></p>


        <p>IMAP/SMTP email provider for generic email servers.</p>








              <details class="quote">
                <summary>Source code in <code>ragora/ragora/utils/email_utils/imap_provider.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span>
<span class="normal">760</span>
<span class="normal">761</span>
<span class="normal">762</span>
<span class="normal">763</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">IMAPProvider</span><span class="p">(</span><span class="n">EmailProvider</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;IMAP/SMTP email provider for generic email servers.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">credentials</span><span class="p">:</span> <span class="n">IMAPCredentials</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize IMAP provider with credentials.</span>

<span class="sd">        Args:</span>
<span class="sd">            credentials: IMAP/SMTP server credentials</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">credentials</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_imap_client</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">imaplib</span><span class="o">.</span><span class="n">IMAP4_SSL</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_smtp_client</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">smtplib</span><span class="o">.</span><span class="n">SMTP</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_connected</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">connect</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Establish connection to IMAP and SMTP servers.&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Connect to IMAP server</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">credentials</span><span class="o">.</span><span class="n">use_ssl</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_imap_client</span> <span class="o">=</span> <span class="n">imaplib</span><span class="o">.</span><span class="n">IMAP4_SSL</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">credentials</span><span class="o">.</span><span class="n">imap_server</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">credentials</span><span class="o">.</span><span class="n">imap_port</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_imap_client</span> <span class="o">=</span> <span class="n">imaplib</span><span class="o">.</span><span class="n">IMAP4</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">credentials</span><span class="o">.</span><span class="n">imap_server</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">credentials</span><span class="o">.</span><span class="n">imap_port</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">credentials</span><span class="o">.</span><span class="n">use_tls</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_imap_client</span><span class="o">.</span><span class="n">starttls</span><span class="p">()</span>

            <span class="c1"># Login to IMAP</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_imap_client</span><span class="o">.</span><span class="n">login</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">credentials</span><span class="o">.</span><span class="n">username</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">credentials</span><span class="o">.</span><span class="n">password</span>
            <span class="p">)</span>

            <span class="c1"># Connect to SMTP server</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">credentials</span><span class="o">.</span><span class="n">use_ssl</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_smtp_client</span> <span class="o">=</span> <span class="n">smtplib</span><span class="o">.</span><span class="n">SMTP_SSL</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">credentials</span><span class="o">.</span><span class="n">smtp_server</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">credentials</span><span class="o">.</span><span class="n">smtp_port</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_smtp_client</span> <span class="o">=</span> <span class="n">smtplib</span><span class="o">.</span><span class="n">SMTP</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">credentials</span><span class="o">.</span><span class="n">smtp_server</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">credentials</span><span class="o">.</span><span class="n">smtp_port</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">credentials</span><span class="o">.</span><span class="n">use_tls</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_smtp_client</span><span class="o">.</span><span class="n">starttls</span><span class="p">()</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_smtp_client</span><span class="o">.</span><span class="n">login</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">credentials</span><span class="o">.</span><span class="n">username</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">credentials</span><span class="o">.</span><span class="n">password</span>
            <span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_connected</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_connected</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">raise</span> <span class="ne">ConnectionError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to connect to email servers: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">disconnect</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Close connections to IMAP and SMTP servers.&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_imap_client</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_imap_client</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_imap_client</span><span class="o">.</span><span class="n">logout</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_imap_client</span> <span class="o">=</span> <span class="kc">None</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_smtp_client</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_smtp_client</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_smtp_client</span> <span class="o">=</span> <span class="kc">None</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_connected</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="c1"># Ignore errors during disconnect</span>
            <span class="k">pass</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">fetch_messages</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">limit</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">folder</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">unread_only</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">EmailMessage</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Fetch messages from IMAP server.</span>
<span class="sd">        Args:</span>
<span class="sd">            limit: The maximum number of messages to fetch</span>
<span class="sd">            folder: The folder to search for messages</span>
<span class="sd">            unread_only: Whether to only fetch unread messages</span>
<span class="sd">        Returns:</span>
<span class="sd">            List of EmailMessage objects</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_connected</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ConnectionError</span><span class="p">(</span><span class="s2">&quot;Not connected to IMAP server&quot;</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Select folder (default to INBOX)</span>
            <span class="n">folder_name</span> <span class="o">=</span> <span class="n">folder</span> <span class="ow">or</span> <span class="s2">&quot;INBOX&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_imap_client</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">folder_name</span><span class="p">)</span>

            <span class="c1"># Build search criteria</span>
            <span class="n">search_criteria</span> <span class="o">=</span> <span class="s2">&quot;ALL&quot;</span>
            <span class="k">if</span> <span class="n">unread_only</span><span class="p">:</span>
                <span class="n">search_criteria</span> <span class="o">=</span> <span class="s2">&quot;UNSEEN&quot;</span>

            <span class="c1"># Search for messages</span>
            <span class="n">status</span><span class="p">,</span> <span class="n">messages</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_imap_client</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">search_criteria</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">status</span> <span class="o">!=</span> <span class="s2">&quot;OK&quot;</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Failed to search messages&quot;</span><span class="p">)</span>

            <span class="n">message_ids</span> <span class="o">=</span> <span class="n">messages</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="n">message_ids</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">message_ids</span><span class="p">[</span><span class="o">-</span><span class="n">limit</span><span class="p">:]</span> <span class="k">if</span> <span class="n">limit</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">limit</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">message_ids</span>
            <span class="p">)</span>

            <span class="n">email_messages</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">msg_id</span> <span class="ow">in</span> <span class="n">message_ids</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">email_msg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fetch_single_message</span><span class="p">(</span><span class="n">msg_id</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">email_msg</span><span class="p">:</span>
                        <span class="n">email_messages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">email_msg</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="c1"># Skip problematic messages</span>
                    <span class="k">continue</span>

            <span class="k">return</span> <span class="n">email_messages</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to fetch messages: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">fetch_message_by_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">EmailMessage</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Fetch a specific message by its ID.</span>
<span class="sd">        Args:</span>
<span class="sd">            message_id: The ID of the message to fetch</span>
<span class="sd">        Returns:</span>
<span class="sd">            EmailMessage object if the message was found, None otherwise</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_connected</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ConnectionError</span><span class="p">(</span><span class="s2">&quot;Not connected to IMAP server&quot;</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Search for the specific message ID</span>
            <span class="n">status</span><span class="p">,</span> <span class="n">messages</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_imap_client</span><span class="o">.</span><span class="n">search</span><span class="p">(</span>
                <span class="kc">None</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;HEADER Message-ID &quot;</span><span class="si">{</span><span class="n">message_id</span><span class="si">}</span><span class="s1">&quot;&#39;</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">status</span> <span class="o">!=</span> <span class="s2">&quot;OK&quot;</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">messages</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                <span class="k">return</span> <span class="kc">None</span>

            <span class="n">msg_ids</span> <span class="o">=</span> <span class="n">messages</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">msg_ids</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">None</span>

            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fetch_single_message</span><span class="p">(</span><span class="n">msg_ids</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to fetch message </span><span class="si">{</span><span class="n">message_id</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_fetch_single_message</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg_id</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">EmailMessage</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Fetch and parse a single message.</span>
<span class="sd">        Args:</span>
<span class="sd">            msg_id: The ID of the message to fetch</span>
<span class="sd">        Returns:</span>
<span class="sd">            EmailMessage object if the message was found, None otherwise</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">status</span><span class="p">,</span> <span class="n">msg_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_imap_client</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="n">msg_id</span><span class="p">,</span> <span class="s2">&quot;(RFC822)&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">status</span> <span class="o">!=</span> <span class="s2">&quot;OK&quot;</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">None</span>

            <span class="n">raw_email</span> <span class="o">=</span> <span class="n">msg_data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">email_message</span> <span class="o">=</span> <span class="n">email</span><span class="o">.</span><span class="n">message_from_bytes</span><span class="p">(</span><span class="n">raw_email</span><span class="p">)</span>

            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_email_message</span><span class="p">(</span><span class="n">email_message</span><span class="p">,</span> <span class="n">msg_id</span><span class="o">.</span><span class="n">decode</span><span class="p">())</span>

        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_parse_email_message</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">email_msg</span><span class="p">:</span> <span class="n">email</span><span class="o">.</span><span class="n">message</span><span class="o">.</span><span class="n">Message</span><span class="p">,</span> <span class="n">msg_id</span><span class="p">:</span> <span class="nb">str</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">EmailMessage</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Parse email.message.Message into EmailMessage object.</span>
<span class="sd">        Args:</span>
<span class="sd">            email_msg: The email.message.Message object to parse</span>
<span class="sd">            msg_id: The ID of the message</span>
<span class="sd">        Returns:</span>
<span class="sd">            EmailMessage object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Extract headers</span>
        <span class="n">subject</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_decode_header</span><span class="p">(</span><span class="n">email_msg</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Subject&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
        <span class="n">sender</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_address</span><span class="p">(</span><span class="n">email_msg</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;From&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>

        <span class="c1"># Parse recipients</span>
        <span class="n">to_addresses</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_address_list</span><span class="p">(</span><span class="n">email_msg</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;To&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
        <span class="n">cc_addresses</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_address_list</span><span class="p">(</span><span class="n">email_msg</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Cc&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
        <span class="n">bcc_addresses</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_address_list</span><span class="p">(</span><span class="n">email_msg</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Bcc&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>

        <span class="c1"># Parse dates</span>
        <span class="n">date_sent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_date</span><span class="p">(</span><span class="n">email_msg</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Date&quot;</span><span class="p">))</span>

        <span class="c1"># Extract body</span>
        <span class="n">body_text</span><span class="p">,</span> <span class="n">body_html</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_body</span><span class="p">(</span><span class="n">email_msg</span><span class="p">)</span>

        <span class="c1"># Extract attachments</span>
        <span class="n">attachments</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_attachments</span><span class="p">(</span><span class="n">email_msg</span><span class="p">)</span>

        <span class="c1"># Determine status</span>
        <span class="n">status</span> <span class="o">=</span> <span class="n">MessageStatus</span><span class="o">.</span><span class="n">READ</span> <span class="k">if</span> <span class="n">email_msg</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;X-Seen&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="n">MessageStatus</span><span class="o">.</span><span class="n">UNREAD</span>

        <span class="k">return</span> <span class="n">EmailMessage</span><span class="p">(</span>
            <span class="n">message_id</span><span class="o">=</span><span class="n">email_msg</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Message-ID&quot;</span><span class="p">,</span> <span class="n">msg_id</span><span class="p">),</span>
            <span class="n">subject</span><span class="o">=</span><span class="n">subject</span><span class="p">,</span>
            <span class="n">sender</span><span class="o">=</span><span class="n">sender</span><span class="p">,</span>
            <span class="n">recipients</span><span class="o">=</span><span class="n">to_addresses</span><span class="p">,</span>
            <span class="n">cc_recipients</span><span class="o">=</span><span class="n">cc_addresses</span><span class="p">,</span>
            <span class="n">bcc_recipients</span><span class="o">=</span><span class="n">bcc_addresses</span><span class="p">,</span>
            <span class="n">body_text</span><span class="o">=</span><span class="n">body_text</span><span class="p">,</span>
            <span class="n">body_html</span><span class="o">=</span><span class="n">body_html</span><span class="p">,</span>
            <span class="n">date_sent</span><span class="o">=</span><span class="n">date_sent</span><span class="p">,</span>
            <span class="n">date_received</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(),</span>
            <span class="n">status</span><span class="o">=</span><span class="n">status</span><span class="p">,</span>
            <span class="n">attachments</span><span class="o">=</span><span class="n">attachments</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_decode_header</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">header</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Decode email header.</span>
<span class="sd">        Args:</span>
<span class="sd">            header: The email header to decode</span>
<span class="sd">        Returns:</span>
<span class="sd">            Decoded email header</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">header</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;&quot;</span>

        <span class="n">decoded_parts</span> <span class="o">=</span> <span class="n">decode_header</span><span class="p">(</span><span class="n">header</span><span class="p">)</span>
        <span class="n">decoded_string</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

        <span class="k">for</span> <span class="n">part</span><span class="p">,</span> <span class="n">encoding</span> <span class="ow">in</span> <span class="n">decoded_parts</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">part</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">encoding</span><span class="p">:</span>
                    <span class="n">decoded_string</span> <span class="o">+=</span> <span class="n">part</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">encoding</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">decoded_string</span> <span class="o">+=</span> <span class="n">part</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">decoded_string</span> <span class="o">+=</span> <span class="n">part</span>

        <span class="k">return</span> <span class="n">decoded_string</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_parse_address</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">address_str</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">EmailAddress</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Parse a single email address.</span>
<span class="sd">        Args:</span>
<span class="sd">            address_str: The email address to parse</span>
<span class="sd">        Returns:</span>
<span class="sd">            EmailAddress object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">address_str</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">EmailAddress</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

        <span class="n">decoded</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_decode_header</span><span class="p">(</span><span class="n">address_str</span><span class="p">)</span>

        <span class="c1"># Simple parsing - could be improved with proper email parsing library</span>
        <span class="k">if</span> <span class="s2">&quot;&lt;&quot;</span> <span class="ow">in</span> <span class="n">decoded</span> <span class="ow">and</span> <span class="s2">&quot;&gt;&quot;</span> <span class="ow">in</span> <span class="n">decoded</span><span class="p">:</span>
            <span class="n">name_part</span> <span class="o">=</span> <span class="n">decoded</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;&lt;&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="n">email_part</span> <span class="o">=</span> <span class="n">decoded</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;&lt;&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;&gt;&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">EmailAddress</span><span class="p">(</span><span class="n">email_part</span><span class="p">,</span> <span class="n">name_part</span> <span class="k">if</span> <span class="n">name_part</span> <span class="k">else</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">EmailAddress</span><span class="p">(</span><span class="n">decoded</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_parse_address_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">address_list</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">EmailAddress</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Parse a list of email addresses.</span>
<span class="sd">        Args:</span>
<span class="sd">            address_list: The list of email addresses to parse</span>
<span class="sd">        Returns:</span>
<span class="sd">            List of EmailAddress objects</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">address_list</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[]</span>

        <span class="n">addresses</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">addr</span> <span class="ow">in</span> <span class="n">address_list</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">):</span>
            <span class="n">addr</span> <span class="o">=</span> <span class="n">addr</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">addr</span><span class="p">:</span>
                <span class="n">addresses</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_parse_address</span><span class="p">(</span><span class="n">addr</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">addresses</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_parse_date</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">date_str</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">datetime</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Parse email date string.</span>
<span class="sd">        Args:</span>
<span class="sd">            date_str: The email date string to parse</span>
<span class="sd">        Returns:</span>
<span class="sd">            datetime object if the date was parsed successfully, None otherwise</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">date_str</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Try parsing with email.utils.parsedate_to_datetime</span>
            <span class="k">return</span> <span class="n">email</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">parsedate_to_datetime</span><span class="p">(</span><span class="n">date_str</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_extract_body</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">email_msg</span><span class="p">:</span> <span class="n">email</span><span class="o">.</span><span class="n">message</span><span class="o">.</span><span class="n">Message</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Extract text and HTML body from email message.</span>
<span class="sd">        Args:</span>
<span class="sd">            email_msg: The email.message.Message object to extract the body from</span>
<span class="sd">        Returns:</span>
<span class="sd">            Tuple of text and HTML body</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">body_text</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">body_html</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="n">email_msg</span><span class="o">.</span><span class="n">is_multipart</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">part</span> <span class="ow">in</span> <span class="n">email_msg</span><span class="o">.</span><span class="n">walk</span><span class="p">():</span>
                <span class="n">content_type</span> <span class="o">=</span> <span class="n">part</span><span class="o">.</span><span class="n">get_content_type</span><span class="p">()</span>
                <span class="n">content_disposition</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">part</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Content-Disposition&quot;</span><span class="p">))</span>

                <span class="c1"># Skip attachments</span>
                <span class="k">if</span> <span class="s2">&quot;attachment&quot;</span> <span class="ow">in</span> <span class="n">content_disposition</span><span class="p">:</span>
                    <span class="k">continue</span>

                <span class="k">if</span> <span class="n">content_type</span> <span class="o">==</span> <span class="s2">&quot;text/plain&quot;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">body_text</span><span class="p">:</span>
                    <span class="n">body_text</span> <span class="o">=</span> <span class="n">part</span><span class="o">.</span><span class="n">get_payload</span><span class="p">(</span><span class="n">decode</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span>
                        <span class="s2">&quot;utf-8&quot;</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s2">&quot;ignore&quot;</span>
                    <span class="p">)</span>
                <span class="k">elif</span> <span class="n">content_type</span> <span class="o">==</span> <span class="s2">&quot;text/html&quot;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">body_html</span><span class="p">:</span>
                    <span class="n">body_html</span> <span class="o">=</span> <span class="n">part</span><span class="o">.</span><span class="n">get_payload</span><span class="p">(</span><span class="n">decode</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span>
                        <span class="s2">&quot;utf-8&quot;</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s2">&quot;ignore&quot;</span>
                    <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">content_type</span> <span class="o">=</span> <span class="n">email_msg</span><span class="o">.</span><span class="n">get_content_type</span><span class="p">()</span>
            <span class="n">payload</span> <span class="o">=</span> <span class="n">email_msg</span><span class="o">.</span><span class="n">get_payload</span><span class="p">(</span><span class="n">decode</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">payload</span><span class="p">:</span>
                <span class="n">decoded_payload</span> <span class="o">=</span> <span class="n">payload</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">content_type</span> <span class="o">==</span> <span class="s2">&quot;text/plain&quot;</span><span class="p">:</span>
                    <span class="n">body_text</span> <span class="o">=</span> <span class="n">decoded_payload</span>
                <span class="k">elif</span> <span class="n">content_type</span> <span class="o">==</span> <span class="s2">&quot;text/html&quot;</span><span class="p">:</span>
                    <span class="n">body_html</span> <span class="o">=</span> <span class="n">decoded_payload</span>

        <span class="k">return</span> <span class="n">body_text</span><span class="p">,</span> <span class="n">body_html</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_extract_attachments</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">email_msg</span><span class="p">:</span> <span class="n">email</span><span class="o">.</span><span class="n">message</span><span class="o">.</span><span class="n">Message</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">EmailAttachment</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Extract attachments from email message.&quot;&quot;&quot;</span>
        <span class="n">attachments</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">if</span> <span class="n">email_msg</span><span class="o">.</span><span class="n">is_multipart</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">part</span> <span class="ow">in</span> <span class="n">email_msg</span><span class="o">.</span><span class="n">walk</span><span class="p">():</span>
                <span class="n">content_disposition</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">part</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Content-Disposition&quot;</span><span class="p">))</span>

                <span class="k">if</span> <span class="s2">&quot;attachment&quot;</span> <span class="ow">in</span> <span class="n">content_disposition</span><span class="p">:</span>
                    <span class="n">filename</span> <span class="o">=</span> <span class="n">part</span><span class="o">.</span><span class="n">get_filename</span><span class="p">()</span>
                    <span class="k">if</span> <span class="n">filename</span><span class="p">:</span>
                        <span class="n">filename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_decode_header</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>

                        <span class="n">content_type</span> <span class="o">=</span> <span class="n">part</span><span class="o">.</span><span class="n">get_content_type</span><span class="p">()</span>
                        <span class="n">content</span> <span class="o">=</span> <span class="n">part</span><span class="o">.</span><span class="n">get_payload</span><span class="p">(</span><span class="n">decode</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

                        <span class="n">attachments</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                            <span class="n">EmailAttachment</span><span class="p">(</span>
                                <span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">,</span>
                                <span class="n">content_type</span><span class="o">=</span><span class="n">content_type</span><span class="p">,</span>
                                <span class="n">size</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">content</span><span class="p">)</span> <span class="k">if</span> <span class="n">content</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span>
                                <span class="n">content</span><span class="o">=</span><span class="n">content</span><span class="p">,</span>
                                <span class="n">content_id</span><span class="o">=</span><span class="n">part</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Content-ID&quot;</span><span class="p">),</span>
                            <span class="p">)</span>
                        <span class="p">)</span>

        <span class="k">return</span> <span class="n">attachments</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_create_draft_message</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">to</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
        <span class="n">subject</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">body</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">cc</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span>
        <span class="n">bcc</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span>
        <span class="n">attachments</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span>
        <span class="n">draft_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a properly formatted draft message for IMAP APPEND.</span>
<span class="sd">        Args:</span>
<span class="sd">            to: List of recipient email addresses</span>
<span class="sd">            subject: Email subject line</span>
<span class="sd">            body: Email body content (HTML or plain text)</span>
<span class="sd">            cc: Optional list of CC recipient email addresses</span>
<span class="sd">            bcc: Optional list of BCC recipient email addresses</span>
<span class="sd">            attachments: Optional list of attachment file paths</span>
<span class="sd">        Returns:</span>
<span class="sd">            String representation of the draft message</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Create the message structure</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">MIMEMultipart</span><span class="p">()</span>

        <span class="c1"># Set headers</span>
        <span class="n">msg</span><span class="p">[</span><span class="s2">&quot;From&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">credentials</span><span class="o">.</span><span class="n">username</span>
        <span class="n">msg</span><span class="p">[</span><span class="s2">&quot;To&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">to</span><span class="p">)</span>
        <span class="n">msg</span><span class="p">[</span><span class="s2">&quot;Subject&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">subject</span>
        <span class="n">msg</span><span class="p">[</span><span class="s2">&quot;Message-ID&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&lt;</span><span class="si">{</span><span class="n">draft_id</span><span class="si">}</span><span class="s2">@draft&gt;&quot;</span>
        <span class="n">msg</span><span class="p">[</span><span class="s2">&quot;Date&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">email</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">formatdate</span><span class="p">(</span><span class="n">localtime</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">cc</span><span class="p">:</span>
            <span class="n">msg</span><span class="p">[</span><span class="s2">&quot;Cc&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">cc</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">bcc</span><span class="p">:</span>
            <span class="n">msg</span><span class="p">[</span><span class="s2">&quot;Bcc&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">bcc</span><span class="p">)</span>

        <span class="c1"># Add body</span>
        <span class="n">msg</span><span class="o">.</span><span class="n">attach</span><span class="p">(</span><span class="n">MIMEText</span><span class="p">(</span><span class="n">body</span><span class="p">,</span> <span class="s2">&quot;plain&quot;</span><span class="p">))</span>

        <span class="c1"># Add attachments</span>
        <span class="k">if</span> <span class="n">attachments</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">file_path</span> <span class="ow">in</span> <span class="n">attachments</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">file_path</span><span class="p">):</span>
                    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">attachment</span><span class="p">:</span>
                        <span class="n">part</span> <span class="o">=</span> <span class="n">MIMEApplication</span><span class="p">(</span>
                            <span class="n">attachment</span><span class="o">.</span><span class="n">read</span><span class="p">(),</span> <span class="n">Name</span><span class="o">=</span><span class="n">Path</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span><span class="o">.</span><span class="n">name</span>
                        <span class="p">)</span>
                        <span class="n">part</span><span class="p">[</span><span class="s2">&quot;Content-Disposition&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                            <span class="sa">f</span><span class="s1">&#39;attachment; filename=&quot;</span><span class="si">{</span><span class="n">Path</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1">&quot;&#39;</span>
                        <span class="p">)</span>
                        <span class="n">msg</span><span class="o">.</span><span class="n">attach</span><span class="p">(</span><span class="n">part</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">msg</span><span class="o">.</span><span class="n">as_string</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_create_local_draft</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">to</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
        <span class="n">subject</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">body</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">cc</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span>
        <span class="n">bcc</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span>
        <span class="n">attachments</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">EmailDraft</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a local draft without storing on server.</span>
<span class="sd">        Args:</span>
<span class="sd">            to: List of recipient email addresses</span>
<span class="sd">            subject: Email subject line</span>
<span class="sd">            body: Email body content (HTML or plain text)</span>
<span class="sd">            cc: Optional list of CC recipient email addresses</span>
<span class="sd">            bcc: Optional list of BCC recipient email addresses</span>
<span class="sd">            attachments: Optional list of attachment file paths</span>
<span class="sd">        Returns:</span>
<span class="sd">            EmailDraft object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">draft_id</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;draft_</span><span class="si">{</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">timestamp</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="c1"># Parse recipients</span>
        <span class="n">to_addresses</span> <span class="o">=</span> <span class="p">[</span><span class="n">EmailAddress</span><span class="p">(</span><span class="n">addr</span><span class="p">)</span> <span class="k">for</span> <span class="n">addr</span> <span class="ow">in</span> <span class="n">to</span><span class="p">]</span>
        <span class="n">cc_addresses</span> <span class="o">=</span> <span class="p">[</span><span class="n">EmailAddress</span><span class="p">(</span><span class="n">addr</span><span class="p">)</span> <span class="k">for</span> <span class="n">addr</span> <span class="ow">in</span> <span class="p">(</span><span class="n">cc</span> <span class="ow">or</span> <span class="p">[])]</span>
        <span class="n">bcc_addresses</span> <span class="o">=</span> <span class="p">[</span><span class="n">EmailAddress</span><span class="p">(</span><span class="n">addr</span><span class="p">)</span> <span class="k">for</span> <span class="n">addr</span> <span class="ow">in</span> <span class="p">(</span><span class="n">bcc</span> <span class="ow">or</span> <span class="p">[])]</span>

        <span class="c1"># Process attachments</span>
        <span class="n">email_attachments</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">attachments</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">file_path</span> <span class="ow">in</span> <span class="n">attachments</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">file_path</span><span class="p">):</span>
                    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                        <span class="n">content</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

                    <span class="n">email_attachments</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="n">EmailAttachment</span><span class="p">(</span>
                            <span class="n">filename</span><span class="o">=</span><span class="n">Path</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                            <span class="n">content_type</span><span class="o">=</span><span class="s2">&quot;application/octet-stream&quot;</span><span class="p">,</span>
                            <span class="n">size</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">content</span><span class="p">),</span>
                            <span class="n">content</span><span class="o">=</span><span class="n">content</span><span class="p">,</span>
                        <span class="p">)</span>
                    <span class="p">)</span>

        <span class="k">return</span> <span class="n">EmailDraft</span><span class="p">(</span>
            <span class="n">draft_id</span><span class="o">=</span><span class="n">draft_id</span><span class="p">,</span>
            <span class="n">subject</span><span class="o">=</span><span class="n">subject</span><span class="p">,</span>
            <span class="n">recipients</span><span class="o">=</span><span class="n">to_addresses</span><span class="p">,</span>
            <span class="n">cc_recipients</span><span class="o">=</span><span class="n">cc_addresses</span><span class="p">,</span>
            <span class="n">bcc_recipients</span><span class="o">=</span><span class="n">bcc_addresses</span><span class="p">,</span>
            <span class="n">body_text</span><span class="o">=</span><span class="n">body</span><span class="p">,</span>
            <span class="n">attachments</span><span class="o">=</span><span class="n">email_attachments</span><span class="p">,</span>
            <span class="n">created_date</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(),</span>
            <span class="n">modified_date</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(),</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">create_draft</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">to</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
        <span class="n">subject</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">body</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">cc</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">bcc</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">attachments</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">folder</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;Drafts&quot;</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">EmailDraft</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create and store a draft message on the server using IMAP APPEND.</span>
<span class="sd">        Args:</span>
<span class="sd">            to: List of recipient email addresses</span>
<span class="sd">            subject: Email subject line</span>
<span class="sd">            body: Email body content (HTML or plain text)</span>
<span class="sd">            cc: Optional list of CC recipient email addresses</span>
<span class="sd">            bcc: Optional list of BCC recipient email addresses</span>
<span class="sd">            attachments: Optional list of attachment file paths</span>
<span class="sd">        Returns:</span>
<span class="sd">            EmailDraft object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># If not connected, create a local draft only</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_connected</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_local_draft</span><span class="p">(</span><span class="n">to</span><span class="p">,</span> <span class="n">subject</span><span class="p">,</span> <span class="n">body</span><span class="p">,</span> <span class="n">cc</span><span class="p">,</span> <span class="n">bcc</span><span class="p">,</span> <span class="n">attachments</span><span class="p">)</span>

        <span class="n">draft_id</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;draft_</span><span class="si">{</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">timestamp</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="c1"># Parse recipients</span>
        <span class="n">to_addresses</span> <span class="o">=</span> <span class="p">[</span><span class="n">EmailAddress</span><span class="p">(</span><span class="n">addr</span><span class="p">)</span> <span class="k">for</span> <span class="n">addr</span> <span class="ow">in</span> <span class="n">to</span><span class="p">]</span>
        <span class="n">cc_addresses</span> <span class="o">=</span> <span class="p">[</span><span class="n">EmailAddress</span><span class="p">(</span><span class="n">addr</span><span class="p">)</span> <span class="k">for</span> <span class="n">addr</span> <span class="ow">in</span> <span class="p">(</span><span class="n">cc</span> <span class="ow">or</span> <span class="p">[])]</span>
        <span class="n">bcc_addresses</span> <span class="o">=</span> <span class="p">[</span><span class="n">EmailAddress</span><span class="p">(</span><span class="n">addr</span><span class="p">)</span> <span class="k">for</span> <span class="n">addr</span> <span class="ow">in</span> <span class="p">(</span><span class="n">bcc</span> <span class="ow">or</span> <span class="p">[])]</span>

        <span class="c1"># Process attachments</span>
        <span class="n">email_attachments</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">attachments</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">file_path</span> <span class="ow">in</span> <span class="n">attachments</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">file_path</span><span class="p">):</span>
                    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                        <span class="n">content</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

                    <span class="n">email_attachments</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="n">EmailAttachment</span><span class="p">(</span>
                            <span class="n">filename</span><span class="o">=</span><span class="n">Path</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                            <span class="n">content_type</span><span class="o">=</span><span class="s2">&quot;application/octet-stream&quot;</span><span class="p">,</span>
                            <span class="n">size</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">content</span><span class="p">),</span>
                            <span class="n">content</span><span class="o">=</span><span class="n">content</span><span class="p">,</span>
                        <span class="p">)</span>
                    <span class="p">)</span>

        <span class="c1"># Create the draft message</span>
        <span class="n">draft_msg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_draft_message</span><span class="p">(</span>
            <span class="n">to</span><span class="p">,</span> <span class="n">subject</span><span class="p">,</span> <span class="n">body</span><span class="p">,</span> <span class="n">cc</span><span class="p">,</span> <span class="n">bcc</span><span class="p">,</span> <span class="n">attachments</span><span class="p">,</span> <span class="n">draft_id</span>
        <span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Select the drafts folder</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_imap_client</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">folder</span><span class="p">)</span>

            <span class="c1"># Append the draft message to the server</span>
            <span class="n">status</span><span class="p">,</span> <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_imap_client</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="n">folder</span><span class="p">,</span>
                <span class="s2">&quot;(</span><span class="se">\\</span><span class="s2">Draft)&quot;</span><span class="p">,</span>  <span class="c1"># Set the \Draft flag</span>
                <span class="kc">None</span><span class="p">,</span>  <span class="c1"># Use current date/time</span>
                <span class="n">draft_msg</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">),</span>
            <span class="p">)</span>

            <span class="k">if</span> <span class="n">status</span> <span class="o">!=</span> <span class="s2">&quot;OK&quot;</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to store draft on server: </span><span class="si">{</span><span class="n">response</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to create draft: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">EmailDraft</span><span class="p">(</span>
            <span class="n">draft_id</span><span class="o">=</span><span class="n">draft_id</span><span class="p">,</span>
            <span class="n">subject</span><span class="o">=</span><span class="n">subject</span><span class="p">,</span>
            <span class="n">recipients</span><span class="o">=</span><span class="n">to_addresses</span><span class="p">,</span>
            <span class="n">cc_recipients</span><span class="o">=</span><span class="n">cc_addresses</span><span class="p">,</span>
            <span class="n">bcc_recipients</span><span class="o">=</span><span class="n">bcc_addresses</span><span class="p">,</span>
            <span class="n">body_text</span><span class="o">=</span><span class="n">body</span><span class="p">,</span>
            <span class="n">attachments</span><span class="o">=</span><span class="n">email_attachments</span><span class="p">,</span>
            <span class="n">created_date</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(),</span>
            <span class="n">modified_date</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(),</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">send_message</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">draft_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">folder</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;Drafts&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Send a draft message by fetching from server and sending via SMTP.</span>
<span class="sd">        Args:</span>
<span class="sd">            draft_id: The ID of the draft message to send</span>
<span class="sd">            folder: The folder to search for the draft message</span>
<span class="sd">        Returns:</span>
<span class="sd">            True if the draft message was sent successfully, False otherwise</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_connected</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ConnectionError</span><span class="p">(</span><span class="s2">&quot;Not connected to email servers&quot;</span><span class="p">)</span>
        <span class="c1"># If draft_id starts with &quot;draft_&quot; and contains timestamp,</span>
        <span class="c1"># it&#39;s a local draft. In this case, we can&#39;t send it since</span>
        <span class="c1"># it wasn&#39;t stored on the server</span>
        <span class="k">if</span> <span class="n">draft_id</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;draft_&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="s2">&quot;.&quot;</span> <span class="ow">in</span> <span class="n">draft_id</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                <span class="s2">&quot;Cannot send local draft - draft must be stored on server first&quot;</span>
            <span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Select the drafts folder</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_imap_client</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">folder</span><span class="p">)</span>

            <span class="c1"># Search for the draft message</span>
            <span class="n">status</span><span class="p">,</span> <span class="n">messages</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_imap_client</span><span class="o">.</span><span class="n">search</span><span class="p">(</span>
                <span class="kc">None</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;HEADER Message-ID &quot;&lt;</span><span class="si">{</span><span class="n">draft_id</span><span class="si">}</span><span class="s1">@draft&gt;&quot;&#39;</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">status</span> <span class="o">!=</span> <span class="s2">&quot;OK&quot;</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">messages</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Draft with ID </span><span class="si">{</span><span class="n">draft_id</span><span class="si">}</span><span class="s2"> not found&quot;</span><span class="p">)</span>

            <span class="n">msg_ids</span> <span class="o">=</span> <span class="n">messages</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">msg_ids</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Draft with ID </span><span class="si">{</span><span class="n">draft_id</span><span class="si">}</span><span class="s2"> not found&quot;</span><span class="p">)</span>

            <span class="c1"># Fetch the draft message</span>
            <span class="n">status</span><span class="p">,</span> <span class="n">msg_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_imap_client</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="n">msg_ids</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;(RFC822)&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">status</span> <span class="o">!=</span> <span class="s2">&quot;OK&quot;</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Failed to fetch draft message&quot;</span><span class="p">)</span>

            <span class="c1"># Send the message via SMTP</span>
            <span class="n">raw_email</span> <span class="o">=</span> <span class="n">msg_data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_smtp_client</span><span class="o">.</span><span class="n">send_message</span><span class="p">(</span><span class="n">email</span><span class="o">.</span><span class="n">message_from_bytes</span><span class="p">(</span><span class="n">raw_email</span><span class="p">))</span>

            <span class="c1"># Optionally delete the draft after sending</span>
            <span class="c1"># self._imap_client.store(msg_ids[0], &quot;+FLAGS&quot;, &quot;\\Deleted&quot;)</span>

            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to send draft message: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">send_message_direct</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">to</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
        <span class="n">subject</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">body</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">cc</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">bcc</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">attachments</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Send a message directly via SMTP.</span>
<span class="sd">        Args:</span>
<span class="sd">            to: List of recipient email addresses</span>
<span class="sd">            subject: Email subject line</span>
<span class="sd">            body: Email body content (HTML or plain text)</span>
<span class="sd">            cc: Optional list of CC recipient email addresses</span>
<span class="sd">            bcc: Optional list of BCC recipient email addresses</span>
<span class="sd">            attachments: Optional list of attachment file paths</span>
<span class="sd">        Returns:</span>
<span class="sd">            True if the message was sent successfully, False otherwise</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_connected</span> <span class="ow">or</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_smtp_client</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ConnectionError</span><span class="p">(</span><span class="s2">&quot;Not connected to SMTP server&quot;</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Create message</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="n">MIMEMultipart</span><span class="p">()</span>
            <span class="n">msg</span><span class="p">[</span><span class="s2">&quot;From&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">credentials</span><span class="o">.</span><span class="n">username</span>
            <span class="n">msg</span><span class="p">[</span><span class="s2">&quot;To&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">to</span><span class="p">)</span>
            <span class="n">msg</span><span class="p">[</span><span class="s2">&quot;Subject&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">subject</span>

            <span class="k">if</span> <span class="n">cc</span><span class="p">:</span>
                <span class="n">msg</span><span class="p">[</span><span class="s2">&quot;Cc&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">cc</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">bcc</span><span class="p">:</span>
                <span class="n">msg</span><span class="p">[</span><span class="s2">&quot;Bcc&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">bcc</span><span class="p">)</span>

            <span class="c1"># Add body</span>
            <span class="n">msg</span><span class="o">.</span><span class="n">attach</span><span class="p">(</span><span class="n">MIMEText</span><span class="p">(</span><span class="n">body</span><span class="p">,</span> <span class="s2">&quot;plain&quot;</span><span class="p">))</span>

            <span class="c1"># Add attachments</span>
            <span class="k">if</span> <span class="n">attachments</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">file_path</span> <span class="ow">in</span> <span class="n">attachments</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">file_path</span><span class="p">):</span>
                        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">attachment</span><span class="p">:</span>
                            <span class="n">part</span> <span class="o">=</span> <span class="n">MIMEApplication</span><span class="p">(</span>
                                <span class="n">attachment</span><span class="o">.</span><span class="n">read</span><span class="p">(),</span> <span class="n">Name</span><span class="o">=</span><span class="n">Path</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span><span class="o">.</span><span class="n">name</span>
                            <span class="p">)</span>
                            <span class="n">part</span><span class="p">[</span><span class="s2">&quot;Content-Disposition&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                                <span class="sa">f</span><span class="s1">&#39;attachment; filename=&quot;</span><span class="si">{</span><span class="n">Path</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1">&quot;&#39;</span>
                            <span class="p">)</span>
                            <span class="n">msg</span><span class="o">.</span><span class="n">attach</span><span class="p">(</span><span class="n">part</span><span class="p">)</span>

            <span class="c1"># Send message</span>
            <span class="n">all_recipients</span> <span class="o">=</span> <span class="n">to</span> <span class="o">+</span> <span class="p">(</span><span class="n">cc</span> <span class="ow">or</span> <span class="p">[])</span> <span class="o">+</span> <span class="p">(</span><span class="n">bcc</span> <span class="ow">or</span> <span class="p">[])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_smtp_client</span><span class="o">.</span><span class="n">send_message</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">to_addrs</span><span class="o">=</span><span class="n">all_recipients</span><span class="p">)</span>

            <span class="k">return</span> <span class="kc">True</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to send message: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">mark_as_read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Mark a message as read.</span>
<span class="sd">        Args:</span>
<span class="sd">            message_id: The ID of the message to mark as read</span>
<span class="sd">        Returns:</span>
<span class="sd">            True if the message was marked as read successfully, False otherwise</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_connected</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ConnectionError</span><span class="p">(</span><span class="s2">&quot;Not connected to IMAP server&quot;</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Search for the message</span>
            <span class="n">status</span><span class="p">,</span> <span class="n">messages</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_imap_client</span><span class="o">.</span><span class="n">search</span><span class="p">(</span>
                <span class="kc">None</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;HEADER Message-ID &quot;</span><span class="si">{</span><span class="n">message_id</span><span class="si">}</span><span class="s1">&quot;&#39;</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">status</span> <span class="o">!=</span> <span class="s2">&quot;OK&quot;</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">messages</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                <span class="k">return</span> <span class="kc">False</span>

            <span class="n">msg_ids</span> <span class="o">=</span> <span class="n">messages</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">msg_ids</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>

            <span class="c1"># Mark as read</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_imap_client</span><span class="o">.</span><span class="n">store</span><span class="p">(</span><span class="n">msg_ids</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;+FLAGS&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">Seen&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">True</span>

        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_folders</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get list of available folders.</span>
<span class="sd">        Returns:</span>
<span class="sd">            List of available folders</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_connected</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ConnectionError</span><span class="p">(</span><span class="s2">&quot;Not connected to IMAP server&quot;</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">status</span><span class="p">,</span> <span class="n">folders</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_imap_client</span><span class="o">.</span><span class="n">list</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">status</span> <span class="o">!=</span> <span class="s2">&quot;OK&quot;</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">[]</span>

            <span class="n">folder_list</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">folder</span> <span class="ow">in</span> <span class="n">folders</span><span class="p">:</span>
                <span class="n">folder_str</span> <span class="o">=</span> <span class="n">folder</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>
                <span class="c1"># Extract folder name from IMAP response</span>
                <span class="n">folder_name</span> <span class="o">=</span> <span class="n">folder_str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &quot;/&quot; &#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">)</span>
                <span class="n">folder_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">folder_name</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">folder_list</span>

        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[]</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">is_connected</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if connected to email servers.</span>
<span class="sd">        Returns:</span>
<span class="sd">            True if connected to email servers, False otherwise</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_connected</span>
            <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_imap_client</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
            <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_smtp_client</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h5 id="ragora.utils.email_utils.imap_provider.IMAPProvider.is_connected" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">is_connected</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#ragora.utils.email_utils.imap_provider.IMAPProvider.is_connected" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Check if connected to email servers.
Returns:
    True if connected to email servers, False otherwise</p>

    </div>

</div>




<div class="doc doc-object doc-function">


<h5 id="ragora.utils.email_utils.imap_provider.IMAPProvider._create_draft_message" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">_create_draft_message</span><span class="p">(</span><span class="n">to</span><span class="p">,</span> <span class="n">subject</span><span class="p">,</span> <span class="n">body</span><span class="p">,</span> <span class="n">cc</span><span class="p">,</span> <span class="n">bcc</span><span class="p">,</span> <span class="n">attachments</span><span class="p">,</span> <span class="n">draft_id</span><span class="p">)</span></code>

<a href="#ragora.utils.email_utils.imap_provider.IMAPProvider._create_draft_message" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Create a properly formatted draft message for IMAP APPEND.
Args:
    to: List of recipient email addresses
    subject: Email subject line
    body: Email body content (HTML or plain text)
    cc: Optional list of CC recipient email addresses
    bcc: Optional list of BCC recipient email addresses
    attachments: Optional list of attachment file paths
Returns:
    String representation of the draft message</p>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/utils/email_utils/imap_provider.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">_create_draft_message</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">to</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
    <span class="n">subject</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">body</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">cc</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span>
    <span class="n">bcc</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span>
    <span class="n">attachments</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span>
    <span class="n">draft_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create a properly formatted draft message for IMAP APPEND.</span>
<span class="sd">    Args:</span>
<span class="sd">        to: List of recipient email addresses</span>
<span class="sd">        subject: Email subject line</span>
<span class="sd">        body: Email body content (HTML or plain text)</span>
<span class="sd">        cc: Optional list of CC recipient email addresses</span>
<span class="sd">        bcc: Optional list of BCC recipient email addresses</span>
<span class="sd">        attachments: Optional list of attachment file paths</span>
<span class="sd">    Returns:</span>
<span class="sd">        String representation of the draft message</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Create the message structure</span>
    <span class="n">msg</span> <span class="o">=</span> <span class="n">MIMEMultipart</span><span class="p">()</span>

    <span class="c1"># Set headers</span>
    <span class="n">msg</span><span class="p">[</span><span class="s2">&quot;From&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">credentials</span><span class="o">.</span><span class="n">username</span>
    <span class="n">msg</span><span class="p">[</span><span class="s2">&quot;To&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">to</span><span class="p">)</span>
    <span class="n">msg</span><span class="p">[</span><span class="s2">&quot;Subject&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">subject</span>
    <span class="n">msg</span><span class="p">[</span><span class="s2">&quot;Message-ID&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&lt;</span><span class="si">{</span><span class="n">draft_id</span><span class="si">}</span><span class="s2">@draft&gt;&quot;</span>
    <span class="n">msg</span><span class="p">[</span><span class="s2">&quot;Date&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">email</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">formatdate</span><span class="p">(</span><span class="n">localtime</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">cc</span><span class="p">:</span>
        <span class="n">msg</span><span class="p">[</span><span class="s2">&quot;Cc&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">cc</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">bcc</span><span class="p">:</span>
        <span class="n">msg</span><span class="p">[</span><span class="s2">&quot;Bcc&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">bcc</span><span class="p">)</span>

    <span class="c1"># Add body</span>
    <span class="n">msg</span><span class="o">.</span><span class="n">attach</span><span class="p">(</span><span class="n">MIMEText</span><span class="p">(</span><span class="n">body</span><span class="p">,</span> <span class="s2">&quot;plain&quot;</span><span class="p">))</span>

    <span class="c1"># Add attachments</span>
    <span class="k">if</span> <span class="n">attachments</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">file_path</span> <span class="ow">in</span> <span class="n">attachments</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">file_path</span><span class="p">):</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">attachment</span><span class="p">:</span>
                    <span class="n">part</span> <span class="o">=</span> <span class="n">MIMEApplication</span><span class="p">(</span>
                        <span class="n">attachment</span><span class="o">.</span><span class="n">read</span><span class="p">(),</span> <span class="n">Name</span><span class="o">=</span><span class="n">Path</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span><span class="o">.</span><span class="n">name</span>
                    <span class="p">)</span>
                    <span class="n">part</span><span class="p">[</span><span class="s2">&quot;Content-Disposition&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="sa">f</span><span class="s1">&#39;attachment; filename=&quot;</span><span class="si">{</span><span class="n">Path</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1">&quot;&#39;</span>
                    <span class="p">)</span>
                    <span class="n">msg</span><span class="o">.</span><span class="n">attach</span><span class="p">(</span><span class="n">part</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">msg</span><span class="o">.</span><span class="n">as_string</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="ragora.utils.email_utils.imap_provider.IMAPProvider._create_local_draft" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">_create_local_draft</span><span class="p">(</span><span class="n">to</span><span class="p">,</span> <span class="n">subject</span><span class="p">,</span> <span class="n">body</span><span class="p">,</span> <span class="n">cc</span><span class="p">,</span> <span class="n">bcc</span><span class="p">,</span> <span class="n">attachments</span><span class="p">)</span></code>

<a href="#ragora.utils.email_utils.imap_provider.IMAPProvider._create_local_draft" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Create a local draft without storing on server.
Args:
    to: List of recipient email addresses
    subject: Email subject line
    body: Email body content (HTML or plain text)
    cc: Optional list of CC recipient email addresses
    bcc: Optional list of BCC recipient email addresses
    attachments: Optional list of attachment file paths
Returns:
    EmailDraft object</p>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/utils/email_utils/imap_provider.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">_create_local_draft</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">to</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
    <span class="n">subject</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">body</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">cc</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span>
    <span class="n">bcc</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span>
    <span class="n">attachments</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">EmailDraft</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create a local draft without storing on server.</span>
<span class="sd">    Args:</span>
<span class="sd">        to: List of recipient email addresses</span>
<span class="sd">        subject: Email subject line</span>
<span class="sd">        body: Email body content (HTML or plain text)</span>
<span class="sd">        cc: Optional list of CC recipient email addresses</span>
<span class="sd">        bcc: Optional list of BCC recipient email addresses</span>
<span class="sd">        attachments: Optional list of attachment file paths</span>
<span class="sd">    Returns:</span>
<span class="sd">        EmailDraft object</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">draft_id</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;draft_</span><span class="si">{</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">timestamp</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="c1"># Parse recipients</span>
    <span class="n">to_addresses</span> <span class="o">=</span> <span class="p">[</span><span class="n">EmailAddress</span><span class="p">(</span><span class="n">addr</span><span class="p">)</span> <span class="k">for</span> <span class="n">addr</span> <span class="ow">in</span> <span class="n">to</span><span class="p">]</span>
    <span class="n">cc_addresses</span> <span class="o">=</span> <span class="p">[</span><span class="n">EmailAddress</span><span class="p">(</span><span class="n">addr</span><span class="p">)</span> <span class="k">for</span> <span class="n">addr</span> <span class="ow">in</span> <span class="p">(</span><span class="n">cc</span> <span class="ow">or</span> <span class="p">[])]</span>
    <span class="n">bcc_addresses</span> <span class="o">=</span> <span class="p">[</span><span class="n">EmailAddress</span><span class="p">(</span><span class="n">addr</span><span class="p">)</span> <span class="k">for</span> <span class="n">addr</span> <span class="ow">in</span> <span class="p">(</span><span class="n">bcc</span> <span class="ow">or</span> <span class="p">[])]</span>

    <span class="c1"># Process attachments</span>
    <span class="n">email_attachments</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="n">attachments</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">file_path</span> <span class="ow">in</span> <span class="n">attachments</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">file_path</span><span class="p">):</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                    <span class="n">content</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

                <span class="n">email_attachments</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="n">EmailAttachment</span><span class="p">(</span>
                        <span class="n">filename</span><span class="o">=</span><span class="n">Path</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                        <span class="n">content_type</span><span class="o">=</span><span class="s2">&quot;application/octet-stream&quot;</span><span class="p">,</span>
                        <span class="n">size</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">content</span><span class="p">),</span>
                        <span class="n">content</span><span class="o">=</span><span class="n">content</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="p">)</span>

    <span class="k">return</span> <span class="n">EmailDraft</span><span class="p">(</span>
        <span class="n">draft_id</span><span class="o">=</span><span class="n">draft_id</span><span class="p">,</span>
        <span class="n">subject</span><span class="o">=</span><span class="n">subject</span><span class="p">,</span>
        <span class="n">recipients</span><span class="o">=</span><span class="n">to_addresses</span><span class="p">,</span>
        <span class="n">cc_recipients</span><span class="o">=</span><span class="n">cc_addresses</span><span class="p">,</span>
        <span class="n">bcc_recipients</span><span class="o">=</span><span class="n">bcc_addresses</span><span class="p">,</span>
        <span class="n">body_text</span><span class="o">=</span><span class="n">body</span><span class="p">,</span>
        <span class="n">attachments</span><span class="o">=</span><span class="n">email_attachments</span><span class="p">,</span>
        <span class="n">created_date</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(),</span>
        <span class="n">modified_date</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(),</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="ragora.utils.email_utils.imap_provider.IMAPProvider._decode_header" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">_decode_header</span><span class="p">(</span><span class="n">header</span><span class="p">)</span></code>

<a href="#ragora.utils.email_utils.imap_provider.IMAPProvider._decode_header" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Decode email header.
Args:
    header: The email header to decode
Returns:
    Decoded email header</p>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/utils/email_utils/imap_provider.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">_decode_header</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">header</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Decode email header.</span>
<span class="sd">    Args:</span>
<span class="sd">        header: The email header to decode</span>
<span class="sd">    Returns:</span>
<span class="sd">        Decoded email header</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">header</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;&quot;</span>

    <span class="n">decoded_parts</span> <span class="o">=</span> <span class="n">decode_header</span><span class="p">(</span><span class="n">header</span><span class="p">)</span>
    <span class="n">decoded_string</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

    <span class="k">for</span> <span class="n">part</span><span class="p">,</span> <span class="n">encoding</span> <span class="ow">in</span> <span class="n">decoded_parts</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">part</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">encoding</span><span class="p">:</span>
                <span class="n">decoded_string</span> <span class="o">+=</span> <span class="n">part</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">encoding</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">decoded_string</span> <span class="o">+=</span> <span class="n">part</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">decoded_string</span> <span class="o">+=</span> <span class="n">part</span>

    <span class="k">return</span> <span class="n">decoded_string</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="ragora.utils.email_utils.imap_provider.IMAPProvider._extract_attachments" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">_extract_attachments</span><span class="p">(</span><span class="n">email_msg</span><span class="p">)</span></code>

<a href="#ragora.utils.email_utils.imap_provider.IMAPProvider._extract_attachments" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Extract attachments from email message.</p>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/utils/email_utils/imap_provider.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">_extract_attachments</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">email_msg</span><span class="p">:</span> <span class="n">email</span><span class="o">.</span><span class="n">message</span><span class="o">.</span><span class="n">Message</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">EmailAttachment</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Extract attachments from email message.&quot;&quot;&quot;</span>
    <span class="n">attachments</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">if</span> <span class="n">email_msg</span><span class="o">.</span><span class="n">is_multipart</span><span class="p">():</span>
        <span class="k">for</span> <span class="n">part</span> <span class="ow">in</span> <span class="n">email_msg</span><span class="o">.</span><span class="n">walk</span><span class="p">():</span>
            <span class="n">content_disposition</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">part</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Content-Disposition&quot;</span><span class="p">))</span>

            <span class="k">if</span> <span class="s2">&quot;attachment&quot;</span> <span class="ow">in</span> <span class="n">content_disposition</span><span class="p">:</span>
                <span class="n">filename</span> <span class="o">=</span> <span class="n">part</span><span class="o">.</span><span class="n">get_filename</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">filename</span><span class="p">:</span>
                    <span class="n">filename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_decode_header</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>

                    <span class="n">content_type</span> <span class="o">=</span> <span class="n">part</span><span class="o">.</span><span class="n">get_content_type</span><span class="p">()</span>
                    <span class="n">content</span> <span class="o">=</span> <span class="n">part</span><span class="o">.</span><span class="n">get_payload</span><span class="p">(</span><span class="n">decode</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

                    <span class="n">attachments</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="n">EmailAttachment</span><span class="p">(</span>
                            <span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">,</span>
                            <span class="n">content_type</span><span class="o">=</span><span class="n">content_type</span><span class="p">,</span>
                            <span class="n">size</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">content</span><span class="p">)</span> <span class="k">if</span> <span class="n">content</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span>
                            <span class="n">content</span><span class="o">=</span><span class="n">content</span><span class="p">,</span>
                            <span class="n">content_id</span><span class="o">=</span><span class="n">part</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Content-ID&quot;</span><span class="p">),</span>
                        <span class="p">)</span>
                    <span class="p">)</span>

    <span class="k">return</span> <span class="n">attachments</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="ragora.utils.email_utils.imap_provider.IMAPProvider._extract_body" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">_extract_body</span><span class="p">(</span><span class="n">email_msg</span><span class="p">)</span></code>

<a href="#ragora.utils.email_utils.imap_provider.IMAPProvider._extract_body" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Extract text and HTML body from email message.
Args:
    email_msg: The email.message.Message object to extract the body from
Returns:
    Tuple of text and HTML body</p>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/utils/email_utils/imap_provider.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">_extract_body</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">email_msg</span><span class="p">:</span> <span class="n">email</span><span class="o">.</span><span class="n">message</span><span class="o">.</span><span class="n">Message</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Extract text and HTML body from email message.</span>
<span class="sd">    Args:</span>
<span class="sd">        email_msg: The email.message.Message object to extract the body from</span>
<span class="sd">    Returns:</span>
<span class="sd">        Tuple of text and HTML body</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">body_text</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">body_html</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">if</span> <span class="n">email_msg</span><span class="o">.</span><span class="n">is_multipart</span><span class="p">():</span>
        <span class="k">for</span> <span class="n">part</span> <span class="ow">in</span> <span class="n">email_msg</span><span class="o">.</span><span class="n">walk</span><span class="p">():</span>
            <span class="n">content_type</span> <span class="o">=</span> <span class="n">part</span><span class="o">.</span><span class="n">get_content_type</span><span class="p">()</span>
            <span class="n">content_disposition</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">part</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Content-Disposition&quot;</span><span class="p">))</span>

            <span class="c1"># Skip attachments</span>
            <span class="k">if</span> <span class="s2">&quot;attachment&quot;</span> <span class="ow">in</span> <span class="n">content_disposition</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="k">if</span> <span class="n">content_type</span> <span class="o">==</span> <span class="s2">&quot;text/plain&quot;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">body_text</span><span class="p">:</span>
                <span class="n">body_text</span> <span class="o">=</span> <span class="n">part</span><span class="o">.</span><span class="n">get_payload</span><span class="p">(</span><span class="n">decode</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span>
                    <span class="s2">&quot;utf-8&quot;</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s2">&quot;ignore&quot;</span>
                <span class="p">)</span>
            <span class="k">elif</span> <span class="n">content_type</span> <span class="o">==</span> <span class="s2">&quot;text/html&quot;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">body_html</span><span class="p">:</span>
                <span class="n">body_html</span> <span class="o">=</span> <span class="n">part</span><span class="o">.</span><span class="n">get_payload</span><span class="p">(</span><span class="n">decode</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span>
                    <span class="s2">&quot;utf-8&quot;</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s2">&quot;ignore&quot;</span>
                <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">content_type</span> <span class="o">=</span> <span class="n">email_msg</span><span class="o">.</span><span class="n">get_content_type</span><span class="p">()</span>
        <span class="n">payload</span> <span class="o">=</span> <span class="n">email_msg</span><span class="o">.</span><span class="n">get_payload</span><span class="p">(</span><span class="n">decode</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">payload</span><span class="p">:</span>
            <span class="n">decoded_payload</span> <span class="o">=</span> <span class="n">payload</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">content_type</span> <span class="o">==</span> <span class="s2">&quot;text/plain&quot;</span><span class="p">:</span>
                <span class="n">body_text</span> <span class="o">=</span> <span class="n">decoded_payload</span>
            <span class="k">elif</span> <span class="n">content_type</span> <span class="o">==</span> <span class="s2">&quot;text/html&quot;</span><span class="p">:</span>
                <span class="n">body_html</span> <span class="o">=</span> <span class="n">decoded_payload</span>

    <span class="k">return</span> <span class="n">body_text</span><span class="p">,</span> <span class="n">body_html</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="ragora.utils.email_utils.imap_provider.IMAPProvider._fetch_single_message" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">_fetch_single_message</span><span class="p">(</span><span class="n">msg_id</span><span class="p">)</span></code>

<a href="#ragora.utils.email_utils.imap_provider.IMAPProvider._fetch_single_message" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Fetch and parse a single message.
Args:
    msg_id: The ID of the message to fetch
Returns:
    EmailMessage object if the message was found, None otherwise</p>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/utils/email_utils/imap_provider.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">_fetch_single_message</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg_id</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">EmailMessage</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Fetch and parse a single message.</span>
<span class="sd">    Args:</span>
<span class="sd">        msg_id: The ID of the message to fetch</span>
<span class="sd">    Returns:</span>
<span class="sd">        EmailMessage object if the message was found, None otherwise</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">status</span><span class="p">,</span> <span class="n">msg_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_imap_client</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="n">msg_id</span><span class="p">,</span> <span class="s2">&quot;(RFC822)&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">status</span> <span class="o">!=</span> <span class="s2">&quot;OK&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="n">raw_email</span> <span class="o">=</span> <span class="n">msg_data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">email_message</span> <span class="o">=</span> <span class="n">email</span><span class="o">.</span><span class="n">message_from_bytes</span><span class="p">(</span><span class="n">raw_email</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_email_message</span><span class="p">(</span><span class="n">email_message</span><span class="p">,</span> <span class="n">msg_id</span><span class="o">.</span><span class="n">decode</span><span class="p">())</span>

    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="ragora.utils.email_utils.imap_provider.IMAPProvider._parse_address" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">_parse_address</span><span class="p">(</span><span class="n">address_str</span><span class="p">)</span></code>

<a href="#ragora.utils.email_utils.imap_provider.IMAPProvider._parse_address" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Parse a single email address.
Args:
    address_str: The email address to parse
Returns:
    EmailAddress object</p>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/utils/email_utils/imap_provider.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">_parse_address</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">address_str</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">EmailAddress</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Parse a single email address.</span>
<span class="sd">    Args:</span>
<span class="sd">        address_str: The email address to parse</span>
<span class="sd">    Returns:</span>
<span class="sd">        EmailAddress object</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">address_str</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">EmailAddress</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

    <span class="n">decoded</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_decode_header</span><span class="p">(</span><span class="n">address_str</span><span class="p">)</span>

    <span class="c1"># Simple parsing - could be improved with proper email parsing library</span>
    <span class="k">if</span> <span class="s2">&quot;&lt;&quot;</span> <span class="ow">in</span> <span class="n">decoded</span> <span class="ow">and</span> <span class="s2">&quot;&gt;&quot;</span> <span class="ow">in</span> <span class="n">decoded</span><span class="p">:</span>
        <span class="n">name_part</span> <span class="o">=</span> <span class="n">decoded</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;&lt;&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="n">email_part</span> <span class="o">=</span> <span class="n">decoded</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;&lt;&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;&gt;&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">EmailAddress</span><span class="p">(</span><span class="n">email_part</span><span class="p">,</span> <span class="n">name_part</span> <span class="k">if</span> <span class="n">name_part</span> <span class="k">else</span> <span class="kc">None</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">EmailAddress</span><span class="p">(</span><span class="n">decoded</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="ragora.utils.email_utils.imap_provider.IMAPProvider._parse_address_list" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">_parse_address_list</span><span class="p">(</span><span class="n">address_list</span><span class="p">)</span></code>

<a href="#ragora.utils.email_utils.imap_provider.IMAPProvider._parse_address_list" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Parse a list of email addresses.
Args:
    address_list: The list of email addresses to parse
Returns:
    List of EmailAddress objects</p>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/utils/email_utils/imap_provider.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">_parse_address_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">address_list</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">EmailAddress</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Parse a list of email addresses.</span>
<span class="sd">    Args:</span>
<span class="sd">        address_list: The list of email addresses to parse</span>
<span class="sd">    Returns:</span>
<span class="sd">        List of EmailAddress objects</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">address_list</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[]</span>

    <span class="n">addresses</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">addr</span> <span class="ow">in</span> <span class="n">address_list</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">):</span>
        <span class="n">addr</span> <span class="o">=</span> <span class="n">addr</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">addr</span><span class="p">:</span>
            <span class="n">addresses</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_parse_address</span><span class="p">(</span><span class="n">addr</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">addresses</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="ragora.utils.email_utils.imap_provider.IMAPProvider._parse_date" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">_parse_date</span><span class="p">(</span><span class="n">date_str</span><span class="p">)</span></code>

<a href="#ragora.utils.email_utils.imap_provider.IMAPProvider._parse_date" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Parse email date string.
Args:
    date_str: The email date string to parse
Returns:
    datetime object if the date was parsed successfully, None otherwise</p>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/utils/email_utils/imap_provider.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">_parse_date</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">date_str</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">datetime</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Parse email date string.</span>
<span class="sd">    Args:</span>
<span class="sd">        date_str: The email date string to parse</span>
<span class="sd">    Returns:</span>
<span class="sd">        datetime object if the date was parsed successfully, None otherwise</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">date_str</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Try parsing with email.utils.parsedate_to_datetime</span>
        <span class="k">return</span> <span class="n">email</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">parsedate_to_datetime</span><span class="p">(</span><span class="n">date_str</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="ragora.utils.email_utils.imap_provider.IMAPProvider._parse_email_message" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">_parse_email_message</span><span class="p">(</span><span class="n">email_msg</span><span class="p">,</span> <span class="n">msg_id</span><span class="p">)</span></code>

<a href="#ragora.utils.email_utils.imap_provider.IMAPProvider._parse_email_message" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Parse email.message.Message into EmailMessage object.
Args:
    email_msg: The email.message.Message object to parse
    msg_id: The ID of the message
Returns:
    EmailMessage object</p>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/utils/email_utils/imap_provider.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">_parse_email_message</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">email_msg</span><span class="p">:</span> <span class="n">email</span><span class="o">.</span><span class="n">message</span><span class="o">.</span><span class="n">Message</span><span class="p">,</span> <span class="n">msg_id</span><span class="p">:</span> <span class="nb">str</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">EmailMessage</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Parse email.message.Message into EmailMessage object.</span>
<span class="sd">    Args:</span>
<span class="sd">        email_msg: The email.message.Message object to parse</span>
<span class="sd">        msg_id: The ID of the message</span>
<span class="sd">    Returns:</span>
<span class="sd">        EmailMessage object</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Extract headers</span>
    <span class="n">subject</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_decode_header</span><span class="p">(</span><span class="n">email_msg</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Subject&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
    <span class="n">sender</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_address</span><span class="p">(</span><span class="n">email_msg</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;From&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>

    <span class="c1"># Parse recipients</span>
    <span class="n">to_addresses</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_address_list</span><span class="p">(</span><span class="n">email_msg</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;To&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
    <span class="n">cc_addresses</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_address_list</span><span class="p">(</span><span class="n">email_msg</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Cc&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
    <span class="n">bcc_addresses</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_address_list</span><span class="p">(</span><span class="n">email_msg</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Bcc&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>

    <span class="c1"># Parse dates</span>
    <span class="n">date_sent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_date</span><span class="p">(</span><span class="n">email_msg</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Date&quot;</span><span class="p">))</span>

    <span class="c1"># Extract body</span>
    <span class="n">body_text</span><span class="p">,</span> <span class="n">body_html</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_body</span><span class="p">(</span><span class="n">email_msg</span><span class="p">)</span>

    <span class="c1"># Extract attachments</span>
    <span class="n">attachments</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_attachments</span><span class="p">(</span><span class="n">email_msg</span><span class="p">)</span>

    <span class="c1"># Determine status</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">MessageStatus</span><span class="o">.</span><span class="n">READ</span> <span class="k">if</span> <span class="n">email_msg</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;X-Seen&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="n">MessageStatus</span><span class="o">.</span><span class="n">UNREAD</span>

    <span class="k">return</span> <span class="n">EmailMessage</span><span class="p">(</span>
        <span class="n">message_id</span><span class="o">=</span><span class="n">email_msg</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Message-ID&quot;</span><span class="p">,</span> <span class="n">msg_id</span><span class="p">),</span>
        <span class="n">subject</span><span class="o">=</span><span class="n">subject</span><span class="p">,</span>
        <span class="n">sender</span><span class="o">=</span><span class="n">sender</span><span class="p">,</span>
        <span class="n">recipients</span><span class="o">=</span><span class="n">to_addresses</span><span class="p">,</span>
        <span class="n">cc_recipients</span><span class="o">=</span><span class="n">cc_addresses</span><span class="p">,</span>
        <span class="n">bcc_recipients</span><span class="o">=</span><span class="n">bcc_addresses</span><span class="p">,</span>
        <span class="n">body_text</span><span class="o">=</span><span class="n">body_text</span><span class="p">,</span>
        <span class="n">body_html</span><span class="o">=</span><span class="n">body_html</span><span class="p">,</span>
        <span class="n">date_sent</span><span class="o">=</span><span class="n">date_sent</span><span class="p">,</span>
        <span class="n">date_received</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(),</span>
        <span class="n">status</span><span class="o">=</span><span class="n">status</span><span class="p">,</span>
        <span class="n">attachments</span><span class="o">=</span><span class="n">attachments</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="ragora.utils.email_utils.imap_provider.IMAPProvider.connect" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">connect</span><span class="p">()</span></code>

<a href="#ragora.utils.email_utils.imap_provider.IMAPProvider.connect" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Establish connection to IMAP and SMTP servers.</p>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/utils/email_utils/imap_provider.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">connect</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Establish connection to IMAP and SMTP servers.&quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Connect to IMAP server</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">credentials</span><span class="o">.</span><span class="n">use_ssl</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_imap_client</span> <span class="o">=</span> <span class="n">imaplib</span><span class="o">.</span><span class="n">IMAP4_SSL</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">credentials</span><span class="o">.</span><span class="n">imap_server</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">credentials</span><span class="o">.</span><span class="n">imap_port</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_imap_client</span> <span class="o">=</span> <span class="n">imaplib</span><span class="o">.</span><span class="n">IMAP4</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">credentials</span><span class="o">.</span><span class="n">imap_server</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">credentials</span><span class="o">.</span><span class="n">imap_port</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">credentials</span><span class="o">.</span><span class="n">use_tls</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_imap_client</span><span class="o">.</span><span class="n">starttls</span><span class="p">()</span>

        <span class="c1"># Login to IMAP</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_imap_client</span><span class="o">.</span><span class="n">login</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">credentials</span><span class="o">.</span><span class="n">username</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">credentials</span><span class="o">.</span><span class="n">password</span>
        <span class="p">)</span>

        <span class="c1"># Connect to SMTP server</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">credentials</span><span class="o">.</span><span class="n">use_ssl</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_smtp_client</span> <span class="o">=</span> <span class="n">smtplib</span><span class="o">.</span><span class="n">SMTP_SSL</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">credentials</span><span class="o">.</span><span class="n">smtp_server</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">credentials</span><span class="o">.</span><span class="n">smtp_port</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_smtp_client</span> <span class="o">=</span> <span class="n">smtplib</span><span class="o">.</span><span class="n">SMTP</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">credentials</span><span class="o">.</span><span class="n">smtp_server</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">credentials</span><span class="o">.</span><span class="n">smtp_port</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">credentials</span><span class="o">.</span><span class="n">use_tls</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_smtp_client</span><span class="o">.</span><span class="n">starttls</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_smtp_client</span><span class="o">.</span><span class="n">login</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">credentials</span><span class="o">.</span><span class="n">username</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">credentials</span><span class="o">.</span><span class="n">password</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_connected</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_connected</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">raise</span> <span class="ne">ConnectionError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to connect to email servers: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="ragora.utils.email_utils.imap_provider.IMAPProvider.create_draft" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">create_draft</span><span class="p">(</span><span class="n">to</span><span class="p">,</span> <span class="n">subject</span><span class="p">,</span> <span class="n">body</span><span class="p">,</span> <span class="n">cc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">bcc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">attachments</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">folder</span><span class="o">=</span><span class="s1">&#39;Drafts&#39;</span><span class="p">)</span></code>

<a href="#ragora.utils.email_utils.imap_provider.IMAPProvider.create_draft" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Create and store a draft message on the server using IMAP APPEND.
Args:
    to: List of recipient email addresses
    subject: Email subject line
    body: Email body content (HTML or plain text)
    cc: Optional list of CC recipient email addresses
    bcc: Optional list of BCC recipient email addresses
    attachments: Optional list of attachment file paths
Returns:
    EmailDraft object</p>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/utils/email_utils/imap_provider.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">create_draft</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">to</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
    <span class="n">subject</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">body</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">cc</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">bcc</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">attachments</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">folder</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;Drafts&quot;</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">EmailDraft</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create and store a draft message on the server using IMAP APPEND.</span>
<span class="sd">    Args:</span>
<span class="sd">        to: List of recipient email addresses</span>
<span class="sd">        subject: Email subject line</span>
<span class="sd">        body: Email body content (HTML or plain text)</span>
<span class="sd">        cc: Optional list of CC recipient email addresses</span>
<span class="sd">        bcc: Optional list of BCC recipient email addresses</span>
<span class="sd">        attachments: Optional list of attachment file paths</span>
<span class="sd">    Returns:</span>
<span class="sd">        EmailDraft object</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># If not connected, create a local draft only</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_connected</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_local_draft</span><span class="p">(</span><span class="n">to</span><span class="p">,</span> <span class="n">subject</span><span class="p">,</span> <span class="n">body</span><span class="p">,</span> <span class="n">cc</span><span class="p">,</span> <span class="n">bcc</span><span class="p">,</span> <span class="n">attachments</span><span class="p">)</span>

    <span class="n">draft_id</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;draft_</span><span class="si">{</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">timestamp</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="c1"># Parse recipients</span>
    <span class="n">to_addresses</span> <span class="o">=</span> <span class="p">[</span><span class="n">EmailAddress</span><span class="p">(</span><span class="n">addr</span><span class="p">)</span> <span class="k">for</span> <span class="n">addr</span> <span class="ow">in</span> <span class="n">to</span><span class="p">]</span>
    <span class="n">cc_addresses</span> <span class="o">=</span> <span class="p">[</span><span class="n">EmailAddress</span><span class="p">(</span><span class="n">addr</span><span class="p">)</span> <span class="k">for</span> <span class="n">addr</span> <span class="ow">in</span> <span class="p">(</span><span class="n">cc</span> <span class="ow">or</span> <span class="p">[])]</span>
    <span class="n">bcc_addresses</span> <span class="o">=</span> <span class="p">[</span><span class="n">EmailAddress</span><span class="p">(</span><span class="n">addr</span><span class="p">)</span> <span class="k">for</span> <span class="n">addr</span> <span class="ow">in</span> <span class="p">(</span><span class="n">bcc</span> <span class="ow">or</span> <span class="p">[])]</span>

    <span class="c1"># Process attachments</span>
    <span class="n">email_attachments</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="n">attachments</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">file_path</span> <span class="ow">in</span> <span class="n">attachments</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">file_path</span><span class="p">):</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                    <span class="n">content</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

                <span class="n">email_attachments</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="n">EmailAttachment</span><span class="p">(</span>
                        <span class="n">filename</span><span class="o">=</span><span class="n">Path</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                        <span class="n">content_type</span><span class="o">=</span><span class="s2">&quot;application/octet-stream&quot;</span><span class="p">,</span>
                        <span class="n">size</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">content</span><span class="p">),</span>
                        <span class="n">content</span><span class="o">=</span><span class="n">content</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="p">)</span>

    <span class="c1"># Create the draft message</span>
    <span class="n">draft_msg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_draft_message</span><span class="p">(</span>
        <span class="n">to</span><span class="p">,</span> <span class="n">subject</span><span class="p">,</span> <span class="n">body</span><span class="p">,</span> <span class="n">cc</span><span class="p">,</span> <span class="n">bcc</span><span class="p">,</span> <span class="n">attachments</span><span class="p">,</span> <span class="n">draft_id</span>
    <span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Select the drafts folder</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_imap_client</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">folder</span><span class="p">)</span>

        <span class="c1"># Append the draft message to the server</span>
        <span class="n">status</span><span class="p">,</span> <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_imap_client</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="n">folder</span><span class="p">,</span>
            <span class="s2">&quot;(</span><span class="se">\\</span><span class="s2">Draft)&quot;</span><span class="p">,</span>  <span class="c1"># Set the \Draft flag</span>
            <span class="kc">None</span><span class="p">,</span>  <span class="c1"># Use current date/time</span>
            <span class="n">draft_msg</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">),</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">status</span> <span class="o">!=</span> <span class="s2">&quot;OK&quot;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to store draft on server: </span><span class="si">{</span><span class="n">response</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to create draft: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">EmailDraft</span><span class="p">(</span>
        <span class="n">draft_id</span><span class="o">=</span><span class="n">draft_id</span><span class="p">,</span>
        <span class="n">subject</span><span class="o">=</span><span class="n">subject</span><span class="p">,</span>
        <span class="n">recipients</span><span class="o">=</span><span class="n">to_addresses</span><span class="p">,</span>
        <span class="n">cc_recipients</span><span class="o">=</span><span class="n">cc_addresses</span><span class="p">,</span>
        <span class="n">bcc_recipients</span><span class="o">=</span><span class="n">bcc_addresses</span><span class="p">,</span>
        <span class="n">body_text</span><span class="o">=</span><span class="n">body</span><span class="p">,</span>
        <span class="n">attachments</span><span class="o">=</span><span class="n">email_attachments</span><span class="p">,</span>
        <span class="n">created_date</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(),</span>
        <span class="n">modified_date</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(),</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="ragora.utils.email_utils.imap_provider.IMAPProvider.disconnect" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">disconnect</span><span class="p">()</span></code>

<a href="#ragora.utils.email_utils.imap_provider.IMAPProvider.disconnect" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Close connections to IMAP and SMTP servers.</p>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/utils/email_utils/imap_provider.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span>
<span class="normal">93</span>
<span class="normal">94</span>
<span class="normal">95</span>
<span class="normal">96</span>
<span class="normal">97</span>
<span class="normal">98</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">disconnect</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Close connections to IMAP and SMTP servers.&quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_imap_client</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_imap_client</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_imap_client</span><span class="o">.</span><span class="n">logout</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_imap_client</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_smtp_client</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_smtp_client</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_smtp_client</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_connected</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
        <span class="c1"># Ignore errors during disconnect</span>
        <span class="k">pass</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="ragora.utils.email_utils.imap_provider.IMAPProvider.fetch_message_by_id" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">fetch_message_by_id</span><span class="p">(</span><span class="n">message_id</span><span class="p">)</span></code>

<a href="#ragora.utils.email_utils.imap_provider.IMAPProvider.fetch_message_by_id" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Fetch a specific message by its ID.
Args:
    message_id: The ID of the message to fetch
Returns:
    EmailMessage object if the message was found, None otherwise</p>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/utils/email_utils/imap_provider.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">fetch_message_by_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">EmailMessage</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Fetch a specific message by its ID.</span>
<span class="sd">    Args:</span>
<span class="sd">        message_id: The ID of the message to fetch</span>
<span class="sd">    Returns:</span>
<span class="sd">        EmailMessage object if the message was found, None otherwise</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_connected</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ConnectionError</span><span class="p">(</span><span class="s2">&quot;Not connected to IMAP server&quot;</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Search for the specific message ID</span>
        <span class="n">status</span><span class="p">,</span> <span class="n">messages</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_imap_client</span><span class="o">.</span><span class="n">search</span><span class="p">(</span>
            <span class="kc">None</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;HEADER Message-ID &quot;</span><span class="si">{</span><span class="n">message_id</span><span class="si">}</span><span class="s1">&quot;&#39;</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">status</span> <span class="o">!=</span> <span class="s2">&quot;OK&quot;</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">messages</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="n">msg_ids</span> <span class="o">=</span> <span class="n">messages</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">msg_ids</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fetch_single_message</span><span class="p">(</span><span class="n">msg_ids</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to fetch message </span><span class="si">{</span><span class="n">message_id</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="ragora.utils.email_utils.imap_provider.IMAPProvider.fetch_messages" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">fetch_messages</span><span class="p">(</span><span class="n">limit</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">folder</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">unread_only</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#ragora.utils.email_utils.imap_provider.IMAPProvider.fetch_messages" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Fetch messages from IMAP server.
Args:
    limit: The maximum number of messages to fetch
    folder: The folder to search for messages
    unread_only: Whether to only fetch unread messages
Returns:
    List of EmailMessage objects</p>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/utils/email_utils/imap_provider.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">fetch_messages</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">limit</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">folder</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">unread_only</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">EmailMessage</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Fetch messages from IMAP server.</span>
<span class="sd">    Args:</span>
<span class="sd">        limit: The maximum number of messages to fetch</span>
<span class="sd">        folder: The folder to search for messages</span>
<span class="sd">        unread_only: Whether to only fetch unread messages</span>
<span class="sd">    Returns:</span>
<span class="sd">        List of EmailMessage objects</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_connected</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ConnectionError</span><span class="p">(</span><span class="s2">&quot;Not connected to IMAP server&quot;</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Select folder (default to INBOX)</span>
        <span class="n">folder_name</span> <span class="o">=</span> <span class="n">folder</span> <span class="ow">or</span> <span class="s2">&quot;INBOX&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_imap_client</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">folder_name</span><span class="p">)</span>

        <span class="c1"># Build search criteria</span>
        <span class="n">search_criteria</span> <span class="o">=</span> <span class="s2">&quot;ALL&quot;</span>
        <span class="k">if</span> <span class="n">unread_only</span><span class="p">:</span>
            <span class="n">search_criteria</span> <span class="o">=</span> <span class="s2">&quot;UNSEEN&quot;</span>

        <span class="c1"># Search for messages</span>
        <span class="n">status</span><span class="p">,</span> <span class="n">messages</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_imap_client</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">search_criteria</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">status</span> <span class="o">!=</span> <span class="s2">&quot;OK&quot;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Failed to search messages&quot;</span><span class="p">)</span>

        <span class="n">message_ids</span> <span class="o">=</span> <span class="n">messages</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="n">message_ids</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">message_ids</span><span class="p">[</span><span class="o">-</span><span class="n">limit</span><span class="p">:]</span> <span class="k">if</span> <span class="n">limit</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">limit</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">message_ids</span>
        <span class="p">)</span>

        <span class="n">email_messages</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">msg_id</span> <span class="ow">in</span> <span class="n">message_ids</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">email_msg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fetch_single_message</span><span class="p">(</span><span class="n">msg_id</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">email_msg</span><span class="p">:</span>
                    <span class="n">email_messages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">email_msg</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="c1"># Skip problematic messages</span>
                <span class="k">continue</span>

        <span class="k">return</span> <span class="n">email_messages</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to fetch messages: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="ragora.utils.email_utils.imap_provider.IMAPProvider.get_folders" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_folders</span><span class="p">()</span></code>

<a href="#ragora.utils.email_utils.imap_provider.IMAPProvider.get_folders" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Get list of available folders.
Returns:
    List of available folders</p>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/utils/email_utils/imap_provider.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_folders</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get list of available folders.</span>
<span class="sd">    Returns:</span>
<span class="sd">        List of available folders</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_connected</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ConnectionError</span><span class="p">(</span><span class="s2">&quot;Not connected to IMAP server&quot;</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">status</span><span class="p">,</span> <span class="n">folders</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_imap_client</span><span class="o">.</span><span class="n">list</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">status</span> <span class="o">!=</span> <span class="s2">&quot;OK&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[]</span>

        <span class="n">folder_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">folder</span> <span class="ow">in</span> <span class="n">folders</span><span class="p">:</span>
            <span class="n">folder_str</span> <span class="o">=</span> <span class="n">folder</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>
            <span class="c1"># Extract folder name from IMAP response</span>
            <span class="n">folder_name</span> <span class="o">=</span> <span class="n">folder_str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &quot;/&quot; &#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">)</span>
            <span class="n">folder_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">folder_name</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">folder_list</span>

    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="ragora.utils.email_utils.imap_provider.IMAPProvider.mark_as_read" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">mark_as_read</span><span class="p">(</span><span class="n">message_id</span><span class="p">)</span></code>

<a href="#ragora.utils.email_utils.imap_provider.IMAPProvider.mark_as_read" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Mark a message as read.
Args:
    message_id: The ID of the message to mark as read
Returns:
    True if the message was marked as read successfully, False otherwise</p>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/utils/email_utils/imap_provider.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">mark_as_read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Mark a message as read.</span>
<span class="sd">    Args:</span>
<span class="sd">        message_id: The ID of the message to mark as read</span>
<span class="sd">    Returns:</span>
<span class="sd">        True if the message was marked as read successfully, False otherwise</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_connected</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ConnectionError</span><span class="p">(</span><span class="s2">&quot;Not connected to IMAP server&quot;</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Search for the message</span>
        <span class="n">status</span><span class="p">,</span> <span class="n">messages</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_imap_client</span><span class="o">.</span><span class="n">search</span><span class="p">(</span>
            <span class="kc">None</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;HEADER Message-ID &quot;</span><span class="si">{</span><span class="n">message_id</span><span class="si">}</span><span class="s1">&quot;&#39;</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">status</span> <span class="o">!=</span> <span class="s2">&quot;OK&quot;</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">messages</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="n">msg_ids</span> <span class="o">=</span> <span class="n">messages</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">msg_ids</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="c1"># Mark as read</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_imap_client</span><span class="o">.</span><span class="n">store</span><span class="p">(</span><span class="n">msg_ids</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;+FLAGS&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">Seen&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="ragora.utils.email_utils.imap_provider.IMAPProvider.send_message" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">send_message</span><span class="p">(</span><span class="n">draft_id</span><span class="p">,</span> <span class="n">folder</span><span class="o">=</span><span class="s1">&#39;Drafts&#39;</span><span class="p">)</span></code>

<a href="#ragora.utils.email_utils.imap_provider.IMAPProvider.send_message" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Send a draft message by fetching from server and sending via SMTP.
Args:
    draft_id: The ID of the draft message to send
    folder: The folder to search for the draft message
Returns:
    True if the draft message was sent successfully, False otherwise</p>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/utils/email_utils/imap_provider.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">send_message</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">draft_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">folder</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;Drafts&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Send a draft message by fetching from server and sending via SMTP.</span>
<span class="sd">    Args:</span>
<span class="sd">        draft_id: The ID of the draft message to send</span>
<span class="sd">        folder: The folder to search for the draft message</span>
<span class="sd">    Returns:</span>
<span class="sd">        True if the draft message was sent successfully, False otherwise</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_connected</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ConnectionError</span><span class="p">(</span><span class="s2">&quot;Not connected to email servers&quot;</span><span class="p">)</span>
    <span class="c1"># If draft_id starts with &quot;draft_&quot; and contains timestamp,</span>
    <span class="c1"># it&#39;s a local draft. In this case, we can&#39;t send it since</span>
    <span class="c1"># it wasn&#39;t stored on the server</span>
    <span class="k">if</span> <span class="n">draft_id</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;draft_&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="s2">&quot;.&quot;</span> <span class="ow">in</span> <span class="n">draft_id</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
            <span class="s2">&quot;Cannot send local draft - draft must be stored on server first&quot;</span>
        <span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Select the drafts folder</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_imap_client</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">folder</span><span class="p">)</span>

        <span class="c1"># Search for the draft message</span>
        <span class="n">status</span><span class="p">,</span> <span class="n">messages</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_imap_client</span><span class="o">.</span><span class="n">search</span><span class="p">(</span>
            <span class="kc">None</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;HEADER Message-ID &quot;&lt;</span><span class="si">{</span><span class="n">draft_id</span><span class="si">}</span><span class="s1">@draft&gt;&quot;&#39;</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">status</span> <span class="o">!=</span> <span class="s2">&quot;OK&quot;</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">messages</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Draft with ID </span><span class="si">{</span><span class="n">draft_id</span><span class="si">}</span><span class="s2"> not found&quot;</span><span class="p">)</span>

        <span class="n">msg_ids</span> <span class="o">=</span> <span class="n">messages</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">msg_ids</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Draft with ID </span><span class="si">{</span><span class="n">draft_id</span><span class="si">}</span><span class="s2"> not found&quot;</span><span class="p">)</span>

        <span class="c1"># Fetch the draft message</span>
        <span class="n">status</span><span class="p">,</span> <span class="n">msg_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_imap_client</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="n">msg_ids</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;(RFC822)&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">status</span> <span class="o">!=</span> <span class="s2">&quot;OK&quot;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Failed to fetch draft message&quot;</span><span class="p">)</span>

        <span class="c1"># Send the message via SMTP</span>
        <span class="n">raw_email</span> <span class="o">=</span> <span class="n">msg_data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_smtp_client</span><span class="o">.</span><span class="n">send_message</span><span class="p">(</span><span class="n">email</span><span class="o">.</span><span class="n">message_from_bytes</span><span class="p">(</span><span class="n">raw_email</span><span class="p">))</span>

        <span class="c1"># Optionally delete the draft after sending</span>
        <span class="c1"># self._imap_client.store(msg_ids[0], &quot;+FLAGS&quot;, &quot;\\Deleted&quot;)</span>

        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to send draft message: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="ragora.utils.email_utils.imap_provider.IMAPProvider.send_message_direct" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">send_message_direct</span><span class="p">(</span><span class="n">to</span><span class="p">,</span> <span class="n">subject</span><span class="p">,</span> <span class="n">body</span><span class="p">,</span> <span class="n">cc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">bcc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">attachments</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#ragora.utils.email_utils.imap_provider.IMAPProvider.send_message_direct" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Send a message directly via SMTP.
Args:
    to: List of recipient email addresses
    subject: Email subject line
    body: Email body content (HTML or plain text)
    cc: Optional list of CC recipient email addresses
    bcc: Optional list of BCC recipient email addresses
    attachments: Optional list of attachment file paths
Returns:
    True if the message was sent successfully, False otherwise</p>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/utils/email_utils/imap_provider.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">send_message_direct</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">to</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
    <span class="n">subject</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">body</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">cc</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">bcc</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">attachments</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Send a message directly via SMTP.</span>
<span class="sd">    Args:</span>
<span class="sd">        to: List of recipient email addresses</span>
<span class="sd">        subject: Email subject line</span>
<span class="sd">        body: Email body content (HTML or plain text)</span>
<span class="sd">        cc: Optional list of CC recipient email addresses</span>
<span class="sd">        bcc: Optional list of BCC recipient email addresses</span>
<span class="sd">        attachments: Optional list of attachment file paths</span>
<span class="sd">    Returns:</span>
<span class="sd">        True if the message was sent successfully, False otherwise</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_connected</span> <span class="ow">or</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_smtp_client</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ConnectionError</span><span class="p">(</span><span class="s2">&quot;Not connected to SMTP server&quot;</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Create message</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">MIMEMultipart</span><span class="p">()</span>
        <span class="n">msg</span><span class="p">[</span><span class="s2">&quot;From&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">credentials</span><span class="o">.</span><span class="n">username</span>
        <span class="n">msg</span><span class="p">[</span><span class="s2">&quot;To&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">to</span><span class="p">)</span>
        <span class="n">msg</span><span class="p">[</span><span class="s2">&quot;Subject&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">subject</span>

        <span class="k">if</span> <span class="n">cc</span><span class="p">:</span>
            <span class="n">msg</span><span class="p">[</span><span class="s2">&quot;Cc&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">cc</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">bcc</span><span class="p">:</span>
            <span class="n">msg</span><span class="p">[</span><span class="s2">&quot;Bcc&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">bcc</span><span class="p">)</span>

        <span class="c1"># Add body</span>
        <span class="n">msg</span><span class="o">.</span><span class="n">attach</span><span class="p">(</span><span class="n">MIMEText</span><span class="p">(</span><span class="n">body</span><span class="p">,</span> <span class="s2">&quot;plain&quot;</span><span class="p">))</span>

        <span class="c1"># Add attachments</span>
        <span class="k">if</span> <span class="n">attachments</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">file_path</span> <span class="ow">in</span> <span class="n">attachments</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">file_path</span><span class="p">):</span>
                    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">attachment</span><span class="p">:</span>
                        <span class="n">part</span> <span class="o">=</span> <span class="n">MIMEApplication</span><span class="p">(</span>
                            <span class="n">attachment</span><span class="o">.</span><span class="n">read</span><span class="p">(),</span> <span class="n">Name</span><span class="o">=</span><span class="n">Path</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span><span class="o">.</span><span class="n">name</span>
                        <span class="p">)</span>
                        <span class="n">part</span><span class="p">[</span><span class="s2">&quot;Content-Disposition&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                            <span class="sa">f</span><span class="s1">&#39;attachment; filename=&quot;</span><span class="si">{</span><span class="n">Path</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1">&quot;&#39;</span>
                        <span class="p">)</span>
                        <span class="n">msg</span><span class="o">.</span><span class="n">attach</span><span class="p">(</span><span class="n">part</span><span class="p">)</span>

        <span class="c1"># Send message</span>
        <span class="n">all_recipients</span> <span class="o">=</span> <span class="n">to</span> <span class="o">+</span> <span class="p">(</span><span class="n">cc</span> <span class="ow">or</span> <span class="p">[])</span> <span class="o">+</span> <span class="p">(</span><span class="n">bcc</span> <span class="ow">or</span> <span class="p">[])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_smtp_client</span><span class="o">.</span><span class="n">send_message</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">to_addrs</span><span class="o">=</span><span class="n">all_recipients</span><span class="p">)</span>

        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to send message: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<a id="ragora.utils.email_utils.models"></a>
    <div class="doc doc-contents first">

        <p>Data models for email functionality.</p>










  <div class="doc doc-children">









<div class="doc doc-object doc-class">



<h4 id="ragora.utils.email_utils.models.EmailAddress" class="doc doc-heading">
            <code>EmailAddress</code>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

<a href="#ragora.utils.email_utils.models.EmailAddress" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">


        <p>Represents an email address with optional display name.</p>








              <details class="quote">
                <summary>Source code in <code>ragora/ragora/utils/email_utils/models.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">EmailAddress</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Represents an email address with optional display name.&quot;&quot;&quot;</span>

    <span class="n">email</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> &lt;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">email</span><span class="si">}</span><span class="s2">&gt;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">email</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="ragora.utils.email_utils.models.EmailAttachment" class="doc doc-heading">
            <code>EmailAttachment</code>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

<a href="#ragora.utils.email_utils.models.EmailAttachment" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">


        <p>Represents an email attachment.</p>








              <details class="quote">
                <summary>Source code in <code>ragora/ragora/utils/email_utils/models.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">EmailAttachment</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Represents an email attachment.&quot;&quot;&quot;</span>

    <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">content_type</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">size</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">content</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bytes</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">content_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># For inline attachments</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">__post_init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">)</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="ragora.utils.email_utils.models.EmailCredentials" class="doc doc-heading">
            <code>EmailCredentials</code>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

<a href="#ragora.utils.email_utils.models.EmailCredentials" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">


        <p>Base class for email credentials.</p>








              <details class="quote">
                <summary>Source code in <code>ragora/ragora/utils/email_utils/models.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">EmailCredentials</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Base class for email credentials.&quot;&quot;&quot;</span>

    <span class="k">pass</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="ragora.utils.email_utils.models.EmailDraft" class="doc doc-heading">
            <code>EmailDraft</code>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

<a href="#ragora.utils.email_utils.models.EmailDraft" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">


        <p>Represents a draft email message.</p>








              <details class="quote">
                <summary>Source code in <code>ragora/ragora/utils/email_utils/models.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span>
<span class="normal">93</span>
<span class="normal">94</span>
<span class="normal">95</span>
<span class="normal">96</span>
<span class="normal">97</span>
<span class="normal">98</span>
<span class="normal">99</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">EmailDraft</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Represents a draft email message.&quot;&quot;&quot;</span>

    <span class="n">draft_id</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">subject</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">recipients</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">EmailAddress</span><span class="p">]</span>
    <span class="n">cc_recipients</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">EmailAddress</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>
    <span class="n">bcc_recipients</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">EmailAddress</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>
    <span class="n">body_text</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">body_html</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">attachments</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">EmailAttachment</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>
    <span class="n">created_date</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">datetime</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">modified_date</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">datetime</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">metadata</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">dict</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_body</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the best available body content (HTML preferred, fallback to text).&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">body_html</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">body_html</span> <span class="k">else</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">body_text</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_all_recipients</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">EmailAddress</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get all recipients including CC and BCC.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">recipients</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">cc_recipients</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">bcc_recipients</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h5 id="ragora.utils.email_utils.models.EmailDraft.get_all_recipients" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_all_recipients</span><span class="p">()</span></code>

<a href="#ragora.utils.email_utils.models.EmailDraft.get_all_recipients" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Get all recipients including CC and BCC.</p>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/utils/email_utils/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">97</span>
<span class="normal">98</span>
<span class="normal">99</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_all_recipients</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">EmailAddress</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get all recipients including CC and BCC.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">recipients</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">cc_recipients</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">bcc_recipients</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="ragora.utils.email_utils.models.EmailDraft.get_body" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_body</span><span class="p">()</span></code>

<a href="#ragora.utils.email_utils.models.EmailDraft.get_body" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Get the best available body content (HTML preferred, fallback to text).</p>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/utils/email_utils/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">93</span>
<span class="normal">94</span>
<span class="normal">95</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_body</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the best available body content (HTML preferred, fallback to text).&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">body_html</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">body_html</span> <span class="k">else</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">body_text</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="ragora.utils.email_utils.models.EmailMessage" class="doc doc-heading">
            <code>EmailMessage</code>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

<a href="#ragora.utils.email_utils.models.EmailMessage" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">


        <p>Represents an email message.</p>








              <details class="quote">
                <summary>Source code in <code>ragora/ragora/utils/email_utils/models.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">EmailMessage</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Represents an email message.&quot;&quot;&quot;</span>

    <span class="n">message_id</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">subject</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">sender</span><span class="p">:</span> <span class="n">EmailAddress</span>
    <span class="n">recipients</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">EmailAddress</span><span class="p">]</span>
    <span class="n">cc_recipients</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">EmailAddress</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>
    <span class="n">bcc_recipients</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">EmailAddress</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>
    <span class="n">body_text</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">body_html</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">date_sent</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">datetime</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">date_received</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">datetime</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">status</span><span class="p">:</span> <span class="n">MessageStatus</span> <span class="o">=</span> <span class="n">MessageStatus</span><span class="o">.</span><span class="n">UNREAD</span>
    <span class="n">attachments</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">EmailAttachment</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>
    <span class="n">thread_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">conversation_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">folder</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">metadata</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">dict</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_body</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the best available body content (HTML preferred, fallback to text).&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">body_html</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">body_html</span> <span class="k">else</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">body_text</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_all_recipients</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">EmailAddress</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get all recipients including CC and BCC.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">recipients</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">cc_recipients</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">bcc_recipients</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h5 id="ragora.utils.email_utils.models.EmailMessage.get_all_recipients" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_all_recipients</span><span class="p">()</span></code>

<a href="#ragora.utils.email_utils.models.EmailMessage.get_all_recipients" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Get all recipients including CC and BCC.</p>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/utils/email_utils/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_all_recipients</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">EmailAddress</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get all recipients including CC and BCC.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">recipients</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">cc_recipients</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">bcc_recipients</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="ragora.utils.email_utils.models.EmailMessage.get_body" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_body</span><span class="p">()</span></code>

<a href="#ragora.utils.email_utils.models.EmailMessage.get_body" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Get the best available body content (HTML preferred, fallback to text).</p>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/utils/email_utils/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_body</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the best available body content (HTML preferred, fallback to text).&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">body_html</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">body_html</span> <span class="k">else</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">body_text</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="ragora.utils.email_utils.models.GraphCredentials" class="doc doc-heading">
            <code>GraphCredentials</code>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

<a href="#ragora.utils.email_utils.models.GraphCredentials" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="EmailCredentials


  
      dataclass
   (ragora.utils.email_utils.models.EmailCredentials)" href="#ragora.utils.email_utils.models.EmailCredentials">EmailCredentials</a></code></p>


        <p>Credentials for Microsoft Graph API.</p>








              <details class="quote">
                <summary>Source code in <code>ragora/ragora/utils/email_utils/models.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">GraphCredentials</span><span class="p">(</span><span class="n">EmailCredentials</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Credentials for Microsoft Graph API.&quot;&quot;&quot;</span>

    <span class="n">client_id</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">client_secret</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">tenant_id</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">access_token</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">refresh_token</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="ragora.utils.email_utils.models.IMAPCredentials" class="doc doc-heading">
            <code>IMAPCredentials</code>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

<a href="#ragora.utils.email_utils.models.IMAPCredentials" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="EmailCredentials


  
      dataclass
   (ragora.utils.email_utils.models.EmailCredentials)" href="#ragora.utils.email_utils.models.EmailCredentials">EmailCredentials</a></code></p>


        <p>Credentials for IMAP/SMTP servers.</p>








              <details class="quote">
                <summary>Source code in <code>ragora/ragora/utils/email_utils/models.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">IMAPCredentials</span><span class="p">(</span><span class="n">EmailCredentials</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Credentials for IMAP/SMTP servers.&quot;&quot;&quot;</span>

    <span class="n">imap_server</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">imap_port</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">smtp_server</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">smtp_port</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">username</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">password</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">use_ssl</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">use_tls</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="ragora.utils.email_utils.models.MessageStatus" class="doc doc-heading">
            <code>MessageStatus</code>


<a href="#ragora.utils.email_utils.models.MessageStatus" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="enum.Enum">Enum</span></code></p>


        <p>Status of an email message.</p>








              <details class="quote">
                <summary>Source code in <code>ragora/ragora/utils/email_utils/models.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">MessageStatus</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Status of an email message.&quot;&quot;&quot;</span>

    <span class="n">UNREAD</span> <span class="o">=</span> <span class="s2">&quot;unread&quot;</span>
    <span class="n">READ</span> <span class="o">=</span> <span class="s2">&quot;read&quot;</span>
    <span class="n">DRAFT</span> <span class="o">=</span> <span class="s2">&quot;draft&quot;</span>
    <span class="n">SENT</span> <span class="o">=</span> <span class="s2">&quot;sent&quot;</span>
    <span class="n">TRASH</span> <span class="o">=</span> <span class="s2">&quot;trash&quot;</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">












  </div>

    </div>

</div>




  </div>

    </div>

</div><h3 id="latex-parser">LaTeX Parser<a class="headerlink" href="#latex-parser" title="Permanent link">&para;</a></h3>


<div class="doc doc-object doc-module">



<a id="ragora.utils.latex_parser"></a>
    <div class="doc doc-contents first">

        <p>Parse LaTeX sources into structured Ragora data classes.</p>










  <div class="doc doc-children">









<div class="doc doc-object doc-class">



<h4 id="ragora.utils.latex_parser.Citation" class="doc doc-heading">
            <code>Citation</code>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

<a href="#ragora.utils.latex_parser.Citation" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">


        <p>Citation information for a document.</p>








              <details class="quote">
                <summary>Source code in <code>ragora/ragora/utils/latex_parser.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">Citation</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Citation information for a document.&quot;&quot;&quot;</span>

    <span class="n">author</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">year</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">title</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">doi</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">source_document</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">page_reference</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">citation_label</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">citation_hash</span><span class="p">:</span> <span class="nb">str</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">to_text</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">citation_command</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Convert the citation to a text string.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">citation_command</span> <span class="o">==</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">cite&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">author</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">year</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">citation_label</span><span class="si">}</span><span class="s2">]&quot;</span>
        <span class="k">elif</span> <span class="n">citation_command</span> <span class="o">==</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">citep&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">author</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">year</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">citation_label</span><span class="si">}</span><span class="s2">]&quot;</span>
        <span class="k">elif</span> <span class="n">citation_command</span> <span class="o">==</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">citet&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">author</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">year</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">citation_label</span><span class="si">}</span><span class="s2">]&quot;</span>
        <span class="k">elif</span> <span class="n">citation_command</span> <span class="o">==</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">citeauthor&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">author</span>
        <span class="k">elif</span> <span class="n">citation_command</span> <span class="o">==</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">citeyear&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">year</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">author</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">year</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">citation_label</span><span class="si">}</span><span class="s2">]&quot;</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h5 id="ragora.utils.latex_parser.Citation.to_text" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">to_text</span><span class="p">(</span><span class="n">citation_command</span><span class="p">)</span></code>

<a href="#ragora.utils.latex_parser.Citation.to_text" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Convert the citation to a text string.</p>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/utils/latex_parser.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">to_text</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">citation_command</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Convert the citation to a text string.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">citation_command</span> <span class="o">==</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">cite&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">author</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">year</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">citation_label</span><span class="si">}</span><span class="s2">]&quot;</span>
    <span class="k">elif</span> <span class="n">citation_command</span> <span class="o">==</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">citep&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">author</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">year</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">citation_label</span><span class="si">}</span><span class="s2">]&quot;</span>
    <span class="k">elif</span> <span class="n">citation_command</span> <span class="o">==</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">citet&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">author</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">year</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">citation_label</span><span class="si">}</span><span class="s2">]&quot;</span>
    <span class="k">elif</span> <span class="n">citation_command</span> <span class="o">==</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">citeauthor&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">author</span>
    <span class="k">elif</span> <span class="n">citation_command</span> <span class="o">==</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">citeyear&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">year</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">author</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">year</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">citation_label</span><span class="si">}</span><span class="s2">]&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="ragora.utils.latex_parser.LatexChapter" class="doc doc-heading">
            <code>LatexChapter</code>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

<a href="#ragora.utils.latex_parser.LatexChapter" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">


        <p>A LaTeX chapter.</p>








              <details class="quote">
                <summary>Source code in <code>ragora/ragora/utils/latex_parser.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">LatexChapter</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A LaTeX chapter.&quot;&quot;&quot;</span>

    <span class="n">title</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">label</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">paragraphs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">LatexParagraph</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">sections</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">LatexSection</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="ragora.utils.latex_parser.LatexDocument" class="doc doc-heading">
            <code>LatexDocument</code>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

<a href="#ragora.utils.latex_parser.LatexDocument" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">


        <p>A LaTeX document.</p>








              <details class="quote">
                <summary>Source code in <code>ragora/ragora/utils/latex_parser.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">LatexDocument</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A LaTeX document.&quot;&quot;&quot;</span>

    <span class="n">title</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">author</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">year</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">doi</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">source_document</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">page_reference</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">chapters</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">LatexChapter</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">sections</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">LatexSection</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">subsections</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">LatexSubsection</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">subsubsections</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">LatexSubsubsection</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">paragraphs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">LatexParagraph</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">tables</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">LatexTable</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">figures</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">LatexFigure</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="ragora.utils.latex_parser.LatexFigure" class="doc doc-heading">
            <code>LatexFigure</code>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

<a href="#ragora.utils.latex_parser.LatexFigure" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">


        <p>A LaTeX figure.</p>








              <details class="quote">
                <summary>Source code in <code>ragora/ragora/utils/latex_parser.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">LatexFigure</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A LaTeX figure.&quot;&quot;&quot;</span>

    <span class="n">caption</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">label</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">image_path</span><span class="p">:</span> <span class="nb">str</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="ragora.utils.latex_parser.LatexParagraph" class="doc doc-heading">
            <code>LatexParagraph</code>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

<a href="#ragora.utils.latex_parser.LatexParagraph" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">


        <p>A LaTeX paragraph.</p>








              <details class="quote">
                <summary>Source code in <code>ragora/ragora/utils/latex_parser.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">LatexParagraph</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A LaTeX paragraph.&quot;&quot;&quot;</span>

    <span class="n">content</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">citations</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Citation</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="ragora.utils.latex_parser.LatexParser" class="doc doc-heading">
            <code>LatexParser</code>


<a href="#ragora.utils.latex_parser.LatexParser" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">


        <p>Parse LaTeX sources into structured document objects.</p>
<p>The parser extracts citations, tables, figures, and hierarchical document
structure (chapters/sections) that downstream components convert into
chunks.</p>


<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><span class="n">parser</span> <span class="o">=</span> <span class="n">LatexParser</span><span class="p">()</span>
<span class="n">doc</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_document</span><span class="p">(</span><span class="s2">&quot;paper.tex&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">doc</span><span class="o">.</span><span class="n">title</span><span class="p">)</span>
</code></pre></div>








              <details class="quote">
                <summary>Source code in <code>ragora/ragora/utils/latex_parser.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">LatexParser</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Parse LaTeX sources into structured document objects.</span>

<span class="sd">    The parser extracts citations, tables, figures, and hierarchical document</span>
<span class="sd">    structure (chapters/sections) that downstream components convert into</span>
<span class="sd">    chunks.</span>

<span class="sd">    Examples:</span>
<span class="sd">        ```python</span>
<span class="sd">        parser = LatexParser()</span>
<span class="sd">        doc = parser.parse_document(&quot;paper.tex&quot;)</span>
<span class="sd">        print(doc.title)</span>
<span class="sd">        ```</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">document_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">bibliography_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">document_path</span> <span class="o">=</span> <span class="n">document_path</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bibliography_path</span> <span class="o">=</span> <span class="n">bibliography_path</span>
        <span class="c1"># If bibliography or document path is provided, load bibliography entries</span>
        <span class="c1"># otherwise, set bibliography entries to an empty dictionary</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bibliography_entries</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_load_bibliography</span><span class="p">()</span>
            <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bibliography_path</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">document_path</span><span class="p">)</span>
            <span class="k">else</span> <span class="p">{}</span>
        <span class="p">)</span>
        <span class="c1"># If document path is provided, parse the document</span>
        <span class="c1"># otherwise, set document to None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">document</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_document</span><span class="p">(</span><span class="n">document_path</span><span class="p">)</span> <span class="k">if</span> <span class="n">document_path</span> <span class="k">else</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">parse_bibliography</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bibliography_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Parse the bibliography.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bibliography_path</span> <span class="o">=</span> <span class="n">bibliography_path</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bibliography_entries</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_bibliography</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_bibliography_entries</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Citation</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the bibliography entries.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">bibliography_entries</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_load_bibliography</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Citation</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Load bibliography entries from bibliography_path file or document_path file.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bibliography_path</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">document_path</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">{}</span>
        <span class="n">actual_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bibliography_path</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">document_path</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">actual_path</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
                <span class="n">bib_content</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_bibtex</span><span class="p">(</span><span class="n">bib_content</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not load bibliography file: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">{}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_parse_bibtex</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bib_content</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Citation</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Parse BibTeX content into Citation objects.&quot;&quot;&quot;</span>
        <span class="n">entries</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># Split into individual entries</span>
        <span class="n">bib_entries</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\n\s*\n&quot;</span><span class="p">,</span> <span class="n">bib_content</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">bib_entries</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">entry</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
                <span class="k">continue</span>

            <span class="c1"># Extract entry type and key</span>
            <span class="n">type_match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;@(\w+)\{([^,]+),&quot;</span><span class="p">,</span> <span class="n">entry</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">type_match</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="n">entry_type</span> <span class="o">=</span> <span class="n">type_match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">entry_key</span> <span class="o">=</span> <span class="n">type_match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

            <span class="c1"># Only process article, book, inproceedings, etc.</span>
            <span class="k">if</span> <span class="n">entry_type</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span>
                <span class="s2">&quot;article&quot;</span><span class="p">,</span>
                <span class="s2">&quot;book&quot;</span><span class="p">,</span>
                <span class="s2">&quot;inproceedings&quot;</span><span class="p">,</span>
                <span class="s2">&quot;conference&quot;</span><span class="p">,</span>
                <span class="s2">&quot;techreport&quot;</span><span class="p">,</span>
            <span class="p">]:</span>
                <span class="k">continue</span>

            <span class="c1"># Extract fields</span>
            <span class="n">author</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_bib_field</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="s2">&quot;author&quot;</span><span class="p">,</span> <span class="s2">&quot;Unknown&quot;</span><span class="p">)</span>
            <span class="n">year</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_bib_field</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="s2">&quot;year&quot;</span><span class="p">,</span> <span class="s2">&quot;Unknown&quot;</span><span class="p">)</span>
            <span class="n">title</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_bib_field</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="s2">&quot;title&quot;</span><span class="p">,</span> <span class="s2">&quot;Unknown&quot;</span><span class="p">)</span>
            <span class="n">doi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_bib_field</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="s2">&quot;doi&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>

            <span class="n">citation</span> <span class="o">=</span> <span class="n">Citation</span><span class="p">(</span>
                <span class="n">author</span><span class="o">=</span><span class="n">author</span><span class="p">,</span>
                <span class="n">year</span><span class="o">=</span><span class="n">year</span><span class="p">,</span>
                <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span>
                <span class="n">doi</span><span class="o">=</span><span class="n">doi</span><span class="p">,</span>
                <span class="n">source_document</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">bibliography_path</span> <span class="ow">or</span> <span class="s2">&quot;unknown&quot;</span><span class="p">,</span>
                <span class="n">page_reference</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
                <span class="n">citation_label</span><span class="o">=</span><span class="n">entry_key</span><span class="p">,</span>
                <span class="n">citation_hash</span><span class="o">=</span><span class="nb">hash</span><span class="p">(</span><span class="n">entry_key</span><span class="p">),</span>
            <span class="p">)</span>

            <span class="n">entries</span><span class="p">[</span><span class="n">entry_key</span><span class="p">]</span> <span class="o">=</span> <span class="n">citation</span>

        <span class="k">return</span> <span class="n">entries</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_extract_bib_field</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entry</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">field</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">default</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Extract a specific field from a BibTeX entry.&quot;&quot;&quot;</span>
        <span class="n">pattern</span> <span class="o">=</span> <span class="sa">rf</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">field</span><span class="si">}</span><span class="s2">\s*=\s*</span><span class="se">{{</span><span class="s2">([^</span><span class="se">}}</span><span class="s2">]+)</span><span class="se">}}</span><span class="s2">&quot;</span>
        <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">entry</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">if</span> <span class="n">match</span> <span class="k">else</span> <span class="n">default</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">parse_document</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">document_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">LatexDocument</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Parse a LaTeX file into a :class:`LatexDocument`.</span>

<span class="sd">        Args:</span>
<span class="sd">            document_path: Path to the `.tex` file.</span>

<span class="sd">        Returns:</span>
<span class="sd">            LatexDocument | None: Parsed representation, or ``None`` if parsing fails.</span>

<span class="sd">        Examples:</span>
<span class="sd">            ```python</span>
<span class="sd">            parser = LatexParser()</span>
<span class="sd">            document = parser.parse_document(&quot;thesis.tex&quot;)</span>
<span class="sd">            ```</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">document_path</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">document_path</span> <span class="o">=</span> <span class="n">document_path</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">document_path</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
                <span class="n">document_text</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_document_text</span><span class="p">(</span><span class="n">document_text</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error parsing document: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">parse_document_text</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">document_text</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">LatexDocument</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Parse in-memory LaTeX text into a :class:`LatexDocument`.</span>

<span class="sd">        Args:</span>
<span class="sd">            document_text: Raw LaTeX content.</span>

<span class="sd">        Returns:</span>
<span class="sd">            LatexDocument: Parsed representation suitable for chunking.</span>

<span class="sd">        Examples:</span>
<span class="sd">            ```python</span>
<span class="sd">            parser = LatexParser()</span>
<span class="sd">            doc = parser.parse_document_text(</span>
<span class="sd">                &quot;\\title{Sample}\\n\\begin{document}Hello\\end{document}&quot;</span>
<span class="sd">            )</span>
<span class="sd">            ```</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Extract document metadata</span>
        <span class="n">title</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_title</span><span class="p">(</span><span class="n">document_text</span><span class="p">)</span>
        <span class="n">author</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_author</span><span class="p">(</span><span class="n">document_text</span><span class="p">)</span>
        <span class="n">year</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_year</span><span class="p">(</span><span class="n">document_text</span><span class="p">)</span>
        <span class="n">doi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_doi</span><span class="p">(</span><span class="n">document_text</span><span class="p">)</span>

        <span class="n">cleaned_text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_remove_document_preamble</span><span class="p">(</span><span class="n">document_text</span><span class="p">)</span>

        <span class="c1"># Parse tables and figures FIRST (to remove them from text)</span>
        <span class="n">tables</span><span class="p">,</span> <span class="n">cleaned_text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_tables</span><span class="p">(</span><span class="n">cleaned_text</span><span class="p">)</span>
        <span class="n">figures</span><span class="p">,</span> <span class="n">cleaned_text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_figures</span><span class="p">(</span><span class="n">cleaned_text</span><span class="p">)</span>

        <span class="c1"># Parse chapters hierarchically from cleaned text</span>
        <span class="n">chapters</span><span class="p">,</span> <span class="n">cleaned_text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_chapters</span><span class="p">(</span><span class="n">cleaned_text</span><span class="p">)</span>

        <span class="c1"># Parse sections hierarchically from cleaned text</span>
        <span class="n">sections</span><span class="p">,</span> <span class="n">cleaned_text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_sections</span><span class="p">(</span><span class="n">cleaned_text</span><span class="p">)</span>

        <span class="c1"># Parse paragraphs from remaining text</span>
        <span class="n">paragraphs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_paragraphs</span><span class="p">(</span><span class="n">cleaned_text</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">LatexDocument</span><span class="p">(</span>
            <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span>
            <span class="n">author</span><span class="o">=</span><span class="n">author</span><span class="p">,</span>
            <span class="n">year</span><span class="o">=</span><span class="n">year</span><span class="p">,</span>
            <span class="n">doi</span><span class="o">=</span><span class="n">doi</span><span class="p">,</span>
            <span class="n">source_document</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">document_path</span><span class="p">,</span>
            <span class="n">page_reference</span><span class="o">=</span><span class="s2">&quot;1&quot;</span><span class="p">,</span>
            <span class="n">chapters</span><span class="o">=</span><span class="n">chapters</span><span class="p">,</span>
            <span class="n">sections</span><span class="o">=</span><span class="n">sections</span><span class="p">,</span>
            <span class="n">paragraphs</span><span class="o">=</span><span class="n">paragraphs</span><span class="p">,</span>
            <span class="n">tables</span><span class="o">=</span><span class="n">tables</span><span class="p">,</span>
            <span class="n">figures</span><span class="o">=</span><span class="n">figures</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_remove_document_preamble</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Remove document preamble from text.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">begin\{document\}|</span><span class="se">\\</span><span class="s2">end\{document\}&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_extract_title</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Extract document title from LaTeX text.&quot;&quot;&quot;</span>
        <span class="n">title_match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">title\{([^}]+)\}&quot;</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">title_match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="k">if</span> <span class="n">title_match</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_extract_author</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Extract document author from LaTeX text.&quot;&quot;&quot;</span>
        <span class="n">author_match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">author\{([^}]+)\}&quot;</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">author_match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="k">if</span> <span class="n">author_match</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_extract_year</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Extract document year from LaTeX text.&quot;&quot;&quot;</span>
        <span class="n">year_match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">date\{([^}]+)\}&quot;</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">year_match</span><span class="p">:</span>
            <span class="n">year_text</span> <span class="o">=</span> <span class="n">year_match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">year_match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\b(\d</span><span class="si">{4}</span><span class="s2">)\b&quot;</span><span class="p">,</span> <span class="n">year_text</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">year_match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="k">if</span> <span class="n">year_match</span> <span class="k">else</span> <span class="n">year_text</span>
        <span class="k">return</span> <span class="s2">&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_extract_label</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Extract label from LaTeX text.&quot;&quot;&quot;</span>
        <span class="n">label_match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">label\{([^}]+)\}&quot;</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">label_match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="k">if</span> <span class="n">label_match</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_extract_doi</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Extract DOI from LaTeX text.&quot;&quot;&quot;</span>
        <span class="n">doi_match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">doi\{([^}]+)\}&quot;</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">doi_match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="k">if</span> <span class="n">doi_match</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_parse_chapters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">LatexChapter</span><span class="p">],</span> <span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Parse chapters hierarchically from LaTeX text.&quot;&quot;&quot;</span>
        <span class="n">chapters</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">remaining_text</span> <span class="o">=</span> <span class="n">text</span>
        <span class="c1"># Split text into chapter blocks</span>
        <span class="n">chapter_blocks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_split_into_chapters</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">block</span> <span class="ow">in</span> <span class="n">chapter_blocks</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">block</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
                <span class="n">chapter</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_single_chapter</span><span class="p">(</span><span class="n">block</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">chapter</span><span class="p">:</span>
                    <span class="n">chapters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chapter</span><span class="p">)</span>
                    <span class="n">remaining_text</span> <span class="o">=</span> <span class="n">remaining_text</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">block</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">chapters</span><span class="p">,</span> <span class="n">remaining_text</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_split_into_chapters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Split LaTeX text into chapter blocks.&quot;&quot;&quot;</span>
        <span class="c1"># Use re.finditer to match chapter command and its content together</span>
        <span class="n">chapter_pattern</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;(</span><span class="se">\\</span><span class="s2">chapter\*?\{[^}]+\}.*?)(?=(</span><span class="se">\\</span><span class="s2">chapter\*?\{[^}]+\})|$)&quot;</span>
        <span class="n">matches</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">finditer</span><span class="p">(</span><span class="n">chapter_pattern</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">DOTALL</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">matches</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_parse_single_chapter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">chapter_text</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">LatexChapter</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Parse a single chapter block into a LatexChapter object.&quot;&quot;&quot;</span>
        <span class="n">title_match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">chapter\*?\{([^}]+)\}&quot;</span><span class="p">,</span> <span class="n">chapter_text</span><span class="p">)</span>
        <span class="n">chapter_text_after_title</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">chapter\*?\{[^}]+\}&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">chapter_text</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">title_match</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="n">title</span> <span class="o">=</span> <span class="n">title_match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">label</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_label</span><span class="p">(</span><span class="n">chapter_text</span><span class="p">)</span>
        <span class="n">chapter_text_after_label</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span>
            <span class="sa">r</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">label\{[^}]+\}&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">chapter_text_after_title</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="mi">1</span>
        <span class="p">)</span>

        <span class="c1"># capture sections</span>
        <span class="n">sections</span><span class="p">,</span> <span class="n">remaining_text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_sections</span><span class="p">(</span><span class="n">chapter_text_after_label</span><span class="p">)</span>

        <span class="c1"># capture paragraphs</span>
        <span class="n">paragraphs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_paragraphs</span><span class="p">(</span><span class="n">remaining_text</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">LatexChapter</span><span class="p">(</span>
            <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span> <span class="n">paragraphs</span><span class="o">=</span><span class="n">paragraphs</span><span class="p">,</span> <span class="n">sections</span><span class="o">=</span><span class="n">sections</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_parse_sections</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">LatexSection</span><span class="p">],</span> <span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Parse sections hierarchically from LaTeX text.</span>
<span class="sd">        Returns:</span>
<span class="sd">            List[LatexSection]: List of sections</span>
<span class="sd">            str: Remaining text after sections are parsed and removed</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">sections</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">remaining_text</span> <span class="o">=</span> <span class="n">text</span>
        <span class="c1"># Split text into section blocks</span>
        <span class="n">section_blocks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_split_into_sections</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">block</span> <span class="ow">in</span> <span class="n">section_blocks</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">block</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
                <span class="n">section</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_single_section</span><span class="p">(</span><span class="n">block</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">section</span><span class="p">:</span>
                    <span class="n">remaining_text</span> <span class="o">=</span> <span class="n">remaining_text</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">block</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                    <span class="n">sections</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">section</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">sections</span><span class="p">,</span> <span class="n">remaining_text</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_split_into_sections</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Split LaTeX text into section blocks which start with section, subsection, or subsubsection.</span>
<span class="sd">        Any other text not part of a section command is ignored.</span>
<span class="sd">        Returns:</span>
<span class="sd">            List[str]: List of section blocks</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Split by section, subsection, or subsubsection commands</span>
        <span class="n">section_pattern</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;(</span><span class="se">\\</span><span class="s2">section\*?\{[^}]+\}|</span><span class="se">\\</span><span class="s2">subsection\*?\{[^}]+\}|</span><span class="se">\\</span><span class="s2">subsubsection\*?\{[^}]+\})&quot;</span>
        <span class="n">parts</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">section_pattern</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>

        <span class="c1"># Group section commands with their content</span>
        <span class="n">sections</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">current_section</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">part</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">parts</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="n">part</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">section&quot;</span><span class="p">)</span>
                <span class="ow">or</span> <span class="n">part</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">subsection&quot;</span><span class="p">)</span>
                <span class="ow">or</span> <span class="n">part</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">subsubsection&quot;</span><span class="p">)</span>
            <span class="p">):</span>
                <span class="k">if</span> <span class="n">current_section</span><span class="p">:</span>
                    <span class="n">sections</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">current_section</span><span class="p">)</span>
                <span class="n">current_section</span> <span class="o">=</span> <span class="n">part</span>
            <span class="k">elif</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">current_section</span> <span class="o">+=</span> <span class="n">part</span>

        <span class="k">if</span> <span class="n">current_section</span><span class="p">:</span>
            <span class="n">sections</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">current_section</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">sections</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_parse_single_section</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">section_text</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">LatexSection</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Parse a single section block into a LatexSection object.&quot;&quot;&quot;</span>

        <span class="n">regular_expression</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">section\*?\{([^}]+)\}|</span><span class="se">\\</span><span class="s2">subsection\*?\{([^}]+)\}|</span><span class="se">\\</span><span class="s2">subsubsection\*?\{([^}]+)\}&quot;</span>

        <span class="c1"># Extract section title</span>
        <span class="n">title_match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span>
            <span class="n">regular_expression</span><span class="p">,</span>
            <span class="n">section_text</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">title_match</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="n">title</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">title_match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">title_match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">else</span> <span class="n">title_match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="n">title_match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="k">else</span> <span class="n">title_match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="c1"># Remove the section command</span>
        <span class="n">section_text</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">regular_expression</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">section_text</span><span class="p">)</span>

        <span class="c1"># capture label</span>
        <span class="n">label</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_label</span><span class="p">(</span><span class="n">section_text</span><span class="p">)</span>
        <span class="n">section_text_after_label</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span>
            <span class="sa">r</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">label\{[^}]+\}&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">section_text</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="mi">1</span>
        <span class="p">)</span>

        <span class="c1"># Extract paragraphs</span>
        <span class="n">paragraphs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_paragraphs</span><span class="p">(</span><span class="n">section_text_after_label</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">LatexSection</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span> <span class="n">paragraphs</span><span class="o">=</span><span class="n">paragraphs</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_parse_paragraphs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">LatexParagraph</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Parse paragraphs from section text.&quot;&quot;&quot;</span>
        <span class="n">paragraphs</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># Split by paragraph breaks (double newlines or \par commands)</span>
        <span class="n">para_blocks</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\n\s*\n|\s*</span><span class="se">\\</span><span class="s2">par\s*&quot;</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">block</span> <span class="ow">in</span> <span class="n">para_blocks</span><span class="p">:</span>
            <span class="n">block</span> <span class="o">=</span> <span class="n">block</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">block</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">block</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">&quot;</span><span class="p">):</span>
                <span class="c1"># Extract citations and embed them in text</span>
                <span class="n">clean_content</span><span class="p">,</span> <span class="n">citations</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_process_citations_in_text</span><span class="p">(</span><span class="n">block</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">clean_content</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
                    <span class="n">paragraphs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="n">LatexParagraph</span><span class="p">(</span><span class="n">content</span><span class="o">=</span><span class="n">clean_content</span><span class="p">,</span> <span class="n">citations</span><span class="o">=</span><span class="n">citations</span><span class="p">)</span>
                    <span class="p">)</span>

        <span class="k">return</span> <span class="n">paragraphs</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_process_citations_in_text</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">Citation</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Process citations in text, embedding them and creating Citation objects.&quot;&quot;&quot;</span>
        <span class="n">citations</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">processed_text</span> <span class="o">=</span> <span class="n">text</span>

        <span class="c1"># Find all citation commands</span>
        <span class="n">cite_patterns</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">cite\{([^}]+)\}&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">cite&quot;</span><span class="p">),</span>
            <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">citep\{([^}]+)\}&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">citep&quot;</span><span class="p">),</span>
            <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">citet\{([^}]+)\}&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">citet&quot;</span><span class="p">),</span>
            <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">citeauthor\{([^}]+)\}&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">citeauthor&quot;</span><span class="p">),</span>
            <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">citeyear\{([^}]+)\}&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">citeyear&quot;</span><span class="p">),</span>
        <span class="p">]</span>

        <span class="k">for</span> <span class="n">pattern</span><span class="p">,</span> <span class="n">command</span> <span class="ow">in</span> <span class="n">cite_patterns</span><span class="p">:</span>
            <span class="n">matches</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">finditer</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">processed_text</span><span class="p">))</span>

            <span class="k">for</span> <span class="n">match</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="n">matches</span><span class="p">):</span>  <span class="c1"># Process in reverse to maintain indices</span>
                <span class="n">citation_key</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">citation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_or_create_citation</span><span class="p">(</span><span class="n">citation_key</span><span class="p">)</span>
                <span class="n">citations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">citation</span><span class="p">)</span>

                <span class="c1"># Replace citation command with embedded text</span>
                <span class="n">replacement</span> <span class="o">=</span> <span class="n">citation</span><span class="o">.</span><span class="n">to_text</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
                <span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">span</span><span class="p">()</span>
                <span class="n">processed_text</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">processed_text</span><span class="p">[:</span><span class="n">start</span><span class="p">]</span> <span class="o">+</span> <span class="n">replacement</span> <span class="o">+</span> <span class="n">processed_text</span><span class="p">[</span><span class="n">end</span><span class="p">:]</span>
                <span class="p">)</span>

        <span class="k">return</span> <span class="n">processed_text</span><span class="p">,</span> <span class="n">citations</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_get_or_create_citation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">citation_key</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Citation</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get existing citation from bibliography or create a new one.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">citation_key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">bibliography_entries</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">bibliography_entries</span><span class="p">[</span><span class="n">citation_key</span><span class="p">]</span>

        <span class="c1"># Create placeholder citation</span>
        <span class="k">return</span> <span class="n">Citation</span><span class="p">(</span>
            <span class="n">author</span><span class="o">=</span><span class="s2">&quot;Unknown&quot;</span><span class="p">,</span>
            <span class="n">year</span><span class="o">=</span><span class="s2">&quot;Unknown&quot;</span><span class="p">,</span>
            <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Unknown&quot;</span><span class="p">,</span>
            <span class="n">doi</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="n">source_document</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">document_path</span> <span class="ow">or</span> <span class="s2">&quot;unknown&quot;</span><span class="p">,</span>
            <span class="n">page_reference</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="n">citation_label</span><span class="o">=</span><span class="n">citation_key</span><span class="p">,</span>
            <span class="n">citation_hash</span><span class="o">=</span><span class="nb">hash</span><span class="p">(</span><span class="n">citation_key</span><span class="p">),</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_parse_tables</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">LatexTable</span><span class="p">],</span> <span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Parse tables from LaTeX text.&quot;&quot;&quot;</span>
        <span class="n">tables</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">remaining_text</span> <span class="o">=</span> <span class="n">text</span>

        <span class="c1"># Find table environments</span>
        <span class="n">table_pattern</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">begin\{table\}.*?</span><span class="se">\\</span><span class="s2">end\{table\}&quot;</span>
        <span class="n">table_matches</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">finditer</span><span class="p">(</span><span class="n">table_pattern</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">DOTALL</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">match</span> <span class="ow">in</span> <span class="n">table_matches</span><span class="p">:</span>
            <span class="n">table_text</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_single_table</span><span class="p">(</span><span class="n">table_text</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">table</span><span class="p">:</span>
                <span class="n">tables</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">table</span><span class="p">)</span>
                <span class="c1"># remove the table text from the text</span>
                <span class="n">remaining_text</span> <span class="o">=</span> <span class="n">remaining_text</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">table_text</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">tables</span><span class="p">,</span> <span class="n">remaining_text</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_parse_single_table</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table_text</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">LatexTable</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Parse a single table environment.&quot;&quot;&quot;</span>
        <span class="c1"># Extract caption</span>
        <span class="n">caption_match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">caption\{([^}]+)\}&quot;</span><span class="p">,</span> <span class="n">table_text</span><span class="p">)</span>
        <span class="n">caption</span> <span class="o">=</span> <span class="n">caption_match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="k">if</span> <span class="n">caption_match</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>

        <span class="c1"># Extract label</span>
        <span class="n">label_match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">label\{([^}]+)\}&quot;</span><span class="p">,</span> <span class="n">table_text</span><span class="p">)</span>
        <span class="n">label</span> <span class="o">=</span> <span class="n">label_match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="k">if</span> <span class="n">label_match</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>

        <span class="c1"># Parse tabular content</span>
        <span class="n">headers</span><span class="p">,</span> <span class="n">rows</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_tabular_content</span><span class="p">(</span><span class="n">table_text</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">(</span>
            <span class="n">LatexTable</span><span class="p">(</span><span class="n">caption</span><span class="o">=</span><span class="n">caption</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">rows</span><span class="o">=</span><span class="n">rows</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">headers</span> <span class="ow">or</span> <span class="n">rows</span>
            <span class="k">else</span> <span class="kc">None</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_parse_tabular_content</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">table_text</span><span class="p">:</span> <span class="nb">str</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Parse tabular content from table text.&quot;&quot;&quot;</span>
        <span class="c1"># Find tabular environment</span>
        <span class="n">tabular_match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span>
            <span class="sa">r</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">begin\{tabular\}.*?</span><span class="se">\\</span><span class="s2">end\{tabular\}&quot;</span><span class="p">,</span> <span class="n">table_text</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">DOTALL</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">tabular_match</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[],</span> <span class="p">[]</span>

        <span class="n">tabular_text</span> <span class="o">=</span> <span class="n">tabular_match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

        <span class="c1"># Remove the tabular commands and only keep the content</span>
        <span class="n">tabular_text</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">begin\{tabular\}&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">tabular_text</span><span class="p">)</span>
        <span class="n">tabular_text</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">end\{tabular\}&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">tabular_text</span><span class="p">)</span>
        <span class="n">tabular_text</span> <span class="o">=</span> <span class="n">tabular_text</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

        <span class="c1"># Remove column formatting like {|c|c|} at the start of tabular</span>
        <span class="n">tabular_text</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;^\s*\{[^\}]*\}\s*&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">tabular_text</span><span class="p">)</span>
        <span class="n">tabular_text</span> <span class="o">=</span> <span class="n">tabular_text</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="c1"># Split into rows</span>
        <span class="n">rows</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">tabular_text</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\\\</span><span class="s2">&quot;</span><span class="p">):</span>
            <span class="k">if</span> <span class="s2">&quot;&amp;&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                <span class="c1"># Split by &amp; and clean up</span>
                <span class="n">cells</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="n">cell</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">hline&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                    <span class="k">for</span> <span class="n">cell</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;&amp;&quot;</span><span class="p">)</span>
                <span class="p">]</span>
                <span class="n">cells</span> <span class="o">=</span> <span class="p">[</span><span class="n">cell</span> <span class="k">for</span> <span class="n">cell</span> <span class="ow">in</span> <span class="n">cells</span> <span class="k">if</span> <span class="n">cell</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">cells</span><span class="p">:</span>
                    <span class="n">rows</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cells</span><span class="p">)</span>

        <span class="c1"># First row is headers</span>
        <span class="n">headers</span> <span class="o">=</span> <span class="n">rows</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="n">rows</span> <span class="k">else</span> <span class="p">[]</span>
        <span class="n">data_rows</span> <span class="o">=</span> <span class="n">rows</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">rows</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="k">else</span> <span class="p">[]</span>

        <span class="k">return</span> <span class="n">headers</span><span class="p">,</span> <span class="n">data_rows</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_parse_figures</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">LatexFigure</span><span class="p">],</span> <span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Parse figures from LaTeX text.&quot;&quot;&quot;</span>
        <span class="n">figures</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">remaining_text</span> <span class="o">=</span> <span class="n">text</span>
        <span class="c1"># Find figure environments</span>
        <span class="n">figure_pattern</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">begin\{figure\}.*?</span><span class="se">\\</span><span class="s2">end\{figure\}&quot;</span>
        <span class="n">figure_matches</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">finditer</span><span class="p">(</span><span class="n">figure_pattern</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">DOTALL</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">match</span> <span class="ow">in</span> <span class="n">figure_matches</span><span class="p">:</span>
            <span class="n">figure_text</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">figure</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_single_figure</span><span class="p">(</span><span class="n">figure_text</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">figure</span><span class="p">:</span>
                <span class="n">figures</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">figure</span><span class="p">)</span>
                <span class="c1"># remove the figure text from the text</span>
                <span class="n">remaining_text</span> <span class="o">=</span> <span class="n">remaining_text</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">figure_text</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">figures</span><span class="p">,</span> <span class="n">remaining_text</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_parse_single_figure</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">figure_text</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">LatexFigure</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Parse a single figure environment.&quot;&quot;&quot;</span>
        <span class="c1"># Extract caption</span>
        <span class="n">caption_match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">caption\{([^}]+)\}&quot;</span><span class="p">,</span> <span class="n">figure_text</span><span class="p">)</span>
        <span class="n">caption</span> <span class="o">=</span> <span class="n">caption_match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="k">if</span> <span class="n">caption_match</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>

        <span class="c1"># Extract label</span>
        <span class="n">label_match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">label\{([^}]+)\}&quot;</span><span class="p">,</span> <span class="n">figure_text</span><span class="p">)</span>
        <span class="n">label</span> <span class="o">=</span> <span class="n">label_match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="k">if</span> <span class="n">label_match</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>

        <span class="c1"># Extract image path</span>
        <span class="n">includegraphics_match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">includegraphics\{([^}]+)\}&quot;</span><span class="p">,</span> <span class="n">figure_text</span><span class="p">)</span>
        <span class="n">image_path</span> <span class="o">=</span> <span class="n">includegraphics_match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="k">if</span> <span class="n">includegraphics_match</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>

        <span class="k">return</span> <span class="n">LatexFigure</span><span class="p">(</span><span class="n">caption</span><span class="o">=</span><span class="n">caption</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span> <span class="n">image_path</span><span class="o">=</span><span class="n">image_path</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h5 id="ragora.utils.latex_parser.LatexParser._extract_author" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">_extract_author</span><span class="p">(</span><span class="n">text</span><span class="p">)</span></code>

<a href="#ragora.utils.latex_parser.LatexParser._extract_author" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Extract document author from LaTeX text.</p>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/utils/latex_parser.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">_extract_author</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Extract document author from LaTeX text.&quot;&quot;&quot;</span>
    <span class="n">author_match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">author\{([^}]+)\}&quot;</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">author_match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="k">if</span> <span class="n">author_match</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="ragora.utils.latex_parser.LatexParser._extract_bib_field" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">_extract_bib_field</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="n">field</span><span class="p">,</span> <span class="n">default</span><span class="p">)</span></code>

<a href="#ragora.utils.latex_parser.LatexParser._extract_bib_field" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Extract a specific field from a BibTeX entry.</p>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/utils/latex_parser.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">_extract_bib_field</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entry</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">field</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">default</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Extract a specific field from a BibTeX entry.&quot;&quot;&quot;</span>
    <span class="n">pattern</span> <span class="o">=</span> <span class="sa">rf</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">field</span><span class="si">}</span><span class="s2">\s*=\s*</span><span class="se">{{</span><span class="s2">([^</span><span class="se">}}</span><span class="s2">]+)</span><span class="se">}}</span><span class="s2">&quot;</span>
    <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">entry</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">if</span> <span class="n">match</span> <span class="k">else</span> <span class="n">default</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="ragora.utils.latex_parser.LatexParser._extract_doi" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">_extract_doi</span><span class="p">(</span><span class="n">text</span><span class="p">)</span></code>

<a href="#ragora.utils.latex_parser.LatexParser._extract_doi" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Extract DOI from LaTeX text.</p>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/utils/latex_parser.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">_extract_doi</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Extract DOI from LaTeX text.&quot;&quot;&quot;</span>
    <span class="n">doi_match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">doi\{([^}]+)\}&quot;</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">doi_match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="k">if</span> <span class="n">doi_match</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="ragora.utils.latex_parser.LatexParser._extract_label" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">_extract_label</span><span class="p">(</span><span class="n">text</span><span class="p">)</span></code>

<a href="#ragora.utils.latex_parser.LatexParser._extract_label" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Extract label from LaTeX text.</p>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/utils/latex_parser.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">_extract_label</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Extract label from LaTeX text.&quot;&quot;&quot;</span>
    <span class="n">label_match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">label\{([^}]+)\}&quot;</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">label_match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="k">if</span> <span class="n">label_match</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="ragora.utils.latex_parser.LatexParser._extract_title" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">_extract_title</span><span class="p">(</span><span class="n">text</span><span class="p">)</span></code>

<a href="#ragora.utils.latex_parser.LatexParser._extract_title" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Extract document title from LaTeX text.</p>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/utils/latex_parser.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">_extract_title</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Extract document title from LaTeX text.&quot;&quot;&quot;</span>
    <span class="n">title_match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">title\{([^}]+)\}&quot;</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">title_match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="k">if</span> <span class="n">title_match</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="ragora.utils.latex_parser.LatexParser._extract_year" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">_extract_year</span><span class="p">(</span><span class="n">text</span><span class="p">)</span></code>

<a href="#ragora.utils.latex_parser.LatexParser._extract_year" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Extract document year from LaTeX text.</p>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/utils/latex_parser.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">_extract_year</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Extract document year from LaTeX text.&quot;&quot;&quot;</span>
    <span class="n">year_match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">date\{([^}]+)\}&quot;</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">year_match</span><span class="p">:</span>
        <span class="n">year_text</span> <span class="o">=</span> <span class="n">year_match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">year_match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\b(\d</span><span class="si">{4}</span><span class="s2">)\b&quot;</span><span class="p">,</span> <span class="n">year_text</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">year_match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="k">if</span> <span class="n">year_match</span> <span class="k">else</span> <span class="n">year_text</span>
    <span class="k">return</span> <span class="s2">&quot;&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="ragora.utils.latex_parser.LatexParser._get_or_create_citation" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">_get_or_create_citation</span><span class="p">(</span><span class="n">citation_key</span><span class="p">)</span></code>

<a href="#ragora.utils.latex_parser.LatexParser._get_or_create_citation" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Get existing citation from bibliography or create a new one.</p>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/utils/latex_parser.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">_get_or_create_citation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">citation_key</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Citation</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get existing citation from bibliography or create a new one.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">citation_key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">bibliography_entries</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">bibliography_entries</span><span class="p">[</span><span class="n">citation_key</span><span class="p">]</span>

    <span class="c1"># Create placeholder citation</span>
    <span class="k">return</span> <span class="n">Citation</span><span class="p">(</span>
        <span class="n">author</span><span class="o">=</span><span class="s2">&quot;Unknown&quot;</span><span class="p">,</span>
        <span class="n">year</span><span class="o">=</span><span class="s2">&quot;Unknown&quot;</span><span class="p">,</span>
        <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Unknown&quot;</span><span class="p">,</span>
        <span class="n">doi</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">source_document</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">document_path</span> <span class="ow">or</span> <span class="s2">&quot;unknown&quot;</span><span class="p">,</span>
        <span class="n">page_reference</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">citation_label</span><span class="o">=</span><span class="n">citation_key</span><span class="p">,</span>
        <span class="n">citation_hash</span><span class="o">=</span><span class="nb">hash</span><span class="p">(</span><span class="n">citation_key</span><span class="p">),</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="ragora.utils.latex_parser.LatexParser._load_bibliography" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">_load_bibliography</span><span class="p">()</span></code>

<a href="#ragora.utils.latex_parser.LatexParser._load_bibliography" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Load bibliography entries from bibliography_path file or document_path file.</p>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/utils/latex_parser.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">_load_bibliography</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Citation</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Load bibliography entries from bibliography_path file or document_path file.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bibliography_path</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">document_path</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">{}</span>
    <span class="n">actual_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bibliography_path</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">document_path</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">actual_path</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
            <span class="n">bib_content</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_bibtex</span><span class="p">(</span><span class="n">bib_content</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not load bibliography file: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">{}</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="ragora.utils.latex_parser.LatexParser._parse_bibtex" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">_parse_bibtex</span><span class="p">(</span><span class="n">bib_content</span><span class="p">)</span></code>

<a href="#ragora.utils.latex_parser.LatexParser._parse_bibtex" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Parse BibTeX content into Citation objects.</p>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/utils/latex_parser.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">_parse_bibtex</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bib_content</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Citation</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Parse BibTeX content into Citation objects.&quot;&quot;&quot;</span>
    <span class="n">entries</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c1"># Split into individual entries</span>
    <span class="n">bib_entries</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\n\s*\n&quot;</span><span class="p">,</span> <span class="n">bib_content</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">bib_entries</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">entry</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
            <span class="k">continue</span>

        <span class="c1"># Extract entry type and key</span>
        <span class="n">type_match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;@(\w+)\{([^,]+),&quot;</span><span class="p">,</span> <span class="n">entry</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">type_match</span><span class="p">:</span>
            <span class="k">continue</span>

        <span class="n">entry_type</span> <span class="o">=</span> <span class="n">type_match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">entry_key</span> <span class="o">=</span> <span class="n">type_match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

        <span class="c1"># Only process article, book, inproceedings, etc.</span>
        <span class="k">if</span> <span class="n">entry_type</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span>
            <span class="s2">&quot;article&quot;</span><span class="p">,</span>
            <span class="s2">&quot;book&quot;</span><span class="p">,</span>
            <span class="s2">&quot;inproceedings&quot;</span><span class="p">,</span>
            <span class="s2">&quot;conference&quot;</span><span class="p">,</span>
            <span class="s2">&quot;techreport&quot;</span><span class="p">,</span>
        <span class="p">]:</span>
            <span class="k">continue</span>

        <span class="c1"># Extract fields</span>
        <span class="n">author</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_bib_field</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="s2">&quot;author&quot;</span><span class="p">,</span> <span class="s2">&quot;Unknown&quot;</span><span class="p">)</span>
        <span class="n">year</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_bib_field</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="s2">&quot;year&quot;</span><span class="p">,</span> <span class="s2">&quot;Unknown&quot;</span><span class="p">)</span>
        <span class="n">title</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_bib_field</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="s2">&quot;title&quot;</span><span class="p">,</span> <span class="s2">&quot;Unknown&quot;</span><span class="p">)</span>
        <span class="n">doi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_bib_field</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="s2">&quot;doi&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>

        <span class="n">citation</span> <span class="o">=</span> <span class="n">Citation</span><span class="p">(</span>
            <span class="n">author</span><span class="o">=</span><span class="n">author</span><span class="p">,</span>
            <span class="n">year</span><span class="o">=</span><span class="n">year</span><span class="p">,</span>
            <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span>
            <span class="n">doi</span><span class="o">=</span><span class="n">doi</span><span class="p">,</span>
            <span class="n">source_document</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">bibliography_path</span> <span class="ow">or</span> <span class="s2">&quot;unknown&quot;</span><span class="p">,</span>
            <span class="n">page_reference</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="n">citation_label</span><span class="o">=</span><span class="n">entry_key</span><span class="p">,</span>
            <span class="n">citation_hash</span><span class="o">=</span><span class="nb">hash</span><span class="p">(</span><span class="n">entry_key</span><span class="p">),</span>
        <span class="p">)</span>

        <span class="n">entries</span><span class="p">[</span><span class="n">entry_key</span><span class="p">]</span> <span class="o">=</span> <span class="n">citation</span>

    <span class="k">return</span> <span class="n">entries</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="ragora.utils.latex_parser.LatexParser._parse_chapters" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">_parse_chapters</span><span class="p">(</span><span class="n">text</span><span class="p">)</span></code>

<a href="#ragora.utils.latex_parser.LatexParser._parse_chapters" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Parse chapters hierarchically from LaTeX text.</p>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/utils/latex_parser.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">_parse_chapters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">LatexChapter</span><span class="p">],</span> <span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Parse chapters hierarchically from LaTeX text.&quot;&quot;&quot;</span>
    <span class="n">chapters</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">remaining_text</span> <span class="o">=</span> <span class="n">text</span>
    <span class="c1"># Split text into chapter blocks</span>
    <span class="n">chapter_blocks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_split_into_chapters</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">block</span> <span class="ow">in</span> <span class="n">chapter_blocks</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">block</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
            <span class="n">chapter</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_single_chapter</span><span class="p">(</span><span class="n">block</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">chapter</span><span class="p">:</span>
                <span class="n">chapters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chapter</span><span class="p">)</span>
                <span class="n">remaining_text</span> <span class="o">=</span> <span class="n">remaining_text</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">block</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">chapters</span><span class="p">,</span> <span class="n">remaining_text</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="ragora.utils.latex_parser.LatexParser._parse_figures" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">_parse_figures</span><span class="p">(</span><span class="n">text</span><span class="p">)</span></code>

<a href="#ragora.utils.latex_parser.LatexParser._parse_figures" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Parse figures from LaTeX text.</p>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/utils/latex_parser.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">_parse_figures</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">LatexFigure</span><span class="p">],</span> <span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Parse figures from LaTeX text.&quot;&quot;&quot;</span>
    <span class="n">figures</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">remaining_text</span> <span class="o">=</span> <span class="n">text</span>
    <span class="c1"># Find figure environments</span>
    <span class="n">figure_pattern</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">begin\{figure\}.*?</span><span class="se">\\</span><span class="s2">end\{figure\}&quot;</span>
    <span class="n">figure_matches</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">finditer</span><span class="p">(</span><span class="n">figure_pattern</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">DOTALL</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">match</span> <span class="ow">in</span> <span class="n">figure_matches</span><span class="p">:</span>
        <span class="n">figure_text</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">figure</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_single_figure</span><span class="p">(</span><span class="n">figure_text</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">figure</span><span class="p">:</span>
            <span class="n">figures</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">figure</span><span class="p">)</span>
            <span class="c1"># remove the figure text from the text</span>
            <span class="n">remaining_text</span> <span class="o">=</span> <span class="n">remaining_text</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">figure_text</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">figures</span><span class="p">,</span> <span class="n">remaining_text</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="ragora.utils.latex_parser.LatexParser._parse_paragraphs" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">_parse_paragraphs</span><span class="p">(</span><span class="n">text</span><span class="p">)</span></code>

<a href="#ragora.utils.latex_parser.LatexParser._parse_paragraphs" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Parse paragraphs from section text.</p>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/utils/latex_parser.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">_parse_paragraphs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">LatexParagraph</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Parse paragraphs from section text.&quot;&quot;&quot;</span>
    <span class="n">paragraphs</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># Split by paragraph breaks (double newlines or \par commands)</span>
    <span class="n">para_blocks</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\n\s*\n|\s*</span><span class="se">\\</span><span class="s2">par\s*&quot;</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">block</span> <span class="ow">in</span> <span class="n">para_blocks</span><span class="p">:</span>
        <span class="n">block</span> <span class="o">=</span> <span class="n">block</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">block</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">block</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">&quot;</span><span class="p">):</span>
            <span class="c1"># Extract citations and embed them in text</span>
            <span class="n">clean_content</span><span class="p">,</span> <span class="n">citations</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_process_citations_in_text</span><span class="p">(</span><span class="n">block</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">clean_content</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
                <span class="n">paragraphs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="n">LatexParagraph</span><span class="p">(</span><span class="n">content</span><span class="o">=</span><span class="n">clean_content</span><span class="p">,</span> <span class="n">citations</span><span class="o">=</span><span class="n">citations</span><span class="p">)</span>
                <span class="p">)</span>

    <span class="k">return</span> <span class="n">paragraphs</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="ragora.utils.latex_parser.LatexParser._parse_sections" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">_parse_sections</span><span class="p">(</span><span class="n">text</span><span class="p">)</span></code>

<a href="#ragora.utils.latex_parser.LatexParser._parse_sections" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Parse sections hierarchically from LaTeX text.
Returns:
    List[LatexSection]: List of sections
    str: Remaining text after sections are parsed and removed</p>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/utils/latex_parser.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">_parse_sections</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">LatexSection</span><span class="p">],</span> <span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Parse sections hierarchically from LaTeX text.</span>
<span class="sd">    Returns:</span>
<span class="sd">        List[LatexSection]: List of sections</span>
<span class="sd">        str: Remaining text after sections are parsed and removed</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">sections</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">remaining_text</span> <span class="o">=</span> <span class="n">text</span>
    <span class="c1"># Split text into section blocks</span>
    <span class="n">section_blocks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_split_into_sections</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">block</span> <span class="ow">in</span> <span class="n">section_blocks</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">block</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
            <span class="n">section</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_single_section</span><span class="p">(</span><span class="n">block</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">section</span><span class="p">:</span>
                <span class="n">remaining_text</span> <span class="o">=</span> <span class="n">remaining_text</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">block</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="n">sections</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">section</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">sections</span><span class="p">,</span> <span class="n">remaining_text</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="ragora.utils.latex_parser.LatexParser._parse_single_chapter" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">_parse_single_chapter</span><span class="p">(</span><span class="n">chapter_text</span><span class="p">)</span></code>

<a href="#ragora.utils.latex_parser.LatexParser._parse_single_chapter" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Parse a single chapter block into a LatexChapter object.</p>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/utils/latex_parser.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">_parse_single_chapter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">chapter_text</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">LatexChapter</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Parse a single chapter block into a LatexChapter object.&quot;&quot;&quot;</span>
    <span class="n">title_match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">chapter\*?\{([^}]+)\}&quot;</span><span class="p">,</span> <span class="n">chapter_text</span><span class="p">)</span>
    <span class="n">chapter_text_after_title</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">chapter\*?\{[^}]+\}&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">chapter_text</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">title_match</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="n">title</span> <span class="o">=</span> <span class="n">title_match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">label</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_label</span><span class="p">(</span><span class="n">chapter_text</span><span class="p">)</span>
    <span class="n">chapter_text_after_label</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span>
        <span class="sa">r</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">label\{[^}]+\}&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">chapter_text_after_title</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">)</span>

    <span class="c1"># capture sections</span>
    <span class="n">sections</span><span class="p">,</span> <span class="n">remaining_text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_sections</span><span class="p">(</span><span class="n">chapter_text_after_label</span><span class="p">)</span>

    <span class="c1"># capture paragraphs</span>
    <span class="n">paragraphs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_paragraphs</span><span class="p">(</span><span class="n">remaining_text</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">LatexChapter</span><span class="p">(</span>
        <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span> <span class="n">paragraphs</span><span class="o">=</span><span class="n">paragraphs</span><span class="p">,</span> <span class="n">sections</span><span class="o">=</span><span class="n">sections</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="ragora.utils.latex_parser.LatexParser._parse_single_figure" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">_parse_single_figure</span><span class="p">(</span><span class="n">figure_text</span><span class="p">)</span></code>

<a href="#ragora.utils.latex_parser.LatexParser._parse_single_figure" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Parse a single figure environment.</p>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/utils/latex_parser.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">_parse_single_figure</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">figure_text</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">LatexFigure</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Parse a single figure environment.&quot;&quot;&quot;</span>
    <span class="c1"># Extract caption</span>
    <span class="n">caption_match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">caption\{([^}]+)\}&quot;</span><span class="p">,</span> <span class="n">figure_text</span><span class="p">)</span>
    <span class="n">caption</span> <span class="o">=</span> <span class="n">caption_match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="k">if</span> <span class="n">caption_match</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>

    <span class="c1"># Extract label</span>
    <span class="n">label_match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">label\{([^}]+)\}&quot;</span><span class="p">,</span> <span class="n">figure_text</span><span class="p">)</span>
    <span class="n">label</span> <span class="o">=</span> <span class="n">label_match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="k">if</span> <span class="n">label_match</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>

    <span class="c1"># Extract image path</span>
    <span class="n">includegraphics_match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">includegraphics\{([^}]+)\}&quot;</span><span class="p">,</span> <span class="n">figure_text</span><span class="p">)</span>
    <span class="n">image_path</span> <span class="o">=</span> <span class="n">includegraphics_match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="k">if</span> <span class="n">includegraphics_match</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>

    <span class="k">return</span> <span class="n">LatexFigure</span><span class="p">(</span><span class="n">caption</span><span class="o">=</span><span class="n">caption</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span> <span class="n">image_path</span><span class="o">=</span><span class="n">image_path</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="ragora.utils.latex_parser.LatexParser._parse_single_section" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">_parse_single_section</span><span class="p">(</span><span class="n">section_text</span><span class="p">)</span></code>

<a href="#ragora.utils.latex_parser.LatexParser._parse_single_section" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Parse a single section block into a LatexSection object.</p>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/utils/latex_parser.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">_parse_single_section</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">section_text</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">LatexSection</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Parse a single section block into a LatexSection object.&quot;&quot;&quot;</span>

    <span class="n">regular_expression</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">section\*?\{([^}]+)\}|</span><span class="se">\\</span><span class="s2">subsection\*?\{([^}]+)\}|</span><span class="se">\\</span><span class="s2">subsubsection\*?\{([^}]+)\}&quot;</span>

    <span class="c1"># Extract section title</span>
    <span class="n">title_match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span>
        <span class="n">regular_expression</span><span class="p">,</span>
        <span class="n">section_text</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">title_match</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="n">title</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">title_match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">title_match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">else</span> <span class="n">title_match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="n">title_match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="k">else</span> <span class="n">title_match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
    <span class="p">)</span>

    <span class="c1"># Remove the section command</span>
    <span class="n">section_text</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">regular_expression</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">section_text</span><span class="p">)</span>

    <span class="c1"># capture label</span>
    <span class="n">label</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_label</span><span class="p">(</span><span class="n">section_text</span><span class="p">)</span>
    <span class="n">section_text_after_label</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span>
        <span class="sa">r</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">label\{[^}]+\}&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">section_text</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">)</span>

    <span class="c1"># Extract paragraphs</span>
    <span class="n">paragraphs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_paragraphs</span><span class="p">(</span><span class="n">section_text_after_label</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">LatexSection</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span> <span class="n">paragraphs</span><span class="o">=</span><span class="n">paragraphs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="ragora.utils.latex_parser.LatexParser._parse_single_table" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">_parse_single_table</span><span class="p">(</span><span class="n">table_text</span><span class="p">)</span></code>

<a href="#ragora.utils.latex_parser.LatexParser._parse_single_table" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Parse a single table environment.</p>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/utils/latex_parser.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">_parse_single_table</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table_text</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">LatexTable</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Parse a single table environment.&quot;&quot;&quot;</span>
    <span class="c1"># Extract caption</span>
    <span class="n">caption_match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">caption\{([^}]+)\}&quot;</span><span class="p">,</span> <span class="n">table_text</span><span class="p">)</span>
    <span class="n">caption</span> <span class="o">=</span> <span class="n">caption_match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="k">if</span> <span class="n">caption_match</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>

    <span class="c1"># Extract label</span>
    <span class="n">label_match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">label\{([^}]+)\}&quot;</span><span class="p">,</span> <span class="n">table_text</span><span class="p">)</span>
    <span class="n">label</span> <span class="o">=</span> <span class="n">label_match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="k">if</span> <span class="n">label_match</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>

    <span class="c1"># Parse tabular content</span>
    <span class="n">headers</span><span class="p">,</span> <span class="n">rows</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_tabular_content</span><span class="p">(</span><span class="n">table_text</span><span class="p">)</span>

    <span class="k">return</span> <span class="p">(</span>
        <span class="n">LatexTable</span><span class="p">(</span><span class="n">caption</span><span class="o">=</span><span class="n">caption</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">rows</span><span class="o">=</span><span class="n">rows</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">headers</span> <span class="ow">or</span> <span class="n">rows</span>
        <span class="k">else</span> <span class="kc">None</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="ragora.utils.latex_parser.LatexParser._parse_tables" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">_parse_tables</span><span class="p">(</span><span class="n">text</span><span class="p">)</span></code>

<a href="#ragora.utils.latex_parser.LatexParser._parse_tables" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Parse tables from LaTeX text.</p>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/utils/latex_parser.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">_parse_tables</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">LatexTable</span><span class="p">],</span> <span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Parse tables from LaTeX text.&quot;&quot;&quot;</span>
    <span class="n">tables</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">remaining_text</span> <span class="o">=</span> <span class="n">text</span>

    <span class="c1"># Find table environments</span>
    <span class="n">table_pattern</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">begin\{table\}.*?</span><span class="se">\\</span><span class="s2">end\{table\}&quot;</span>
    <span class="n">table_matches</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">finditer</span><span class="p">(</span><span class="n">table_pattern</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">DOTALL</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">match</span> <span class="ow">in</span> <span class="n">table_matches</span><span class="p">:</span>
        <span class="n">table_text</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_single_table</span><span class="p">(</span><span class="n">table_text</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">table</span><span class="p">:</span>
            <span class="n">tables</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">table</span><span class="p">)</span>
            <span class="c1"># remove the table text from the text</span>
            <span class="n">remaining_text</span> <span class="o">=</span> <span class="n">remaining_text</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">table_text</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">tables</span><span class="p">,</span> <span class="n">remaining_text</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="ragora.utils.latex_parser.LatexParser._parse_tabular_content" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">_parse_tabular_content</span><span class="p">(</span><span class="n">table_text</span><span class="p">)</span></code>

<a href="#ragora.utils.latex_parser.LatexParser._parse_tabular_content" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Parse tabular content from table text.</p>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/utils/latex_parser.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">_parse_tabular_content</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">table_text</span><span class="p">:</span> <span class="nb">str</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Parse tabular content from table text.&quot;&quot;&quot;</span>
    <span class="c1"># Find tabular environment</span>
    <span class="n">tabular_match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span>
        <span class="sa">r</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">begin\{tabular\}.*?</span><span class="se">\\</span><span class="s2">end\{tabular\}&quot;</span><span class="p">,</span> <span class="n">table_text</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">DOTALL</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">tabular_match</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[],</span> <span class="p">[]</span>

    <span class="n">tabular_text</span> <span class="o">=</span> <span class="n">tabular_match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

    <span class="c1"># Remove the tabular commands and only keep the content</span>
    <span class="n">tabular_text</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">begin\{tabular\}&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">tabular_text</span><span class="p">)</span>
    <span class="n">tabular_text</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">end\{tabular\}&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">tabular_text</span><span class="p">)</span>
    <span class="n">tabular_text</span> <span class="o">=</span> <span class="n">tabular_text</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

    <span class="c1"># Remove column formatting like {|c|c|} at the start of tabular</span>
    <span class="n">tabular_text</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;^\s*\{[^\}]*\}\s*&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">tabular_text</span><span class="p">)</span>
    <span class="n">tabular_text</span> <span class="o">=</span> <span class="n">tabular_text</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
    <span class="c1"># Split into rows</span>
    <span class="n">rows</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">tabular_text</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\\\</span><span class="s2">&quot;</span><span class="p">):</span>
        <span class="k">if</span> <span class="s2">&quot;&amp;&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
            <span class="c1"># Split by &amp; and clean up</span>
            <span class="n">cells</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">cell</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">hline&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">cell</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;&amp;&quot;</span><span class="p">)</span>
            <span class="p">]</span>
            <span class="n">cells</span> <span class="o">=</span> <span class="p">[</span><span class="n">cell</span> <span class="k">for</span> <span class="n">cell</span> <span class="ow">in</span> <span class="n">cells</span> <span class="k">if</span> <span class="n">cell</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">cells</span><span class="p">:</span>
                <span class="n">rows</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cells</span><span class="p">)</span>

    <span class="c1"># First row is headers</span>
    <span class="n">headers</span> <span class="o">=</span> <span class="n">rows</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="n">rows</span> <span class="k">else</span> <span class="p">[]</span>
    <span class="n">data_rows</span> <span class="o">=</span> <span class="n">rows</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">rows</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="k">else</span> <span class="p">[]</span>

    <span class="k">return</span> <span class="n">headers</span><span class="p">,</span> <span class="n">data_rows</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="ragora.utils.latex_parser.LatexParser._process_citations_in_text" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">_process_citations_in_text</span><span class="p">(</span><span class="n">text</span><span class="p">)</span></code>

<a href="#ragora.utils.latex_parser.LatexParser._process_citations_in_text" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Process citations in text, embedding them and creating Citation objects.</p>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/utils/latex_parser.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">_process_citations_in_text</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">Citation</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Process citations in text, embedding them and creating Citation objects.&quot;&quot;&quot;</span>
    <span class="n">citations</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">processed_text</span> <span class="o">=</span> <span class="n">text</span>

    <span class="c1"># Find all citation commands</span>
    <span class="n">cite_patterns</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">cite\{([^}]+)\}&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">cite&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">citep\{([^}]+)\}&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">citep&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">citet\{([^}]+)\}&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">citet&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">citeauthor\{([^}]+)\}&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">citeauthor&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">citeyear\{([^}]+)\}&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">citeyear&quot;</span><span class="p">),</span>
    <span class="p">]</span>

    <span class="k">for</span> <span class="n">pattern</span><span class="p">,</span> <span class="n">command</span> <span class="ow">in</span> <span class="n">cite_patterns</span><span class="p">:</span>
        <span class="n">matches</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">finditer</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">processed_text</span><span class="p">))</span>

        <span class="k">for</span> <span class="n">match</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="n">matches</span><span class="p">):</span>  <span class="c1"># Process in reverse to maintain indices</span>
            <span class="n">citation_key</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">citation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_or_create_citation</span><span class="p">(</span><span class="n">citation_key</span><span class="p">)</span>
            <span class="n">citations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">citation</span><span class="p">)</span>

            <span class="c1"># Replace citation command with embedded text</span>
            <span class="n">replacement</span> <span class="o">=</span> <span class="n">citation</span><span class="o">.</span><span class="n">to_text</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
            <span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">span</span><span class="p">()</span>
            <span class="n">processed_text</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">processed_text</span><span class="p">[:</span><span class="n">start</span><span class="p">]</span> <span class="o">+</span> <span class="n">replacement</span> <span class="o">+</span> <span class="n">processed_text</span><span class="p">[</span><span class="n">end</span><span class="p">:]</span>
            <span class="p">)</span>

    <span class="k">return</span> <span class="n">processed_text</span><span class="p">,</span> <span class="n">citations</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="ragora.utils.latex_parser.LatexParser._remove_document_preamble" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">_remove_document_preamble</span><span class="p">(</span><span class="n">text</span><span class="p">)</span></code>

<a href="#ragora.utils.latex_parser.LatexParser._remove_document_preamble" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Remove document preamble from text.</p>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/utils/latex_parser.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">_remove_document_preamble</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Remove document preamble from text.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">begin\{document\}|</span><span class="se">\\</span><span class="s2">end\{document\}&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="ragora.utils.latex_parser.LatexParser._split_into_chapters" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">_split_into_chapters</span><span class="p">(</span><span class="n">text</span><span class="p">)</span></code>

<a href="#ragora.utils.latex_parser.LatexParser._split_into_chapters" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Split LaTeX text into chapter blocks.</p>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/utils/latex_parser.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">_split_into_chapters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Split LaTeX text into chapter blocks.&quot;&quot;&quot;</span>
    <span class="c1"># Use re.finditer to match chapter command and its content together</span>
    <span class="n">chapter_pattern</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;(</span><span class="se">\\</span><span class="s2">chapter\*?\{[^}]+\}.*?)(?=(</span><span class="se">\\</span><span class="s2">chapter\*?\{[^}]+\})|$)&quot;</span>
    <span class="n">matches</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">finditer</span><span class="p">(</span><span class="n">chapter_pattern</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">DOTALL</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">matches</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="ragora.utils.latex_parser.LatexParser._split_into_sections" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">_split_into_sections</span><span class="p">(</span><span class="n">text</span><span class="p">)</span></code>

<a href="#ragora.utils.latex_parser.LatexParser._split_into_sections" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Split LaTeX text into section blocks which start with section, subsection, or subsubsection.
Any other text not part of a section command is ignored.
Returns:
    List[str]: List of section blocks</p>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/utils/latex_parser.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">_split_into_sections</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Split LaTeX text into section blocks which start with section, subsection, or subsubsection.</span>
<span class="sd">    Any other text not part of a section command is ignored.</span>
<span class="sd">    Returns:</span>
<span class="sd">        List[str]: List of section blocks</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Split by section, subsection, or subsubsection commands</span>
    <span class="n">section_pattern</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;(</span><span class="se">\\</span><span class="s2">section\*?\{[^}]+\}|</span><span class="se">\\</span><span class="s2">subsection\*?\{[^}]+\}|</span><span class="se">\\</span><span class="s2">subsubsection\*?\{[^}]+\})&quot;</span>
    <span class="n">parts</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">section_pattern</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>

    <span class="c1"># Group section commands with their content</span>
    <span class="n">sections</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">current_section</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">part</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">parts</span><span class="p">):</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="n">part</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">section&quot;</span><span class="p">)</span>
            <span class="ow">or</span> <span class="n">part</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">subsection&quot;</span><span class="p">)</span>
            <span class="ow">or</span> <span class="n">part</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">subsubsection&quot;</span><span class="p">)</span>
        <span class="p">):</span>
            <span class="k">if</span> <span class="n">current_section</span><span class="p">:</span>
                <span class="n">sections</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">current_section</span><span class="p">)</span>
            <span class="n">current_section</span> <span class="o">=</span> <span class="n">part</span>
        <span class="k">elif</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">current_section</span> <span class="o">+=</span> <span class="n">part</span>

    <span class="k">if</span> <span class="n">current_section</span><span class="p">:</span>
        <span class="n">sections</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">current_section</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">sections</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="ragora.utils.latex_parser.LatexParser.get_bibliography_entries" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_bibliography_entries</span><span class="p">()</span></code>

<a href="#ragora.utils.latex_parser.LatexParser.get_bibliography_entries" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Get the bibliography entries.</p>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/utils/latex_parser.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_bibliography_entries</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Citation</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the bibliography entries.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">bibliography_entries</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="ragora.utils.latex_parser.LatexParser.parse_bibliography" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">parse_bibliography</span><span class="p">(</span><span class="n">bibliography_path</span><span class="p">)</span></code>

<a href="#ragora.utils.latex_parser.LatexParser.parse_bibliography" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Parse the bibliography.</p>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/utils/latex_parser.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">parse_bibliography</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bibliography_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Parse the bibliography.&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">bibliography_path</span> <span class="o">=</span> <span class="n">bibliography_path</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">bibliography_entries</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_bibliography</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="ragora.utils.latex_parser.LatexParser.parse_document" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">parse_document</span><span class="p">(</span><span class="n">document_path</span><span class="p">)</span></code>

<a href="#ragora.utils.latex_parser.LatexParser.parse_document" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Parse a LaTeX file into a :class:<code>LatexDocument</code>.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>document_path</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to the <code>.tex</code> file.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="LatexDocument


  
      dataclass
   (ragora.utils.latex_parser.LatexDocument)" href="#ragora.utils.latex_parser.LatexDocument">LatexDocument</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>LatexDocument | None: Parsed representation, or <code>None</code> if parsing fails.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><span class="n">parser</span> <span class="o">=</span> <span class="n">LatexParser</span><span class="p">()</span>
<span class="n">document</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_document</span><span class="p">(</span><span class="s2">&quot;thesis.tex&quot;</span><span class="p">)</span>
</code></pre></div>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/utils/latex_parser.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">parse_document</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">document_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">LatexDocument</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Parse a LaTeX file into a :class:`LatexDocument`.</span>

<span class="sd">    Args:</span>
<span class="sd">        document_path: Path to the `.tex` file.</span>

<span class="sd">    Returns:</span>
<span class="sd">        LatexDocument | None: Parsed representation, or ``None`` if parsing fails.</span>

<span class="sd">    Examples:</span>
<span class="sd">        ```python</span>
<span class="sd">        parser = LatexParser()</span>
<span class="sd">        document = parser.parse_document(&quot;thesis.tex&quot;)</span>
<span class="sd">        ```</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">document_path</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">document_path</span> <span class="o">=</span> <span class="n">document_path</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">document_path</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
            <span class="n">document_text</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_document_text</span><span class="p">(</span><span class="n">document_text</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error parsing document: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="ragora.utils.latex_parser.LatexParser.parse_document_text" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">parse_document_text</span><span class="p">(</span><span class="n">document_text</span><span class="p">)</span></code>

<a href="#ragora.utils.latex_parser.LatexParser.parse_document_text" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Parse in-memory LaTeX text into a :class:<code>LatexDocument</code>.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>document_text</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Raw LaTeX content.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>LatexDocument</code></td>            <td>
                  <code><a class="autorefs autorefs-internal" title="LatexDocument


  
      dataclass
   (ragora.utils.latex_parser.LatexDocument)" href="#ragora.utils.latex_parser.LatexDocument">LatexDocument</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Parsed representation suitable for chunking.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><span class="n">parser</span> <span class="o">=</span> <span class="n">LatexParser</span><span class="p">()</span>
<span class="n">doc</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_document_text</span><span class="p">(</span>
    <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">itle</span><span class="si">{Sample}</span><span class="se">\n\b</span><span class="s2">egin</span><span class="si">{document}</span><span class="s2">Hello\end</span><span class="si">{document}</span><span class="s2">&quot;</span>
<span class="p">)</span>
</code></pre></div>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/utils/latex_parser.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">parse_document_text</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">document_text</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">LatexDocument</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Parse in-memory LaTeX text into a :class:`LatexDocument`.</span>

<span class="sd">    Args:</span>
<span class="sd">        document_text: Raw LaTeX content.</span>

<span class="sd">    Returns:</span>
<span class="sd">        LatexDocument: Parsed representation suitable for chunking.</span>

<span class="sd">    Examples:</span>
<span class="sd">        ```python</span>
<span class="sd">        parser = LatexParser()</span>
<span class="sd">        doc = parser.parse_document_text(</span>
<span class="sd">            &quot;\\title{Sample}\\n\\begin{document}Hello\\end{document}&quot;</span>
<span class="sd">        )</span>
<span class="sd">        ```</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Extract document metadata</span>
    <span class="n">title</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_title</span><span class="p">(</span><span class="n">document_text</span><span class="p">)</span>
    <span class="n">author</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_author</span><span class="p">(</span><span class="n">document_text</span><span class="p">)</span>
    <span class="n">year</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_year</span><span class="p">(</span><span class="n">document_text</span><span class="p">)</span>
    <span class="n">doi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_doi</span><span class="p">(</span><span class="n">document_text</span><span class="p">)</span>

    <span class="n">cleaned_text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_remove_document_preamble</span><span class="p">(</span><span class="n">document_text</span><span class="p">)</span>

    <span class="c1"># Parse tables and figures FIRST (to remove them from text)</span>
    <span class="n">tables</span><span class="p">,</span> <span class="n">cleaned_text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_tables</span><span class="p">(</span><span class="n">cleaned_text</span><span class="p">)</span>
    <span class="n">figures</span><span class="p">,</span> <span class="n">cleaned_text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_figures</span><span class="p">(</span><span class="n">cleaned_text</span><span class="p">)</span>

    <span class="c1"># Parse chapters hierarchically from cleaned text</span>
    <span class="n">chapters</span><span class="p">,</span> <span class="n">cleaned_text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_chapters</span><span class="p">(</span><span class="n">cleaned_text</span><span class="p">)</span>

    <span class="c1"># Parse sections hierarchically from cleaned text</span>
    <span class="n">sections</span><span class="p">,</span> <span class="n">cleaned_text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_sections</span><span class="p">(</span><span class="n">cleaned_text</span><span class="p">)</span>

    <span class="c1"># Parse paragraphs from remaining text</span>
    <span class="n">paragraphs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_paragraphs</span><span class="p">(</span><span class="n">cleaned_text</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">LatexDocument</span><span class="p">(</span>
        <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span>
        <span class="n">author</span><span class="o">=</span><span class="n">author</span><span class="p">,</span>
        <span class="n">year</span><span class="o">=</span><span class="n">year</span><span class="p">,</span>
        <span class="n">doi</span><span class="o">=</span><span class="n">doi</span><span class="p">,</span>
        <span class="n">source_document</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">document_path</span><span class="p">,</span>
        <span class="n">page_reference</span><span class="o">=</span><span class="s2">&quot;1&quot;</span><span class="p">,</span>
        <span class="n">chapters</span><span class="o">=</span><span class="n">chapters</span><span class="p">,</span>
        <span class="n">sections</span><span class="o">=</span><span class="n">sections</span><span class="p">,</span>
        <span class="n">paragraphs</span><span class="o">=</span><span class="n">paragraphs</span><span class="p">,</span>
        <span class="n">tables</span><span class="o">=</span><span class="n">tables</span><span class="p">,</span>
        <span class="n">figures</span><span class="o">=</span><span class="n">figures</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="ragora.utils.latex_parser.LatexSection" class="doc doc-heading">
            <code>LatexSection</code>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

<a href="#ragora.utils.latex_parser.LatexSection" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">


        <p>A LaTeX section.</p>








              <details class="quote">
                <summary>Source code in <code>ragora/ragora/utils/latex_parser.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">LatexSection</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A LaTeX section.&quot;&quot;&quot;</span>

    <span class="n">title</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">label</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">paragraphs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">LatexParagraph</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="ragora.utils.latex_parser.LatexSubsection" class="doc doc-heading">
            <code>LatexSubsection</code>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

<a href="#ragora.utils.latex_parser.LatexSubsection" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">


        <p>A LaTeX subsection.</p>








              <details class="quote">
                <summary>Source code in <code>ragora/ragora/utils/latex_parser.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">LatexSubsection</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A LaTeX subsection.&quot;&quot;&quot;</span>

    <span class="n">title</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">label</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">paragraphs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">LatexParagraph</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">subsubsections</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">LatexSubsubsection</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="ragora.utils.latex_parser.LatexSubsubsection" class="doc doc-heading">
            <code>LatexSubsubsection</code>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

<a href="#ragora.utils.latex_parser.LatexSubsubsection" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">


        <p>A LaTeX subsubsection.</p>








              <details class="quote">
                <summary>Source code in <code>ragora/ragora/utils/latex_parser.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">LatexSubsubsection</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A LaTeX subsubsection.&quot;&quot;&quot;</span>

    <span class="n">title</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">label</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">paragraphs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">LatexParagraph</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="ragora.utils.latex_parser.LatexTable" class="doc doc-heading">
            <code>LatexTable</code>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

<a href="#ragora.utils.latex_parser.LatexTable" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">


        <p>A LaTeX table.</p>








              <details class="quote">
                <summary>Source code in <code>ragora/ragora/utils/latex_parser.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span>
<span class="normal">93</span>
<span class="normal">94</span>
<span class="normal">95</span>
<span class="normal">96</span>
<span class="normal">97</span>
<span class="normal">98</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">LatexTable</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A LaTeX table.&quot;&quot;&quot;</span>

    <span class="n">caption</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">label</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">headers</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
    <span class="n">rows</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span>
    <span class="n">footnotes</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">to_markdown</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Convert the table to a Markdown table.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">headers</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">rows</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;**Table: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">caption</span><span class="si">}</span><span class="s2">**</span><span class="se">\n\n</span><span class="s2">&quot;</span>

            <span class="c1"># Build markdown table</span>
        <span class="n">md_lines</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">caption</span><span class="p">:</span>
            <span class="n">md_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;**Table: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">caption</span><span class="si">}</span><span class="s2">**</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Headers</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">headers</span><span class="p">:</span>
            <span class="n">md_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;| &quot;</span> <span class="o">+</span> <span class="s2">&quot; | &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">headers</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; |&quot;</span><span class="p">)</span>
            <span class="n">md_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;|&quot;</span> <span class="o">+</span> <span class="s2">&quot;|&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s2">&quot;---&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">headers</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot;|&quot;</span><span class="p">)</span>

        <span class="c1"># Rows</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">rows</span><span class="p">:</span>
            <span class="n">md_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;| &quot;</span> <span class="o">+</span> <span class="s2">&quot; | &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">cell</span><span class="p">)</span> <span class="k">for</span> <span class="n">cell</span> <span class="ow">in</span> <span class="n">row</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; |&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">md_lines</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">to_plain_text</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Convert the table to a plain text table.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">headers</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">rows</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Table: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">caption</span><span class="si">}</span><span class="se">\n\n</span><span class="s2">&quot;</span>

        <span class="n">lines</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">caption</span><span class="p">:</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Table: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">caption</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Headers</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">headers</span><span class="p">:</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot; | &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">headers</span><span class="p">))</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot; | &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s2">&quot;-&quot;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">header</span><span class="p">)</span> <span class="k">for</span> <span class="n">header</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">headers</span><span class="p">]))</span>

        <span class="c1"># Rows</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">rows</span><span class="p">:</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot; | &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">cell</span><span class="p">)</span> <span class="k">for</span> <span class="n">cell</span> <span class="ow">in</span> <span class="n">row</span><span class="p">))</span>

        <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h5 id="ragora.utils.latex_parser.LatexTable.to_markdown" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">to_markdown</span><span class="p">()</span></code>

<a href="#ragora.utils.latex_parser.LatexTable.to_markdown" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Convert the table to a Markdown table.</p>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/utils/latex_parser.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">to_markdown</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Convert the table to a Markdown table.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">headers</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">rows</span><span class="p">:</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;**Table: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">caption</span><span class="si">}</span><span class="s2">**</span><span class="se">\n\n</span><span class="s2">&quot;</span>

        <span class="c1"># Build markdown table</span>
    <span class="n">md_lines</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">caption</span><span class="p">:</span>
        <span class="n">md_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;**Table: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">caption</span><span class="si">}</span><span class="s2">**</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Headers</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">headers</span><span class="p">:</span>
        <span class="n">md_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;| &quot;</span> <span class="o">+</span> <span class="s2">&quot; | &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">headers</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; |&quot;</span><span class="p">)</span>
        <span class="n">md_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;|&quot;</span> <span class="o">+</span> <span class="s2">&quot;|&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s2">&quot;---&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">headers</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot;|&quot;</span><span class="p">)</span>

    <span class="c1"># Rows</span>
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">rows</span><span class="p">:</span>
        <span class="n">md_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;| &quot;</span> <span class="o">+</span> <span class="s2">&quot; | &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">cell</span><span class="p">)</span> <span class="k">for</span> <span class="n">cell</span> <span class="ow">in</span> <span class="n">row</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; |&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">md_lines</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="ragora.utils.latex_parser.LatexTable.to_plain_text" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">to_plain_text</span><span class="p">()</span></code>

<a href="#ragora.utils.latex_parser.LatexTable.to_plain_text" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Convert the table to a plain text table.</p>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/utils/latex_parser.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span>
<span class="normal">93</span>
<span class="normal">94</span>
<span class="normal">95</span>
<span class="normal">96</span>
<span class="normal">97</span>
<span class="normal">98</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">to_plain_text</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Convert the table to a plain text table.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">headers</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">rows</span><span class="p">:</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Table: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">caption</span><span class="si">}</span><span class="se">\n\n</span><span class="s2">&quot;</span>

    <span class="n">lines</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">caption</span><span class="p">:</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Table: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">caption</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Headers</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">headers</span><span class="p">:</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot; | &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">headers</span><span class="p">))</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot; | &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s2">&quot;-&quot;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">header</span><span class="p">)</span> <span class="k">for</span> <span class="n">header</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">headers</span><span class="p">]))</span>

    <span class="c1"># Rows</span>
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">rows</span><span class="p">:</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot; | &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">cell</span><span class="p">)</span> <span class="k">for</span> <span class="n">cell</span> <span class="ow">in</span> <span class="n">row</span><span class="p">))</span>

    <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div><h3 id="markdown-parser">Markdown Parser<a class="headerlink" href="#markdown-parser" title="Permanent link">&para;</a></h3>


<div class="doc doc-object doc-module">



<a id="ragora.utils.markdown_parser"></a>
    <div class="doc doc-contents first">

        <p>Parse Markdown or plain-text files into structured Ragora models.</p>










  <div class="doc doc-children">









<div class="doc doc-object doc-class">



<h4 id="ragora.utils.markdown_parser.MarkdownChapter" class="doc doc-heading">
            <code>MarkdownChapter</code>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

<a href="#ragora.utils.markdown_parser.MarkdownChapter" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">


        <p>Represents a top-level Markdown heading (level 1).</p>








              <details class="quote">
                <summary>Source code in <code>ragora/ragora/utils/markdown_parser.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">MarkdownChapter</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Represents a top-level Markdown heading (level 1).&quot;&quot;&quot;</span>

    <span class="n">title</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">paragraphs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">MarkdownParagraph</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>
    <span class="n">sections</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">MarkdownSection</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="ragora.utils.markdown_parser.MarkdownDocument" class="doc doc-heading">
            <code>MarkdownDocument</code>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

<a href="#ragora.utils.markdown_parser.MarkdownDocument" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">


        <p>Structured representation of a Markdown/plain text document.</p>








              <details class="quote">
                <summary>Source code in <code>ragora/ragora/utils/markdown_parser.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">MarkdownDocument</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Structured representation of a Markdown/plain text document.&quot;&quot;&quot;</span>

    <span class="n">source_document</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">title</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">paragraphs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">MarkdownParagraph</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>
    <span class="n">chapters</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">MarkdownChapter</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>
    <span class="n">sections</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">MarkdownSection</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="ragora.utils.markdown_parser.MarkdownParagraph" class="doc doc-heading">
            <code>MarkdownParagraph</code>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

<a href="#ragora.utils.markdown_parser.MarkdownParagraph" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">


        <p>Represents a paragraph or block of text within a Markdown document.</p>








              <details class="quote">
                <summary>Source code in <code>ragora/ragora/utils/markdown_parser.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">MarkdownParagraph</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Represents a paragraph or block of text within a Markdown document.&quot;&quot;&quot;</span>

    <span class="n">content</span><span class="p">:</span> <span class="nb">str</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="ragora.utils.markdown_parser.MarkdownParser" class="doc doc-heading">
            <code>MarkdownParser</code>


<a href="#ragora.utils.markdown_parser.MarkdownParser" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">


        <p>Convert Markdown/plain text into the :class:<code>MarkdownDocument</code> model.</p>








              <details class="quote">
                <summary>Source code in <code>ragora/ragora/utils/markdown_parser.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">MarkdownParser</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Convert Markdown/plain text into the :class:`MarkdownDocument` model.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">enable_tables</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">enable_fenced_code</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Build a parser with optional CommonMark extensions.</span>

<span class="sd">        Args:</span>
<span class="sd">            enable_tables: Enable GitHub-style table support.</span>
<span class="sd">            enable_fenced_code: Enable fenced code block parsing.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_markdown</span> <span class="o">=</span> <span class="n">MarkdownIt</span><span class="p">(</span><span class="s2">&quot;commonmark&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">enable_tables</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_markdown</span><span class="o">.</span><span class="n">enable</span><span class="p">(</span><span class="s2">&quot;table&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">enable_fenced_code</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_markdown</span><span class="o">.</span><span class="n">enable</span><span class="p">(</span><span class="s2">&quot;fence&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">parse_document</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">MarkdownDocument</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Parse a Markdown document from disk.</span>

<span class="sd">        Args:</span>
<span class="sd">            file_path: Path to the Markdown/plain text file.</span>

<span class="sd">        Returns:</span>
<span class="sd">            MarkdownDocument: Parsed representation.</span>

<span class="sd">        Raises:</span>
<span class="sd">            FileNotFoundError: If the file does not exist.</span>

<span class="sd">        Examples:</span>
<span class="sd">            ```python</span>
<span class="sd">            parser = MarkdownParser()</span>
<span class="sd">            doc = parser.parse_document(&quot;notes.md&quot;)</span>
<span class="sd">            ```</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">file_path</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Markdown file not found: </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
            <span class="n">content</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_text</span><span class="p">(</span><span class="n">content</span><span class="p">,</span> <span class="n">source_document</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">file_path</span><span class="p">))</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">parse_text</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">source_document</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">MarkdownDocument</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Parse provided Markdown/plain text content.</span>

<span class="sd">        Args:</span>
<span class="sd">            text: Text blob to parse.</span>
<span class="sd">            source_document: Optional source name for metadata.</span>

<span class="sd">        Returns:</span>
<span class="sd">            MarkdownDocument: Parsed representation suitable for chunking.</span>

<span class="sd">        Examples:</span>
<span class="sd">            ```python</span>
<span class="sd">            parser = MarkdownParser()</span>
<span class="sd">            doc = parser.parse_text(&quot;# Title\\n\\nSome content&quot;)</span>
<span class="sd">            ```</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">source_name</span> <span class="o">=</span> <span class="n">source_document</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span>
        <span class="n">default_title</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">source_name</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="n">source_name</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="p">)</span>
        <span class="n">document</span> <span class="o">=</span> <span class="n">MarkdownDocument</span><span class="p">(</span><span class="n">source_document</span><span class="o">=</span><span class="n">source_name</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">default_title</span><span class="p">)</span>

        <span class="n">tokens</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_markdown</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
        <span class="n">current_chapter</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">MarkdownChapter</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">current_section</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">MarkdownSection</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">block_context</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">blockquote_level</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">list_stack</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">in_list_item</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">add_paragraph</span><span class="p">(</span><span class="n">raw_text</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">text_to_add</span> <span class="o">=</span> <span class="n">raw_text</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">text_to_add</span><span class="p">:</span>
                <span class="k">return</span>

            <span class="k">if</span> <span class="n">blockquote_level</span><span class="p">:</span>
                <span class="n">prefix</span> <span class="o">=</span> <span class="s2">&quot;&gt; &quot;</span> <span class="o">*</span> <span class="n">blockquote_level</span>
                <span class="n">text_to_add</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">prefix</span><span class="si">}{</span><span class="n">text_to_add</span><span class="si">}</span><span class="s2">&quot;</span>

            <span class="n">paragraph</span> <span class="o">=</span> <span class="n">MarkdownParagraph</span><span class="p">(</span><span class="n">content</span><span class="o">=</span><span class="n">text_to_add</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">current_section</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">current_section</span><span class="o">.</span><span class="n">paragraphs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">paragraph</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">current_chapter</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">current_chapter</span><span class="o">.</span><span class="n">paragraphs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">paragraph</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">document</span><span class="o">.</span><span class="n">paragraphs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">paragraph</span><span class="p">)</span>

        <span class="n">index</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="n">index</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">tokens</span><span class="p">):</span>
            <span class="n">token</span> <span class="o">=</span> <span class="n">tokens</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">token</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s2">&quot;heading_open&quot;</span><span class="p">:</span>
                <span class="n">level</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="nb">int</span><span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">tag</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="k">if</span> <span class="n">token</span><span class="o">.</span><span class="n">tag</span> <span class="ow">and</span> <span class="n">token</span><span class="o">.</span><span class="n">tag</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">isdigit</span><span class="p">()</span> <span class="k">else</span> <span class="mi">1</span>
                <span class="p">)</span>
                <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                <span class="n">lookahead</span> <span class="o">=</span> <span class="n">index</span> <span class="o">+</span> <span class="mi">1</span>
                <span class="k">while</span> <span class="p">(</span>
                    <span class="n">lookahead</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">tokens</span><span class="p">)</span>
                    <span class="ow">and</span> <span class="n">tokens</span><span class="p">[</span><span class="n">lookahead</span><span class="p">]</span><span class="o">.</span><span class="n">type</span> <span class="o">!=</span> <span class="s2">&quot;heading_close&quot;</span>
                <span class="p">):</span>
                    <span class="k">if</span> <span class="n">tokens</span><span class="p">[</span><span class="n">lookahead</span><span class="p">]</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s2">&quot;inline&quot;</span><span class="p">:</span>
                        <span class="n">title</span> <span class="o">=</span> <span class="n">tokens</span><span class="p">[</span><span class="n">lookahead</span><span class="p">]</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                    <span class="n">lookahead</span> <span class="o">+=</span> <span class="mi">1</span>

                <span class="k">if</span> <span class="n">level</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">current_chapter</span> <span class="o">=</span> <span class="n">MarkdownChapter</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">)</span>
                    <span class="n">document</span><span class="o">.</span><span class="n">chapters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">current_chapter</span><span class="p">)</span>
                    <span class="n">current_section</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">document</span><span class="o">.</span><span class="n">title</span><span class="p">:</span>
                        <span class="n">document</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="n">title</span>
                <span class="k">elif</span> <span class="n">level</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="n">section</span> <span class="o">=</span> <span class="n">MarkdownSection</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="n">level</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">current_chapter</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">current_chapter</span><span class="o">.</span><span class="n">sections</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">section</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">document</span><span class="o">.</span><span class="n">sections</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">section</span><span class="p">)</span>
                    <span class="n">current_section</span> <span class="o">=</span> <span class="n">section</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">add_paragraph</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;#&#39;</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">level</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">title</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

                <span class="n">index</span> <span class="o">=</span> <span class="n">lookahead</span>  <span class="c1"># Skip inline tokens handled above</span>
                <span class="n">block_context</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">elif</span> <span class="n">token</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s2">&quot;paragraph_open&quot;</span><span class="p">:</span>
                <span class="n">block_context</span> <span class="o">=</span> <span class="s2">&quot;paragraph&quot;</span>
            <span class="k">elif</span> <span class="n">token</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s2">&quot;paragraph_close&quot;</span><span class="p">:</span>
                <span class="n">block_context</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">elif</span> <span class="n">token</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s2">&quot;blockquote_open&quot;</span><span class="p">:</span>
                <span class="n">blockquote_level</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">elif</span> <span class="n">token</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s2">&quot;blockquote_close&quot;</span><span class="p">:</span>
                <span class="n">blockquote_level</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">blockquote_level</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">token</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s2">&quot;bullet_list_open&quot;</span><span class="p">:</span>
                <span class="n">list_stack</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;bullet&quot;</span><span class="p">})</span>
            <span class="k">elif</span> <span class="n">token</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s2">&quot;bullet_list_close&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">list_stack</span><span class="p">:</span>
                    <span class="n">list_stack</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
            <span class="k">elif</span> <span class="n">token</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s2">&quot;ordered_list_open&quot;</span><span class="p">:</span>
                <span class="n">start_attr</span> <span class="o">=</span> <span class="n">token</span><span class="o">.</span><span class="n">attrGet</span><span class="p">(</span><span class="s2">&quot;start&quot;</span><span class="p">)</span>
                <span class="n">start_index</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">start_attr</span><span class="p">)</span> <span class="k">if</span> <span class="n">start_attr</span> <span class="k">else</span> <span class="mi">1</span>
                <span class="n">list_stack</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;ordered&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span> <span class="n">start_index</span><span class="p">})</span>
            <span class="k">elif</span> <span class="n">token</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s2">&quot;ordered_list_close&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">list_stack</span><span class="p">:</span>
                    <span class="n">list_stack</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
            <span class="k">elif</span> <span class="n">token</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s2">&quot;list_item_open&quot;</span><span class="p">:</span>
                <span class="n">block_context</span> <span class="o">=</span> <span class="s2">&quot;list_item&quot;</span>
                <span class="n">in_list_item</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">elif</span> <span class="n">token</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s2">&quot;list_item_close&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">list_stack</span> <span class="ow">and</span> <span class="n">list_stack</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;ordered&quot;</span><span class="p">:</span>
                    <span class="n">list_stack</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;index&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">block_context</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">in_list_item</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">elif</span> <span class="n">token</span><span class="o">.</span><span class="n">type</span> <span class="ow">in</span> <span class="p">{</span><span class="s2">&quot;fence&quot;</span><span class="p">,</span> <span class="s2">&quot;code_block&quot;</span><span class="p">}:</span>
                <span class="n">code_text</span> <span class="o">=</span> <span class="n">token</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">add_paragraph</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;```</span><span class="se">\n</span><span class="si">{</span><span class="n">code_text</span><span class="si">}</span><span class="se">\n</span><span class="s2">```&quot;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">token</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s2">&quot;inline&quot;</span><span class="p">:</span>
                <span class="n">inline_text</span> <span class="o">=</span> <span class="n">token</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">inline_text</span><span class="p">:</span>
                    <span class="n">index</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="k">continue</span>

                <span class="k">if</span> <span class="n">in_list_item</span> <span class="ow">and</span> <span class="n">list_stack</span><span class="p">:</span>
                    <span class="n">current_list</span> <span class="o">=</span> <span class="n">list_stack</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">current_list</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;bullet&quot;</span><span class="p">:</span>
                        <span class="n">formatted_text</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;- </span><span class="si">{</span><span class="n">inline_text</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">formatted_text</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">current_list</span><span class="p">[</span><span class="s1">&#39;index&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">. </span><span class="si">{</span><span class="n">inline_text</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="n">add_paragraph</span><span class="p">(</span><span class="n">formatted_text</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">add_paragraph</span><span class="p">(</span><span class="n">inline_text</span><span class="p">)</span>

            <span class="n">index</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="k">return</span> <span class="n">document</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h5 id="ragora.utils.markdown_parser.MarkdownParser.parse_document" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">parse_document</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span></code>

<a href="#ragora.utils.markdown_parser.MarkdownParser.parse_document" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Parse a Markdown document from disk.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>file_path</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to the Markdown/plain text file.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>MarkdownDocument</code></td>            <td>
                  <code><a class="autorefs autorefs-internal" title="MarkdownDocument


  
      dataclass
   (ragora.utils.markdown_parser.MarkdownDocument)" href="#ragora.utils.markdown_parser.MarkdownDocument">MarkdownDocument</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Parsed representation.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="FileNotFoundError">FileNotFoundError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If the file does not exist.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><span class="n">parser</span> <span class="o">=</span> <span class="n">MarkdownParser</span><span class="p">()</span>
<span class="n">doc</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_document</span><span class="p">(</span><span class="s2">&quot;notes.md&quot;</span><span class="p">)</span>
</code></pre></div>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/utils/markdown_parser.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">parse_document</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">MarkdownDocument</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Parse a Markdown document from disk.</span>

<span class="sd">    Args:</span>
<span class="sd">        file_path: Path to the Markdown/plain text file.</span>

<span class="sd">    Returns:</span>
<span class="sd">        MarkdownDocument: Parsed representation.</span>

<span class="sd">    Raises:</span>
<span class="sd">        FileNotFoundError: If the file does not exist.</span>

<span class="sd">    Examples:</span>
<span class="sd">        ```python</span>
<span class="sd">        parser = MarkdownParser()</span>
<span class="sd">        doc = parser.parse_document(&quot;notes.md&quot;)</span>
<span class="sd">        ```</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">file_path</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Markdown file not found: </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
        <span class="n">content</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_text</span><span class="p">(</span><span class="n">content</span><span class="p">,</span> <span class="n">source_document</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">file_path</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="ragora.utils.markdown_parser.MarkdownParser.parse_text" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">parse_text</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">source_document</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#ragora.utils.markdown_parser.MarkdownParser.parse_text" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Parse provided Markdown/plain text content.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>text</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Text blob to parse.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>source_document</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional source name for metadata.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>MarkdownDocument</code></td>            <td>
                  <code><a class="autorefs autorefs-internal" title="MarkdownDocument


  
      dataclass
   (ragora.utils.markdown_parser.MarkdownDocument)" href="#ragora.utils.markdown_parser.MarkdownDocument">MarkdownDocument</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Parsed representation suitable for chunking.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><span class="n">parser</span> <span class="o">=</span> <span class="n">MarkdownParser</span><span class="p">()</span>
<span class="n">doc</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_text</span><span class="p">(</span><span class="s2">&quot;# Title</span><span class="se">\n\n</span><span class="s2">Some content&quot;</span><span class="p">)</span>
</code></pre></div>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/utils/markdown_parser.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">parse_text</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">source_document</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">MarkdownDocument</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Parse provided Markdown/plain text content.</span>

<span class="sd">    Args:</span>
<span class="sd">        text: Text blob to parse.</span>
<span class="sd">        source_document: Optional source name for metadata.</span>

<span class="sd">    Returns:</span>
<span class="sd">        MarkdownDocument: Parsed representation suitable for chunking.</span>

<span class="sd">    Examples:</span>
<span class="sd">        ```python</span>
<span class="sd">        parser = MarkdownParser()</span>
<span class="sd">        doc = parser.parse_text(&quot;# Title\\n\\nSome content&quot;)</span>
<span class="sd">        ```</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">source_name</span> <span class="o">=</span> <span class="n">source_document</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span>
    <span class="n">default_title</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">source_name</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="n">source_name</span> <span class="k">else</span> <span class="kc">None</span>
    <span class="p">)</span>
    <span class="n">document</span> <span class="o">=</span> <span class="n">MarkdownDocument</span><span class="p">(</span><span class="n">source_document</span><span class="o">=</span><span class="n">source_name</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">default_title</span><span class="p">)</span>

    <span class="n">tokens</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_markdown</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
    <span class="n">current_chapter</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">MarkdownChapter</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">current_section</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">MarkdownSection</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">block_context</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">blockquote_level</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">list_stack</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">in_list_item</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">add_paragraph</span><span class="p">(</span><span class="n">raw_text</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">text_to_add</span> <span class="o">=</span> <span class="n">raw_text</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">text_to_add</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="n">blockquote_level</span><span class="p">:</span>
            <span class="n">prefix</span> <span class="o">=</span> <span class="s2">&quot;&gt; &quot;</span> <span class="o">*</span> <span class="n">blockquote_level</span>
            <span class="n">text_to_add</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">prefix</span><span class="si">}{</span><span class="n">text_to_add</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="n">paragraph</span> <span class="o">=</span> <span class="n">MarkdownParagraph</span><span class="p">(</span><span class="n">content</span><span class="o">=</span><span class="n">text_to_add</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">current_section</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">current_section</span><span class="o">.</span><span class="n">paragraphs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">paragraph</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">current_chapter</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">current_chapter</span><span class="o">.</span><span class="n">paragraphs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">paragraph</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">document</span><span class="o">.</span><span class="n">paragraphs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">paragraph</span><span class="p">)</span>

    <span class="n">index</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">while</span> <span class="n">index</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">tokens</span><span class="p">):</span>
        <span class="n">token</span> <span class="o">=</span> <span class="n">tokens</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">token</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s2">&quot;heading_open&quot;</span><span class="p">:</span>
            <span class="n">level</span> <span class="o">=</span> <span class="p">(</span>
                <span class="nb">int</span><span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">tag</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="k">if</span> <span class="n">token</span><span class="o">.</span><span class="n">tag</span> <span class="ow">and</span> <span class="n">token</span><span class="o">.</span><span class="n">tag</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">isdigit</span><span class="p">()</span> <span class="k">else</span> <span class="mi">1</span>
            <span class="p">)</span>
            <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="n">lookahead</span> <span class="o">=</span> <span class="n">index</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="k">while</span> <span class="p">(</span>
                <span class="n">lookahead</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">tokens</span><span class="p">)</span>
                <span class="ow">and</span> <span class="n">tokens</span><span class="p">[</span><span class="n">lookahead</span><span class="p">]</span><span class="o">.</span><span class="n">type</span> <span class="o">!=</span> <span class="s2">&quot;heading_close&quot;</span>
            <span class="p">):</span>
                <span class="k">if</span> <span class="n">tokens</span><span class="p">[</span><span class="n">lookahead</span><span class="p">]</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s2">&quot;inline&quot;</span><span class="p">:</span>
                    <span class="n">title</span> <span class="o">=</span> <span class="n">tokens</span><span class="p">[</span><span class="n">lookahead</span><span class="p">]</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="n">lookahead</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="k">if</span> <span class="n">level</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">current_chapter</span> <span class="o">=</span> <span class="n">MarkdownChapter</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">)</span>
                <span class="n">document</span><span class="o">.</span><span class="n">chapters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">current_chapter</span><span class="p">)</span>
                <span class="n">current_section</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">document</span><span class="o">.</span><span class="n">title</span><span class="p">:</span>
                    <span class="n">document</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="n">title</span>
            <span class="k">elif</span> <span class="n">level</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">section</span> <span class="o">=</span> <span class="n">MarkdownSection</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="n">level</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">current_chapter</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">current_chapter</span><span class="o">.</span><span class="n">sections</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">section</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">document</span><span class="o">.</span><span class="n">sections</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">section</span><span class="p">)</span>
                <span class="n">current_section</span> <span class="o">=</span> <span class="n">section</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">add_paragraph</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;#&#39;</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">level</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">title</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="n">index</span> <span class="o">=</span> <span class="n">lookahead</span>  <span class="c1"># Skip inline tokens handled above</span>
            <span class="n">block_context</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">elif</span> <span class="n">token</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s2">&quot;paragraph_open&quot;</span><span class="p">:</span>
            <span class="n">block_context</span> <span class="o">=</span> <span class="s2">&quot;paragraph&quot;</span>
        <span class="k">elif</span> <span class="n">token</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s2">&quot;paragraph_close&quot;</span><span class="p">:</span>
            <span class="n">block_context</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">elif</span> <span class="n">token</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s2">&quot;blockquote_open&quot;</span><span class="p">:</span>
            <span class="n">blockquote_level</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">elif</span> <span class="n">token</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s2">&quot;blockquote_close&quot;</span><span class="p">:</span>
            <span class="n">blockquote_level</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">blockquote_level</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">token</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s2">&quot;bullet_list_open&quot;</span><span class="p">:</span>
            <span class="n">list_stack</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;bullet&quot;</span><span class="p">})</span>
        <span class="k">elif</span> <span class="n">token</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s2">&quot;bullet_list_close&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">list_stack</span><span class="p">:</span>
                <span class="n">list_stack</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">token</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s2">&quot;ordered_list_open&quot;</span><span class="p">:</span>
            <span class="n">start_attr</span> <span class="o">=</span> <span class="n">token</span><span class="o">.</span><span class="n">attrGet</span><span class="p">(</span><span class="s2">&quot;start&quot;</span><span class="p">)</span>
            <span class="n">start_index</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">start_attr</span><span class="p">)</span> <span class="k">if</span> <span class="n">start_attr</span> <span class="k">else</span> <span class="mi">1</span>
            <span class="n">list_stack</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;ordered&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span> <span class="n">start_index</span><span class="p">})</span>
        <span class="k">elif</span> <span class="n">token</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s2">&quot;ordered_list_close&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">list_stack</span><span class="p">:</span>
                <span class="n">list_stack</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">token</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s2">&quot;list_item_open&quot;</span><span class="p">:</span>
            <span class="n">block_context</span> <span class="o">=</span> <span class="s2">&quot;list_item&quot;</span>
            <span class="n">in_list_item</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="n">token</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s2">&quot;list_item_close&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">list_stack</span> <span class="ow">and</span> <span class="n">list_stack</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;ordered&quot;</span><span class="p">:</span>
                <span class="n">list_stack</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;index&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">block_context</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">in_list_item</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">elif</span> <span class="n">token</span><span class="o">.</span><span class="n">type</span> <span class="ow">in</span> <span class="p">{</span><span class="s2">&quot;fence&quot;</span><span class="p">,</span> <span class="s2">&quot;code_block&quot;</span><span class="p">}:</span>
            <span class="n">code_text</span> <span class="o">=</span> <span class="n">token</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">add_paragraph</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;```</span><span class="se">\n</span><span class="si">{</span><span class="n">code_text</span><span class="si">}</span><span class="se">\n</span><span class="s2">```&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">token</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s2">&quot;inline&quot;</span><span class="p">:</span>
            <span class="n">inline_text</span> <span class="o">=</span> <span class="n">token</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">inline_text</span><span class="p">:</span>
                <span class="n">index</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">continue</span>

            <span class="k">if</span> <span class="n">in_list_item</span> <span class="ow">and</span> <span class="n">list_stack</span><span class="p">:</span>
                <span class="n">current_list</span> <span class="o">=</span> <span class="n">list_stack</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">current_list</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;bullet&quot;</span><span class="p">:</span>
                    <span class="n">formatted_text</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;- </span><span class="si">{</span><span class="n">inline_text</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">formatted_text</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">current_list</span><span class="p">[</span><span class="s1">&#39;index&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">. </span><span class="si">{</span><span class="n">inline_text</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="n">add_paragraph</span><span class="p">(</span><span class="n">formatted_text</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">add_paragraph</span><span class="p">(</span><span class="n">inline_text</span><span class="p">)</span>

        <span class="n">index</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">return</span> <span class="n">document</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="ragora.utils.markdown_parser.MarkdownSection" class="doc doc-heading">
            <code>MarkdownSection</code>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

<a href="#ragora.utils.markdown_parser.MarkdownSection" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">


        <p>Represents a Markdown section (heading level &gt;= 2).</p>








              <details class="quote">
                <summary>Source code in <code>ragora/ragora/utils/markdown_parser.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">MarkdownSection</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Represents a Markdown section (heading level &gt;= 2).&quot;&quot;&quot;</span>

    <span class="n">title</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">level</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">paragraphs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">MarkdownParagraph</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">












  </div>

    </div>

</div>




  </div>

    </div>

</div><h2 id="configuration">Configuration<a class="headerlink" href="#configuration" title="Permanent link">&para;</a></h2>


<div class="doc doc-object doc-module">



<a id="ragora.config.settings"></a>
    <div class="doc doc-contents first">

        <p>Dataclasses that capture Ragora configuration.</p>










  <div class="doc doc-children">









<div class="doc doc-object doc-class">



<h3 id="ragora.config.settings.ChunkConfig" class="doc doc-heading">
            <code>ChunkConfig</code>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

<a href="#ragora.config.settings.ChunkConfig" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">


        <p>Chunking behaviour for document ingestion.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="ragora.config.settings.ChunkConfig.chunk_size">chunk_size</span></code></td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Target token length per chunk.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="ragora.config.settings.ChunkConfig.overlap_size">overlap_size</span></code></td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Token overlap between sequential chunks.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="ragora.config.settings.ChunkConfig.chunk_type">chunk_type</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Friendly label used downstream for metadata.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>








              <details class="quote">
                <summary>Source code in <code>ragora/ragora/config/settings.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">ChunkConfig</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Chunking behaviour for document ingestion.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        chunk_size: Target token length per chunk.</span>
<span class="sd">        overlap_size: Token overlap between sequential chunks.</span>
<span class="sd">        chunk_type: Friendly label used downstream for metadata.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">chunk_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">768</span>
    <span class="n">overlap_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100</span>
    <span class="n">chunk_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;document&quot;</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="ragora.config.settings.DatabaseManagerConfig" class="doc doc-heading">
            <code>DatabaseManagerConfig</code>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

<a href="#ragora.config.settings.DatabaseManagerConfig" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">


        <p>Connection properties for the Weaviate backend.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="ragora.config.settings.DatabaseManagerConfig.url">url</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>HTTP endpoint for Weaviate.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="ragora.config.settings.DatabaseManagerConfig.grpc_port">grpc_port</span></code></td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional gRPC port.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="ragora.config.settings.DatabaseManagerConfig.timeout">timeout</span></code></td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Request timeout in seconds.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="ragora.config.settings.DatabaseManagerConfig.retry_attempts">retry_attempts</span></code></td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Automatic retry count for transient failures.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>








              <details class="quote">
                <summary>Source code in <code>ragora/ragora/config/settings.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">DatabaseManagerConfig</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Connection properties for the Weaviate backend.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        url: HTTP endpoint for Weaviate.</span>
<span class="sd">        grpc_port: Optional gRPC port.</span>
<span class="sd">        timeout: Request timeout in seconds.</span>
<span class="sd">        retry_attempts: Automatic retry count for transient failures.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">url</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;http://localhost:8080&quot;</span>
    <span class="n">grpc_port</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">50051</span>
    <span class="n">timeout</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">30</span>
    <span class="n">retry_attempts</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="ragora.config.settings.EmbeddingConfig" class="doc doc-heading">
            <code>EmbeddingConfig</code>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

<a href="#ragora.config.settings.EmbeddingConfig" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">


        <p>Sentence-transformer settings for semantic retrieval.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="ragora.config.settings.EmbeddingConfig.model_name">model_name</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Hugging Face model identifier.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="ragora.config.settings.EmbeddingConfig.device">device</span></code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Explicit torch device string (<code>"cpu"</code>, <code>"cuda"</code>); <code>None</code> auto-selects.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="ragora.config.settings.EmbeddingConfig.max_length">max_length</span></code></td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Maximum tokens per forward pass.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>








              <details class="quote">
                <summary>Source code in <code>ragora/ragora/config/settings.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">EmbeddingConfig</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Sentence-transformer settings for semantic retrieval.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        model_name: Hugging Face model identifier.</span>
<span class="sd">        device: Explicit torch device string (``\&quot;cpu\&quot;``, ``\&quot;cuda\&quot;``); ``None`` auto-selects.</span>
<span class="sd">        max_length: Maximum tokens per forward pass.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">model_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;all-mpnet-base-v2&quot;</span>
    <span class="n">device</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">max_length</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">512</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="ragora.config.settings.KnowledgeBaseManagerConfig" class="doc doc-heading">
            <code>KnowledgeBaseManagerConfig</code>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

<a href="#ragora.config.settings.KnowledgeBaseManagerConfig" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">


        <p>Aggregates all subsystems used by :class:<code>KnowledgeBaseManager</code>.</p>








              <details class="quote">
                <summary>Source code in <code>ragora/ragora/config/settings.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">KnowledgeBaseManagerConfig</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Aggregates all subsystems used by :class:`KnowledgeBaseManager`.&quot;&quot;&quot;</span>

    <span class="n">chunk_config</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ChunkConfig</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">embedding_config</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">EmbeddingConfig</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">database_manager_config</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">DatabaseManagerConfig</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_dict</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">config_dict</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="s2">&quot;KnowledgeBaseManagerConfig&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a configuration from nested dictionaries.</span>

<span class="sd">        Args:</span>
<span class="sd">            config_dict: Dictionary matching the dataclass schema</span>
<span class="sd">                (the keys ``chunk``, ``embedding``, ``database_manager`` are recognised).</span>

<span class="sd">        Returns:</span>
<span class="sd">            KnowledgeBaseManagerConfig: Parsed configuration instance.</span>

<span class="sd">        Examples:</span>
<span class="sd">            ```python</span>
<span class="sd">            cfg = KnowledgeBaseManagerConfig.from_dict(</span>
<span class="sd">                {</span>
<span class="sd">                    &quot;chunk&quot;: {&quot;chunk_size&quot;: 512, &quot;overlap_size&quot;: 64},</span>
<span class="sd">                    &quot;embedding&quot;: {&quot;model_name&quot;: &quot;multi-qa-MiniLM-L6-v2&quot;},</span>
<span class="sd">                }</span>
<span class="sd">            )</span>
<span class="sd">            ```</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span>
            <span class="n">chunk_config</span><span class="o">=</span><span class="p">(</span>
                <span class="n">ChunkConfig</span><span class="p">(</span><span class="o">**</span><span class="n">config_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;chunk&quot;</span><span class="p">,</span> <span class="p">{}))</span>
                <span class="k">if</span> <span class="n">config_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;chunk&quot;</span><span class="p">)</span>
                <span class="k">else</span> <span class="kc">None</span>
            <span class="p">),</span>
            <span class="n">embedding_config</span><span class="o">=</span><span class="p">(</span>
                <span class="n">EmbeddingConfig</span><span class="p">(</span><span class="o">**</span><span class="n">config_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;embedding&quot;</span><span class="p">,</span> <span class="p">{}))</span>
                <span class="k">if</span> <span class="n">config_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;embedding&quot;</span><span class="p">)</span>
                <span class="k">else</span> <span class="kc">None</span>
            <span class="p">),</span>
            <span class="n">database_manager_config</span><span class="o">=</span><span class="p">(</span>
                <span class="n">DatabaseManagerConfig</span><span class="p">(</span><span class="o">**</span><span class="n">config_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;database_manager&quot;</span><span class="p">,</span> <span class="p">{}))</span>
                <span class="k">if</span> <span class="n">config_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;database_manager&quot;</span><span class="p">)</span>
                <span class="k">else</span> <span class="kc">None</span>
            <span class="p">),</span>
        <span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">default</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;KnowledgeBaseManagerConfig&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a configuration with Ragora defaults.</span>

<span class="sd">        Returns:</span>
<span class="sd">            KnowledgeBaseManagerConfig: Configuration using standard values.</span>

<span class="sd">        Examples:</span>
<span class="sd">            ```python</span>
<span class="sd">            cfg = KnowledgeBaseManagerConfig.default()</span>
<span class="sd">            ```</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span>
            <span class="n">chunk_config</span><span class="o">=</span><span class="n">ChunkConfig</span><span class="p">(),</span>
            <span class="n">embedding_config</span><span class="o">=</span><span class="n">EmbeddingConfig</span><span class="p">(),</span>
            <span class="n">database_manager_config</span><span class="o">=</span><span class="n">DatabaseManagerConfig</span><span class="p">(),</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h4 id="ragora.config.settings.KnowledgeBaseManagerConfig.default" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">default</span><span class="p">()</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

<a href="#ragora.config.settings.KnowledgeBaseManagerConfig.default" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Create a configuration with Ragora defaults.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>KnowledgeBaseManagerConfig</code></td>            <td>
                  <code><a class="autorefs autorefs-internal" title="KnowledgeBaseManagerConfig


  
      dataclass
   (ragora.config.settings.KnowledgeBaseManagerConfig)" href="#ragora.config.settings.KnowledgeBaseManagerConfig">KnowledgeBaseManagerConfig</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Configuration using standard values.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><span class="n">cfg</span> <span class="o">=</span> <span class="n">KnowledgeBaseManagerConfig</span><span class="o">.</span><span class="n">default</span><span class="p">()</span>
</code></pre></div>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/config/settings.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">default</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;KnowledgeBaseManagerConfig&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create a configuration with Ragora defaults.</span>

<span class="sd">    Returns:</span>
<span class="sd">        KnowledgeBaseManagerConfig: Configuration using standard values.</span>

<span class="sd">    Examples:</span>
<span class="sd">        ```python</span>
<span class="sd">        cfg = KnowledgeBaseManagerConfig.default()</span>
<span class="sd">        ```</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span>
        <span class="n">chunk_config</span><span class="o">=</span><span class="n">ChunkConfig</span><span class="p">(),</span>
        <span class="n">embedding_config</span><span class="o">=</span><span class="n">EmbeddingConfig</span><span class="p">(),</span>
        <span class="n">database_manager_config</span><span class="o">=</span><span class="n">DatabaseManagerConfig</span><span class="p">(),</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="ragora.config.settings.KnowledgeBaseManagerConfig.from_dict" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">from_dict</span><span class="p">(</span><span class="n">config_dict</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

<a href="#ragora.config.settings.KnowledgeBaseManagerConfig.from_dict" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Create a configuration from nested dictionaries.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>config_dict</code>
            </td>
            <td>
                  <code><span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dictionary matching the dataclass schema
(the keys <code>chunk</code>, <code>embedding</code>, <code>database_manager</code> are recognised).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>KnowledgeBaseManagerConfig</code></td>            <td>
                  <code><a class="autorefs autorefs-internal" title="KnowledgeBaseManagerConfig


  
      dataclass
   (ragora.config.settings.KnowledgeBaseManagerConfig)" href="#ragora.config.settings.KnowledgeBaseManagerConfig">KnowledgeBaseManagerConfig</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Parsed configuration instance.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><span class="n">cfg</span> <span class="o">=</span> <span class="n">KnowledgeBaseManagerConfig</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span>
    <span class="p">{</span>
        <span class="s2">&quot;chunk&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;chunk_size&quot;</span><span class="p">:</span> <span class="mi">512</span><span class="p">,</span> <span class="s2">&quot;overlap_size&quot;</span><span class="p">:</span> <span class="mi">64</span><span class="p">},</span>
        <span class="s2">&quot;embedding&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;model_name&quot;</span><span class="p">:</span> <span class="s2">&quot;multi-qa-MiniLM-L6-v2&quot;</span><span class="p">},</span>
    <span class="p">}</span>
<span class="p">)</span>
</code></pre></div>


            <details class="quote">
              <summary>Source code in <code>ragora/ragora/config/settings.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span>
<span class="normal">93</span>
<span class="normal">94</span>
<span class="normal">95</span>
<span class="normal">96</span>
<span class="normal">97</span>
<span class="normal">98</span>
<span class="normal">99</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">from_dict</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">config_dict</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="s2">&quot;KnowledgeBaseManagerConfig&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create a configuration from nested dictionaries.</span>

<span class="sd">    Args:</span>
<span class="sd">        config_dict: Dictionary matching the dataclass schema</span>
<span class="sd">            (the keys ``chunk``, ``embedding``, ``database_manager`` are recognised).</span>

<span class="sd">    Returns:</span>
<span class="sd">        KnowledgeBaseManagerConfig: Parsed configuration instance.</span>

<span class="sd">    Examples:</span>
<span class="sd">        ```python</span>
<span class="sd">        cfg = KnowledgeBaseManagerConfig.from_dict(</span>
<span class="sd">            {</span>
<span class="sd">                &quot;chunk&quot;: {&quot;chunk_size&quot;: 512, &quot;overlap_size&quot;: 64},</span>
<span class="sd">                &quot;embedding&quot;: {&quot;model_name&quot;: &quot;multi-qa-MiniLM-L6-v2&quot;},</span>
<span class="sd">            }</span>
<span class="sd">        )</span>
<span class="sd">        ```</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span>
        <span class="n">chunk_config</span><span class="o">=</span><span class="p">(</span>
            <span class="n">ChunkConfig</span><span class="p">(</span><span class="o">**</span><span class="n">config_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;chunk&quot;</span><span class="p">,</span> <span class="p">{}))</span>
            <span class="k">if</span> <span class="n">config_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;chunk&quot;</span><span class="p">)</span>
            <span class="k">else</span> <span class="kc">None</span>
        <span class="p">),</span>
        <span class="n">embedding_config</span><span class="o">=</span><span class="p">(</span>
            <span class="n">EmbeddingConfig</span><span class="p">(</span><span class="o">**</span><span class="n">config_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;embedding&quot;</span><span class="p">,</span> <span class="p">{}))</span>
            <span class="k">if</span> <span class="n">config_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;embedding&quot;</span><span class="p">)</span>
            <span class="k">else</span> <span class="kc">None</span>
        <span class="p">),</span>
        <span class="n">database_manager_config</span><span class="o">=</span><span class="p">(</span>
            <span class="n">DatabaseManagerConfig</span><span class="p">(</span><span class="o">**</span><span class="n">config_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;database_manager&quot;</span><span class="p">,</span> <span class="p">{}))</span>
            <span class="k">if</span> <span class="n">config_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;database_manager&quot;</span><span class="p">)</span>
            <span class="k">else</span> <span class="kc">None</span>
        <span class="p">),</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "..", "features": ["navigation.instant", "navigation.tracking", "toc.follow", "search.highlight", "search.share"], "search": "../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.f55a23d4.min.js"></script>
      
    
  </body>
</html>